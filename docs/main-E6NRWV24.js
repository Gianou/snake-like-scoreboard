import{A as db,B as zn,C as Oi,D as vh,E as wu,F as gy,G as hb,H as fb,I as ae,J as En,K as kt,L as my,M as pb,N as Eu,O as ce,P as Gt,Q as wh,R as yy,S as Gn,T as Fi,U as ai,V as ia,W as gb,X as In,Y as pt,a as Q,b as nt,c as hy,d as M,e as rb,f as ph,g as ib,h as sb,i as j,j as na,k as gh,l as ob,m as ab,n as Ut,o as ra,p as vu,q as fy,r as cb,s as Cr,t as py,u as mh,v as yh,w as ub,x as _h,y as Dt,z as lb}from"./chunk-L2ZMDQ4Q.js";var mb=null;var _y=1,yb=Symbol("SIGNAL");function je(n){let e=mb;return mb=n,e}var _b={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function UL(n){if(!(Ey(n)&&!n.dirty)&&!(!n.dirty&&n.lastCleanEpoch===_y)){if(!n.producerMustRecompute(n)&&!vy(n)){n.dirty=!1,n.lastCleanEpoch=_y;return}n.producerRecomputeValue(n),n.dirty=!1,n.lastCleanEpoch=_y}}function vb(n){return n&&(n.nextProducerIndex=0),je(n)}function wb(n,e){if(je(e),!(!n||n.producerNode===void 0||n.producerIndexOfThis===void 0||n.producerLastReadVersion===void 0)){if(Ey(n))for(let t=n.nextProducerIndex;t<n.producerNode.length;t++)wy(n.producerNode[t],n.producerIndexOfThis[t]);for(;n.producerNode.length>n.nextProducerIndex;)n.producerNode.pop(),n.producerLastReadVersion.pop(),n.producerIndexOfThis.pop()}}function vy(n){Eh(n);for(let e=0;e<n.producerNode.length;e++){let t=n.producerNode[e],r=n.producerLastReadVersion[e];if(r!==t.version||(UL(t),r!==t.version))return!0}return!1}function Eb(n){if(Eh(n),Ey(n))for(let e=0;e<n.producerNode.length;e++)wy(n.producerNode[e],n.producerIndexOfThis[e]);n.producerNode.length=n.producerLastReadVersion.length=n.producerIndexOfThis.length=0,n.liveConsumerNode&&(n.liveConsumerNode.length=n.liveConsumerIndexOfThis.length=0)}function wy(n,e){if(jL(n),Eh(n),n.liveConsumerNode.length===1)for(let r=0;r<n.producerNode.length;r++)wy(n.producerNode[r],n.producerIndexOfThis[r]);let t=n.liveConsumerNode.length-1;if(n.liveConsumerNode[e]=n.liveConsumerNode[t],n.liveConsumerIndexOfThis[e]=n.liveConsumerIndexOfThis[t],n.liveConsumerNode.length--,n.liveConsumerIndexOfThis.length--,e<n.liveConsumerNode.length){let r=n.liveConsumerIndexOfThis[e],i=n.liveConsumerNode[e];Eh(i),i.producerIndexOfThis[r]=e}}function Ey(n){return n.consumerIsAlwaysLive||(n?.liveConsumerNode?.length??0)>0}function Eh(n){n.producerNode??=[],n.producerIndexOfThis??=[],n.producerLastReadVersion??=[]}function jL(n){n.liveConsumerNode??=[],n.liveConsumerIndexOfThis??=[]}function BL(){throw new Error}var $L=BL;function Ib(n){$L=n}function de(n){return typeof n=="function"}function sa(n){let t=n(r=>{Error.call(r),r.stack=new Error().stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Ih=sa(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:
${t.map((r,i)=>`${i+1}) ${r.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=t});function js(n,e){if(n){let t=n.indexOf(e);0<=t&&n.splice(t,1)}}var yt=class n{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;let{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(let s of t)s.remove(this);else t.remove(this);let{initialTeardown:r}=this;if(de(r))try{r()}catch(s){e=s instanceof Ih?s.errors:[s]}let{_finalizers:i}=this;if(i){this._finalizers=null;for(let s of i)try{Cb(s)}catch(o){e=e??[],o instanceof Ih?e=[...e,...o.errors]:e.push(o)}}if(e)throw new Ih(e)}}add(e){var t;if(e&&e!==this)if(this.closed)Cb(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}}_hasParent(e){let{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){let{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){let{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&js(t,e)}remove(e){let{_finalizers:t}=this;t&&js(t,e),e instanceof n&&e._removeParent(this)}};yt.EMPTY=(()=>{let n=new yt;return n.closed=!0,n})();var Iy=yt.EMPTY;function Ch(n){return n instanceof yt||n&&"closed"in n&&de(n.remove)&&de(n.add)&&de(n.unsubscribe)}function Cb(n){de(n)?n():n.unsubscribe()}var ar={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var oa={setTimeout(n,e,...t){let{delegate:r}=oa;return r?.setTimeout?r.setTimeout(n,e,...t):setTimeout(n,e,...t)},clearTimeout(n){let{delegate:e}=oa;return(e?.clearTimeout||clearTimeout)(n)},delegate:void 0};function Th(n){oa.setTimeout(()=>{let{onUnhandledError:e}=ar;if(e)e(n);else throw n})}function Bs(){}var Tb=Cy("C",void 0,void 0);function Db(n){return Cy("E",void 0,n)}function bb(n){return Cy("N",n,void 0)}function Cy(n,e,t){return{kind:n,value:e,error:t}}var $s=null;function aa(n){if(ar.useDeprecatedSynchronousErrorHandling){let e=!$s;if(e&&($s={errorThrown:!1,error:null}),n(),e){let{errorThrown:t,error:r}=$s;if($s=null,t)throw r}}else n()}function Sb(n){ar.useDeprecatedSynchronousErrorHandling&&$s&&($s.errorThrown=!0,$s.error=n)}var qs=class extends yt{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,Ch(e)&&e.add(this)):this.destination=zL}static create(e,t,r){return new ci(e,t,r)}next(e){this.isStopped?Dy(bb(e),this):this._next(e)}error(e){this.isStopped?Dy(Db(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?Dy(Tb,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},qL=Function.prototype.bind;function Ty(n,e){return qL.call(n,e)}var by=class{constructor(e){this.partialObserver=e}next(e){let{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(r){Dh(r)}}error(e){let{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(r){Dh(r)}else Dh(e)}complete(){let{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){Dh(t)}}},ci=class extends qs{constructor(e,t,r){super();let i;if(de(e)||!e)i={next:e??void 0,error:t??void 0,complete:r??void 0};else{let s;this&&ar.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=()=>this.unsubscribe(),i={next:e.next&&Ty(e.next,s),error:e.error&&Ty(e.error,s),complete:e.complete&&Ty(e.complete,s)}):i=e}this.destination=new by(i)}};function Dh(n){ar.useDeprecatedSynchronousErrorHandling?Sb(n):Th(n)}function HL(n){throw n}function Dy(n,e){let{onStoppedNotification:t}=ar;t&&oa.setTimeout(()=>t(n,e))}var zL={closed:!0,next:Bs,error:HL,complete:Bs};var ca=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Wt(n){return n}function Sy(...n){return Ay(n)}function Ay(n){return n.length===0?Wt:n.length===1?n[0]:function(t){return n.reduce((r,i)=>i(r),t)}}var ve=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){let r=new n;return r.source=this,r.operator=t,r}subscribe(t,r,i){let s=WL(t)?t:new ci(t,r,i);return aa(()=>{let{operator:o,source:a}=this;s.add(o?o.call(s,a):a?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(t){try{return this._subscribe(t)}catch(r){t.error(r)}}forEach(t,r){return r=Ab(r),new r((i,s)=>{let o=new ci({next:a=>{try{t(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:i});this.subscribe(o)})}_subscribe(t){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(t)}[ca](){return this}pipe(...t){return Ay(t)(this)}toPromise(t){return t=Ab(t),new t((r,i)=>{let s;this.subscribe(o=>s=o,o=>i(o),()=>r(s))})}}return n.create=e=>new n(e),n})();function Ab(n){var e;return(e=n??ar.Promise)!==null&&e!==void 0?e:Promise}function GL(n){return n&&de(n.next)&&de(n.error)&&de(n.complete)}function WL(n){return n&&n instanceof qs||GL(n)&&Ch(n)}function xy(n){return de(n?.lift)}function ue(n){return e=>{if(xy(e))return e.lift(function(t){try{return n(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function he(n,e,t,r,i){return new Ry(n,e,t,r,i)}var Ry=class extends qs{constructor(e,t,r,i,s,o){super(e),this.onFinalize=s,this.shouldUnsubscribe=o,this._next=t?function(a){try{t(a)}catch(c){e.error(c)}}:super._next,this._error=i?function(a){try{i(a)}catch(c){e.error(c)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(a){e.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:t}=this;super.unsubscribe(),!t&&((e=this.onFinalize)===null||e===void 0||e.call(this))}}};function ua(){return ue((n,e)=>{let t=null;n._refCount++;let r=he(e,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount){t=null;return}let i=n._connection,s=t;t=null,i&&(!s||i===s)&&i.unsubscribe(),e.unsubscribe()});n.subscribe(r),r.closed||(t=n.connect())})}var la=class extends ve{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,xy(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){let e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new yt;let t=this.getSubject();e.add(this.source.subscribe(he(t,void 0,()=>{this._teardown(),t.complete()},r=>{this._teardown(),t.error(r)},()=>this._teardown()))),e.closed&&(this._connection=null,e=yt.EMPTY)}return e}refCount(){return ua()(this)}};var xb=sa(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var _t=(()=>{class n extends ve{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){let r=new bh(this,this);return r.operator=t,r}_throwIfClosed(){if(this.closed)throw new xb}next(t){aa(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let r of this.currentObservers)r.next(t)}})}error(t){aa(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;let{observers:r}=this;for(;r.length;)r.shift().error(t)}})}complete(){aa(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){let{hasError:r,isStopped:i,observers:s}=this;return r||i?Iy:(this.currentObservers=null,s.push(t),new yt(()=>{this.currentObservers=null,js(s,t)}))}_checkFinalizedStatuses(t){let{hasError:r,thrownError:i,isStopped:s}=this;r?t.error(i):s&&t.complete()}asObservable(){let t=new ve;return t.source=this,t}}return n.create=(e,t)=>new bh(e,t),n})(),bh=class extends _t{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.next)===null||r===void 0||r.call(t,e)}error(e){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.error)===null||r===void 0||r.call(t,e)}complete(){var e,t;(t=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||t===void 0||t.call(e)}_subscribe(e){var t,r;return(r=(t=this.source)===null||t===void 0?void 0:t.subscribe(e))!==null&&r!==void 0?r:Iy}};var Kt=class extends _t{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){let t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){let{hasError:e,thrownError:t,_value:r}=this;if(e)throw t;return this._throwIfClosed(),r}next(e){super.next(this._value=e)}};var Iu={now(){return(Iu.delegate||Date).now()},delegate:void 0};var Sh=class extends _t{constructor(e=1/0,t=1/0,r=Iu){super(),this._bufferSize=e,this._windowTime=t,this._timestampProvider=r,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,e),this._windowTime=Math.max(1,t)}next(e){let{isStopped:t,_buffer:r,_infiniteTimeWindow:i,_timestampProvider:s,_windowTime:o}=this;t||(r.push(e),!i&&r.push(s.now()+o)),this._trimBuffer(),super.next(e)}_subscribe(e){this._throwIfClosed(),this._trimBuffer();let t=this._innerSubscribe(e),{_infiniteTimeWindow:r,_buffer:i}=this,s=i.slice();for(let o=0;o<s.length&&!e.closed;o+=r?1:2)e.next(s[o]);return this._checkFinalizedStatuses(e),t}_trimBuffer(){let{_bufferSize:e,_timestampProvider:t,_buffer:r,_infiniteTimeWindow:i}=this,s=(i?1:2)*e;if(e<1/0&&s<r.length&&r.splice(0,r.length-s),!i){let o=t.now(),a=0;for(let c=1;c<r.length&&r[c]<=o;c+=2)a=c;a&&r.splice(0,a+1)}}};var Ah=class extends yt{constructor(e,t){super()}schedule(e,t=0){return this}};var Cu={setInterval(n,e,...t){let{delegate:r}=Cu;return r?.setInterval?r.setInterval(n,e,...t):setInterval(n,e,...t)},clearInterval(n){let{delegate:e}=Cu;return(e?.clearInterval||clearInterval)(n)},delegate:void 0};var da=class extends Ah{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){var r;if(this.closed)return this;this.state=e;let i=this.id,s=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(s,i,t)),this.pending=!0,this.delay=t,this.id=(r=this.id)!==null&&r!==void 0?r:this.requestAsyncId(s,this.id,t),this}requestAsyncId(e,t,r=0){return Cu.setInterval(e.flush.bind(e,this),r)}recycleAsyncId(e,t,r=0){if(r!=null&&this.delay===r&&this.pending===!1)return t;t!=null&&Cu.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let r=this._execute(e,t);if(r)return r;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let r=!1,i;try{this.work(e)}catch(s){r=!0,i=s||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),i}unsubscribe(){if(!this.closed){let{id:e,scheduler:t}=this,{actions:r}=t;this.work=this.state=this.scheduler=null,this.pending=!1,js(r,this),e!=null&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}};var ha=class n{constructor(e,t=n.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,r){return new this.schedulerActionCtor(this,e).schedule(r,t)}};ha.now=Iu.now;var fa=class extends ha{constructor(e,t=ha.now){super(e,t),this.actions=[],this._active=!1}flush(e){let{actions:t}=this;if(this._active){t.push(e);return}let r;this._active=!0;do if(r=e.execute(e.state,e.delay))break;while(e=t.shift());if(this._active=!1,r){for(;e=t.shift();)e.unsubscribe();throw r}}};var ui=new fa(da);var xh=class extends da{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}schedule(e,t=0){return t>0?super.schedule(e,t):(this.delay=t,this.state=e,this.scheduler.flush(this),this)}execute(e,t){return t>0||this.closed?super.execute(e,t):this._execute(e,t)}requestAsyncId(e,t,r=0){return r!=null&&r>0||r==null&&this.delay>0?super.requestAsyncId(e,t,r):(e.flush(this),0)}};var Rh=class extends fa{};var My=new Rh(xh);var un=new ve(n=>n.complete());function Rb(n){return n&&de(n.schedule)}function Ny(n){return n[n.length-1]}function Mh(n){return de(Ny(n))?n.pop():void 0}function Tr(n){return Rb(Ny(n))?n.pop():void 0}function Mb(n,e){return typeof Ny(n)=="number"?n.pop():e}var Nh=n=>n&&typeof n.length=="number"&&typeof n!="function";function Ph(n){return de(n?.then)}function kh(n){return de(n[ca])}function Oh(n){return Symbol.asyncIterator&&de(n?.[Symbol.asyncIterator])}function Fh(n){return new TypeError(`You provided ${n!==null&&typeof n=="object"?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function KL(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Lh=KL();function Vh(n){return de(n?.[Lh])}function Uh(n){return ib(this,arguments,function*(){let t=n.getReader();try{for(;;){let{value:r,done:i}=yield ph(t.read());if(i)return yield ph(void 0);yield yield ph(r)}}finally{t.releaseLock()}})}function jh(n){return de(n?.getReader)}function rt(n){if(n instanceof ve)return n;if(n!=null){if(kh(n))return QL(n);if(Nh(n))return YL(n);if(Ph(n))return ZL(n);if(Oh(n))return Nb(n);if(Vh(n))return XL(n);if(jh(n))return JL(n)}throw Fh(n)}function QL(n){return new ve(e=>{let t=n[ca]();if(de(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function YL(n){return new ve(e=>{for(let t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function ZL(n){return new ve(e=>{n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,Th)})}function XL(n){return new ve(e=>{for(let t of n)if(e.next(t),e.closed)return;e.complete()})}function Nb(n){return new ve(e=>{eV(n,e).catch(t=>e.error(t))})}function JL(n){return Nb(Uh(n))}function eV(n,e){var t,r,i,s;return rb(this,void 0,void 0,function*(){try{for(t=sb(n);r=yield t.next(),!r.done;){let o=r.value;if(e.next(o),e.closed)return}}catch(o){i={error:o}}finally{try{r&&!r.done&&(s=t.return)&&(yield s.call(t))}finally{if(i)throw i.error}}e.complete()})}function Cn(n,e,t,r=0,i=!1){let s=e.schedule(function(){t(),i?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(s),!i)return s}function Nn(n,e=0){return ue((t,r)=>{t.subscribe(he(r,i=>Cn(r,n,()=>r.next(i),e),()=>Cn(r,n,()=>r.complete(),e),i=>Cn(r,n,()=>r.error(i),e)))})}function cr(n,e=0){return ue((t,r)=>{r.add(n.schedule(()=>t.subscribe(r),e))})}function Pb(n,e){return rt(n).pipe(cr(e),Nn(e))}function kb(n,e){return rt(n).pipe(cr(e),Nn(e))}function Ob(n,e){return new ve(t=>{let r=0;return e.schedule(function(){r===n.length?t.complete():(t.next(n[r++]),t.closed||this.schedule())})})}function Fb(n,e){return new ve(t=>{let r;return Cn(t,e,()=>{r=n[Lh](),Cn(t,e,()=>{let i,s;try{({value:i,done:s}=r.next())}catch(o){t.error(o);return}s?t.complete():t.next(i)},0,!0)}),()=>de(r?.return)&&r.return()})}function Bh(n,e){if(!n)throw new Error("Iterable cannot be null");return new ve(t=>{Cn(t,e,()=>{let r=n[Symbol.asyncIterator]();Cn(t,e,()=>{r.next().then(i=>{i.done?t.complete():t.next(i.value)})},0,!0)})})}function Lb(n,e){return Bh(Uh(n),e)}function Vb(n,e){if(n!=null){if(kh(n))return Pb(n,e);if(Nh(n))return Ob(n,e);if(Ph(n))return kb(n,e);if(Oh(n))return Bh(n,e);if(Vh(n))return Fb(n,e);if(jh(n))return Lb(n,e)}throw Fh(n)}function xe(n,e){return e?Vb(n,e):rt(n)}function ne(...n){let e=Tr(n);return xe(n,e)}function pa(n,e){let t=de(n)?n:()=>n,r=i=>i.error(t());return new ve(e?i=>e.schedule(r,0,i):r)}function Py(n){return!!n&&(n instanceof ve||de(n.lift)&&de(n.subscribe))}var li=sa(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function ee(n,e){return ue((t,r)=>{let i=0;t.subscribe(he(r,s=>{r.next(n.call(e,s,i++))}))})}var{isArray:tV}=Array;function nV(n,e){return tV(e)?n(...e):n(e)}function Ub(n){return ee(e=>nV(n,e))}var{isArray:rV}=Array,{getPrototypeOf:iV,prototype:sV,keys:oV}=Object;function jb(n){if(n.length===1){let e=n[0];if(rV(e))return{args:e,keys:null};if(aV(e)){let t=oV(e);return{args:t.map(r=>e[r]),keys:t}}}return{args:n,keys:null}}function aV(n){return n&&typeof n=="object"&&iV(n)===sV}function Bb(n,e){return n.reduce((t,r,i)=>(t[r]=e[i],t),{})}function Tu(...n){let e=Tr(n),t=Mh(n),{args:r,keys:i}=jb(n);if(r.length===0)return xe([],e);let s=new ve(cV(r,e,i?o=>Bb(i,o):Wt));return t?s.pipe(Ub(t)):s}function cV(n,e,t=Wt){return r=>{$b(e,()=>{let{length:i}=n,s=new Array(i),o=i,a=i;for(let c=0;c<i;c++)$b(e,()=>{let l=xe(n[c],e),d=!1;l.subscribe(he(r,f=>{s[c]=f,d||(d=!0,a--),a||r.next(t(s.slice()))},()=>{--o||r.complete()}))},r)},r)}}function $b(n,e,t){n?Cn(t,n,e):e()}function qb(n,e,t,r,i,s,o,a){let c=[],l=0,d=0,f=!1,g=()=>{f&&!c.length&&!l&&e.complete()},y=b=>l<r?v(b):c.push(b),v=b=>{s&&e.next(b),l++;let T=!1;rt(t(b,d++)).subscribe(he(e,V=>{i?.(V),s?y(V):e.next(V)},()=>{T=!0},void 0,()=>{if(T)try{for(l--;c.length&&l<r;){let V=c.shift();o?Cn(e,o,()=>v(V)):v(V)}g()}catch(V){e.error(V)}}))};return n.subscribe(he(e,y,()=>{f=!0,g()})),()=>{a?.()}}function bt(n,e,t=1/0){return de(e)?bt((r,i)=>ee((s,o)=>e(r,s,i,o))(rt(n(r,i))),t):(typeof e=="number"&&(t=e),ue((r,i)=>qb(r,i,n,t)))}function Li(n=1/0){return bt(Wt,n)}function Hb(){return Li(1)}function ga(...n){return Hb()(xe(n,Tr(n)))}function $h(n){return new ve(e=>{rt(n()).subscribe(e)})}function ma(...n){let e=Tr(n),t=Mb(n,1/0),r=n;return r.length?r.length===1?rt(r[0]):Li(t)(xe(r,e)):un}function Qt(n,e){return ue((t,r)=>{let i=0;t.subscribe(he(r,s=>n.call(e,s,i++)&&r.next(s)))})}function Vi(n){return ue((e,t)=>{let r=null,i=!1,s;r=e.subscribe(he(t,void 0,void 0,o=>{s=rt(n(o,Vi(n)(e))),r?(r.unsubscribe(),r=null,s.subscribe(t)):i=!0})),i&&(r.unsubscribe(),r=null,s.subscribe(t))})}function zb(n,e,t,r,i){return(s,o)=>{let a=t,c=e,l=0;s.subscribe(he(o,d=>{let f=l++;c=a?n(c,d,f):(a=!0,d),r&&o.next(c)},i&&(()=>{a&&o.next(c),o.complete()})))}}function Hs(n,e){return de(e)?bt(n,e,1):bt(n,1)}function ky(n,e=ui){return ue((t,r)=>{let i=null,s=null,o=null,a=()=>{if(i){i.unsubscribe(),i=null;let l=s;s=null,r.next(l)}};function c(){let l=o+n,d=e.now();if(d<l){i=this.schedule(void 0,l-d),r.add(i);return}a()}t.subscribe(he(r,l=>{s=l,o=e.now(),i||(i=e.schedule(c,n),r.add(i))},()=>{a(),r.complete()},void 0,()=>{s=i=null}))})}function Ui(n){return ue((e,t)=>{let r=!1;e.subscribe(he(t,i=>{r=!0,t.next(i)},()=>{r||t.next(n),t.complete()}))})}function di(n){return n<=0?()=>un:ue((e,t)=>{let r=0;e.subscribe(he(t,i=>{++r<=n&&(t.next(i),n<=r&&t.complete())}))})}function Oy(n){return ee(()=>n)}function Du(n,e=Wt){return n=n??uV,ue((t,r)=>{let i,s=!0;t.subscribe(he(r,o=>{let a=e(o);(s||!n(i,a))&&(s=!1,i=a,r.next(o))}))})}function uV(n,e){return n===e}function qh(n=lV){return ue((e,t)=>{let r=!1;e.subscribe(he(t,i=>{r=!0,t.next(i)},()=>r?t.complete():t.error(n())))})}function lV(){return new li}function bu(n){return ue((e,t)=>{try{e.subscribe(t)}finally{t.add(n)}})}function Wn(n,e){let t=arguments.length>=2;return r=>r.pipe(n?Qt((i,s)=>n(i,s,r)):Wt,di(1),t?Ui(e):qh(()=>new li))}function ya(n){return n<=0?()=>un:ue((e,t)=>{let r=[];e.subscribe(he(t,i=>{r.push(i),n<r.length&&r.shift()},()=>{for(let i of r)t.next(i);t.complete()},void 0,()=>{r=null}))})}function Fy(n,e){let t=arguments.length>=2;return r=>r.pipe(n?Qt((i,s)=>n(i,s,r)):Wt,ya(1),t?Ui(e):qh(()=>new li))}function Su(){return ue((n,e)=>{let t,r=!1;n.subscribe(he(e,i=>{let s=t;t=i,r&&e.next([s,i]),r=!0}))})}function Dr(n,e){return ue(zb(n,e,arguments.length>=2,!0))}function Au(n={}){let{connector:e=()=>new _t,resetOnError:t=!0,resetOnComplete:r=!0,resetOnRefCountZero:i=!0}=n;return s=>{let o,a,c,l=0,d=!1,f=!1,g=()=>{a?.unsubscribe(),a=void 0},y=()=>{g(),o=c=void 0,d=f=!1},v=()=>{let b=o;y(),b?.unsubscribe()};return ue((b,T)=>{l++,!f&&!d&&g();let V=c=c??e();T.add(()=>{l--,l===0&&!f&&!d&&(a=Ly(v,i))}),V.subscribe(T),!o&&l>0&&(o=new ci({next:B=>V.next(B),error:B=>{f=!0,g(),a=Ly(y,t,B),V.error(B)},complete:()=>{d=!0,g(),a=Ly(y,r),V.complete()}}),rt(b).subscribe(o))})(s)}}function Ly(n,e,...t){if(e===!0){n();return}if(e===!1)return;let r=new ci({next:()=>{r.unsubscribe(),n()}});return rt(e(...t)).subscribe(r)}function Hh(n,e,t){let r,i=!1;return n&&typeof n=="object"?{bufferSize:r=1/0,windowTime:e=1/0,refCount:i=!1,scheduler:t}=n:r=n??1/0,Au({connector:()=>new Sh(r,e,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:i})}function Vy(n){return ue((e,t)=>{let r=!1,i=0;e.subscribe(he(t,s=>(r||(r=!n(s,i++)))&&t.next(s)))})}function zs(...n){let e=Tr(n);return ue((t,r)=>{(e?ga(n,t,e):ga(n,t)).subscribe(r)})}function We(n,e){return ue((t,r)=>{let i=null,s=0,o=!1,a=()=>o&&!i&&r.complete();t.subscribe(he(r,c=>{i?.unsubscribe();let l=0,d=s++;rt(n(c,d)).subscribe(i=he(r,f=>r.next(e?e(c,f,d,l++):f),()=>{i=null,a()}))},()=>{o=!0,a()}))})}function zh(n,e){return de(e)?We(()=>n,e):We(()=>n)}function Uy(n){return ue((e,t)=>{rt(n).subscribe(he(t,()=>t.complete(),Bs)),!t.closed&&e.subscribe(t)})}function St(n,e,t){let r=de(n)||e||t?{next:n,error:e,complete:t}:n;return r?ue((i,s)=>{var o;(o=r.subscribe)===null||o===void 0||o.call(r);let a=!0;i.subscribe(he(s,c=>{var l;(l=r.next)===null||l===void 0||l.call(r,c),s.next(c)},()=>{var c;a=!1,(c=r.complete)===null||c===void 0||c.call(r),s.complete()},c=>{var l;a=!1,(l=r.error)===null||l===void 0||l.call(r,c),s.error(c)},()=>{var c,l;a&&((c=r.unsubscribe)===null||c===void 0||c.call(r)),(l=r.finalize)===null||l===void 0||l.call(r)}))}):Wt}function jy(...n){let e=Mh(n);return ue((t,r)=>{let i=n.length,s=new Array(i),o=n.map(()=>!1),a=!1;for(let c=0;c<i;c++)rt(n[c]).subscribe(he(r,l=>{s[c]=l,!a&&!o[c]&&(o[c]=!0,(a=o.every(Wt))&&(o=null))},Bs));t.subscribe(he(r,c=>{if(a){let l=[c,...s];r.next(e?e(...l):l)}}))})}var se=class extends Error{constructor(e,t){super(F_(e,t)),this.code=e}};function F_(n,e){return`${`NG0${Math.abs(n)}`}${e?": "+e:""}`}function Bu(n){return{toString:n}.toString()}var Gh="__parameters__";function dV(n){return function(...t){if(n){let r=n(...t);for(let i in r)this[i]=r[i]}}}function SS(n,e,t){return Bu(()=>{let r=dV(e);function i(...s){if(this instanceof i)return r.apply(this,s),this;let o=new i(...s);return a.annotation=o,a;function a(c,l,d){let f=c.hasOwnProperty(Gh)?c[Gh]:Object.defineProperty(c,Gh,{value:[]})[Gh];for(;f.length<=d;)f.push(null);return(f[d]=f[d]||[]).push(o),c}}return t&&(i.prototype=Object.create(t.prototype)),i.prototype.ngMetadataName=n,i.annotationCls=i,i})}var Pn=globalThis;function Ke(n){for(let e in n)if(n[e]===Ke)return e;throw Error("Could not find renamed property on target object.")}function Dn(n){if(typeof n=="string")return n;if(Array.isArray(n))return"["+n.map(Dn).join(", ")+"]";if(n==null)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;let e=n.toString();if(e==null)return""+e;let t=e.indexOf(`
`);return t===-1?e:e.substring(0,t)}function Gb(n,e){return n==null||n===""?e===null?"":e:e==null||e===""?n:n+" "+e}var hV=Ke({__forward_ref__:Ke});function AS(n){return n.__forward_ref__=AS,n.toString=function(){return Dn(this())},n}function Kn(n){return xS(n)?n():n}function xS(n){return typeof n=="function"&&n.hasOwnProperty(hV)&&n.__forward_ref__===AS}function J(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function vt(n){return{providers:n.providers||[],imports:n.imports||[]}}function Ef(n){return Wb(n,MS)||Wb(n,NS)}function RS(n){return Ef(n)!==null}function Wb(n,e){return n.hasOwnProperty(e)?n[e]:null}function fV(n){let e=n&&(n[MS]||n[NS]);return e||null}function Kb(n){return n&&(n.hasOwnProperty(Qb)||n.hasOwnProperty(pV))?n[Qb]:null}var MS=Ke({\u0275prov:Ke}),Qb=Ke({\u0275inj:Ke}),NS=Ke({ngInjectableDef:Ke}),pV=Ke({ngInjectorDef:Ke}),K=class{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof t=="number"?this.__NG_ELEMENT_ID__=t:t!==void 0&&(this.\u0275prov=J({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function PS(n){return n&&!!n.\u0275providers}var gV=Ke({\u0275cmp:Ke}),mV=Ke({\u0275dir:Ke}),yV=Ke({\u0275pipe:Ke}),_V=Ke({\u0275mod:Ke}),Jh=Ke({\u0275fac:Ke}),xu=Ke({__NG_ELEMENT_ID__:Ke}),Yb=Ke({__NG_ENV_ID__:Ke});function kS(n){return typeof n=="string"?n:n==null?"":String(n)}function vV(n){return typeof n=="function"?n.name||n.toString():typeof n=="object"&&n!=null&&typeof n.type=="function"?n.type.name||n.type.toString():kS(n)}function wV(n,e){let t=e?`. Dependency path: ${e.join(" > ")} > ${n}`:"";throw new se(-200,n)}function L_(n,e){throw new se(-201,!1)}var Te=function(n){return n[n.Default=0]="Default",n[n.Host=1]="Host",n[n.Self=2]="Self",n[n.SkipSelf=4]="SkipSelf",n[n.Optional=8]="Optional",n}(Te||{}),Yy;function OS(){return Yy}function Tn(n){let e=Yy;return Yy=n,e}function FS(n,e,t){let r=Ef(n);if(r&&r.providedIn=="root")return r.value===void 0?r.value=r.factory():r.value;if(t&Te.Optional)return null;if(e!==void 0)return e;L_(n,"Injector")}var EV={},Mu=EV,Zy="__NG_DI_FLAG__",ef="ngTempTokenPath",IV="ngTokenPath",CV=/\n/gm,TV="\u0275",Zb="__source",Ia;function DV(){return Ia}function ji(n){let e=Ia;return Ia=n,e}function bV(n,e=Te.Default){if(Ia===void 0)throw new se(-203,!1);return Ia===null?FS(n,void 0,e):Ia.get(n,e&Te.Optional?null:void 0,e)}function F(n,e=Te.Default){return(OS()||bV)(Kn(n),e)}function G(n,e=Te.Default){return F(n,If(e))}function If(n){return typeof n>"u"||typeof n=="number"?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function Xy(n){let e=[];for(let t=0;t<n.length;t++){let r=Kn(n[t]);if(Array.isArray(r)){if(r.length===0)throw new se(900,!1);let i,s=Te.Default;for(let o=0;o<r.length;o++){let a=r[o],c=SV(a);typeof c=="number"?c===-1?i=a.token:s|=c:i=a}e.push(F(i,s))}else e.push(F(r))}return e}function LS(n,e){return n[Zy]=e,n.prototype[Zy]=e,n}function SV(n){return n[Zy]}function AV(n,e,t,r){let i=n[ef];throw e[Zb]&&i.unshift(e[Zb]),n.message=xV(`
`+n.message,i,t,r),n[IV]=i,n[ef]=null,n}function xV(n,e,t,r=null){n=n&&n.charAt(0)===`
`&&n.charAt(1)==TV?n.slice(2):n;let i=Dn(e);if(Array.isArray(e))i=e.map(Dn).join(" -> ");else if(typeof e=="object"){let s=[];for(let o in e)if(e.hasOwnProperty(o)){let a=e[o];s.push(o+":"+(typeof a=="string"?JSON.stringify(a):Dn(a)))}i=`{${s.join(", ")}}`}return`${t}${r?"("+r+")":""}[${i}]: ${n.replace(CV,`
  `)}`}var eo=LS(SS("Optional"),8);var Cf=LS(SS("SkipSelf"),4);function Ks(n,e){let t=n.hasOwnProperty(Jh);return t?n[Jh]:null}function V_(n,e){n.forEach(t=>Array.isArray(t)?V_(t,e):e(t))}function VS(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function tf(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}var Nu={},br=[],Ta=new K(""),US=new K("",-1),jS=new K(""),nf=class{get(e,t=Mu){if(t===Mu){let r=new Error(`NullInjectorError: No provider for ${Dn(e)}!`);throw r.name="NullInjectorError",r}return t}},BS=function(n){return n[n.OnPush=0]="OnPush",n[n.Default=1]="Default",n}(BS||{}),Ar=function(n){return n[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",n}(Ar||{}),qi=function(n){return n[n.None=0]="None",n[n.SignalBased=1]="SignalBased",n[n.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",n}(qi||{});function RV(n,e,t){let r=n.length;for(;;){let i=n.indexOf(e,t);if(i===-1)return i;if(i===0||n.charCodeAt(i-1)<=32){let s=e.length;if(i+s===r||n.charCodeAt(i+s)<=32)return i}t=i+1}}function Jy(n,e,t){let r=0;for(;r<t.length;){let i=t[r];if(typeof i=="number"){if(i!==0)break;r++;let s=t[r++],o=t[r++],a=t[r++];n.setAttribute(e,o,a,s)}else{let s=i,o=t[++r];NV(s)?n.setProperty(e,s,o):n.setAttribute(e,s,o),r++}}return r}function MV(n){return n===3||n===4||n===6}function NV(n){return n.charCodeAt(0)===64}function U_(n,e){if(!(e===null||e.length===0))if(n===null||n.length===0)n=e.slice();else{let t=-1;for(let r=0;r<e.length;r++){let i=e[r];typeof i=="number"?t=i:t===0||(t===-1||t===2?Xb(n,t,i,null,e[++r]):Xb(n,t,i,null,null))}}return n}function Xb(n,e,t,r,i){let s=0,o=n.length;if(e===-1)o=-1;else for(;s<n.length;){let a=n[s++];if(typeof a=="number"){if(a===e){o=-1;break}else if(a>e){o=s-1;break}}}for(;s<n.length;){let a=n[s];if(typeof a=="number")break;if(a===t){if(r===null){i!==null&&(n[s+1]=i);return}else if(r===n[s+1]){n[s+2]=i;return}}s++,r!==null&&s++,i!==null&&s++}o!==-1&&(n.splice(o,0,e),s=o+1),n.splice(s++,0,t),r!==null&&n.splice(s++,0,r),i!==null&&n.splice(s++,0,i)}var $S="ng-template";function PV(n,e,t,r){let i=0;if(r){for(;i<e.length&&typeof e[i]=="string";i+=2)if(e[i]==="class"&&RV(e[i+1].toLowerCase(),t,0)!==-1)return!0}else if(j_(n))return!1;if(i=e.indexOf(1,i),i>-1){let s;for(;++i<e.length&&typeof(s=e[i])=="string";)if(s.toLowerCase()===t)return!0}return!1}function j_(n){return n.type===4&&n.value!==$S}function kV(n,e,t){let r=n.type===4&&!t?$S:n.value;return e===r}function OV(n,e,t){let r=4,i=n.attrs,s=i!==null?VV(i):0,o=!1;for(let a=0;a<e.length;a++){let c=e[a];if(typeof c=="number"){if(!o&&!ur(r)&&!ur(c))return!1;if(o&&ur(c))continue;o=!1,r=c|r&1;continue}if(!o)if(r&4){if(r=2|r&1,c!==""&&!kV(n,c,t)||c===""&&e.length===1){if(ur(r))return!1;o=!0}}else if(r&8){if(i===null||!PV(n,i,c,t)){if(ur(r))return!1;o=!0}}else{let l=e[++a],d=FV(c,i,j_(n),t);if(d===-1){if(ur(r))return!1;o=!0;continue}if(l!==""){let f;if(d>s?f="":f=i[d+1].toLowerCase(),r&2&&l!==f){if(ur(r))return!1;o=!0}}}}return ur(r)||o}function ur(n){return(n&1)===0}function FV(n,e,t,r){if(e===null)return-1;let i=0;if(r||!t){let s=!1;for(;i<e.length;){let o=e[i];if(o===n)return i;if(o===3||o===6)s=!0;else if(o===1||o===2){let a=e[++i];for(;typeof a=="string";)a=e[++i];continue}else{if(o===4)break;if(o===0){i+=4;continue}}i+=s?1:2}return-1}else return UV(e,n)}function LV(n,e,t=!1){for(let r=0;r<e.length;r++)if(OV(n,e[r],t))return!0;return!1}function VV(n){for(let e=0;e<n.length;e++){let t=n[e];if(MV(t))return e}return n.length}function UV(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){let r=n[t];if(typeof r=="number")return-1;if(r===e)return t;t++}return-1}function Jb(n,e){return n?":not("+e.trim()+")":e}function jV(n){let e=n[0],t=1,r=2,i="",s=!1;for(;t<n.length;){let o=n[t];if(typeof o=="string")if(r&2){let a=n[++t];i+="["+o+(a.length>0?'="'+a+'"':"")+"]"}else r&8?i+="."+o:r&4&&(i+=" "+o);else i!==""&&!ur(o)&&(e+=Jb(s,i),i=""),r=o,s=s||!ur(r);t++}return i!==""&&(e+=Jb(s,i)),e}function BV(n){return n.map(jV).join(",")}function $V(n){let e=[],t=[],r=1,i=2;for(;r<n.length;){let s=n[r];if(typeof s=="string")i===2?s!==""&&e.push(s,n[++r]):i===8&&t.push(s);else{if(!ur(i))break;i=s}r++}return{attrs:e,classes:t}}function Yn(n){return Bu(()=>{let e=WS(n),t=nt(Q({},e),{decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===BS.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&n.dependencies||null,getStandaloneInjector:null,signals:n.signals??!1,data:n.data||{},encapsulation:n.encapsulation||Ar.Emulated,styles:n.styles||br,_:null,schemas:n.schemas||null,tView:null,id:""});KS(t);let r=n.dependencies;return t.directiveDefs=tS(r,!1),t.pipeDefs=tS(r,!0),t.id=zV(t),t})}function qV(n){return Hi(n)||qS(n)}function HV(n){return n!==null}function wt(n){return Bu(()=>({type:n.type,bootstrap:n.bootstrap||br,declarations:n.declarations||br,imports:n.imports||br,exports:n.exports||br,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function eS(n,e){if(n==null)return Nu;let t={};for(let r in n)if(n.hasOwnProperty(r)){let i=n[r],s,o,a=qi.None;Array.isArray(i)?(a=i[0],s=i[1],o=i[2]??s):(s=i,o=i),e?(t[s]=a!==qi.None?[r,a]:r,e[s]=o):t[s]=r}return t}function Aa(n){return Bu(()=>{let e=WS(n);return KS(e),e})}function B_(n){return{type:n.type,name:n.name,factory:null,pure:n.pure!==!1,standalone:n.standalone===!0,onDestroy:n.type.prototype.ngOnDestroy||null}}function Hi(n){return n[gV]||null}function qS(n){return n[mV]||null}function HS(n){return n[yV]||null}function zS(n){let e=Hi(n)||qS(n)||HS(n);return e!==null?e.standalone:!1}function GS(n,e){let t=n[_V]||null;if(!t&&e===!0)throw new Error(`Type ${Dn(n)} does not have '\u0275mod' property.`);return t}function WS(n){let e={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:e,inputTransforms:null,inputConfig:n.inputs||Nu,exportAs:n.exportAs||null,standalone:n.standalone===!0,signals:n.signals===!0,selectors:n.selectors||br,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:eS(n.inputs,e),outputs:eS(n.outputs),debugInfo:null}}function KS(n){n.features?.forEach(e=>e(n))}function tS(n,e){if(!n)return null;let t=e?HS:qV;return()=>(typeof n=="function"?n():n).map(r=>t(r)).filter(HV)}function zV(n){let e=0,t=[n.selectors,n.ngContentSelectors,n.hostVars,n.hostAttrs,n.consts,n.vars,n.decls,n.encapsulation,n.standalone,n.signals,n.exportAs,JSON.stringify(n.inputs),JSON.stringify(n.outputs),Object.getOwnPropertyNames(n.type.prototype),!!n.contentQueries,!!n.viewQuery].join("|");for(let i of t)e=Math.imul(31,e)+i.charCodeAt(0)<<0;return e+=2147483648,"c"+e}function GV(...n){return{\u0275providers:QS(!0,n),\u0275fromNgModule:!0}}function QS(n,...e){let t=[],r=new Set,i,s=o=>{t.push(o)};return V_(e,o=>{let a=o;e_(a,s,[],r)&&(i||=[],i.push(a))}),i!==void 0&&YS(i,s),t}function YS(n,e){for(let t=0;t<n.length;t++){let{ngModule:r,providers:i}=n[t];$_(i,s=>{e(s,r)})}}function e_(n,e,t,r){if(n=Kn(n),!n)return!1;let i=null,s=Kb(n),o=!s&&Hi(n);if(!s&&!o){let c=n.ngModule;if(s=Kb(c),s)i=c;else return!1}else{if(o&&!o.standalone)return!1;i=n}let a=r.has(i);if(o){if(a)return!1;if(r.add(i),o.dependencies){let c=typeof o.dependencies=="function"?o.dependencies():o.dependencies;for(let l of c)e_(l,e,t,r)}}else if(s){if(s.imports!=null&&!a){r.add(i);let l;try{V_(s.imports,d=>{e_(d,e,t,r)&&(l||=[],l.push(d))})}finally{}l!==void 0&&YS(l,e)}if(!a){let l=Ks(i)||(()=>new i);e({provide:i,useFactory:l,deps:br},i),e({provide:jS,useValue:i,multi:!0},i),e({provide:Ta,useValue:()=>F(i),multi:!0},i)}let c=s.providers;if(c!=null&&!a){let l=n;$_(c,d=>{e(d,l)})}}else return!1;return i!==n&&n.providers!==void 0}function $_(n,e){for(let t of n)PS(t)&&(t=t.\u0275providers),Array.isArray(t)?$_(t,e):e(t)}var WV=Ke({provide:String,useValue:Ke});function ZS(n){return n!==null&&typeof n=="object"&&WV in n}function KV(n){return!!(n&&n.useExisting)}function QV(n){return!!(n&&n.useFactory)}function t_(n){return typeof n=="function"}var Tf=new K(""),Kh={},YV={},By;function q_(){return By===void 0&&(By=new nf),By}var bn=class{},Pu=class extends bn{get destroyed(){return this._destroyed}constructor(e,t,r,i){super(),this.parent=t,this.source=r,this.scopes=i,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,r_(e,o=>this.processProvider(o)),this.records.set(US,_a(void 0,this)),i.has("environment")&&this.records.set(bn,_a(void 0,this));let s=this.records.get(Tf);s!=null&&typeof s.value=="string"&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(jS,br,Te.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let e=je(null);try{for(let r of this._ngOnDestroyHooks)r.ngOnDestroy();let t=this._onDestroyHooks;this._onDestroyHooks=[];for(let r of t)r()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),je(e)}}onDestroy(e){return this.assertNotDestroyed(),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){this.assertNotDestroyed();let t=ji(this),r=Tn(void 0),i;try{return e()}finally{ji(t),Tn(r)}}get(e,t=Mu,r=Te.Default){if(this.assertNotDestroyed(),e.hasOwnProperty(Yb))return e[Yb](this);r=If(r);let i,s=ji(this),o=Tn(void 0);try{if(!(r&Te.SkipSelf)){let c=this.records.get(e);if(c===void 0){let l=n2(e)&&Ef(e);l&&this.injectableDefInScope(l)?c=_a(n_(e),Kh):c=null,this.records.set(e,c)}if(c!=null)return this.hydrate(e,c)}let a=r&Te.Self?q_():this.parent;return t=r&Te.Optional&&t===Mu?null:t,a.get(e,t)}catch(a){if(a.name==="NullInjectorError"){if((a[ef]=a[ef]||[]).unshift(Dn(e)),s)throw a;return AV(a,e,"R3InjectorError",this.source)}else throw a}finally{Tn(o),ji(s)}}resolveInjectorInitializers(){let e=je(null),t=ji(this),r=Tn(void 0),i;try{let s=this.get(Ta,br,Te.Self);for(let o of s)o()}finally{ji(t),Tn(r),je(e)}}toString(){let e=[],t=this.records;for(let r of t.keys())e.push(Dn(r));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new se(205,!1)}processProvider(e){e=Kn(e);let t=t_(e)?e:Kn(e&&e.provide),r=XV(e);if(!t_(e)&&e.multi===!0){let i=this.records.get(t);i||(i=_a(void 0,Kh,!0),i.factory=()=>Xy(i.multi),this.records.set(t,i)),t=e,i.multi.push(e)}this.records.set(t,r)}hydrate(e,t){let r=je(null);try{return t.value===Kh&&(t.value=YV,t.value=t.factory()),typeof t.value=="object"&&t.value&&t2(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}finally{je(r)}}injectableDefInScope(e){if(!e.providedIn)return!1;let t=Kn(e.providedIn);return typeof t=="string"?t==="any"||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(e){let t=this._onDestroyHooks.indexOf(e);t!==-1&&this._onDestroyHooks.splice(t,1)}};function n_(n){let e=Ef(n),t=e!==null?e.factory:Ks(n);if(t!==null)return t;if(n instanceof K)throw new se(204,!1);if(n instanceof Function)return ZV(n);throw new se(204,!1)}function ZV(n){if(n.length>0)throw new se(204,!1);let t=fV(n);return t!==null?()=>t.factory(n):()=>new n}function XV(n){if(ZS(n))return _a(void 0,n.useValue);{let e=JV(n);return _a(e,Kh)}}function JV(n,e,t){let r;if(t_(n)){let i=Kn(n);return Ks(i)||n_(i)}else if(ZS(n))r=()=>Kn(n.useValue);else if(QV(n))r=()=>n.useFactory(...Xy(n.deps||[]));else if(KV(n))r=()=>F(Kn(n.useExisting));else{let i=Kn(n&&(n.useClass||n.provide));if(e2(n))r=()=>new i(...Xy(n.deps));else return Ks(i)||n_(i)}return r}function _a(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function e2(n){return!!n.deps}function t2(n){return n!==null&&typeof n=="object"&&typeof n.ngOnDestroy=="function"}function n2(n){return typeof n=="function"||typeof n=="object"&&n instanceof K}function r_(n,e){for(let t of n)Array.isArray(t)?r_(t,e):t&&PS(t)?r_(t.\u0275providers,e):e(t)}function pi(n,e){n instanceof Pu&&n.assertNotDestroyed();let t,r=ji(n),i=Tn(void 0);try{return e()}finally{ji(r),Tn(i)}}function XS(){return OS()!==void 0||DV()!=null}function r2(n){if(!XS())throw new se(-203,!1)}function i2(n){let e=Pn.ng;if(e&&e.\u0275compilerFacade)return e.\u0275compilerFacade;throw new Error("JIT compiler unavailable")}function s2(n){return typeof n=="function"}var gi=0,Ne=1,le=2,en=3,lr=4,hr=5,rf=6,nS=7,hi=8,Da=9,xr=10,Sn=11,ku=12,rS=13,xa=14,Rr=15,Df=16,va=17,ba=18,bf=19,JS=20,$i=21,$y=22,Qs=23,dr=25,eA=1;var Ys=7,sf=8,of=9,Qn=10,H_=function(n){return n[n.None=0]="None",n[n.HasTransplantedViews=2]="HasTransplantedViews",n}(H_||{});function Gs(n){return Array.isArray(n)&&typeof n[eA]=="object"}function mi(n){return Array.isArray(n)&&n[eA]===!0}function tA(n){return(n.flags&4)!==0}function Sf(n){return n.componentOffset>-1}function nA(n){return(n.flags&1)===1}function $u(n){return!!n.template}function o2(n){return(n[le]&512)!==0}var i_=class{constructor(e,t,r){this.previousValue=e,this.currentValue=t,this.firstChange=r}isFirstChange(){return this.firstChange}};function rA(n,e,t,r){e!==null?e.applyValueToInputSignal(e,r):n[t]=r}function Af(){return iA}function iA(n){return n.type.prototype.ngOnChanges&&(n.setInput=c2),a2}Af.ngInherit=!0;function a2(){let n=oA(this),e=n?.current;if(e){let t=n.previous;if(t===Nu)n.previous=e;else for(let r in e)t[r]=e[r];n.current=null,this.ngOnChanges(e)}}function c2(n,e,t,r,i){let s=this.declaredInputs[r],o=oA(n)||u2(n,{previous:Nu,current:null}),a=o.current||(o.current={}),c=o.previous,l=c[s];a[s]=new i_(l&&l.currentValue,t,c===Nu),rA(n,e,i,t)}var sA="__ngSimpleChanges__";function oA(n){return n[sA]||null}function u2(n,e){return n[sA]=e}var iS=null;var Bi=function(n,e,t){iS?.(n,e,t)},l2="svg",d2="math",h2=!1;function f2(){return h2}function fi(n){for(;Array.isArray(n);)n=n[gi];return n}function p2(n,e){return fi(e[n])}function Nr(n,e){return fi(e[n.index])}function aA(n,e){return n.data[e]}function cA(n,e){return n[e]}function to(n,e){let t=e[n];return Gs(t)?t:t[gi]}function z_(n){return(n[le]&128)===128}function g2(n){return mi(n[en])}function af(n,e){return e==null?null:n[e]}function uA(n){n[va]=0}function m2(n){n[le]&1024||(n[le]|=1024,z_(n)&&Ou(n))}function y2(n,e){for(;n>0;)e=e[xa],n--;return e}function G_(n){return!!(n[le]&9216||n[Qs]?.dirty)}function s_(n){n[xr].changeDetectionScheduler?.notify(1),G_(n)?Ou(n):n[le]&64&&(f2()?(n[le]|=1024,Ou(n)):n[xr].changeDetectionScheduler?.notify())}function Ou(n){n[xr].changeDetectionScheduler?.notify();let e=Fu(n);for(;e!==null&&!(e[le]&8192||(e[le]|=8192,!z_(e)));)e=Fu(e)}function lA(n,e){if((n[le]&256)===256)throw new se(911,!1);n[$i]===null&&(n[$i]=[]),n[$i].push(e)}function _2(n,e){if(n[$i]===null)return;let t=n[$i].indexOf(e);t!==-1&&n[$i].splice(t,1)}function Fu(n){let e=n[en];return mi(e)?e[en]:e}var Pe={lFrame:vA(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function v2(){return Pe.lFrame.elementDepthCount}function w2(){Pe.lFrame.elementDepthCount++}function E2(){Pe.lFrame.elementDepthCount--}function dA(){return Pe.bindingsEnabled}function I2(){return Pe.skipHydrationRootTNode!==null}function C2(n){return Pe.skipHydrationRootTNode===n}function T2(){Pe.skipHydrationRootTNode=null}function At(){return Pe.lFrame.lView}function no(){return Pe.lFrame.tView}function Pr(){let n=hA();for(;n!==null&&n.type===64;)n=n.parent;return n}function hA(){return Pe.lFrame.currentTNode}function D2(){let n=Pe.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}function qu(n,e){let t=Pe.lFrame;t.currentTNode=n,t.isParent=e}function fA(){return Pe.lFrame.isParent}function b2(){Pe.lFrame.isParent=!1}function S2(){return Pe.lFrame.contextLView}function pA(){let n=Pe.lFrame,e=n.bindingRootIndex;return e===-1&&(e=n.bindingRootIndex=n.tView.bindingStartIndex),e}function A2(n){return Pe.lFrame.bindingIndex=n}function gA(){return Pe.lFrame.bindingIndex++}function x2(){return Pe.lFrame.inI18n}function R2(n,e){let t=Pe.lFrame;t.bindingIndex=t.bindingRootIndex=n,o_(e)}function M2(){return Pe.lFrame.currentDirectiveIndex}function o_(n){Pe.lFrame.currentDirectiveIndex=n}function mA(n){Pe.lFrame.currentQueryIndex=n}function N2(n){let e=n[Ne];return e.type===2?e.declTNode:e.type===1?n[hr]:null}function yA(n,e,t){if(t&Te.SkipSelf){let i=e,s=n;for(;i=i.parent,i===null&&!(t&Te.Host);)if(i=N2(s),i===null||(s=s[xa],i.type&10))break;if(i===null)return!1;e=i,n=s}let r=Pe.lFrame=_A();return r.currentTNode=e,r.lView=n,!0}function W_(n){let e=_A(),t=n[Ne];Pe.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function _A(){let n=Pe.lFrame,e=n===null?null:n.child;return e===null?vA(n):e}function vA(n){let e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return n!==null&&(n.child=e),e}function wA(){let n=Pe.lFrame;return Pe.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}var EA=wA;function K_(){let n=wA();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function P2(n){return(Pe.lFrame.contextLView=y2(n,Pe.lFrame.contextLView))[hi]}function Q_(){return Pe.lFrame.selectedIndex}function Zs(n){Pe.lFrame.selectedIndex=n}function k2(){let n=Pe.lFrame;return aA(n.tView,n.selectedIndex)}function O2(){return Pe.lFrame.currentNamespace}var IA=!0;function Y_(){return IA}function Z_(n){IA=n}function F2(n,e,t){let{ngOnChanges:r,ngOnInit:i,ngDoCheck:s}=e.type.prototype;if(r){let o=iA(e);(t.preOrderHooks??=[]).push(n,o),(t.preOrderCheckHooks??=[]).push(n,o)}i&&(t.preOrderHooks??=[]).push(0-n,i),s&&((t.preOrderHooks??=[]).push(n,s),(t.preOrderCheckHooks??=[]).push(n,s))}function X_(n,e){for(let t=e.directiveStart,r=e.directiveEnd;t<r;t++){let s=n.data[t].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:a,ngAfterViewInit:c,ngAfterViewChecked:l,ngOnDestroy:d}=s;o&&(n.contentHooks??=[]).push(-t,o),a&&((n.contentHooks??=[]).push(t,a),(n.contentCheckHooks??=[]).push(t,a)),c&&(n.viewHooks??=[]).push(-t,c),l&&((n.viewHooks??=[]).push(t,l),(n.viewCheckHooks??=[]).push(t,l)),d!=null&&(n.destroyHooks??=[]).push(t,d)}}function Qh(n,e,t){CA(n,e,3,t)}function Yh(n,e,t,r){(n[le]&3)===t&&CA(n,e,t,r)}function qy(n,e){let t=n[le];(t&3)===e&&(t&=16383,t+=1,n[le]=t)}function CA(n,e,t,r){let i=r!==void 0?n[va]&65535:0,s=r??-1,o=e.length-1,a=0;for(let c=i;c<o;c++)if(typeof e[c+1]=="number"){if(a=e[c],r!=null&&a>=r)break}else e[c]<0&&(n[va]+=65536),(a<s||s==-1)&&(L2(n,t,e,c),n[va]=(n[va]&4294901760)+c+2),c++}function sS(n,e){Bi(4,n,e);let t=je(null);try{e.call(n)}finally{je(t),Bi(5,n,e)}}function L2(n,e,t,r){let i=t[r]<0,s=t[r+1],o=i?-t[r]:t[r],a=n[o];i?n[le]>>14<n[va]>>16&&(n[le]&3)===e&&(n[le]+=16384,sS(a,s)):sS(a,s)}var Ca=-1,Lu=class{constructor(e,t,r){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=r}};function V2(n){return n instanceof Lu}function U2(n){return(n.flags&8)!==0}function j2(n){return(n.flags&16)!==0}function TA(n){return n!==Ca}function cf(n){return n&32767}function B2(n){return n>>16}function uf(n,e){let t=B2(n),r=e;for(;t>0;)r=r[xa],t--;return r}var a_=!0;function lf(n){let e=a_;return a_=n,e}var $2=256,DA=$2-1,bA=5,q2=0,Sr={};function H2(n,e,t){let r;typeof t=="string"?r=t.charCodeAt(0)||0:t.hasOwnProperty(xu)&&(r=t[xu]),r==null&&(r=t[xu]=q2++);let i=r&DA,s=1<<i;e.data[n+(i>>bA)]|=s}function SA(n,e){let t=AA(n,e);if(t!==-1)return t;let r=e[Ne];r.firstCreatePass&&(n.injectorIndex=e.length,Hy(r.data,n),Hy(e,null),Hy(r.blueprint,null));let i=J_(n,e),s=n.injectorIndex;if(TA(i)){let o=cf(i),a=uf(i,e),c=a[Ne].data;for(let l=0;l<8;l++)e[s+l]=a[o+l]|c[o+l]}return e[s+8]=i,s}function Hy(n,e){n.push(0,0,0,0,0,0,0,0,e)}function AA(n,e){return n.injectorIndex===-1||n.parent&&n.parent.injectorIndex===n.injectorIndex||e[n.injectorIndex+8]===null?-1:n.injectorIndex}function J_(n,e){if(n.parent&&n.parent.injectorIndex!==-1)return n.parent.injectorIndex;let t=0,r=null,i=e;for(;i!==null;){if(r=PA(i),r===null)return Ca;if(t++,i=i[xa],r.injectorIndex!==-1)return r.injectorIndex|t<<16}return Ca}function z2(n,e,t){H2(n,e,t)}function xA(n,e,t){if(t&Te.Optional||n!==void 0)return n;L_(e,"NodeInjector")}function RA(n,e,t,r){if(t&Te.Optional&&r===void 0&&(r=null),!(t&(Te.Self|Te.Host))){let i=n[Da],s=Tn(void 0);try{return i?i.get(e,r,t&Te.Optional):FS(e,r,t&Te.Optional)}finally{Tn(s)}}return xA(r,e,t)}function MA(n,e,t,r=Te.Default,i){if(n!==null){if(e[le]&2048&&!(r&Te.Self)){let o=Y2(n,e,t,r,Sr);if(o!==Sr)return o}let s=NA(n,e,t,r,Sr);if(s!==Sr)return s}return RA(e,t,r,i)}function NA(n,e,t,r,i){let s=K2(t);if(typeof s=="function"){if(!yA(e,n,r))return r&Te.Host?xA(i,t,r):RA(e,t,r,i);try{let o;if(o=s(r),o==null&&!(r&Te.Optional))L_(t);else return o}finally{EA()}}else if(typeof s=="number"){let o=null,a=AA(n,e),c=Ca,l=r&Te.Host?e[Rr][hr]:null;for((a===-1||r&Te.SkipSelf)&&(c=a===-1?J_(n,e):e[a+8],c===Ca||!aS(r,!1)?a=-1:(o=e[Ne],a=cf(c),e=uf(c,e)));a!==-1;){let d=e[Ne];if(oS(s,a,d.data)){let f=G2(a,e,t,o,r,l);if(f!==Sr)return f}c=e[a+8],c!==Ca&&aS(r,e[Ne].data[a+8]===l)&&oS(s,a,e)?(o=d,a=cf(c),e=uf(c,e)):a=-1}}return i}function G2(n,e,t,r,i,s){let o=e[Ne],a=o.data[n+8],c=r==null?Sf(a)&&a_:r!=o&&(a.type&3)!==0,l=i&Te.Host&&s===a,d=W2(a,o,t,c,l);return d!==null?Vu(e,o,d,a):Sr}function W2(n,e,t,r,i){let s=n.providerIndexes,o=e.data,a=s&1048575,c=n.directiveStart,l=n.directiveEnd,d=s>>20,f=r?a:a+d,g=i?a+d:l;for(let y=f;y<g;y++){let v=o[y];if(y<c&&t===v||y>=c&&v.type===t)return y}if(i){let y=o[c];if(y&&$u(y)&&y.type===t)return c}return null}function Vu(n,e,t,r){let i=n[t],s=e.data;if(V2(i)){let o=i;o.resolving&&wV(vV(s[t]));let a=lf(o.canSeeViewProviders);o.resolving=!0;let c,l=o.injectImpl?Tn(o.injectImpl):null,d=yA(n,r,Te.Default);try{i=n[t]=o.factory(void 0,s,n,r),e.firstCreatePass&&t>=r.directiveStart&&F2(t,s[t],e)}finally{l!==null&&Tn(l),lf(a),o.resolving=!1,EA()}}return i}function K2(n){if(typeof n=="string")return n.charCodeAt(0)||0;let e=n.hasOwnProperty(xu)?n[xu]:void 0;return typeof e=="number"?e>=0?e&DA:Q2:e}function oS(n,e,t){let r=1<<n;return!!(t[e+(n>>bA)]&r)}function aS(n,e){return!(n&Te.Self)&&!(n&Te.Host&&e)}var Ws=class{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,r){return MA(this._tNode,this._lView,e,If(r),t)}};function Q2(){return new Ws(Pr(),At())}function ev(n){return Bu(()=>{let e=n.prototype.constructor,t=e[Jh]||c_(e),r=Object.prototype,i=Object.getPrototypeOf(n.prototype).constructor;for(;i&&i!==r;){let s=i[Jh]||c_(i);if(s&&s!==t)return s;i=Object.getPrototypeOf(i)}return s=>new s})}function c_(n){return xS(n)?()=>{let e=c_(Kn(n));return e&&e()}:Ks(n)}function Y2(n,e,t,r,i){let s=n,o=e;for(;s!==null&&o!==null&&o[le]&2048&&!(o[le]&512);){let a=NA(s,o,t,r|Te.Self,Sr);if(a!==Sr)return a;let c=s.parent;if(!c){let l=o[JS];if(l){let d=l.get(t,Sr,r);if(d!==Sr)return d}c=PA(o),o=o[xa]}s=c}return i}function PA(n){let e=n[Ne],t=e.type;return t===2?e.declTNode:t===1?n[hr]:null}function cS(n,e=null,t=null,r){let i=kA(n,e,t,r);return i.resolveInjectorInitializers(),i}function kA(n,e=null,t=null,r,i=new Set){let s=[t||br,GV(n)];return r=r||(typeof n=="object"?void 0:Dn(n)),new Pu(s,e||q_(),r||null,i)}var kr=(()=>{let e=class e{static create(r,i){if(Array.isArray(r))return cS({name:""},i,r,"");{let s=r.name??"";return cS({name:s},r.parent,r.providers,s)}}};e.THROW_IF_NOT_FOUND=Mu,e.NULL=new nf,e.\u0275prov=J({token:e,providedIn:"any",factory:()=>F(US)}),e.__NG_ELEMENT_ID__=-1;let n=e;return n})();var Z2="ngOriginalError";function zy(n){return n[Z2]}var Mr=class{constructor(){this._console=console}handleError(e){let t=this._findOriginalError(e);this._console.error("ERROR",e),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(e){let t=e&&zy(e);for(;t&&zy(t);)t=zy(t);return t||null}},OA=new K("",{providedIn:"root",factory:()=>G(Mr).handleError.bind(void 0)}),tv=(()=>{let e=class e{};e.__NG_ELEMENT_ID__=X2,e.__NG_ENV_ID__=r=>r;let n=e;return n})(),u_=class extends tv{constructor(e){super(),this._lView=e}onDestroy(e){return lA(this._lView,e),()=>_2(this._lView,e)}};function X2(){return new u_(At())}function J2(){return xf(Pr(),At())}function xf(n,e){return new Hu(Nr(n,e))}var Hu=(()=>{let e=class e{constructor(r){this.nativeElement=r}};e.__NG_ELEMENT_ID__=J2;let n=e;return n})();var l_=class extends _t{constructor(e=!1){super(),this.destroyRef=void 0,this.__isAsync=e,XS()&&(this.destroyRef=G(tv,{optional:!0})??void 0)}emit(e){let t=je(null);try{super.next(e)}finally{je(t)}}subscribe(e,t,r){let i=e,s=t||(()=>null),o=r;if(e&&typeof e=="object"){let c=e;i=c.next?.bind(c),s=c.error?.bind(c),o=c.complete?.bind(c)}this.__isAsync&&(s=Gy(s),i&&(i=Gy(i)),o&&(o=Gy(o)));let a=super.subscribe({next:i,error:s,complete:o});return e instanceof yt&&e.add(a),a}};function Gy(n){return e=>{setTimeout(n,void 0,e)}}var ln=l_;function FA(n){return(n.flags&128)===128}var LA=new Map,eU=0;function tU(){return eU++}function nU(n){LA.set(n[bf],n)}function rU(n){LA.delete(n[bf])}var uS="__ngContext__";function Xs(n,e){Gs(e)?(n[uS]=e[bf],nU(e)):n[uS]=e}function VA(n){return jA(n[ku])}function UA(n){return jA(n[lr])}function jA(n){for(;n!==null&&!mi(n);)n=n[lr];return n}var d_;function BA(n){d_=n}function iU(){if(d_!==void 0)return d_;if(typeof document<"u")return document;throw new se(210,!1)}var Rf=new K("",{providedIn:"root",factory:()=>sU}),sU="ng",nv=new K(""),jt=new K("",{providedIn:"platform",factory:()=>"unknown"});var rv=new K("",{providedIn:"root",factory:()=>iU().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var oU="h",aU="b";var cU=()=>null;function iv(n,e,t=!1){return cU(n,e,t)}var $A=!1,uU=new K("",{providedIn:"root",factory:()=>$A});function qA(n){return n instanceof Function?n():n}function lU(n){return(n??G(kr)).get(jt)==="browser"}var Wi=function(n){return n[n.Important=1]="Important",n[n.DashCase=2]="DashCase",n}(Wi||{}),dU;function sv(n,e){return dU(n,e)}function wa(n,e,t,r,i){if(r!=null){let s,o=!1;mi(r)?s=r:Gs(r)&&(o=!0,r=r[gi]);let a=fi(r);n===0&&t!==null?i==null?KA(e,t,a):df(e,t,a,i||null,!0):n===1&&t!==null?df(e,t,a,i||null,!0):n===2?AU(e,a,o):n===3&&e.destroyNode(a),s!=null&&RU(e,n,s,t,i)}}function hU(n,e){return n.createText(e)}function fU(n,e,t){n.setValue(e,t)}function HA(n,e,t){return n.createElement(e,t)}function pU(n,e){zA(n,e),e[gi]=null,e[hr]=null}function gU(n,e,t,r,i,s){r[gi]=i,r[hr]=e,Mf(n,r,t,1,i,s)}function zA(n,e){e[xr].changeDetectionScheduler?.notify(1),Mf(n,e,e[Sn],2,null,null)}function mU(n){let e=n[ku];if(!e)return Wy(n[Ne],n);for(;e;){let t=null;if(Gs(e))t=e[ku];else{let r=e[Qn];r&&(t=r)}if(!t){for(;e&&!e[lr]&&e!==n;)Gs(e)&&Wy(e[Ne],e),e=e[en];e===null&&(e=n),Gs(e)&&Wy(e[Ne],e),t=e&&e[lr]}e=t}}function yU(n,e,t,r){let i=Qn+r,s=t.length;r>0&&(t[i-1][lr]=e),r<s-Qn?(e[lr]=t[i],VS(t,Qn+r,e)):(t.push(e),e[lr]=null),e[en]=t;let o=e[Df];o!==null&&t!==o&&_U(o,e);let a=e[ba];a!==null&&a.insertView(n),s_(e),e[le]|=128}function _U(n,e){let t=n[of],i=e[en][en][Rr];e[Rr]!==i&&(n[le]|=H_.HasTransplantedViews),t===null?n[of]=[e]:t.push(e)}function GA(n,e){let t=n[of],r=t.indexOf(e);t.splice(r,1)}function h_(n,e){if(n.length<=Qn)return;let t=Qn+e,r=n[t];if(r){let i=r[Df];i!==null&&i!==n&&GA(i,r),e>0&&(n[t-1][lr]=r[lr]);let s=tf(n,Qn+e);pU(r[Ne],r);let o=s[ba];o!==null&&o.detachView(s[Ne]),r[en]=null,r[lr]=null,r[le]&=-129}return r}function WA(n,e){if(!(e[le]&256)){let t=e[Sn];t.destroyNode&&Mf(n,e,t,3,null,null),mU(e)}}function Wy(n,e){if(e[le]&256)return;let t=je(null);try{e[le]&=-129,e[le]|=256,e[Qs]&&Eb(e[Qs]),wU(n,e),vU(n,e),e[Ne].type===1&&e[Sn].destroy();let r=e[Df];if(r!==null&&mi(e[en])){r!==e[en]&&GA(r,e);let i=e[ba];i!==null&&i.detachView(n)}rU(e)}finally{je(t)}}function vU(n,e){let t=n.cleanup,r=e[nS];if(t!==null)for(let s=0;s<t.length-1;s+=2)if(typeof t[s]=="string"){let o=t[s+3];o>=0?r[o]():r[-o].unsubscribe(),s+=2}else{let o=r[t[s+1]];t[s].call(o)}r!==null&&(e[nS]=null);let i=e[$i];if(i!==null){e[$i]=null;for(let s=0;s<i.length;s++){let o=i[s];o()}}}function wU(n,e){let t;if(n!=null&&(t=n.destroyHooks)!=null)for(let r=0;r<t.length;r+=2){let i=e[t[r]];if(!(i instanceof Lu)){let s=t[r+1];if(Array.isArray(s))for(let o=0;o<s.length;o+=2){let a=i[s[o]],c=s[o+1];Bi(4,a,c);try{c.call(a)}finally{Bi(5,a,c)}}else{Bi(4,i,s);try{s.call(i)}finally{Bi(5,i,s)}}}}}function EU(n,e,t){return IU(n,e.parent,t)}function IU(n,e,t){let r=e;for(;r!==null&&r.type&40;)e=r,r=e.parent;if(r===null)return t[gi];{let{componentOffset:i}=r;if(i>-1){let{encapsulation:s}=n.data[r.directiveStart+i];if(s===Ar.None||s===Ar.Emulated)return null}return Nr(r,t)}}function df(n,e,t,r,i){n.insertBefore(e,t,r,i)}function KA(n,e,t){n.appendChild(e,t)}function lS(n,e,t,r,i){r!==null?df(n,e,t,r,i):KA(n,e,t)}function CU(n,e,t,r){n.removeChild(e,t,r)}function ov(n,e){return n.parentNode(e)}function TU(n,e){return n.nextSibling(e)}function DU(n,e,t){return SU(n,e,t)}function bU(n,e,t){return n.type&40?Nr(n,t):null}var SU=bU,dS;function av(n,e,t,r){let i=EU(n,r,e),s=e[Sn],o=r.parent||e[hr],a=DU(o,r,e);if(i!=null)if(Array.isArray(t))for(let c=0;c<t.length;c++)lS(s,i,t[c],a,!1);else lS(s,i,t,a,!1);dS!==void 0&&dS(s,r,e,t,i)}function Zh(n,e){if(e!==null){let t=e.type;if(t&3)return Nr(e,n);if(t&4)return f_(-1,n[e.index]);if(t&8){let r=e.child;if(r!==null)return Zh(n,r);{let i=n[e.index];return mi(i)?f_(-1,i):fi(i)}}else{if(t&32)return sv(e,n)()||fi(n[e.index]);{let r=QA(n,e);if(r!==null){if(Array.isArray(r))return r[0];let i=Fu(n[Rr]);return Zh(i,r)}else return Zh(n,e.next)}}}return null}function QA(n,e){if(e!==null){let r=n[Rr][hr],i=e.projection;return r.projection[i]}return null}function f_(n,e){let t=Qn+n+1;if(t<e.length){let r=e[t],i=r[Ne].firstChild;if(i!==null)return Zh(r,i)}return e[Ys]}function AU(n,e,t){let r=ov(n,e);r&&CU(n,r,e,t)}function cv(n,e,t,r,i,s,o){for(;t!=null;){let a=r[t.index],c=t.type;if(o&&e===0&&(a&&Xs(fi(a),r),t.flags|=2),(t.flags&32)!==32)if(c&8)cv(n,e,t.child,r,i,s,!1),wa(e,n,i,a,s);else if(c&32){let l=sv(t,r),d;for(;d=l();)wa(e,n,i,d,s);wa(e,n,i,a,s)}else c&16?xU(n,e,r,t,i,s):wa(e,n,i,a,s);t=o?t.projectionNext:t.next}}function Mf(n,e,t,r,i,s){cv(t,r,n.firstChild,e,i,s,!1)}function xU(n,e,t,r,i,s){let o=t[Rr],c=o[hr].projection[r.projection];if(Array.isArray(c))for(let l=0;l<c.length;l++){let d=c[l];wa(e,n,i,d,s)}else{let l=c,d=o[en];FA(r)&&(l.flags|=128),cv(n,e,l,d,i,s,!0)}}function RU(n,e,t,r,i){let s=t[Ys],o=fi(t);s!==o&&wa(e,n,r,s,i);for(let a=Qn;a<t.length;a++){let c=t[a];Mf(c[Ne],c,n,e,r,s)}}function MU(n,e,t){n.setAttribute(e,"style",t)}function YA(n,e,t){t===""?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t)}function ZA(n,e,t){let{mergedAttrs:r,classes:i,styles:s}=t;r!==null&&Jy(n,e,r),i!==null&&YA(n,e,i),s!==null&&MU(n,e,s)}var zu={};function dn(n=1){XA(no(),At(),Q_()+n,!1)}function XA(n,e,t,r){if(!r)if((e[le]&3)===3){let s=n.preOrderCheckHooks;s!==null&&Qh(e,s,t)}else{let s=n.preOrderHooks;s!==null&&Yh(e,s,0,t)}Zs(t)}function tn(n,e=Te.Default){let t=At();if(t===null)return F(n,e);let r=Pr();return MA(r,t,Kn(n),e)}function JA(){let n="invalid";throw new Error(n)}function ex(n,e,t,r,i,s){let o=je(null);try{let a=null;i&qi.SignalBased&&(a=e[r][yb]),a!==null&&a.transformFn!==void 0&&(s=a.transformFn(s)),i&qi.HasDecoratorInputTransform&&(s=n.inputTransforms[r].call(e,s)),n.setInput!==null?n.setInput(e,a,s,t,r):rA(e,a,r,s)}finally{je(o)}}function NU(n,e){let t=n.hostBindingOpCodes;if(t!==null)try{for(let r=0;r<t.length;r++){let i=t[r];if(i<0)Zs(~i);else{let s=i,o=t[++r],a=t[++r];R2(o,s);let c=e[s];a(2,c)}}}finally{Zs(-1)}}function Nf(n,e,t,r,i,s,o,a,c,l,d){let f=e.blueprint.slice();return f[gi]=i,f[le]=r|4|128|8|64,(l!==null||n&&n[le]&2048)&&(f[le]|=2048),uA(f),f[en]=f[xa]=n,f[hi]=t,f[xr]=o||n&&n[xr],f[Sn]=a||n&&n[Sn],f[Da]=c||n&&n[Da]||null,f[hr]=s,f[bf]=tU(),f[rf]=d,f[JS]=l,f[Rr]=e.type==2?n[Rr]:f,f}function Pf(n,e,t,r,i){let s=n.data[e];if(s===null)s=PU(n,e,t,r,i),x2()&&(s.flags|=32);else if(s.type&64){s.type=t,s.value=r,s.attrs=i;let o=D2();s.injectorIndex=o===null?-1:o.injectorIndex}return qu(s,!0),s}function PU(n,e,t,r,i){let s=hA(),o=fA(),a=o?s:s&&s.parent,c=n.data[e]=VU(n,a,t,e,r,i);return n.firstChild===null&&(n.firstChild=c),s!==null&&(o?s.child==null&&c.parent!==null&&(s.child=c):s.next===null&&(s.next=c,c.prev=s)),c}function tx(n,e,t,r){if(t===0)return-1;let i=e.length;for(let s=0;s<t;s++)e.push(r),n.blueprint.push(r),n.data.push(null);return i}function nx(n,e,t,r,i){let s=Q_(),o=r&2;try{Zs(-1),o&&e.length>dr&&XA(n,e,dr,!1),Bi(o?2:0,i),t(r,i)}finally{Zs(s),Bi(o?3:1,i)}}function rx(n,e,t){if(tA(e)){let r=je(null);try{let i=e.directiveStart,s=e.directiveEnd;for(let o=i;o<s;o++){let a=n.data[o];if(a.contentQueries){let c=t[o];a.contentQueries(1,c,o)}}}finally{je(r)}}}function ix(n,e,t){dA()&&(zU(n,e,t,Nr(t,e)),(t.flags&64)===64&&ux(n,e,t))}function sx(n,e,t=Nr){let r=e.localNames;if(r!==null){let i=e.index+1;for(let s=0;s<r.length;s+=2){let o=r[s+1],a=o===-1?t(e,n):n[o];n[i++]=a}}}function ox(n){let e=n.tView;return e===null||e.incompleteFirstPass?n.tView=uv(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts,n.id):e}function uv(n,e,t,r,i,s,o,a,c,l,d){let f=dr+r,g=f+i,y=kU(f,g),v=typeof l=="function"?l():l;return y[Ne]={type:n,blueprint:y,template:t,queries:null,viewQuery:a,declTNode:e,data:y.slice().fill(null,f),bindingStartIndex:f,expandoStartIndex:g,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof s=="function"?s():s,pipeRegistry:typeof o=="function"?o():o,firstChild:null,schemas:c,consts:v,incompleteFirstPass:!1,ssrId:d}}function kU(n,e){let t=[];for(let r=0;r<e;r++)t.push(r<n?null:zu);return t}function OU(n,e,t,r){let s=r.get(uU,$A)||t===Ar.ShadowDom,o=n.selectRootElement(e,s);return FU(o),o}function FU(n){LU(n)}var LU=()=>null;function VU(n,e,t,r,i,s){let o=e?e.injectorIndex:-1,a=0;return I2()&&(a|=128),{type:t,index:r,insertBeforeIndex:null,injectorIndex:o,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:i,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function hS(n,e,t,r,i){for(let s in e){if(!e.hasOwnProperty(s))continue;let o=e[s];if(o===void 0)continue;r??={};let a,c=qi.None;Array.isArray(o)?(a=o[0],c=o[1]):a=o;let l=s;if(i!==null){if(!i.hasOwnProperty(s))continue;l=i[s]}n===0?fS(r,t,l,a,c):fS(r,t,l,a)}return r}function fS(n,e,t,r,i){let s;n.hasOwnProperty(t)?(s=n[t]).push(e,r):s=n[t]=[e,r],i!==void 0&&s.push(i)}function UU(n,e,t){let r=e.directiveStart,i=e.directiveEnd,s=n.data,o=e.attrs,a=[],c=null,l=null;for(let d=r;d<i;d++){let f=s[d],g=t?t.get(f):null,y=g?g.inputs:null,v=g?g.outputs:null;c=hS(0,f.inputs,d,c,y),l=hS(1,f.outputs,d,l,v);let b=c!==null&&o!==null&&!j_(e)?ej(c,d,o):null;a.push(b)}c!==null&&(c.hasOwnProperty("class")&&(e.flags|=8),c.hasOwnProperty("style")&&(e.flags|=16)),e.initialInputs=a,e.inputs=c,e.outputs=l}function jU(n){return n==="class"?"className":n==="for"?"htmlFor":n==="formaction"?"formAction":n==="innerHtml"?"innerHTML":n==="readonly"?"readOnly":n==="tabindex"?"tabIndex":n}function BU(n,e,t,r,i,s,o,a){let c=Nr(e,t),l=e.inputs,d;!a&&l!=null&&(d=l[r])?(lv(n,t,d,r,i),Sf(e)&&$U(t,e.index)):e.type&3?(r=jU(r),i=o!=null?o(i,e.value||"",r):i,s.setProperty(c,r,i)):e.type&12}function $U(n,e){let t=to(e,n);t[le]&16||(t[le]|=64)}function ax(n,e,t,r){if(dA()){let i=r===null?null:{"":-1},s=WU(n,t),o,a;s===null?o=a=null:[o,a]=s,o!==null&&cx(n,e,t,o,i,a),i&&KU(t,r,i)}t.mergedAttrs=U_(t.mergedAttrs,t.attrs)}function cx(n,e,t,r,i,s){for(let l=0;l<r.length;l++)z2(SA(t,e),n,r[l].type);YU(t,n.data.length,r.length);for(let l=0;l<r.length;l++){let d=r[l];d.providersResolver&&d.providersResolver(d)}let o=!1,a=!1,c=tx(n,e,r.length,null);for(let l=0;l<r.length;l++){let d=r[l];t.mergedAttrs=U_(t.mergedAttrs,d.hostAttrs),ZU(n,t,e,c,d),QU(c,d,i),d.contentQueries!==null&&(t.flags|=4),(d.hostBindings!==null||d.hostAttrs!==null||d.hostVars!==0)&&(t.flags|=64);let f=d.type.prototype;!o&&(f.ngOnChanges||f.ngOnInit||f.ngDoCheck)&&((n.preOrderHooks??=[]).push(t.index),o=!0),!a&&(f.ngOnChanges||f.ngDoCheck)&&((n.preOrderCheckHooks??=[]).push(t.index),a=!0),c++}UU(n,t,s)}function qU(n,e,t,r,i){let s=i.hostBindings;if(s){let o=n.hostBindingOpCodes;o===null&&(o=n.hostBindingOpCodes=[]);let a=~e.index;HU(o)!=a&&o.push(a),o.push(t,r,s)}}function HU(n){let e=n.length;for(;e>0;){let t=n[--e];if(typeof t=="number"&&t<0)return t}return 0}function zU(n,e,t,r){let i=t.directiveStart,s=t.directiveEnd;Sf(t)&&XU(e,t,n.data[i+t.componentOffset]),n.firstCreatePass||SA(t,e),Xs(r,e);let o=t.initialInputs;for(let a=i;a<s;a++){let c=n.data[a],l=Vu(e,n,a,t);if(Xs(l,e),o!==null&&JU(e,a-i,l,c,t,o),$u(c)){let d=to(t.index,e);d[hi]=Vu(e,n,a,t)}}}function ux(n,e,t){let r=t.directiveStart,i=t.directiveEnd,s=t.index,o=M2();try{Zs(s);for(let a=r;a<i;a++){let c=n.data[a],l=e[a];o_(a),(c.hostBindings!==null||c.hostVars!==0||c.hostAttrs!==null)&&GU(c,l)}}finally{Zs(-1),o_(o)}}function GU(n,e){n.hostBindings!==null&&n.hostBindings(1,e)}function WU(n,e){let t=n.directiveRegistry,r=null,i=null;if(t)for(let s=0;s<t.length;s++){let o=t[s];if(LV(e,o.selectors,!1))if(r||(r=[]),$u(o))if(o.findHostDirectiveDefs!==null){let a=[];i=i||new Map,o.findHostDirectiveDefs(o,a,i),r.unshift(...a,o);let c=a.length;p_(n,e,c)}else r.unshift(o),p_(n,e,0);else i=i||new Map,o.findHostDirectiveDefs?.(o,r,i),r.push(o)}return r===null?null:[r,i]}function p_(n,e,t){e.componentOffset=t,(n.components??=[]).push(e.index)}function KU(n,e,t){if(e){let r=n.localNames=[];for(let i=0;i<e.length;i+=2){let s=t[e[i+1]];if(s==null)throw new se(-301,!1);r.push(e[i],s)}}}function QU(n,e,t){if(t){if(e.exportAs)for(let r=0;r<e.exportAs.length;r++)t[e.exportAs[r]]=n;$u(e)&&(t[""]=n)}}function YU(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}function ZU(n,e,t,r,i){n.data[r]=i;let s=i.factory||(i.factory=Ks(i.type,!0)),o=new Lu(s,$u(i),tn);n.blueprint[r]=o,t[r]=o,qU(n,e,r,tx(n,t,i.hostVars,zu),i)}function XU(n,e,t){let r=Nr(e,n),i=ox(t),s=n[xr].rendererFactory,o=16;t.signals?o=4096:t.onPush&&(o=64);let a=kf(n,Nf(n,i,null,o,r,e,null,s.createRenderer(r,t),null,null,null));n[e.index]=a}function JU(n,e,t,r,i,s){let o=s[e];if(o!==null)for(let a=0;a<o.length;){let c=o[a++],l=o[a++],d=o[a++],f=o[a++];ex(r,t,c,l,d,f)}}function ej(n,e,t){let r=null,i=0;for(;i<t.length;){let s=t[i];if(s===0){i+=4;continue}else if(s===5){i+=2;continue}if(typeof s=="number")break;if(n.hasOwnProperty(s)){r===null&&(r=[]);let o=n[s];for(let a=0;a<o.length;a+=3)if(o[a]===e){r.push(s,o[a+1],o[a+2],t[i+1]);break}}i+=2}return r}function lx(n,e,t,r){return[n,!0,0,e,null,r,null,t,null,null]}function dx(n,e){let t=n.contentQueries;if(t!==null){let r=je(null);try{for(let i=0;i<t.length;i+=2){let s=t[i],o=t[i+1];if(o!==-1){let a=n.data[o];mA(s),a.contentQueries(2,e[o],o)}}}finally{je(r)}}}function kf(n,e){return n[ku]?n[rS][lr]=e:n[ku]=e,n[rS]=e,e}function g_(n,e,t){mA(0);let r=je(null);try{e(n,t)}finally{je(r)}}function tj(n,e){let t=n[Da],r=t?t.get(Mr,null):null;r&&r.handleError(e)}function lv(n,e,t,r,i){for(let s=0;s<t.length;){let o=t[s++],a=t[s++],c=t[s++],l=e[o],d=n.data[o];ex(d,l,r,a,c,i)}}function nj(n,e,t){let r=p2(e,n);fU(n[Sn],r,t)}function rj(n,e){let t=to(e,n),r=t[Ne];ij(r,t);let i=t[gi];i!==null&&t[rf]===null&&(t[rf]=iv(i,t[Da])),dv(r,t,t[hi])}function ij(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])}function dv(n,e,t){W_(e);try{let r=n.viewQuery;r!==null&&g_(1,r,t);let i=n.template;i!==null&&nx(n,e,i,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),e[ba]?.finishViewCreation(n),n.staticContentQueries&&dx(n,e),n.staticViewQueries&&g_(2,n.viewQuery,t);let s=n.components;s!==null&&sj(e,s)}catch(r){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),r}finally{e[le]&=-5,K_()}}function sj(n,e){for(let t=0;t<e.length;t++)rj(n,e[t])}function oj(n,e,t,r){let i=je(null);try{let s=e.tView,a=n[le]&4096?4096:16,c=Nf(n,s,t,a,null,e,null,null,r?.injector??null,r?.embeddedViewInjector??null,r?.dehydratedView??null),l=n[e.index];c[Df]=l;let d=n[ba];return d!==null&&(c[ba]=d.createEmbeddedView(s)),dv(s,c,t),c}finally{je(i)}}function pS(n,e){return!e||e.firstChild===null||FA(n)}function aj(n,e,t,r=!0){let i=e[Ne];if(yU(i,e,n,t),r){let o=f_(t,n),a=e[Sn],c=ov(a,n[Ys]);c!==null&&gU(i,n[hr],a,e,c,o)}let s=e[rf];s!==null&&s.firstChild!==null&&(s.firstChild=null)}function hf(n,e,t,r,i=!1){for(;t!==null;){let s=e[t.index];s!==null&&r.push(fi(s)),mi(s)&&cj(s,r);let o=t.type;if(o&8)hf(n,e,t.child,r);else if(o&32){let a=sv(t,e),c;for(;c=a();)r.push(c)}else if(o&16){let a=QA(e,t);if(Array.isArray(a))r.push(...a);else{let c=Fu(e[Rr]);hf(c[Ne],c,a,r,!0)}}t=i?t.projectionNext:t.next}return r}function cj(n,e){for(let t=Qn;t<n.length;t++){let r=n[t],i=r[Ne].firstChild;i!==null&&hf(r[Ne],r,i,e)}n[Ys]!==n[gi]&&e.push(n[Ys])}var hx=[];function uj(n){return n[Qs]??lj(n)}function lj(n){let e=hx.pop()??Object.create(hj);return e.lView=n,e}function dj(n){n.lView[Qs]!==n&&(n.lView=null,hx.push(n))}var hj=nt(Q({},_b),{consumerIsAlwaysLive:!0,consumerMarkedDirty:n=>{Ou(n.lView)},consumerOnSignalRead(){this.lView[Qs]=this}}),fx=100;function px(n,e=!0,t=0){let r=n[xr],i=r.rendererFactory,s=!1;s||i.begin?.();try{fj(n,t)}catch(o){throw e&&tj(n,o),o}finally{s||(i.end?.(),r.inlineEffectRunner?.flush())}}function fj(n,e){m_(n,e);let t=0;for(;G_(n);){if(t===fx)throw new se(103,!1);t++,m_(n,1)}}function pj(n,e,t,r){let i=e[le];if((i&256)===256)return;let s=!1;!s&&e[xr].inlineEffectRunner?.flush(),W_(e);let o=null,a=null;!s&&gj(n)&&(a=uj(e),o=vb(a));try{uA(e),A2(n.bindingStartIndex),t!==null&&nx(n,e,t,2,r);let c=(i&3)===3;if(!s)if(c){let f=n.preOrderCheckHooks;f!==null&&Qh(e,f,null)}else{let f=n.preOrderHooks;f!==null&&Yh(e,f,0,null),qy(e,0)}if(mj(e),gx(e,0),n.contentQueries!==null&&dx(n,e),!s)if(c){let f=n.contentCheckHooks;f!==null&&Qh(e,f)}else{let f=n.contentHooks;f!==null&&Yh(e,f,1),qy(e,1)}NU(n,e);let l=n.components;l!==null&&yx(e,l,0);let d=n.viewQuery;if(d!==null&&g_(2,d,r),!s)if(c){let f=n.viewCheckHooks;f!==null&&Qh(e,f)}else{let f=n.viewHooks;f!==null&&Yh(e,f,2),qy(e,2)}if(n.firstUpdatePass===!0&&(n.firstUpdatePass=!1),e[$y]){for(let f of e[$y])f();e[$y]=null}s||(e[le]&=-73)}catch(c){throw Ou(e),c}finally{a!==null&&(wb(a,o),dj(a)),K_()}}function gj(n){return n.type!==2}function gx(n,e){for(let t=VA(n);t!==null;t=UA(t))for(let r=Qn;r<t.length;r++){let i=t[r];mx(i,e)}}function mj(n){for(let e=VA(n);e!==null;e=UA(e)){if(!(e[le]&H_.HasTransplantedViews))continue;let t=e[of];for(let r=0;r<t.length;r++){let i=t[r],s=i[en];m2(i)}}}function yj(n,e,t){let r=to(e,n);mx(r,t)}function mx(n,e){z_(n)&&m_(n,e)}function m_(n,e){let r=n[Ne],i=n[le],s=n[Qs],o=!!(e===0&&i&16);if(o||=!!(i&64&&e===0),o||=!!(i&1024),o||=!!(s?.dirty&&vy(s)),s&&(s.dirty=!1),n[le]&=-9217,o)pj(r,n,r.template,n[hi]);else if(i&8192){gx(n,1);let a=r.components;a!==null&&yx(n,a,1)}}function yx(n,e,t){for(let r=0;r<e.length;r++)yj(n,e[r],t)}function _x(n){for(n[xr].changeDetectionScheduler?.notify();n;){n[le]|=64;let e=Fu(n);if(o2(n)&&!e)return n;n=e}return null}var Js=class{get rootNodes(){let e=this._lView,t=e[Ne];return hf(t,e,t.firstChild,[])}constructor(e,t,r=!0){this._lView=e,this._cdRefInjectingView=t,this.notifyErrorHandler=r,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[hi]}set context(e){this._lView[hi]=e}get destroyed(){return(this._lView[le]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let e=this._lView[en];if(mi(e)){let t=e[sf],r=t?t.indexOf(this):-1;r>-1&&(h_(e,r),tf(t,r))}this._attachedToViewContainer=!1}WA(this._lView[Ne],this._lView)}onDestroy(e){lA(this._lView,e)}markForCheck(){_x(this._cdRefInjectingView||this._lView)}detach(){this._lView[le]&=-129}reattach(){s_(this._lView),this._lView[le]|=128}detectChanges(){this._lView[le]|=1024,px(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new se(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,zA(this._lView[Ne],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new se(902,!1);this._appRef=e,s_(this._lView)}},Of=(()=>{let e=class e{};e.__NG_ELEMENT_ID__=wj;let n=e;return n})(),_j=Of,vj=class extends _j{constructor(e,t,r){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(e,t){return this.createEmbeddedViewImpl(e,t)}createEmbeddedViewImpl(e,t,r){let i=oj(this._declarationLView,this._declarationTContainer,e,{embeddedViewInjector:t,dehydratedView:r});return new Js(i)}};function wj(){return vx(Pr(),At())}function vx(n,e){return n.type&4?new vj(e,n,xf(n,e)):null}var uX=new RegExp(`^(\\d+)*(${aU}|${oU})*(.*)`);var Ej=()=>null;function gS(n,e){return Ej(n,e)}var ff=class{},y_=class{},pf=class{};function Ij(n){let e=Error(`No component factory found for ${Dn(n)}.`);return e[Cj]=n,e}var Cj="ngComponent";var __=class{resolveComponentFactory(e){throw Ij(e)}},Ff=(()=>{let e=class e{};e.NULL=new __;let n=e;return n})(),Uu=class{},Lf=(()=>{let e=class e{constructor(){this.destroyNode=null}};e.__NG_ELEMENT_ID__=()=>Tj();let n=e;return n})();function Tj(){let n=At(),e=Pr(),t=to(e.index,n);return(Gs(t)?t:n)[Sn]}var Dj=(()=>{let e=class e{};e.\u0275prov=J({token:e,providedIn:"root",factory:()=>null});let n=e;return n})(),Ky={};var mS=new Set;function hv(n){mS.has(n)||(mS.add(n),performance?.mark?.("mark_feature_usage",{detail:{feature:n}}))}function yS(...n){}function bj(){let n=typeof Pn.requestAnimationFrame=="function",e=Pn[n?"requestAnimationFrame":"setTimeout"],t=Pn[n?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&e&&t){let r=e[Zone.__symbol__("OriginalDelegate")];r&&(e=r);let i=t[Zone.__symbol__("OriginalDelegate")];i&&(t=i)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}var De=class n{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new ln(!1),this.onMicrotaskEmpty=new ln(!1),this.onStable=new ln(!1),this.onError=new ln(!1),typeof Zone>"u")throw new se(908,!1);Zone.assertZonePatched();let i=this;i._nesting=0,i._outer=i._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(i._inner=i._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(i._inner=i._inner.fork(Zone.longStackTraceZoneSpec)),i.shouldCoalesceEventChangeDetection=!r&&t,i.shouldCoalesceRunChangeDetection=r,i.lastRequestAnimationFrameId=-1,i.nativeRequestAnimationFrame=bj().nativeRequestAnimationFrame,xj(i)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get("isAngularZone")===!0}static assertInAngularZone(){if(!n.isInAngularZone())throw new se(909,!1)}static assertNotInAngularZone(){if(n.isInAngularZone())throw new se(909,!1)}run(e,t,r){return this._inner.run(e,t,r)}runTask(e,t,r,i){let s=this._inner,o=s.scheduleEventTask("NgZoneEvent: "+i,e,Sj,yS,yS);try{return s.runTask(o,t,r)}finally{s.cancelTask(o)}}runGuarded(e,t,r){return this._inner.runGuarded(e,t,r)}runOutsideAngular(e){return this._outer.run(e)}},Sj={};function fv(n){if(n._nesting==0&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function Aj(n){n.isCheckStableRunning||n.lastRequestAnimationFrameId!==-1||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(Pn,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,v_(n),n.isCheckStableRunning=!0,fv(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),v_(n))}function xj(n){let e=()=>{Aj(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,r,i,s,o,a)=>{if(Rj(a))return t.invokeTask(i,s,o,a);try{return _S(n),t.invokeTask(i,s,o,a)}finally{(n.shouldCoalesceEventChangeDetection&&s.type==="eventTask"||n.shouldCoalesceRunChangeDetection)&&e(),vS(n)}},onInvoke:(t,r,i,s,o,a,c)=>{try{return _S(n),t.invoke(i,s,o,a,c)}finally{n.shouldCoalesceRunChangeDetection&&e(),vS(n)}},onHasTask:(t,r,i,s)=>{t.hasTask(i,s),r===i&&(s.change=="microTask"?(n._hasPendingMicrotasks=s.microTask,v_(n),fv(n)):s.change=="macroTask"&&(n.hasPendingMacrotasks=s.macroTask))},onHandleError:(t,r,i,s)=>(t.handleError(i,s),n.runOutsideAngular(()=>n.onError.emit(s)),!1)})}function v_(n){n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&n.lastRequestAnimationFrameId!==-1?n.hasPendingMicrotasks=!0:n.hasPendingMicrotasks=!1}function _S(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function vS(n){n._nesting--,fv(n)}var w_=class{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new ln,this.onMicrotaskEmpty=new ln,this.onStable=new ln,this.onError=new ln}run(e,t,r){return e.apply(t,r)}runGuarded(e,t,r){return e.apply(t,r)}runOutsideAngular(e){return e()}runTask(e,t,r,i){return e.apply(t,r)}};function Rj(n){return!Array.isArray(n)||n.length!==1?!1:n[0].data?.__ignore_ng_zone__===!0}function Mj(n="zone.js",e){return n==="noop"?new w_:n==="zone.js"?new De(e):n}var Ea=function(n){return n[n.EarlyRead=0]="EarlyRead",n[n.Write=1]="Write",n[n.MixedReadWrite=2]="MixedReadWrite",n[n.Read=3]="Read",n}(Ea||{}),Nj={destroy(){}};function Vf(n,e){!e&&r2(Vf);let t=e?.injector??G(kr);if(!lU(t))return Nj;hv("NgAfterNextRender");let r=t.get(pv),i=r.handler??=new I_,s=e?.phase??Ea.MixedReadWrite,o=()=>{i.unregister(c),a()},a=t.get(tv).onDestroy(o),c=pi(t,()=>new E_(s,()=>{o(),n()}));return i.register(c),{destroy:o}}var E_=class{constructor(e,t){this.phase=e,this.callbackFn=t,this.zone=G(De),this.errorHandler=G(Mr,{optional:!0}),G(ff,{optional:!0})?.notify(1)}invoke(){try{this.zone.runOutsideAngular(this.callbackFn)}catch(e){this.errorHandler?.handleError(e)}}},I_=class{constructor(){this.executingCallbacks=!1,this.buckets={[Ea.EarlyRead]:new Set,[Ea.Write]:new Set,[Ea.MixedReadWrite]:new Set,[Ea.Read]:new Set},this.deferredCallbacks=new Set}register(e){(this.executingCallbacks?this.deferredCallbacks:this.buckets[e.phase]).add(e)}unregister(e){this.buckets[e.phase].delete(e),this.deferredCallbacks.delete(e)}execute(){this.executingCallbacks=!0;for(let e of Object.values(this.buckets))for(let t of e)t.invoke();this.executingCallbacks=!1;for(let e of this.deferredCallbacks)this.buckets[e.phase].add(e);this.deferredCallbacks.clear()}destroy(){for(let e of Object.values(this.buckets))e.clear();this.deferredCallbacks.clear()}},pv=(()=>{let e=class e{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){let r=[...this.internalCallbacks];this.internalCallbacks.length=0;for(let i of r)i()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}};e.\u0275prov=J({token:e,providedIn:"root",factory:()=>new e});let n=e;return n})();function C_(n,e,t){let r=t?n.styles:null,i=t?n.classes:null,s=0;if(e!==null)for(let o=0;o<e.length;o++){let a=e[o];if(typeof a=="number")s=a;else if(s==1)i=Gb(i,a);else if(s==2){let c=a,l=e[++o];r=Gb(r,c+": "+l+";")}}t?n.styles=r:n.stylesWithoutHost=r,t?n.classes=i:n.classesWithoutHost=i}var gf=class extends Ff{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){let t=Hi(e);return new Sa(t,this.ngModule)}};function wS(n){let e=[];for(let t in n){if(!n.hasOwnProperty(t))continue;let r=n[t];r!==void 0&&e.push({propName:Array.isArray(r)?r[0]:r,templateName:t})}return e}function Pj(n){let e=n.toLowerCase();return e==="svg"?l2:e==="math"?d2:null}var T_=class{constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,r){r=If(r);let i=this.injector.get(e,Ky,r);return i!==Ky||t===Ky?i:this.parentInjector.get(e,t,r)}},Sa=class extends pf{get inputs(){let e=this.componentDef,t=e.inputTransforms,r=wS(e.inputs);if(t!==null)for(let i of r)t.hasOwnProperty(i.propName)&&(i.transform=t[i.propName]);return r}get outputs(){return wS(this.componentDef.outputs)}constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=BV(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}create(e,t,r,i){let s=je(null);try{i=i||this.ngModule;let o=i instanceof bn?i:i?.injector;o&&this.componentDef.getStandaloneInjector!==null&&(o=this.componentDef.getStandaloneInjector(o)||o);let a=o?new T_(e,o):e,c=a.get(Uu,null);if(c===null)throw new se(407,!1);let l=a.get(Dj,null),d=a.get(pv,null),f=a.get(ff,null),g={rendererFactory:c,sanitizer:l,inlineEffectRunner:null,afterRenderEventManager:d,changeDetectionScheduler:f},y=c.createRenderer(null,this.componentDef),v=this.componentDef.selectors[0][0]||"div",b=r?OU(y,r,this.componentDef.encapsulation,a):HA(y,v,Pj(v)),T=512;this.componentDef.signals?T|=4096:this.componentDef.onPush||(T|=16);let V=null;b!==null&&(V=iv(b,a,!0));let B=uv(0,null,null,1,0,null,null,null,null,null,null),O=Nf(null,B,null,T,null,null,g,y,a,null,V);W_(O);let z,re;try{let Z=this.componentDef,I,_=null;Z.findHostDirectiveDefs?(I=[],_=new Map,Z.findHostDirectiveDefs(Z,I,_),I.push(Z)):I=[Z];let w=kj(O,b),C=Oj(w,b,Z,I,O,g,y);re=aA(B,dr),b&&Vj(y,Z,b,r),t!==void 0&&Uj(re,this.ngContentSelectors,t),z=Lj(C,Z,I,_,O,[jj]),dv(B,O,null)}finally{K_()}return new D_(this.componentType,z,xf(re,O),O,re)}finally{je(s)}}},D_=class extends y_{constructor(e,t,r,i,s){super(),this.location=r,this._rootLView=i,this._tNode=s,this.previousInputValues=null,this.instance=t,this.hostView=this.changeDetectorRef=new Js(i,void 0,!1),this.componentType=e}setInput(e,t){let r=this._tNode.inputs,i;if(r!==null&&(i=r[e])){if(this.previousInputValues??=new Map,this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),t))return;let s=this._rootLView;lv(s[Ne],s,i,e,t),this.previousInputValues.set(e,t);let o=to(this._tNode.index,s);_x(o)}}get injector(){return new Ws(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}};function kj(n,e){let t=n[Ne],r=dr;return n[r]=e,Pf(t,r,2,"#host",null)}function Oj(n,e,t,r,i,s,o){let a=i[Ne];Fj(r,n,e,o);let c=null;e!==null&&(c=iv(e,i[Da]));let l=s.rendererFactory.createRenderer(e,t),d=16;t.signals?d=4096:t.onPush&&(d=64);let f=Nf(i,ox(t),null,d,i[n.index],n,s,l,null,null,c);return a.firstCreatePass&&p_(a,n,r.length-1),kf(i,f),i[n.index]=f}function Fj(n,e,t,r){for(let i of n)e.mergedAttrs=U_(e.mergedAttrs,i.hostAttrs);e.mergedAttrs!==null&&(C_(e,e.mergedAttrs,!0),t!==null&&ZA(r,t,e))}function Lj(n,e,t,r,i,s){let o=Pr(),a=i[Ne],c=Nr(o,i);cx(a,i,o,t,null,r);for(let d=0;d<t.length;d++){let f=o.directiveStart+d,g=Vu(i,a,f,o);Xs(g,i)}ux(a,i,o),c&&Xs(c,i);let l=Vu(i,a,o.directiveStart+o.componentOffset,o);if(n[hi]=i[hi]=l,s!==null)for(let d of s)d(l,e);return rx(a,o,i),l}function Vj(n,e,t,r){if(r)Jy(n,t,["ng-version","17.3.12"]);else{let{attrs:i,classes:s}=$V(e.selectors[0]);i&&Jy(n,t,i),s&&s.length>0&&YA(n,t,s.join(" "))}}function Uj(n,e,t){let r=n.projection=[];for(let i=0;i<e.length;i++){let s=t[i];r.push(s!=null?Array.from(s):null)}}function jj(){let n=Pr();X_(At()[Ne],n)}var Ra=(()=>{let e=class e{};e.__NG_ELEMENT_ID__=Bj;let n=e;return n})();function Bj(){let n=Pr();return qj(n,At())}var $j=Ra,wx=class extends $j{constructor(e,t,r){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=r}get element(){return xf(this._hostTNode,this._hostLView)}get injector(){return new Ws(this._hostTNode,this._hostLView)}get parentInjector(){let e=J_(this._hostTNode,this._hostLView);if(TA(e)){let t=uf(e,this._hostLView),r=cf(e),i=t[Ne].data[r+8];return new Ws(i,t)}else return new Ws(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){let t=ES(this._lContainer);return t!==null&&t[e]||null}get length(){return this._lContainer.length-Qn}createEmbeddedView(e,t,r){let i,s;typeof r=="number"?i=r:r!=null&&(i=r.index,s=r.injector);let o=gS(this._lContainer,e.ssrId),a=e.createEmbeddedViewImpl(t||{},s,o);return this.insertImpl(a,i,pS(this._hostTNode,o)),a}createComponent(e,t,r,i,s){let o=e&&!s2(e),a;if(o)a=t;else{let v=t||{};a=v.index,r=v.injector,i=v.projectableNodes,s=v.environmentInjector||v.ngModuleRef}let c=o?e:new Sa(Hi(e)),l=r||this.parentInjector;if(!s&&c.ngModule==null){let b=(o?l:this.parentInjector).get(bn,null);b&&(s=b)}let d=Hi(c.componentType??{}),f=gS(this._lContainer,d?.id??null),g=f?.firstChild??null,y=c.create(l,i,g,s);return this.insertImpl(y.hostView,a,pS(this._hostTNode,f)),y}insert(e,t){return this.insertImpl(e,t,!0)}insertImpl(e,t,r){let i=e._lView;if(g2(i)){let a=this.indexOf(e);if(a!==-1)this.detach(a);else{let c=i[en],l=new wx(c,c[hr],c[en]);l.detach(l.indexOf(e))}}let s=this._adjustIndex(t),o=this._lContainer;return aj(o,i,s,r),e.attachToViewContainerRef(),VS(Qy(o),s,e),e}move(e,t){return this.insert(e,t)}indexOf(e){let t=ES(this._lContainer);return t!==null?t.indexOf(e):-1}remove(e){let t=this._adjustIndex(e,-1),r=h_(this._lContainer,t);r&&(tf(Qy(this._lContainer),t),WA(r[Ne],r))}detach(e){let t=this._adjustIndex(e,-1),r=h_(this._lContainer,t);return r&&tf(Qy(this._lContainer),t)!=null?new Js(r):null}_adjustIndex(e,t=0){return e??this.length+t}};function ES(n){return n[sf]}function Qy(n){return n[sf]||(n[sf]=[])}function qj(n,e){let t,r=e[n.index];return mi(r)?t=r:(t=lx(r,e,null,n),e[n.index]=t,kf(e,t)),zj(t,e,n,r),new wx(t,n,e)}function Hj(n,e){let t=n[Sn],r=t.createComment(""),i=Nr(e,n),s=ov(t,i);return df(t,s,r,TU(t,i),!1),r}var zj=Kj,Gj=()=>!1;function Wj(n,e,t){return Gj(n,e,t)}function Kj(n,e,t,r){if(n[Ys])return;let i;t.type&8?i=fi(r):i=Hj(e,t),n[Ys]=i}function Qj(n){let e=[],t=new Map;function r(i){let s=t.get(i);if(!s){let o=n(i);t.set(i,s=o.then(Jj))}return s}return mf.forEach((i,s)=>{let o=[];i.templateUrl&&o.push(r(i.templateUrl).then(l=>{i.template=l}));let a=typeof i.styles=="string"?[i.styles]:i.styles||[];if(i.styles=a,i.styleUrl&&i.styleUrls?.length)throw new Error("@Component cannot define both `styleUrl` and `styleUrls`. Use `styleUrl` if the component has one stylesheet, or `styleUrls` if it has multiple");if(i.styleUrls?.length){let l=i.styles.length,d=i.styleUrls;i.styleUrls.forEach((f,g)=>{a.push(""),o.push(r(f).then(y=>{a[l+g]=y,d.splice(d.indexOf(f),1),d.length==0&&(i.styleUrls=void 0)}))})}else i.styleUrl&&o.push(r(i.styleUrl).then(l=>{a.push(l),i.styleUrl=void 0}));let c=Promise.all(o).then(()=>eB(s));e.push(c)}),Zj(),Promise.all(e).then(()=>{})}var mf=new Map,Yj=new Set;function Zj(){let n=mf;return mf=new Map,n}function Xj(){return mf.size===0}function Jj(n){return typeof n=="string"?n:n.text()}function eB(n){Yj.delete(n)}var zi=class{},ju=class{};var yf=class extends zi{constructor(e,t,r){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new gf(this);let i=GS(e);this._bootstrapComponents=qA(i.bootstrap),this._r3Injector=kA(e,t,[{provide:zi,useValue:this},{provide:Ff,useValue:this.componentFactoryResolver},...r],Dn(e),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(e)}get injector(){return this._r3Injector}destroy(){let e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}},_f=class extends ju{constructor(e){super(),this.moduleType=e}create(e){return new yf(this.moduleType,e,[])}};function tB(n,e,t){return new yf(n,e,t)}var b_=class extends zi{constructor(e){super(),this.componentFactoryResolver=new gf(this),this.instance=null;let t=new Pu([...e.providers,{provide:zi,useValue:this},{provide:Ff,useValue:this.componentFactoryResolver}],e.parent||q_(),e.debugName,new Set(["environment"]));this.injector=t,e.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}};function Uf(n,e,t=null){return new b_({providers:n,parent:e,debugName:t,runEnvironmentInitializers:!0}).injector}var jf=(()=>{let e=class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Kt(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let r=this.taskId++;return this.pendingTasks.add(r),r}remove(r){this.pendingTasks.delete(r),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=J({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function Ex(n){return gv(n)?Array.isArray(n)||!(n instanceof Map)&&Symbol.iterator in n:!1}function nB(n,e){if(Array.isArray(n))for(let t=0;t<n.length;t++)e(n[t]);else{let t=n[Symbol.iterator](),r;for(;!(r=t.next()).done;)e(r.value)}}function gv(n){return n!==null&&(typeof n=="function"||typeof n=="object")}function rB(n,e,t){return n[e]=t}function mv(n,e,t){let r=n[e];return Object.is(r,t)?!1:(n[e]=t,!0)}function iB(n){return(n.flags&32)===32}function sB(n,e,t,r,i,s,o,a,c){let l=e.consts,d=Pf(e,n,4,o||null,af(l,a));ax(e,t,d,af(l,c)),X_(e,d);let f=d.tView=uv(2,d,r,i,s,e.directiveRegistry,e.pipeRegistry,null,e.schemas,l,null);return e.queries!==null&&(e.queries.template(e,d),f.queries=e.queries.embeddedTView(d)),d}function ro(n,e,t,r,i,s,o,a){let c=At(),l=no(),d=n+dr,f=l.firstCreatePass?sB(d,l,c,e,t,r,i,s,o):l.data[d];qu(f,!1);let g=oB(l,c,f,n);Y_()&&av(l,c,g,f),Xs(g,c);let y=lx(g,c,g,f);return c[d]=y,kf(c,y),Wj(y,f,c),nA(f)&&ix(l,c,f),o!=null&&sx(c,f,a),ro}var oB=aB;function aB(n,e,t,r){return Z_(!0),e[Sn].createComment("")}function cB(n,e,t,r){return mv(n,gA(),t)?e+kS(t)+r:zu}function Ki(n,e,t){let r=At(),i=gA();if(mv(r,i,e)){let s=no(),o=k2();BU(s,o,r,n,e,r[Sn],t,!1)}return Ki}function IS(n,e,t,r,i){let s=e.inputs,o=i?"class":"style";lv(n,t,s[o],o,r)}function uB(n,e,t,r,i,s){let o=e.consts,a=af(o,i),c=Pf(e,n,2,r,a);return ax(e,t,c,af(o,s)),c.attrs!==null&&C_(c,c.attrs,!1),c.mergedAttrs!==null&&C_(c,c.mergedAttrs,!0),e.queries!==null&&e.queries.elementStart(e,c),c}function Re(n,e,t,r){let i=At(),s=no(),o=dr+n,a=i[Sn],c=s.firstCreatePass?uB(o,s,i,e,t,r):s.data[o],l=lB(s,i,c,a,e,n);i[o]=l;let d=nA(c);return qu(c,!0),ZA(a,l,c),!iB(c)&&Y_()&&av(s,i,l,c),v2()===0&&Xs(l,i),w2(),d&&(ix(s,i,c),rx(s,c,i)),r!==null&&sx(i,c),Re}function be(){let n=Pr();fA()?b2():(n=n.parent,qu(n,!1));let e=n;C2(e)&&T2(),E2();let t=no();return t.firstCreatePass&&(X_(t,n),tA(n)&&t.queries.elementEnd(n)),e.classesWithoutHost!=null&&U2(e)&&IS(t,e,At(),e.classesWithoutHost,!0),e.stylesWithoutHost!=null&&j2(e)&&IS(t,e,At(),e.stylesWithoutHost,!1),be}function kn(n,e,t,r){return Re(n,e,t,r),be(),kn}var lB=(n,e,t,r,i,s)=>(Z_(!0),HA(r,i,O2()));var vf="en-US";var dB=vf;function hB(n){typeof n=="string"&&(dB=n.toLowerCase().replace(/_/g,"-"))}function yv(n=1){return P2(n)}function fB(n,e,t,r){t>=n.data.length&&(n.data[t]=null,n.blueprint[t]=null),e[t]=r}function Ix(n){let e=S2();return cA(e,dr+n)}function Xe(n,e=""){let t=At(),r=no(),i=n+dr,s=r.firstCreatePass?Pf(r,i,1,e,null):r.data[i],o=pB(r,t,s,e,n);t[i]=o,Y_()&&av(r,t,o,s),qu(s,!1)}var pB=(n,e,t,r,i)=>(Z_(!0),hU(e[Sn],r));function Or(n){return Bf("",n,""),Or}function Bf(n,e,t){let r=At(),i=cB(r,n,e,t);return i!==zu&&nj(r,Q_(),i),Bf}var gB=(()=>{let e=class e{constructor(r){this._injector=r,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(r){if(!r.standalone)return null;if(!this.cachedInjectors.has(r)){let i=QS(!1,r.type),s=i.length>0?Uf([i],this._injector,`Standalone[${r.type.name}]`):null;this.cachedInjectors.set(r,s)}return this.cachedInjectors.get(r)}ngOnDestroy(){try{for(let r of this.cachedInjectors.values())r!==null&&r.destroy()}finally{this.cachedInjectors.clear()}}};e.\u0275prov=J({token:e,providedIn:"environment",factory:()=>new e(F(bn))});let n=e;return n})();function Cx(n){hv("NgStandalone"),n.getStandaloneInjector=e=>e.get(gB).getOrCreateStandaloneInjector(n)}function Tx(n,e,t,r){return Dx(At(),pA(),n,e,t,r)}function mB(n,e){let t=n[e];return t===zu?void 0:t}function Dx(n,e,t,r,i,s){let o=e+t;return mv(n,o,i)?rB(n,o+1,s?r.call(s,i):r(i)):mB(n,o+1)}function _v(n,e){let t=no(),r,i=n+dr;t.firstCreatePass?(r=yB(e,t.pipeRegistry),t.data[i]=r,r.onDestroy&&(t.destroyHooks??=[]).push(i,r.onDestroy)):r=t.data[i];let s=r.factory||(r.factory=Ks(r.type,!0)),o,a=Tn(tn);try{let c=lf(!1),l=s();return lf(c),fB(t,At(),i,l),l}finally{Tn(a)}}function yB(n,e){if(e)for(let t=e.length-1;t>=0;t--){let r=e[t];if(n===r.name)return r}}function vv(n,e,t){let r=n+dr,i=At(),s=cA(i,r);return _B(i,r)?Dx(i,pA(),e,s.transform,t,s):s.transform(t)}function _B(n,e){return n[Ne].data[e].pure}function bx(n,e){return vx(n,e)}var Wh=null;function vB(n){Wh!==null&&(n.defaultEncapsulation!==Wh.defaultEncapsulation||n.preserveWhitespaces!==Wh.preserveWhitespaces)||(Wh=n)}var Gi=class{constructor(e){this.full=e;let t=e.split(".");this.major=t[0],this.minor=t[1],this.patch=t.slice(2).join(".")}},Sx=new Gi("17.3.12"),$f=(()=>{let e=class e{log(r){console.log(r)}warn(r){console.warn(r)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=J({token:e,factory:e.\u0275fac,providedIn:"platform"});let n=e;return n})();var wv=new K(""),Gu=new K(""),qf=(()=>{let e=class e{constructor(r,i,s){this._ngZone=r,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._callbacks=[],this.taskTrackingZone=null,Ev||(wB(s),s.addToWindow(i)),this._watchAngularEvents(),r.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{De.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&this._pendingCount===0&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;this._callbacks.length!==0;){let r=this._callbacks.pop();clearTimeout(r.timeoutId),r.doneCb()}});else{let r=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>i.updateCb&&i.updateCb(r)?(clearTimeout(i.timeoutId),!1):!0)}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(r=>({source:r.source,creationLocation:r.creationLocation,data:r.data})):[]}addCallback(r,i,s){let o=-1;i&&i>0&&(o=setTimeout(()=>{this._callbacks=this._callbacks.filter(a=>a.timeoutId!==o),r()},i)),this._callbacks.push({doneCb:r,timeoutId:o,updateCb:s})}whenStable(r,i,s){if(s&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(r,i,s),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(r){this.registry.registerApplication(r,this)}unregisterApplication(r){this.registry.unregisterApplication(r)}findProviders(r,i,s){return[]}};e.\u0275fac=function(i){return new(i||e)(F(De),F(Hf),F(Gu))},e.\u0275prov=J({token:e,factory:e.\u0275fac});let n=e;return n})(),Hf=(()=>{let e=class e{constructor(){this._applications=new Map}registerApplication(r,i){this._applications.set(r,i)}unregisterApplication(r){this._applications.delete(r)}unregisterAllApplications(){this._applications.clear()}getTestability(r){return this._applications.get(r)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(r,i=!0){return Ev?.findTestabilityInTree(this,r,i)??null}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=J({token:e,factory:e.\u0275fac,providedIn:"platform"});let n=e;return n})();function wB(n){Ev=n}var Ev;function Ma(n){return!!n&&typeof n.then=="function"}function Iv(n){return!!n&&typeof n.subscribe=="function"}var zf=new K(""),Ax=(()=>{let e=class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,i)=>{this.resolve=r,this.reject=i}),this.appInits=G(zf,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let r=[];for(let s of this.appInits){let o=s();if(Ma(o))r.push(o);else if(Iv(o)){let a=new Promise((c,l)=>{o.subscribe({complete:c,error:l})});r.push(a)}}let i=()=>{this.done=!0,this.resolve()};Promise.all(r).then(()=>{i()}).catch(s=>{this.reject(s)}),r.length===0&&i(),this.initialized=!0}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=J({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Cv=new K("");function EB(){Ib(()=>{throw new se(600,!1)})}function IB(n){return n.isBoundToModule}function CB(n,e,t){try{let r=t();return Ma(r)?r.catch(i=>{throw e.runOutsideAngular(()=>n.handleError(i)),i}):r}catch(r){throw e.runOutsideAngular(()=>n.handleError(r)),r}}function xx(n,e){return Array.isArray(e)?e.reduce(xx,n):Q(Q({},n),e)}var Na=(()=>{let e=class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=G(OA),this.afterRenderEffectManager=G(pv),this.externalTestViews=new Set,this.beforeRender=new _t,this.afterTick=new _t,this.componentTypes=[],this.components=[],this.isStable=G(jf).hasPendingTasks.pipe(ee(r=>!r)),this._injector=G(bn)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(r,i){let s=r instanceof pf;if(!this._injector.get(Ax).done){let y=!s&&zS(r),v=!1;throw new se(405,v)}let a;s?a=r:a=this._injector.get(Ff).resolveComponentFactory(r),this.componentTypes.push(a.componentType);let c=IB(a)?void 0:this._injector.get(zi),l=i||a.selector,d=a.create(kr.NULL,[],l,c),f=d.location.nativeElement,g=d.injector.get(wv,null);return g?.registerApplication(f),d.onDestroy(()=>{this.detachView(d.hostView),Xh(this.components,d),g?.unregisterApplication(f)}),this._loadComponent(d),d}tick(){this._tick(!0)}_tick(r){if(this._runningTick)throw new se(101,!1);let i=je(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(r)}catch(s){this.internalErrorHandler(s)}finally{this.afterTick.next(),this._runningTick=!1,je(i)}}detectChangesInAttachedViews(r){let i=0,s=this.afterRenderEffectManager;for(;;){if(i===fx)throw new se(103,!1);if(r){let o=i===0;this.beforeRender.next(o);for(let{_lView:a,notifyErrorHandler:c}of this._views)TB(a,o,c)}if(i++,s.executeInternalCallbacks(),![...this.externalTestViews.keys(),...this._views].some(({_lView:o})=>S_(o))&&(s.execute(),![...this.externalTestViews.keys(),...this._views].some(({_lView:o})=>S_(o))))break}}attachView(r){let i=r;this._views.push(i),i.attachToAppRef(this)}detachView(r){let i=r;Xh(this._views,i),i.detachFromAppRef()}_loadComponent(r){this.attachView(r.hostView),this.tick(),this.components.push(r);let i=this._injector.get(Cv,[]);[...this._bootstrapListeners,...i].forEach(s=>s(r))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(r=>r()),this._views.slice().forEach(r=>r.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(r){return this._destroyListeners.push(r),()=>Xh(this._destroyListeners,r)}destroy(){if(this._destroyed)throw new se(406,!1);let r=this._injector;r.destroy&&!r.destroyed&&r.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=J({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function Xh(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function TB(n,e,t){!e&&!S_(n)||DB(n,t,e)}function S_(n){return G_(n)}function DB(n,e,t){let r;t?(r=0,n[le]|=1024):n[le]&64?r=0:r=1,px(n,e,r)}var A_=class{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}},Gf=(()=>{let e=class e{compileModuleSync(r){return new _f(r)}compileModuleAsync(r){return Promise.resolve(this.compileModuleSync(r))}compileModuleAndAllComponentsSync(r){let i=this.compileModuleSync(r),s=GS(r),o=qA(s.declarations).reduce((a,c)=>{let l=Hi(c);return l&&a.push(new Sa(l)),a},[]);return new A_(i,o)}compileModuleAndAllComponentsAsync(r){return Promise.resolve(this.compileModuleAndAllComponentsSync(r))}clearCache(){}clearCacheFor(r){}getModuleId(r){}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=J({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),bB=new K("");function SB(n,e,t){let r=new _f(t);return Promise.resolve(r)}function CS(n){for(let e=n.length-1;e>=0;e--)if(n[e]!==void 0)return n[e]}var AB=(()=>{let e=class e{constructor(){this.zone=G(De),this.applicationRef=G(Na)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=J({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function xB(n){return[{provide:De,useFactory:n},{provide:Ta,multi:!0,useFactory:()=>{let e=G(AB,{optional:!0});return()=>e.initialize()}},{provide:Ta,multi:!0,useFactory:()=>{let e=G(NB);return()=>{e.initialize()}}},{provide:OA,useFactory:RB}]}function RB(){let n=G(De),e=G(Mr);return t=>n.runOutsideAngular(()=>e.handleError(t))}function MB(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:n?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:n?.runCoalescing??!1}}var NB=(()=>{let e=class e{constructor(){this.subscription=new yt,this.initialized=!1,this.zone=G(De),this.pendingTasks=G(jf)}initialize(){if(this.initialized)return;this.initialized=!0;let r=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(r=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{De.assertNotInAngularZone(),queueMicrotask(()=>{r!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(r),r=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{De.assertInAngularZone(),r??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=J({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function PB(){return typeof $localize<"u"&&$localize.locale||vf}var Tv=new K("",{providedIn:"root",factory:()=>G(Tv,Te.Optional|Te.SkipSelf)||PB()});var Rx=new K(""),Mx=(()=>{let e=class e{constructor(r){this._injector=r,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(r,i){let s=Mj(i?.ngZone,MB({eventCoalescing:i?.ngZoneEventCoalescing,runCoalescing:i?.ngZoneRunCoalescing}));return s.run(()=>{let o=tB(r.moduleType,this.injector,xB(()=>s)),a=o.injector.get(Mr,null);return s.runOutsideAngular(()=>{let c=s.onError.subscribe({next:l=>{a.handleError(l)}});o.onDestroy(()=>{Xh(this._modules,o),c.unsubscribe()})}),CB(a,s,()=>{let c=o.injector.get(Ax);return c.runInitializers(),c.donePromise.then(()=>{let l=o.injector.get(Tv,vf);return hB(l||vf),this._moduleDoBootstrap(o),o})})})}bootstrapModule(r,i=[]){let s=xx({},i);return SB(this.injector,s,r).then(o=>this.bootstrapModuleFactory(o,s))}_moduleDoBootstrap(r){let i=r.injector.get(Na);if(r._bootstrapComponents.length>0)r._bootstrapComponents.forEach(s=>i.bootstrap(s));else if(r.instance.ngDoBootstrap)r.instance.ngDoBootstrap(i);else throw new se(-403,!1);this._modules.push(r)}onDestroy(r){this._destroyListeners.push(r)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new se(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());let r=this._injector.get(Rx,null);r&&(r.forEach(i=>i()),r.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}};e.\u0275fac=function(i){return new(i||e)(F(kr))},e.\u0275prov=J({token:e,factory:e.\u0275fac,providedIn:"platform"});let n=e;return n})(),Ru=null,Nx=new K("");function kB(n){if(Ru&&!Ru.get(Nx,!1))throw new se(400,!1);EB(),Ru=n;let e=n.get(Mx);return LB(n),e}function Dv(n,e,t=[]){let r=`Platform: ${e}`,i=new K(r);return(s=[])=>{let o=Px();if(!o||o.injector.get(Nx,!1)){let a=[...t,...s,{provide:i,useValue:!0}];n?n(a):kB(OB(a,r))}return FB(i)}}function OB(n=[],e){return kr.create({name:e,providers:[{provide:Tf,useValue:"platform"},{provide:Rx,useValue:new Set([()=>Ru=null])},...n]})}function FB(n){let e=Px();if(!e)throw new se(401,!1);return e}function Px(){return Ru?.get(Mx)??null}function LB(n){n.get(nv,null)?.forEach(t=>t())}function bv(){return!1}var io=(()=>{let e=class e{};e.__NG_ELEMENT_ID__=VB;let n=e;return n})();function VB(n){return UB(Pr(),At(),(n&16)===16)}function UB(n,e,t){if(Sf(n)&&!t){let r=to(n.index,e);return new Js(r,r)}else if(n.type&47){let r=e[Rr];return new Js(r,e)}return null}var x_=class{constructor(){}supports(e){return Ex(e)}create(e){return new R_(e)}},jB=(n,e)=>e,R_=class{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||jB}forEachItem(e){let t;for(t=this._itHead;t!==null;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,r=this._removalsHead,i=0,s=null;for(;t||r;){let o=!r||t&&t.currentIndex<TS(r,i,s)?t:r,a=TS(o,i,s),c=o.currentIndex;if(o===r)i--,r=r._nextRemoved;else if(t=t._next,o.previousIndex==null)i++;else{s||(s=[]);let l=a-i,d=c-i;if(l!=d){for(let g=0;g<l;g++){let y=g<s.length?s[g]:s[g]=0,v=y+g;d<=v&&v<l&&(s[g]=y+1)}let f=o.previousIndex;s[f]=d-l}}a!==c&&e(o,a,c)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;t!==null;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;t!==null;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;t!==null;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;t!==null;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;t!==null;t=t._nextIdentityChange)e(t)}diff(e){if(e==null&&(e=[]),!Ex(e))throw new se(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._itHead,r=!1,i,s,o;if(Array.isArray(e)){this.length=e.length;for(let a=0;a<this.length;a++)s=e[a],o=this._trackByFn(a,s),t===null||!Object.is(t.trackById,o)?(t=this._mismatch(t,s,o,a),r=!0):(r&&(t=this._verifyReinsertion(t,s,o,a)),Object.is(t.item,s)||this._addIdentityChange(t,s)),t=t._next}else i=0,nB(e,a=>{o=this._trackByFn(i,a),t===null||!Object.is(t.trackById,o)?(t=this._mismatch(t,a,o,i),r=!0):(r&&(t=this._verifyReinsertion(t,a,o,i)),Object.is(t.item,a)||this._addIdentityChange(t,a)),t=t._next,i++}),this.length=i;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;e!==null;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;e!==null;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;e!==null;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,r,i){let s;return e===null?s=this._itTail:(s=e._prev,this._remove(e)),e=this._unlinkedRecords===null?null:this._unlinkedRecords.get(r,null),e!==null?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,s,i)):(e=this._linkedRecords===null?null:this._linkedRecords.get(r,i),e!==null?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,s,i)):e=this._addAfter(new M_(t,r),s,i)),e}_verifyReinsertion(e,t,r,i){let s=this._unlinkedRecords===null?null:this._unlinkedRecords.get(r,null);return s!==null?e=this._reinsertAfter(s,e._prev,i):e.currentIndex!=i&&(e.currentIndex=i,this._addToMoves(e,i)),e}_truncate(e){for(;e!==null;){let t=e._next;this._addToRemovals(this._unlink(e)),e=t}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,r){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(e);let i=e._prevRemoved,s=e._nextRemoved;return i===null?this._removalsHead=s:i._nextRemoved=s,s===null?this._removalsTail=i:s._prevRemoved=i,this._insertAfter(e,t,r),this._addToMoves(e,r),e}_moveAfter(e,t,r){return this._unlink(e),this._insertAfter(e,t,r),this._addToMoves(e,r),e}_addAfter(e,t,r){return this._insertAfter(e,t,r),this._additionsTail===null?this._additionsTail=this._additionsHead=e:this._additionsTail=this._additionsTail._nextAdded=e,e}_insertAfter(e,t,r){let i=t===null?this._itHead:t._next;return e._next=i,e._prev=t,i===null?this._itTail=e:i._prev=e,t===null?this._itHead=e:t._next=e,this._linkedRecords===null&&(this._linkedRecords=new wf),this._linkedRecords.put(e),e.currentIndex=r,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){this._linkedRecords!==null&&this._linkedRecords.remove(e);let t=e._prev,r=e._next;return t===null?this._itHead=r:t._next=r,r===null?this._itTail=t:r._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail===null?this._movesTail=this._movesHead=e:this._movesTail=this._movesTail._nextMoved=e),e}_addToRemovals(e){return this._unlinkedRecords===null&&(this._unlinkedRecords=new wf),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=e:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=e,e}},M_=class{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}},N_=class{constructor(){this._head=null,this._tail=null}add(e){this._head===null?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let r;for(r=this._head;r!==null;r=r._nextDup)if((t===null||t<=r.currentIndex)&&Object.is(r.trackById,e))return r;return null}remove(e){let t=e._prevDup,r=e._nextDup;return t===null?this._head=r:t._nextDup=r,r===null?this._tail=t:r._prevDup=t,this._head===null}},wf=class{constructor(){this.map=new Map}put(e){let t=e.trackById,r=this.map.get(t);r||(r=new N_,this.map.set(t,r)),r.add(e)}get(e,t){let r=e,i=this.map.get(r);return i?i.get(e,t):null}remove(e){let t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function TS(n,e,t){let r=n.previousIndex;if(r===null)return r;let i=0;return t&&r<t.length&&(i=t[r]),r+e+i}var P_=class{constructor(){}supports(e){return e instanceof Map||gv(e)}create(){return new k_}},k_=class{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return this._additionsHead!==null||this._changesHead!==null||this._removalsHead!==null}forEachItem(e){let t;for(t=this._mapHead;t!==null;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;t!==null;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;t!==null;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;t!==null;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;t!==null;t=t._nextRemoved)e(t)}diff(e){if(!e)e=new Map;else if(!(e instanceof Map||gv(e)))throw new se(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(r,i)=>{if(t&&t.key===i)this._maybeAddToChanges(t,r),this._appendAfter=t,t=t._next;else{let s=this._getOrCreateRecordForKey(i,r);t=this._insertBeforeOrAppend(t,s)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let r=t;r!==null;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){let r=e._prev;return t._next=e,t._prev=r,e._prev=t,r&&(r._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){let i=this._records.get(e);this._maybeAddToChanges(i,t);let s=i._prev,o=i._next;return s&&(s._next=o),o&&(o._prev=s),i._next=null,i._prev=null,i}let r=new O_(e);return this._records.set(e,r),r.currentValue=t,this._addToAdditions(r),r}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;e!==null;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;e!==null;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;e!=null;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){this._additionsHead===null?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){this._changesHead===null?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(r=>t(e[r],r))}},O_=class{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}};function DS(){return new Sv([new x_])}var Sv=(()=>{let e=class e{constructor(r){this.factories=r}static create(r,i){if(i!=null){let s=i.factories.slice();r=r.concat(s)}return new e(r)}static extend(r){return{provide:e,useFactory:i=>e.create(r,i||DS()),deps:[[e,new Cf,new eo]]}}find(r){let i=this.factories.find(s=>s.supports(r));if(i!=null)return i;throw new se(901,!1)}};e.\u0275prov=J({token:e,providedIn:"root",factory:DS});let n=e;return n})();function bS(){return new Av([new P_])}var Av=(()=>{let e=class e{constructor(r){this.factories=r}static create(r,i){if(i){let s=i.factories.slice();r=r.concat(s)}return new e(r)}static extend(r){return{provide:e,useFactory:i=>e.create(r,i||bS()),deps:[[e,new Cf,new eo]]}}find(r){let i=this.factories.find(s=>s.supports(r));if(i)return i;throw new se(901,!1)}};e.\u0275prov=J({token:e,providedIn:"root",factory:bS});let n=e;return n})();var kx=Dv(null,"core",[]),Ox=(()=>{let e=class e{constructor(r){}};e.\u0275fac=function(i){return new(i||e)(F(Na))},e.\u0275mod=wt({type:e}),e.\u0275inj=vt({});let n=e;return n})();function xv(n){let e=je(null);try{return n()}finally{je(e)}}function Fx(n){let e=Hi(n);if(!e)return null;let t=new Sa(e);return{get selector(){return t.selector},get type(){return t.componentType},get inputs(){return t.inputs},get outputs(){return t.outputs},get ngContentSelectors(){return t.ngContentSelectors},get isStandalone(){return e.standalone},get isSignal(){return e.signals}}}var Bx=null;function so(){return Bx}function $x(n){Bx??=n}var Wf=class{};var An=new K(""),Fv=(()=>{let e=class e{historyGo(r){throw new Error("")}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=J({token:e,factory:()=>G(zB),providedIn:"platform"});let n=e;return n})(),qx=new K(""),zB=(()=>{let e=class e extends Fv{constructor(){super(),this._doc=G(An),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return so().getBaseHref(this._doc)}onPopState(r){let i=so().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",r,!1),()=>i.removeEventListener("popstate",r)}onHashChange(r){let i=so().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",r,!1),()=>i.removeEventListener("hashchange",r)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(r){this._location.pathname=r}pushState(r,i,s){this._history.pushState(r,i,s)}replaceState(r,i,s){this._history.replaceState(r,i,s)}forward(){this._history.forward()}back(){this._history.back()}historyGo(r=0){this._history.go(r)}getState(){return this._history.state}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=J({token:e,factory:()=>new e,providedIn:"platform"});let n=e;return n})();function Lv(n,e){if(n.length==0)return e;if(e.length==0)return n;let t=0;return n.endsWith("/")&&t++,e.startsWith("/")&&t++,t==2?n+e.substring(1):t==1?n+e:n+"/"+e}function Lx(n){let e=n.match(/#|\?|$/),t=e&&e.index||n.length,r=t-(n[t-1]==="/"?1:0);return n.slice(0,r)+n.slice(t)}function yi(n){return n&&n[0]!=="?"?"?"+n:n}var oo=(()=>{let e=class e{historyGo(r){throw new Error("")}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=J({token:e,factory:()=>G(Vv),providedIn:"root"});let n=e;return n})(),Hx=new K(""),Vv=(()=>{let e=class e extends oo{constructor(r,i){super(),this._platformLocation=r,this._removeListenerFns=[],this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??G(An).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(r){this._removeListenerFns.push(this._platformLocation.onPopState(r),this._platformLocation.onHashChange(r))}getBaseHref(){return this._baseHref}prepareExternalUrl(r){return Lv(this._baseHref,r)}path(r=!1){let i=this._platformLocation.pathname+yi(this._platformLocation.search),s=this._platformLocation.hash;return s&&r?`${i}${s}`:i}pushState(r,i,s,o){let a=this.prepareExternalUrl(s+yi(o));this._platformLocation.pushState(r,i,a)}replaceState(r,i,s,o){let a=this.prepareExternalUrl(s+yi(o));this._platformLocation.replaceState(r,i,a)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(r=0){this._platformLocation.historyGo?.(r)}};e.\u0275fac=function(i){return new(i||e)(F(Fv),F(Hx,8))},e.\u0275prov=J({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),zx=(()=>{let e=class e extends oo{constructor(r,i){super(),this._platformLocation=r,this._baseHref="",this._removeListenerFns=[],i!=null&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(r){this._removeListenerFns.push(this._platformLocation.onPopState(r),this._platformLocation.onHashChange(r))}getBaseHref(){return this._baseHref}path(r=!1){let i=this._platformLocation.hash??"#";return i.length>0?i.substring(1):i}prepareExternalUrl(r){let i=Lv(this._baseHref,r);return i.length>0?"#"+i:i}pushState(r,i,s,o){let a=this.prepareExternalUrl(s+yi(o));a.length==0&&(a=this._platformLocation.pathname),this._platformLocation.pushState(r,i,a)}replaceState(r,i,s,o){let a=this.prepareExternalUrl(s+yi(o));a.length==0&&(a=this._platformLocation.pathname),this._platformLocation.replaceState(r,i,a)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(r=0){this._platformLocation.historyGo?.(r)}};e.\u0275fac=function(i){return new(i||e)(F(Fv),F(Hx,8))},e.\u0275prov=J({token:e,factory:e.\u0275fac});let n=e;return n})(),Pa=(()=>{let e=class e{constructor(r){this._subject=new ln,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=r;let i=this._locationStrategy.getBaseHref();this._basePath=KB(Lx(Vx(i))),this._locationStrategy.onPopState(s=>{this._subject.emit({url:this.path(!0),pop:!0,state:s.state,type:s.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(r=!1){return this.normalize(this._locationStrategy.path(r))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(r,i=""){return this.path()==this.normalize(r+yi(i))}normalize(r){return e.stripTrailingSlash(WB(this._basePath,Vx(r)))}prepareExternalUrl(r){return r&&r[0]!=="/"&&(r="/"+r),this._locationStrategy.prepareExternalUrl(r)}go(r,i="",s=null){this._locationStrategy.pushState(s,"",r,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(r+yi(i)),s)}replaceState(r,i="",s=null){this._locationStrategy.replaceState(s,"",r,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(r+yi(i)),s)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(r=0){this._locationStrategy.historyGo?.(r)}onUrlChange(r){return this._urlChangeListeners.push(r),this._urlChangeSubscription??=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)}),()=>{let i=this._urlChangeListeners.indexOf(r);this._urlChangeListeners.splice(i,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(r="",i){this._urlChangeListeners.forEach(s=>s(r,i))}subscribe(r,i,s){return this._subject.subscribe({next:r,error:i,complete:s})}};e.normalizeQueryParams=yi,e.joinWithSlash=Lv,e.stripTrailingSlash=Lx,e.\u0275fac=function(i){return new(i||e)(F(oo))},e.\u0275prov=J({token:e,factory:()=>GB(),providedIn:"root"});let n=e;return n})();function GB(){return new Pa(F(oo))}function WB(n,e){if(!n||!e.startsWith(n))return e;let t=e.substring(n.length);return t===""||["/",";","?","#"].includes(t[0])?t:e}function Vx(n){return n.replace(/\/index.html$/,"")}function KB(n){if(new RegExp("^(https?:)?//").test(n)){let[,t]=n.split(/\/\/[^\/]+/);return t}return n}function Gx(n,e){e=encodeURIComponent(e);for(let t of n.split(";")){let r=t.indexOf("="),[i,s]=r==-1?[t,""]:[t.slice(0,r),t.slice(r+1)];if(i.trim()===e)return decodeURIComponent(s)}return null}var Rv=class{constructor(e,t,r,i){this.$implicit=e,this.ngForOf=t,this.index=r,this.count=i}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},Wx=(()=>{let e=class e{set ngForOf(r){this._ngForOf=r,this._ngForOfDirty=!0}set ngForTrackBy(r){this._trackByFn=r}get ngForTrackBy(){return this._trackByFn}constructor(r,i,s){this._viewContainer=r,this._template=i,this._differs=s,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(r){r&&(this._template=r)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let r=this._ngForOf;if(!this._differ&&r)if(0)try{}catch{}else this._differ=this._differs.find(r).create(this.ngForTrackBy)}if(this._differ){let r=this._differ.diff(this._ngForOf);r&&this._applyChanges(r)}}_applyChanges(r){let i=this._viewContainer;r.forEachOperation((s,o,a)=>{if(s.previousIndex==null)i.createEmbeddedView(this._template,new Rv(s.item,this._ngForOf,-1,-1),a===null?void 0:a);else if(a==null)i.remove(o===null?void 0:o);else if(o!==null){let c=i.get(o);i.move(c,a),Ux(c,s)}});for(let s=0,o=i.length;s<o;s++){let c=i.get(s).context;c.index=s,c.count=o,c.ngForOf=this._ngForOf}r.forEachIdentityChange(s=>{let o=i.get(s.currentIndex);Ux(o,s)})}static ngTemplateContextGuard(r,i){return!0}};e.\u0275fac=function(i){return new(i||e)(tn(Ra),tn(Of),tn(Sv))},e.\u0275dir=Aa({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0});let n=e;return n})();function Ux(n,e){n.context.$implicit=e.item}var Kx=(()=>{let e=class e{constructor(r,i){this._viewContainer=r,this._context=new Mv,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(r){this._context.$implicit=this._context.ngIf=r,this._updateView()}set ngIfThen(r){jx("ngIfThen",r),this._thenTemplateRef=r,this._thenViewRef=null,this._updateView()}set ngIfElse(r){jx("ngIfElse",r),this._elseTemplateRef=r,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(r,i){return!0}};e.\u0275fac=function(i){return new(i||e)(tn(Ra),tn(Of))},e.\u0275dir=Aa({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0});let n=e;return n})(),Mv=class{constructor(){this.$implicit=null,this.ngIf=null}};function jx(n,e){if(!!!(!e||e.createEmbeddedView))throw new Error(`${n} must be a TemplateRef, but received '${Dn(e)}'.`)}var Qx=(()=>{let e=class e{constructor(r,i,s){this._ngEl=r,this._differs=i,this._renderer=s,this._ngStyle=null,this._differ=null}set ngStyle(r){this._ngStyle=r,!this._differ&&r&&(this._differ=this._differs.find(r).create())}ngDoCheck(){if(this._differ){let r=this._differ.diff(this._ngStyle);r&&this._applyChanges(r)}}_setStyle(r,i){let[s,o]=r.split("."),a=s.indexOf("-")===-1?void 0:Wi.DashCase;i!=null?this._renderer.setStyle(this._ngEl.nativeElement,s,o?`${i}${o}`:i,a):this._renderer.removeStyle(this._ngEl.nativeElement,s,a)}_applyChanges(r){r.forEachRemovedItem(i=>this._setStyle(i.key,null)),r.forEachAddedItem(i=>this._setStyle(i.key,i.currentValue)),r.forEachChangedItem(i=>this._setStyle(i.key,i.currentValue))}};e.\u0275fac=function(i){return new(i||e)(tn(Hu),tn(Av),tn(Lf))},e.\u0275dir=Aa({type:e,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0});let n=e;return n})();function QB(n,e){return new se(2100,!1)}var Nv=class{createSubscription(e,t){return xv(()=>e.subscribe({next:t,error:r=>{throw r}}))}dispose(e){xv(()=>e.unsubscribe())}},Pv=class{createSubscription(e,t){return e.then(t,r=>{throw r})}dispose(e){}},YB=new Pv,ZB=new Nv,Yx=(()=>{let e=class e{constructor(r){this._latestValue=null,this.markForCheckOnValueUpdate=!0,this._subscription=null,this._obj=null,this._strategy=null,this._ref=r}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(r){if(!this._obj){if(r)try{this.markForCheckOnValueUpdate=!1,this._subscribe(r)}finally{this.markForCheckOnValueUpdate=!0}return this._latestValue}return r!==this._obj?(this._dispose(),this.transform(r)):this._latestValue}_subscribe(r){this._obj=r,this._strategy=this._selectStrategy(r),this._subscription=this._strategy.createSubscription(r,i=>this._updateLatestValue(r,i))}_selectStrategy(r){if(Ma(r))return YB;if(Iv(r))return ZB;throw QB(e,r)}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(r,i){r===this._obj&&(this._latestValue=i,this.markForCheckOnValueUpdate&&this._ref?.markForCheck())}};e.\u0275fac=function(i){return new(i||e)(tn(io,16))},e.\u0275pipe=B_({name:"async",type:e,pure:!1,standalone:!0});let n=e;return n})();var Zx=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=wt({type:e}),e.\u0275inj=vt({});let n=e;return n})(),Uv="browser",XB="server";function JB(n){return n===Uv}function ao(n){return n===XB}var Xx=(()=>{let e=class e{};e.\u0275prov=J({token:e,providedIn:"root",factory:()=>JB(G(jt))?new kv(G(An),window):new Ov});let n=e;return n})(),kv=class{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){Array.isArray(e)?this.offset=()=>e:this.offset=e}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(e){this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){let t=e$(this.document,e);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(e){this.window.history.scrollRestoration=e}scrollToElement(e){let t=e.getBoundingClientRect(),r=t.left+this.window.pageXOffset,i=t.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(r-s[0],i-s[1])}};function e$(n,e){let t=n.getElementById(e)||n.getElementsByName(e)[0];if(t)return t;if(typeof n.createTreeWalker=="function"&&n.body&&typeof n.body.attachShadow=="function"){let r=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT),i=r.currentNode;for(;i;){let s=i.shadowRoot;if(s){let o=s.getElementById(e)||s.querySelector(`[name="${e}"]`);if(o)return o}i=r.nextNode()}}return null}var Ov=class{setOffset(e){}getScrollPosition(){return[0,0]}scrollToPosition(e){}scrollToAnchor(e){}setHistoryScrollRestoration(e){}},Kf=class{};var $v=class extends Wf{constructor(){super(...arguments),this.supportsDOMEvents=!0}},qv=class n extends $v{static makeCurrent(){$x(new n)}onAndCancel(e,t,r){return e.addEventListener(t,r),()=>{e.removeEventListener(t,r)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return t=t||this.getDefaultDocument(),t.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return t==="window"?window:t==="document"?e:t==="body"?e.body:null}getBaseHref(e){let t=r$();return t==null?null:i$(t)}resetBaseElement(){Wu=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return Gx(document.cookie,e)}},Wu=null;function r$(){return Wu=Wu||document.querySelector("base"),Wu?Wu.getAttribute("href"):null}function i$(n){return new URL(n,document.baseURI).pathname}var Hv=class{addToWindow(e){Pn.getAngularTestability=(r,i=!0)=>{let s=e.findTestabilityInTree(r,i);if(s==null)throw new se(5103,!1);return s},Pn.getAllAngularTestabilities=()=>e.getAllTestabilities(),Pn.getAllAngularRootElements=()=>e.getAllRootElements();let t=r=>{let i=Pn.getAllAngularTestabilities(),s=i.length,o=function(){s--,s==0&&r()};i.forEach(a=>{a.whenStable(o)})};Pn.frameworkStabilizers||(Pn.frameworkStabilizers=[]),Pn.frameworkStabilizers.push(t)}findTestabilityInTree(e,t,r){if(t==null)return null;let i=e.getTestability(t);return i??(r?so().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}},s$=(()=>{let e=class e{build(){return new XMLHttpRequest}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=J({token:e,factory:e.\u0275fac});let n=e;return n})(),zv=new K(""),nR=(()=>{let e=class e{constructor(r,i){this._zone=i,this._eventNameToPlugin=new Map,r.forEach(s=>{s.manager=this}),this._plugins=r.slice().reverse()}addEventListener(r,i,s){return this._findPluginFor(i).addEventListener(r,i,s)}getZone(){return this._zone}_findPluginFor(r){let i=this._eventNameToPlugin.get(r);if(i)return i;if(i=this._plugins.find(o=>o.supports(r)),!i)throw new se(5101,!1);return this._eventNameToPlugin.set(r,i),i}};e.\u0275fac=function(i){return new(i||e)(F(zv),F(De))},e.\u0275prov=J({token:e,factory:e.\u0275fac});let n=e;return n})(),Qf=class{constructor(e){this._doc=e}},jv="ng-app-id",rR=(()=>{let e=class e{constructor(r,i,s,o={}){this.doc=r,this.appId=i,this.nonce=s,this.platformId=o,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=ao(o),this.resetHostNodes()}addStyles(r){for(let i of r)this.changeUsageCount(i,1)===1&&this.onStyleAdded(i)}removeStyles(r){for(let i of r)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){let r=this.styleNodesInDOM;r&&(r.forEach(i=>i.remove()),r.clear());for(let i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(r){this.hostNodes.add(r);for(let i of this.getAllStyles())this.addStyleToHost(r,i)}removeHost(r){this.hostNodes.delete(r)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(r){for(let i of this.hostNodes)this.addStyleToHost(i,r)}onStyleRemoved(r){let i=this.styleRef;i.get(r)?.elements?.forEach(s=>s.remove()),i.delete(r)}collectServerRenderedStyles(){let r=this.doc.head?.querySelectorAll(`style[${jv}="${this.appId}"]`);if(r?.length){let i=new Map;return r.forEach(s=>{s.textContent!=null&&i.set(s.textContent,s)}),i}return null}changeUsageCount(r,i){let s=this.styleRef;if(s.has(r)){let o=s.get(r);return o.usage+=i,o.usage}return s.set(r,{usage:i,elements:[]}),i}getStyleElement(r,i){let s=this.styleNodesInDOM,o=s?.get(i);if(o?.parentNode===r)return s.delete(i),o.removeAttribute(jv),o;{let a=this.doc.createElement("style");return this.nonce&&a.setAttribute("nonce",this.nonce),a.textContent=i,this.platformIsServer&&a.setAttribute(jv,this.appId),r.appendChild(a),a}}addStyleToHost(r,i){let s=this.getStyleElement(r,i),o=this.styleRef,a=o.get(i)?.elements;a?a.push(s):o.set(i,{elements:[s],usage:1})}resetHostNodes(){let r=this.hostNodes;r.clear(),r.add(this.doc.head)}};e.\u0275fac=function(i){return new(i||e)(F(An),F(Rf),F(rv,8),F(jt))},e.\u0275prov=J({token:e,factory:e.\u0275fac});let n=e;return n})(),Bv={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Wv=/%COMP%/g,iR="%COMP%",o$=`_nghost-${iR}`,a$=`_ngcontent-${iR}`,c$=!0,u$=new K("",{providedIn:"root",factory:()=>c$});function l$(n){return a$.replace(Wv,n)}function d$(n){return o$.replace(Wv,n)}function sR(n,e){return e.map(t=>t.replace(Wv,n))}var Jx=(()=>{let e=class e{constructor(r,i,s,o,a,c,l,d=null){this.eventManager=r,this.sharedStylesHost=i,this.appId=s,this.removeStylesOnCompDestroy=o,this.doc=a,this.platformId=c,this.ngZone=l,this.nonce=d,this.rendererByCompId=new Map,this.platformIsServer=ao(c),this.defaultRenderer=new Ku(r,a,l,this.platformIsServer)}createRenderer(r,i){if(!r||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===Ar.ShadowDom&&(i=nt(Q({},i),{encapsulation:Ar.Emulated}));let s=this.getOrCreateRenderer(r,i);return s instanceof Yf?s.applyToHost(r):s instanceof Qu&&s.applyStyles(),s}getOrCreateRenderer(r,i){let s=this.rendererByCompId,o=s.get(i.id);if(!o){let a=this.doc,c=this.ngZone,l=this.eventManager,d=this.sharedStylesHost,f=this.removeStylesOnCompDestroy,g=this.platformIsServer;switch(i.encapsulation){case Ar.Emulated:o=new Yf(l,d,i,this.appId,f,a,c,g);break;case Ar.ShadowDom:return new Gv(l,d,r,i,a,c,this.nonce,g);default:o=new Qu(l,d,i,f,a,c,g);break}s.set(i.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}};e.\u0275fac=function(i){return new(i||e)(F(nR),F(rR),F(Rf),F(u$),F(An),F(jt),F(De),F(rv))},e.\u0275prov=J({token:e,factory:e.\u0275fac});let n=e;return n})(),Ku=class{constructor(e,t,r,i){this.eventManager=e,this.doc=t,this.ngZone=r,this.platformIsServer=i,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(e,t){return t?this.doc.createElementNS(Bv[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(eR(e)?e.content:e).appendChild(t)}insertBefore(e,t,r){e&&(eR(e)?e.content:e).insertBefore(t,r)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let r=typeof e=="string"?this.doc.querySelector(e):e;if(!r)throw new se(-5104,!1);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,i){if(i){t=i+":"+t;let s=Bv[i];s?e.setAttributeNS(s,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){let i=Bv[r];i?e.removeAttributeNS(i,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,i){i&(Wi.DashCase|Wi.Important)?e.style.setProperty(t,r,i&Wi.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&Wi.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){e!=null&&(e[t]=r)}setValue(e,t){e.nodeValue=t}listen(e,t,r){if(typeof e=="string"&&(e=so().getGlobalEventTarget(this.doc,e),!e))throw new Error(`Unsupported event target ${e} for event ${t}`);return this.eventManager.addEventListener(e,t,this.decoratePreventDefault(r))}decoratePreventDefault(e){return t=>{if(t==="__ngUnwrap__")return e;(this.platformIsServer?this.ngZone.runGuarded(()=>e(t)):e(t))===!1&&t.preventDefault()}}};function eR(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var Gv=class extends Ku{constructor(e,t,r,i,s,o,a,c){super(e,s,o,c),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let l=sR(i.id,i.styles);for(let d of l){let f=document.createElement("style");a&&f.setAttribute("nonce",a),f.textContent=d,this.shadowRoot.appendChild(f)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Qu=class extends Ku{constructor(e,t,r,i,s,o,a,c){super(e,s,o,a),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=i,this.styles=c?sR(c,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},Yf=class extends Qu{constructor(e,t,r,i,s,o,a,c){let l=i+"-"+r.id;super(e,t,r,s,o,a,c,l),this.contentAttr=l$(l),this.hostAttr=d$(l)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){let r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}},h$=(()=>{let e=class e extends Qf{constructor(r){super(r)}supports(r){return!0}addEventListener(r,i,s){return r.addEventListener(i,s,!1),()=>this.removeEventListener(r,i,s)}removeEventListener(r,i,s){return r.removeEventListener(i,s)}};e.\u0275fac=function(i){return new(i||e)(F(An))},e.\u0275prov=J({token:e,factory:e.\u0275fac});let n=e;return n})(),tR=["alt","control","meta","shift"],f$={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},p$={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},g$=(()=>{let e=class e extends Qf{constructor(r){super(r)}supports(r){return e.parseEventName(r)!=null}addEventListener(r,i,s){let o=e.parseEventName(i),a=e.eventCallback(o.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>so().onAndCancel(r,o.domEventName,a))}static parseEventName(r){let i=r.toLowerCase().split("."),s=i.shift();if(i.length===0||!(s==="keydown"||s==="keyup"))return null;let o=e._normalizeKey(i.pop()),a="",c=i.indexOf("code");if(c>-1&&(i.splice(c,1),a="code."),tR.forEach(d=>{let f=i.indexOf(d);f>-1&&(i.splice(f,1),a+=d+".")}),a+=o,i.length!=0||o.length===0)return null;let l={};return l.domEventName=s,l.fullKey=a,l}static matchEventFullKeyCode(r,i){let s=f$[r.key]||r.key,o="";return i.indexOf("code.")>-1&&(s=r.code,o="code."),s==null||!s?!1:(s=s.toLowerCase(),s===" "?s="space":s==="."&&(s="dot"),tR.forEach(a=>{if(a!==s){let c=p$[a];c(r)&&(o+=a+".")}}),o+=s,o===i)}static eventCallback(r,i,s){return o=>{e.matchEventFullKeyCode(o,r)&&s.runGuarded(()=>i(o))}}static _normalizeKey(r){return r==="esc"?"escape":r}};e.\u0275fac=function(i){return new(i||e)(F(An))},e.\u0275prov=J({token:e,factory:e.\u0275fac});let n=e;return n})();function m$(){qv.makeCurrent()}function y$(){return new Mr}function _$(){return BA(document),document}var v$=[{provide:jt,useValue:Uv},{provide:nv,useValue:m$,multi:!0},{provide:An,useFactory:_$,deps:[]}],oR=Dv(kx,"browser",v$),w$=new K(""),E$=[{provide:Gu,useClass:Hv,deps:[]},{provide:wv,useClass:qf,deps:[De,Hf,Gu]},{provide:qf,useClass:qf,deps:[De,Hf,Gu]}],I$=[{provide:Tf,useValue:"root"},{provide:Mr,useFactory:y$,deps:[]},{provide:zv,useClass:h$,multi:!0,deps:[An,De,jt]},{provide:zv,useClass:g$,multi:!0,deps:[An]},Jx,rR,nR,{provide:Uu,useExisting:Jx},{provide:Kf,useClass:s$,deps:[]},[]],aR=(()=>{let e=class e{constructor(r){}static withServerTransition(r){return{ngModule:e,providers:[{provide:Rf,useValue:r.appId}]}}};e.\u0275fac=function(i){return new(i||e)(F(w$,12))},e.\u0275mod=wt({type:e}),e.\u0275inj=vt({providers:[...I$,...E$],imports:[Zx,Ox]});let n=e;return n})();var cR=(()=>{let e=class e{constructor(r){this._doc=r}getTitle(){return this._doc.title}setTitle(r){this._doc.title=r||""}};e.\u0275fac=function(i){return new(i||e)(F(An))},e.\u0275prov=J({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var _e="primary",ll=Symbol("RouteTitle"),Xv=class{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function Va(n){return new Xv(n)}function C$(n,e,t){let r=t.path.split("/");if(r.length>n.length||t.pathMatch==="full"&&(e.hasChildren()||r.length<n.length))return null;let i={};for(let s=0;s<r.length;s++){let o=r[s],a=n[s];if(o.startsWith(":"))i[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:n.slice(0,r.length),posParams:i}}function T$(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!Fr(n[t],e[t]))return!1;return!0}function Fr(n,e){let t=n?Jv(n):void 0,r=e?Jv(e):void 0;if(!t||!r||t.length!=r.length)return!1;let i;for(let s=0;s<t.length;s++)if(i=t[s],!_R(n[i],e[i]))return!1;return!0}function Jv(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function _R(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;let t=[...n].sort(),r=[...e].sort();return t.every((i,s)=>r[s]===i)}else return n===e}function vR(n){return n.length>0?n[n.length-1]:null}function Xi(n){return Py(n)?n:Ma(n)?xe(Promise.resolve(n)):ne(n)}var D$={exact:ER,subset:IR},wR={exact:b$,subset:S$,ignored:()=>!0};function lR(n,e,t){return D$[t.paths](n.root,e.root,t.matrixParams)&&wR[t.queryParams](n.queryParams,e.queryParams)&&!(t.fragment==="exact"&&n.fragment!==e.fragment)}function b$(n,e){return Fr(n,e)}function ER(n,e,t){if(!uo(n.segments,e.segments)||!Jf(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(let r in e.children)if(!n.children[r]||!ER(n.children[r],e.children[r],t))return!1;return!0}function S$(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>_R(n[t],e[t]))}function IR(n,e,t){return CR(n,e,e.segments,t)}function CR(n,e,t,r){if(n.segments.length>t.length){let i=n.segments.slice(0,t.length);return!(!uo(i,t)||e.hasChildren()||!Jf(i,t,r))}else if(n.segments.length===t.length){if(!uo(n.segments,t)||!Jf(n.segments,t,r))return!1;for(let i in e.children)if(!n.children[i]||!IR(n.children[i],e.children[i],r))return!1;return!0}else{let i=t.slice(0,n.segments.length),s=t.slice(n.segments.length);return!uo(n.segments,i)||!Jf(n.segments,i,r)||!n.children[_e]?!1:CR(n.children[_e],e,s,r)}}function Jf(n,e,t){return e.every((r,i)=>wR[t](n[i].parameters,r.parameters))}var Qi=class{constructor(e=new $e([],{}),t={},r=null){this.root=e,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap??=Va(this.queryParams),this._queryParamMap}toString(){return R$.serialize(this)}},$e=class{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Object.values(t).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return ep(this)}},co=class{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=Va(this.parameters),this._parameterMap}toString(){return DR(this)}};function A$(n,e){return uo(n,e)&&n.every((t,r)=>Fr(t.parameters,e[r].parameters))}function uo(n,e){return n.length!==e.length?!1:n.every((t,r)=>t.path===e[r].path)}function x$(n,e){let t=[];return Object.entries(n.children).forEach(([r,i])=>{r===_e&&(t=t.concat(e(i,r)))}),Object.entries(n.children).forEach(([r,i])=>{r!==_e&&(t=t.concat(e(i,r)))}),t}var dl=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=J({token:e,factory:()=>new nl,providedIn:"root"});let n=e;return n})(),nl=class{parse(e){let t=new tw(e);return new Qi(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${Yu(e.root,!0)}`,r=P$(e.queryParams),i=typeof e.fragment=="string"?`#${M$(e.fragment)}`:"";return`${t}${r}${i}`}},R$=new nl;function ep(n){return n.segments.map(e=>DR(e)).join("/")}function Yu(n,e){if(!n.hasChildren())return ep(n);if(e){let t=n.children[_e]?Yu(n.children[_e],!1):"",r=[];return Object.entries(n.children).forEach(([i,s])=>{i!==_e&&r.push(`${i}:${Yu(s,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}else{let t=x$(n,(r,i)=>i===_e?[Yu(n.children[_e],!1)]:[`${i}:${Yu(r,!1)}`]);return Object.keys(n.children).length===1&&n.children[_e]!=null?`${ep(n)}/${t[0]}`:`${ep(n)}/(${t.join("//")})`}}function TR(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Zf(n){return TR(n).replace(/%3B/gi,";")}function M$(n){return encodeURI(n)}function ew(n){return TR(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function tp(n){return decodeURIComponent(n)}function dR(n){return tp(n.replace(/\+/g,"%20"))}function DR(n){return`${ew(n.path)}${N$(n.parameters)}`}function N$(n){return Object.entries(n).map(([e,t])=>`;${ew(e)}=${ew(t)}`).join("")}function P$(n){let e=Object.entries(n).map(([t,r])=>Array.isArray(r)?r.map(i=>`${Zf(t)}=${Zf(i)}`).join("&"):`${Zf(t)}=${Zf(r)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var k$=/^[^\/()?;#]+/;function Kv(n){let e=n.match(k$);return e?e[0]:""}var O$=/^[^\/()?;=#]+/;function F$(n){let e=n.match(O$);return e?e[0]:""}var L$=/^[^=?&#]+/;function V$(n){let e=n.match(L$);return e?e[0]:""}var U$=/^[^&#]+/;function j$(n){let e=n.match(U$);return e?e[0]:""}var tw=class{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new $e([],{}):new $e([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(r[_e]=new $e(e,t)),r}parseSegment(){let e=Kv(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new se(4009,!1);return this.capture(e),new co(tp(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=F$(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let i=Kv(this.remaining);i&&(r=i,this.capture(r))}e[tp(t)]=tp(r)}parseQueryParam(e){let t=V$(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let o=j$(this.remaining);o&&(r=o,this.capture(r))}let i=dR(t),s=dR(r);if(e.hasOwnProperty(i)){let o=e[i];Array.isArray(o)||(o=[o],e[i]=o),o.push(s)}else e[i]=s}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=Kv(this.remaining),i=this.remaining[r.length];if(i!=="/"&&i!==")"&&i!==";")throw new se(4010,!1);let s;r.indexOf(":")>-1?(s=r.slice(0,r.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=_e);let o=this.parseChildren();t[s]=Object.keys(o).length===1?o[_e]:new $e([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new se(4011,!1)}};function bR(n){return n.segments.length>0?new $e([],{[_e]:n}):n}function SR(n){let e={};for(let[r,i]of Object.entries(n.children)){let s=SR(i);if(r===_e&&s.segments.length===0&&s.hasChildren())for(let[o,a]of Object.entries(s.children))e[o]=a;else(s.segments.length>0||s.hasChildren())&&(e[r]=s)}let t=new $e(n.segments,e);return B$(t)}function B$(n){if(n.numberOfChildren===1&&n.children[_e]){let e=n.children[_e];return new $e(n.segments.concat(e.segments),e.children)}return n}function Ua(n){return n instanceof Qi}function $$(n,e,t=null,r=null){let i=AR(n);return xR(i,e,t,r)}function AR(n){let e;function t(s){let o={};for(let c of s.children){let l=t(c);o[c.outlet]=l}let a=new $e(s.url,o);return s===n&&(e=a),a}let r=t(n.root),i=bR(r);return e??i}function xR(n,e,t,r){let i=n;for(;i.parent;)i=i.parent;if(e.length===0)return Qv(i,i,i,t,r);let s=q$(e);if(s.toRoot())return Qv(i,i,new $e([],{}),t,r);let o=H$(s,i,n),a=o.processChildren?Ju(o.segmentGroup,o.index,s.commands):MR(o.segmentGroup,o.index,s.commands);return Qv(i,o.segmentGroup,a,t,r)}function np(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function rl(n){return typeof n=="object"&&n!=null&&n.outlets}function Qv(n,e,t,r,i){let s={};r&&Object.entries(r).forEach(([c,l])=>{s[c]=Array.isArray(l)?l.map(d=>`${d}`):`${l}`});let o;n===e?o=t:o=RR(n,e,t);let a=bR(SR(o));return new Qi(a,s,i)}function RR(n,e,t){let r={};return Object.entries(n.children).forEach(([i,s])=>{s===e?r[i]=t:r[i]=RR(s,e,t)}),new $e(n.segments,r)}var rp=class{constructor(e,t,r){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=r,e&&r.length>0&&np(r[0]))throw new se(4003,!1);let i=r.find(rl);if(i&&i!==vR(r))throw new se(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function q$(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new rp(!0,0,n);let e=0,t=!1,r=n.reduce((i,s,o)=>{if(typeof s=="object"&&s!=null){if(s.outlets){let a={};return Object.entries(s.outlets).forEach(([c,l])=>{a[c]=typeof l=="string"?l.split("/"):l}),[...i,{outlets:a}]}if(s.segmentPath)return[...i,s.segmentPath]}return typeof s!="string"?[...i,s]:o===0?(s.split("/").forEach((a,c)=>{c==0&&a==="."||(c==0&&a===""?t=!0:a===".."?e++:a!=""&&i.push(a))}),i):[...i,s]},[]);return new rp(t,e,r)}var Fa=class{constructor(e,t,r){this.segmentGroup=e,this.processChildren=t,this.index=r}};function H$(n,e,t){if(n.isAbsolute)return new Fa(e,!0,0);if(!t)return new Fa(e,!1,NaN);if(t.parent===null)return new Fa(t,!0,0);let r=np(n.commands[0])?0:1,i=t.segments.length-1+r;return z$(t,i,n.numberOfDoubleDots)}function z$(n,e,t){let r=n,i=e,s=t;for(;s>i;){if(s-=i,r=r.parent,!r)throw new se(4005,!1);i=r.segments.length}return new Fa(r,!1,i-s)}function G$(n){return rl(n[0])?n[0].outlets:{[_e]:n}}function MR(n,e,t){if(n??=new $e([],{}),n.segments.length===0&&n.hasChildren())return Ju(n,e,t);let r=W$(n,e,t),i=t.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){let s=new $e(n.segments.slice(0,r.pathIndex),{});return s.children[_e]=new $e(n.segments.slice(r.pathIndex),n.children),Ju(s,0,i)}else return r.match&&i.length===0?new $e(n.segments,{}):r.match&&!n.hasChildren()?nw(n,e,t):r.match?Ju(n,0,i):nw(n,e,t)}function Ju(n,e,t){if(t.length===0)return new $e(n.segments,{});{let r=G$(t),i={};if(Object.keys(r).some(s=>s!==_e)&&n.children[_e]&&n.numberOfChildren===1&&n.children[_e].segments.length===0){let s=Ju(n.children[_e],e,t);return new $e(n.segments,s.children)}return Object.entries(r).forEach(([s,o])=>{typeof o=="string"&&(o=[o]),o!==null&&(i[s]=MR(n.children[s],e,o))}),Object.entries(n.children).forEach(([s,o])=>{r[s]===void 0&&(i[s]=o)}),new $e(n.segments,i)}}function W$(n,e,t){let r=0,i=e,s={match:!1,pathIndex:0,commandIndex:0};for(;i<n.segments.length;){if(r>=t.length)return s;let o=n.segments[i],a=t[r];if(rl(a))break;let c=`${a}`,l=r<t.length-1?t[r+1]:null;if(i>0&&c===void 0)break;if(c&&l&&typeof l=="object"&&l.outlets===void 0){if(!fR(c,l,o))return s;r+=2}else{if(!fR(c,{},o))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}function nw(n,e,t){let r=n.segments.slice(0,e),i=0;for(;i<t.length;){let s=t[i];if(rl(s)){let c=K$(s.outlets);return new $e(r,c)}if(i===0&&np(t[0])){let c=n.segments[e];r.push(new co(c.path,hR(t[0]))),i++;continue}let o=rl(s)?s.outlets[_e]:`${s}`,a=i<t.length-1?t[i+1]:null;o&&a&&np(a)?(r.push(new co(o,hR(a))),i+=2):(r.push(new co(o,{})),i++)}return new $e(r,{})}function K$(n){let e={};return Object.entries(n).forEach(([t,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(e[t]=nw(new $e([],{}),0,r))}),e}function hR(n){let e={};return Object.entries(n).forEach(([t,r])=>e[t]=`${r}`),e}function fR(n,e,t){return n==t.path&&Fr(e,t.parameters)}var el="imperative",Bt=function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n}(Bt||{}),Zn=class{constructor(e,t){this.id=e,this.url=t}},ja=class extends Zn{constructor(e,t,r="imperative",i=null){super(e,t),this.type=Bt.NavigationStart,this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},_i=class extends Zn{constructor(e,t,r){super(e,t),this.urlAfterRedirects=r,this.type=Bt.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Fn=function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n}(Fn||{}),ip=function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n}(ip||{}),Yi=class extends Zn{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=Bt.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Zi=class extends Zn{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=Bt.NavigationSkipped}},il=class extends Zn{constructor(e,t,r,i){super(e,t),this.error=r,this.target=i,this.type=Bt.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},sp=class extends Zn{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Bt.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},rw=class extends Zn{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Bt.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},iw=class extends Zn{constructor(e,t,r,i,s){super(e,t),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=s,this.type=Bt.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},sw=class extends Zn{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Bt.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},ow=class extends Zn{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Bt.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},aw=class{constructor(e){this.route=e,this.type=Bt.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},cw=class{constructor(e){this.route=e,this.type=Bt.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},uw=class{constructor(e){this.snapshot=e,this.type=Bt.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},lw=class{constructor(e){this.snapshot=e,this.type=Bt.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},dw=class{constructor(e){this.snapshot=e,this.type=Bt.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},hw=class{constructor(e){this.snapshot=e,this.type=Bt.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},op=class{constructor(e,t,r){this.routerEvent=e,this.position=t,this.anchor=r,this.type=Bt.Scroll}toString(){let e=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${e}')`}},sl=class{},ol=class{constructor(e){this.url=e}};var fw=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new hl,this.attachRef=null}},hl=(()=>{let e=class e{constructor(){this.contexts=new Map}onChildOutletCreated(r,i){let s=this.getOrCreateContext(r);s.outlet=i,this.contexts.set(r,s)}onChildOutletDestroyed(r){let i=this.getContext(r);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){let r=this.contexts;return this.contexts=new Map,r}onOutletReAttached(r){this.contexts=r}getOrCreateContext(r){let i=this.getContext(r);return i||(i=new fw,this.contexts.set(r,i)),i}getContext(r){return this.contexts.get(r)||null}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=J({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),ap=class{constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=pw(e,this._root);return t?t.children.map(r=>r.value):[]}firstChild(e){let t=pw(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=gw(e,this._root);return t.length<2?[]:t[t.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return gw(e,this._root).map(t=>t.value)}};function pw(n,e){if(n===e.value)return e;for(let t of e.children){let r=pw(n,t);if(r)return r}return null}function gw(n,e){if(n===e.value)return[e];for(let t of e.children){let r=gw(n,t);if(r.length)return r.unshift(e),r}return[]}var On=class{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function Oa(n){let e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}var cp=class extends ap{constructor(e,t){super(e),this.snapshot=t,Dw(this,e)}toString(){return this.snapshot.toString()}};function NR(n){let e=Q$(n),t=new Kt([new co("",{})]),r=new Kt({}),i=new Kt({}),s=new Kt({}),o=new Kt(""),a=new Ba(t,r,s,o,i,_e,n,e.root);return a.snapshot=e.root,new cp(new On(a,[]),e)}function Q$(n){let e={},t={},r={},i="",s=new al([],e,r,i,t,_e,n,null,{});return new up("",new On(s,[]))}var Ba=class{constructor(e,t,r,i,s,o,a,c){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=r,this.fragmentSubject=i,this.dataSubject=s,this.outlet=o,this.component=a,this._futureSnapshot=c,this.title=this.dataSubject?.pipe(ee(l=>l[ll]))??ne(void 0),this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(ee(e=>Va(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(ee(e=>Va(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function Tw(n,e,t="emptyOnly"){let r,{routeConfig:i}=n;return e!==null&&(t==="always"||i?.path===""||!e.component&&!e.routeConfig?.loadComponent)?r={params:Q(Q({},e.params),n.params),data:Q(Q({},e.data),n.data),resolve:Q(Q(Q(Q({},n.data),e.data),i?.data),n._resolvedData)}:r={params:Q({},n.params),data:Q({},n.data),resolve:Q(Q({},n.data),n._resolvedData??{})},i&&kR(i)&&(r.resolve[ll]=i.title),r}var al=class{get title(){return this.data?.[ll]}constructor(e,t,r,i,s,o,a,c,l){this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s,this.outlet=o,this.component=a,this.routeConfig=c,this._resolve=l}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Va(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Va(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(r=>r.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},up=class extends ap{constructor(e,t){super(t),this.url=e,Dw(this,t)}toString(){return PR(this._root)}};function Dw(n,e){e.value._routerState=n,e.children.forEach(t=>Dw(n,t))}function PR(n){let e=n.children.length>0?` { ${n.children.map(PR).join(", ")} } `:"";return`${n.value}${e}`}function Yv(n){if(n.snapshot){let e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,Fr(e.queryParams,t.queryParams)||n.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&n.fragmentSubject.next(t.fragment),Fr(e.params,t.params)||n.paramsSubject.next(t.params),T$(e.url,t.url)||n.urlSubject.next(t.url),Fr(e.data,t.data)||n.dataSubject.next(t.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function mw(n,e){let t=Fr(n.params,e.params)&&A$(n.url,e.url),r=!n.parent!=!e.parent;return t&&!r&&(!n.parent||mw(n.parent,e.parent))}function kR(n){return typeof n.title=="string"||n.title===null}var Y$=(()=>{let e=class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=_e,this.activateEvents=new ln,this.deactivateEvents=new ln,this.attachEvents=new ln,this.detachEvents=new ln,this.parentContexts=G(hl),this.location=G(Ra),this.changeDetector=G(io),this.environmentInjector=G(bn),this.inputBinder=G(pp,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(r){if(r.name){let{firstChange:i,previousValue:s}=r.name;if(i)return;this.isTrackedInParentContexts(s)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(s)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(r){return this.parentContexts.getContext(r)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let r=this.parentContexts.getContext(this.name);r?.route&&(r.attachRef?this.attach(r.attachRef,r.route):this.activateWith(r.route,r.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new se(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new se(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new se(4012,!1);this.location.detach();let r=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(r.instance),r}attach(r,i){this.activated=r,this._activatedRoute=i,this.location.insert(r.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(r.instance)}deactivate(){if(this.activated){let r=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(r)}}activateWith(r,i){if(this.isActivated)throw new se(4013,!1);this._activatedRoute=r;let s=this.location,a=r.snapshot.component,c=this.parentContexts.getOrCreateContext(this.name).children,l=new yw(r,c,s.injector);this.activated=s.createComponent(a,{index:s.length,injector:l,environmentInjector:i??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=Aa({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Af]});let n=e;return n})(),yw=class n{__ngOutletInjector(e){return new n(this.route,this.childContexts,e)}constructor(e,t,r){this.route=e,this.childContexts=t,this.parent=r}get(e,t){return e===Ba?this.route:e===hl?this.childContexts:this.parent.get(e,t)}},pp=new K(""),pR=(()=>{let e=class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(r){this.unsubscribeFromRouteData(r),this.subscribeToRouteData(r)}unsubscribeFromRouteData(r){this.outletDataSubscriptions.get(r)?.unsubscribe(),this.outletDataSubscriptions.delete(r)}subscribeToRouteData(r){let{activatedRoute:i}=r,s=Tu([i.queryParams,i.params,i.data]).pipe(We(([o,a,c],l)=>(c=Q(Q(Q({},o),a),c),l===0?ne(c):Promise.resolve(c)))).subscribe(o=>{if(!r.isActivated||!r.activatedComponentRef||r.activatedRoute!==i||i.component===null){this.unsubscribeFromRouteData(r);return}let a=Fx(i.component);if(!a){this.unsubscribeFromRouteData(r);return}for(let{templateName:c}of a.inputs)r.activatedComponentRef.setInput(c,o[c])});this.outletDataSubscriptions.set(r,s)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=J({token:e,factory:e.\u0275fac});let n=e;return n})();function Z$(n,e,t){let r=cl(n,e._root,t?t._root:void 0);return new cp(r,e)}function cl(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){let r=t.value;r._futureSnapshot=e.value;let i=X$(n,e,t);return new On(r,i)}else{if(n.shouldAttach(e.value)){let s=n.retrieve(e.value);if(s!==null){let o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(a=>cl(n,a)),o}}let r=J$(e.value),i=e.children.map(s=>cl(n,s));return new On(r,i)}}function X$(n,e,t){return e.children.map(r=>{for(let i of t.children)if(n.shouldReuseRoute(r.value,i.value.snapshot))return cl(n,r,i);return cl(n,r)})}function J$(n){return new Ba(new Kt(n.url),new Kt(n.params),new Kt(n.queryParams),new Kt(n.fragment),new Kt(n.data),n.outlet,n.component,n)}var OR="ngNavigationCancelingError";function FR(n,e){let{redirectTo:t,navigationBehaviorOptions:r}=Ua(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,i=LR(!1,Fn.Redirect);return i.url=t,i.navigationBehaviorOptions=r,i}function LR(n,e){let t=new Error(`NavigationCancelingError: ${n||""}`);return t[OR]=!0,t.cancellationCode=e,t}function eq(n){return VR(n)&&Ua(n.url)}function VR(n){return!!n&&n[OR]}var tq=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Yn({type:e,selectors:[["ng-component"]],standalone:!0,features:[Cx],decls:1,vars:0,template:function(i,s){i&1&&kn(0,"router-outlet")},dependencies:[Y$],encapsulation:2});let n=e;return n})();function nq(n,e){return n.providers&&!n._injector&&(n._injector=Uf(n.providers,e,`Route: ${n.path}`)),n._injector??e}function bw(n){let e=n.children&&n.children.map(bw),t=e?nt(Q({},n),{children:e}):Q({},n);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==_e&&(t.component=tq),t}function Lr(n){return n.outlet||_e}function rq(n,e){let t=n.filter(r=>Lr(r)===e);return t.push(...n.filter(r=>Lr(r)!==e)),t}function fl(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var iq=(n,e,t,r)=>ee(i=>(new _w(e,i.targetRouterState,i.currentRouterState,t,r).activate(n),i)),_w=class{constructor(e,t,r,i,s){this.routeReuseStrategy=e,this.futureState=t,this.currState=r,this.forwardEvent=i,this.inputBindingEnabled=s}activate(e){let t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,e),Yv(this.futureState.root),this.activateChildRoutes(t,r,e)}deactivateChildRoutes(e,t,r){let i=Oa(t);e.children.forEach(s=>{let o=s.value.outlet;this.deactivateRoutes(s,i[o],r),delete i[o]}),Object.values(i).forEach(s=>{this.deactivateRouteAndItsChildren(s,r)})}deactivateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(i===s)if(i.component){let o=r.getContext(i.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,r);else s&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=Oa(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);if(r&&r.outlet){let o=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=Oa(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(e,t,r){let i=Oa(t);e.children.forEach(s=>{this.activateRoutes(s,i[s.value.outlet],r),this.forwardEvent(new hw(s.value.snapshot))}),e.children.length&&this.forwardEvent(new lw(e.value.snapshot))}activateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(Yv(i),i===s)if(i.component){let o=r.getOrCreateContext(i.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,r);else if(i.component){let o=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){let a=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),Yv(a.route.value),this.activateChildRoutes(e,null,o.children)}else{let a=fl(i.snapshot);o.attachRef=null,o.route=i,o.injector=a,o.outlet&&o.outlet.activateWith(i,o.injector),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,r)}},lp=class{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},La=class{constructor(e,t){this.component=e,this.route=t}};function sq(n,e,t){let r=n._root,i=e?e._root:null;return Zu(r,i,t,[r.value])}function oq(n){let e=n.routeConfig?n.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:n,guards:e}}function qa(n,e){let t=Symbol(),r=e.get(n,t);return r===t?typeof n=="function"&&!RS(n)?n:e.get(n):r}function Zu(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=Oa(e);return n.children.forEach(o=>{aq(o,s[o.value.outlet],t,r.concat([o.value]),i),delete s[o.value.outlet]}),Object.entries(s).forEach(([o,a])=>tl(a,t.getContext(o),i)),i}function aq(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=n.value,o=e?e.value:null,a=t?t.getContext(n.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){let c=cq(o,s,s.routeConfig.runGuardsAndResolvers);c?i.canActivateChecks.push(new lp(r)):(s.data=o.data,s._resolvedData=o._resolvedData),s.component?Zu(n,e,a?a.children:null,r,i):Zu(n,e,t,r,i),c&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new La(a.outlet.component,o))}else o&&tl(e,a,i),i.canActivateChecks.push(new lp(r)),s.component?Zu(n,null,a?a.children:null,r,i):Zu(n,null,t,r,i);return i}function cq(n,e,t){if(typeof t=="function")return t(n,e);switch(t){case"pathParamsChange":return!uo(n.url,e.url);case"pathParamsOrQueryParamsChange":return!uo(n.url,e.url)||!Fr(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!mw(n,e)||!Fr(n.queryParams,e.queryParams);case"paramsChange":default:return!mw(n,e)}}function tl(n,e,t){let r=Oa(n),i=n.value;Object.entries(r).forEach(([s,o])=>{i.component?e?tl(o,e.children.getContext(s),t):tl(o,null,t):tl(o,e,t)}),i.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new La(e.outlet.component,i)):t.canDeactivateChecks.push(new La(null,i)):t.canDeactivateChecks.push(new La(null,i))}function pl(n){return typeof n=="function"}function uq(n){return typeof n=="boolean"}function lq(n){return n&&pl(n.canLoad)}function dq(n){return n&&pl(n.canActivate)}function hq(n){return n&&pl(n.canActivateChild)}function fq(n){return n&&pl(n.canDeactivate)}function pq(n){return n&&pl(n.canMatch)}function UR(n){return n instanceof li||n?.name==="EmptyError"}var Xf=Symbol("INITIAL_VALUE");function $a(){return We(n=>Tu(n.map(e=>e.pipe(di(1),zs(Xf)))).pipe(ee(e=>{for(let t of e)if(t!==!0){if(t===Xf)return Xf;if(t===!1||t instanceof Qi)return t}return!0}),Qt(e=>e!==Xf),di(1)))}function gq(n,e){return bt(t=>{let{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=t;return o.length===0&&s.length===0?ne(nt(Q({},t),{guardsResult:!0})):mq(o,r,i,n).pipe(bt(a=>a&&uq(a)?yq(r,s,n,e):ne(a)),ee(a=>nt(Q({},t),{guardsResult:a})))})}function mq(n,e,t,r){return xe(n).pipe(bt(i=>Iq(i.component,i.route,t,e,r)),Wn(i=>i!==!0,!0))}function yq(n,e,t,r){return xe(e).pipe(Hs(i=>ga(vq(i.route.parent,r),_q(i.route,r),Eq(n,i.path,t),wq(n,i.route,t))),Wn(i=>i!==!0,!0))}function _q(n,e){return n!==null&&e&&e(new dw(n)),ne(!0)}function vq(n,e){return n!==null&&e&&e(new uw(n)),ne(!0)}function wq(n,e,t){let r=e.routeConfig?e.routeConfig.canActivate:null;if(!r||r.length===0)return ne(!0);let i=r.map(s=>$h(()=>{let o=fl(e)??t,a=qa(s,o),c=dq(a)?a.canActivate(e,n):pi(o,()=>a(e,n));return Xi(c).pipe(Wn())}));return ne(i).pipe($a())}function Eq(n,e,t){let r=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>oq(o)).filter(o=>o!==null).map(o=>$h(()=>{let a=o.guards.map(c=>{let l=fl(o.node)??t,d=qa(c,l),f=hq(d)?d.canActivateChild(r,n):pi(l,()=>d(r,n));return Xi(f).pipe(Wn())});return ne(a).pipe($a())}));return ne(s).pipe($a())}function Iq(n,e,t,r,i){let s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!s||s.length===0)return ne(!0);let o=s.map(a=>{let c=fl(e)??i,l=qa(a,c),d=fq(l)?l.canDeactivate(n,e,t,r):pi(c,()=>l(n,e,t,r));return Xi(d).pipe(Wn())});return ne(o).pipe($a())}function Cq(n,e,t,r){let i=e.canLoad;if(i===void 0||i.length===0)return ne(!0);let s=i.map(o=>{let a=qa(o,n),c=lq(a)?a.canLoad(e,t):pi(n,()=>a(e,t));return Xi(c)});return ne(s).pipe($a(),jR(r))}function jR(n){return Sy(St(e=>{if(Ua(e))throw FR(n,e)}),ee(e=>e===!0))}function Tq(n,e,t,r){let i=e.canMatch;if(!i||i.length===0)return ne(!0);let s=i.map(o=>{let a=qa(o,n),c=pq(a)?a.canMatch(e,t):pi(n,()=>a(e,t));return Xi(c)});return ne(s).pipe($a(),jR(r))}var ul=class{constructor(e){this.segmentGroup=e||null}},dp=class extends Error{constructor(e){super(),this.urlTree=e}};function ka(n){return pa(new ul(n))}function Dq(n){return pa(new se(4e3,!1))}function bq(n){return pa(LR(!1,Fn.GuardRejected))}var vw=class{constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let r=[],i=t.root;for(;;){if(r=r.concat(i.segments),i.numberOfChildren===0)return ne(r);if(i.numberOfChildren>1||!i.children[_e])return Dq(e.redirectTo);i=i.children[_e]}}applyRedirectCommands(e,t,r){let i=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,r);if(t.startsWith("/"))throw new dp(i);return i}applyRedirectCreateUrlTree(e,t,r,i){let s=this.createSegmentGroup(e,t.root,r,i);return new Qi(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let r={};return Object.entries(e).forEach(([i,s])=>{if(typeof s=="string"&&s.startsWith(":")){let a=s.substring(1);r[i]=t[a]}else r[i]=s}),r}createSegmentGroup(e,t,r,i){let s=this.createSegments(e,t.segments,r,i),o={};return Object.entries(t.children).forEach(([a,c])=>{o[a]=this.createSegmentGroup(e,c,r,i)}),new $e(s,o)}createSegments(e,t,r,i){return t.map(s=>s.path.startsWith(":")?this.findPosParam(e,s,i):this.findOrReturn(s,r))}findPosParam(e,t,r){let i=r[t.path.substring(1)];if(!i)throw new se(4001,!1);return i}findOrReturn(e,t){let r=0;for(let i of t){if(i.path===e.path)return t.splice(r),i;r++}return e}},ww={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Sq(n,e,t,r,i){let s=Sw(n,e,t);return s.matched?(r=nq(e,r),Tq(r,e,t,i).pipe(ee(o=>o===!0?s:Q({},ww)))):ne(s)}function Sw(n,e,t){if(e.path==="**")return Aq(t);if(e.path==="")return e.pathMatch==="full"&&(n.hasChildren()||t.length>0)?Q({},ww):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let i=(e.matcher||C$)(t,n,e);if(!i)return Q({},ww);let s={};Object.entries(i.posParams??{}).forEach(([a,c])=>{s[a]=c.path});let o=i.consumed.length>0?Q(Q({},s),i.consumed[i.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:i.consumed,remainingSegments:t.slice(i.consumed.length),parameters:o,positionalParamSegments:i.posParams??{}}}function Aq(n){return{matched:!0,parameters:n.length>0?vR(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function gR(n,e,t,r){return t.length>0&&Mq(n,t,r)?{segmentGroup:new $e(e,Rq(r,new $e(t,n.children))),slicedSegments:[]}:t.length===0&&Nq(n,t,r)?{segmentGroup:new $e(n.segments,xq(n,t,r,n.children)),slicedSegments:t}:{segmentGroup:new $e(n.segments,n.children),slicedSegments:t}}function xq(n,e,t,r){let i={};for(let s of t)if(gp(n,e,s)&&!r[Lr(s)]){let o=new $e([],{});i[Lr(s)]=o}return Q(Q({},r),i)}function Rq(n,e){let t={};t[_e]=e;for(let r of n)if(r.path===""&&Lr(r)!==_e){let i=new $e([],{});t[Lr(r)]=i}return t}function Mq(n,e,t){return t.some(r=>gp(n,e,r)&&Lr(r)!==_e)}function Nq(n,e,t){return t.some(r=>gp(n,e,r))}function gp(n,e,t){return(n.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function Pq(n,e,t,r){return Lr(n)!==r&&(r===_e||!gp(e,t,n))?!1:Sw(e,n,t).matched}function kq(n,e,t){return e.length===0&&!n.children[t]}var Ew=class{};function Oq(n,e,t,r,i,s,o="emptyOnly"){return new Iw(n,e,t,r,i,o,s).recognize()}var Fq=31,Iw=class{constructor(e,t,r,i,s,o,a){this.injector=e,this.configLoader=t,this.rootComponentType=r,this.config=i,this.urlTree=s,this.paramsInheritanceStrategy=o,this.urlSerializer=a,this.applyRedirects=new vw(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(e){return new se(4002,`'${e.segmentGroup}'`)}recognize(){let e=gR(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(ee(t=>{let r=new al([],Object.freeze({}),Object.freeze(Q({},this.urlTree.queryParams)),this.urlTree.fragment,{},_e,this.rootComponentType,null,{}),i=new On(r,t),s=new up("",i),o=$$(r,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(o),this.inheritParamsAndData(s._root,null),{state:s,tree:o}}))}match(e){return this.processSegmentGroup(this.injector,this.config,e,_e).pipe(Vi(r=>{if(r instanceof dp)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof ul?this.noMatchError(r):r}))}inheritParamsAndData(e,t){let r=e.value,i=Tw(r,t,this.paramsInheritanceStrategy);r.params=Object.freeze(i.params),r.data=Object.freeze(i.data),e.children.forEach(s=>this.inheritParamsAndData(s,r))}processSegmentGroup(e,t,r,i){return r.segments.length===0&&r.hasChildren()?this.processChildren(e,t,r):this.processSegment(e,t,r,r.segments,i,!0).pipe(ee(s=>s instanceof On?[s]:[]))}processChildren(e,t,r){let i=[];for(let s of Object.keys(r.children))s==="primary"?i.unshift(s):i.push(s);return xe(i).pipe(Hs(s=>{let o=r.children[s],a=rq(t,s);return this.processSegmentGroup(e,a,o,s)}),Dr((s,o)=>(s.push(...o),s)),Ui(null),Fy(),bt(s=>{if(s===null)return ka(r);let o=BR(s);return Lq(o),ne(o)}))}processSegment(e,t,r,i,s,o){return xe(t).pipe(Hs(a=>this.processSegmentAgainstRoute(a._injector??e,t,a,r,i,s,o).pipe(Vi(c=>{if(c instanceof ul)return ne(null);throw c}))),Wn(a=>!!a),Vi(a=>{if(UR(a))return kq(r,i,s)?ne(new Ew):ka(r);throw a}))}processSegmentAgainstRoute(e,t,r,i,s,o,a){return Pq(r,i,s,o)?r.redirectTo===void 0?this.matchSegmentAgainstRoute(e,i,r,s,o):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(e,i,t,r,s,o):ka(i):ka(i)}expandSegmentAgainstRouteUsingRedirect(e,t,r,i,s,o){let{matched:a,consumedSegments:c,positionalParamSegments:l,remainingSegments:d}=Sw(t,i,s);if(!a)return ka(t);i.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>Fq&&(this.allowRedirects=!1));let f=this.applyRedirects.applyRedirectCommands(c,i.redirectTo,l);return this.applyRedirects.lineralizeSegments(i,f).pipe(bt(g=>this.processSegment(e,r,t,g.concat(d),o,!1)))}matchSegmentAgainstRoute(e,t,r,i,s){let o=Sq(t,r,i,e,this.urlSerializer);return r.path==="**"&&(t.children={}),o.pipe(We(a=>a.matched?(e=r._injector??e,this.getChildConfig(e,r,i).pipe(We(({routes:c})=>{let l=r._loadedInjector??e,{consumedSegments:d,remainingSegments:f,parameters:g}=a,y=new al(d,g,Object.freeze(Q({},this.urlTree.queryParams)),this.urlTree.fragment,Uq(r),Lr(r),r.component??r._loadedComponent??null,r,jq(r)),{segmentGroup:v,slicedSegments:b}=gR(t,d,f,c);if(b.length===0&&v.hasChildren())return this.processChildren(l,c,v).pipe(ee(V=>V===null?null:new On(y,V)));if(c.length===0&&b.length===0)return ne(new On(y,[]));let T=Lr(r)===s;return this.processSegment(l,c,v,b,T?_e:s,!0).pipe(ee(V=>new On(y,V instanceof On?[V]:[])))}))):ka(t)))}getChildConfig(e,t,r){return t.children?ne({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?ne({routes:t._loadedRoutes,injector:t._loadedInjector}):Cq(e,t,r,this.urlSerializer).pipe(bt(i=>i?this.configLoader.loadChildren(e,t).pipe(St(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):bq(t))):ne({routes:[],injector:e})}};function Lq(n){n.sort((e,t)=>e.value.outlet===_e?-1:t.value.outlet===_e?1:e.value.outlet.localeCompare(t.value.outlet))}function Vq(n){let e=n.value.routeConfig;return e&&e.path===""}function BR(n){let e=[],t=new Set;for(let r of n){if(!Vq(r)){e.push(r);continue}let i=e.find(s=>r.value.routeConfig===s.value.routeConfig);i!==void 0?(i.children.push(...r.children),t.add(i)):e.push(r)}for(let r of t){let i=BR(r.children);e.push(new On(r.value,i))}return e.filter(r=>!t.has(r))}function Uq(n){return n.data||{}}function jq(n){return n.resolve||{}}function Bq(n,e,t,r,i,s){return bt(o=>Oq(n,e,t,r,o.extractedUrl,i,s).pipe(ee(({state:a,tree:c})=>nt(Q({},o),{targetSnapshot:a,urlAfterRedirects:c}))))}function $q(n,e){return bt(t=>{let{targetSnapshot:r,guards:{canActivateChecks:i}}=t;if(!i.length)return ne(t);let s=new Set(i.map(c=>c.route)),o=new Set;for(let c of s)if(!o.has(c))for(let l of $R(c))o.add(l);let a=0;return xe(o).pipe(Hs(c=>s.has(c)?qq(c,r,n,e):(c.data=Tw(c,c.parent,n).resolve,ne(void 0))),St(()=>a++),ya(1),bt(c=>a===o.size?ne(t):un))})}function $R(n){let e=n.children.map(t=>$R(t)).flat();return[n,...e]}function qq(n,e,t,r){let i=n.routeConfig,s=n._resolve;return i?.title!==void 0&&!kR(i)&&(s[ll]=i.title),Hq(s,n,e,r).pipe(ee(o=>(n._resolvedData=o,n.data=Tw(n,n.parent,t).resolve,null)))}function Hq(n,e,t,r){let i=Jv(n);if(i.length===0)return ne({});let s={};return xe(i).pipe(bt(o=>zq(n[o],e,t,r).pipe(Wn(),St(a=>{s[o]=a}))),ya(1),Oy(s),Vi(o=>UR(o)?un:pa(o)))}function zq(n,e,t,r){let i=fl(e)??r,s=qa(n,i),o=s.resolve?s.resolve(e,t):pi(i,()=>s(e,t));return Xi(o)}function Zv(n){return We(e=>{let t=n(e);return t?xe(t).pipe(ee(()=>e)):ne(e)})}var qR=(()=>{let e=class e{buildTitle(r){let i,s=r.root;for(;s!==void 0;)i=this.getResolvedTitleForRoute(s)??i,s=s.children.find(o=>o.outlet===_e);return i}getResolvedTitleForRoute(r){return r.data[ll]}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=J({token:e,factory:()=>G(Gq),providedIn:"root"});let n=e;return n})(),Gq=(()=>{let e=class e extends qR{constructor(r){super(),this.title=r}updateTitle(r){let i=this.buildTitle(r);i!==void 0&&this.title.setTitle(i)}};e.\u0275fac=function(i){return new(i||e)(F(cR))},e.\u0275prov=J({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),gl=new K("",{providedIn:"root",factory:()=>({})}),hp=new K(""),Aw=(()=>{let e=class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=G(Gf)}loadComponent(r){if(this.componentLoaders.get(r))return this.componentLoaders.get(r);if(r._loadedComponent)return ne(r._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(r);let i=Xi(r.loadComponent()).pipe(ee(HR),St(o=>{this.onLoadEndListener&&this.onLoadEndListener(r),r._loadedComponent=o}),bu(()=>{this.componentLoaders.delete(r)})),s=new la(i,()=>new _t).pipe(ua());return this.componentLoaders.set(r,s),s}loadChildren(r,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return ne({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);let o=Wq(i,this.compiler,r,this.onLoadEndListener).pipe(bu(()=>{this.childrenLoaders.delete(i)})),a=new la(o,()=>new _t).pipe(ua());return this.childrenLoaders.set(i,a),a}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=J({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function Wq(n,e,t,r){return Xi(n.loadChildren()).pipe(ee(HR),bt(i=>i instanceof ju||Array.isArray(i)?ne(i):xe(e.compileModuleAsync(i))),ee(i=>{r&&r(n);let s,o,a=!1;return Array.isArray(i)?(o=i,a=!0):(s=i.create(t).injector,o=s.get(hp,[],{optional:!0,self:!0}).flat()),{routes:o.map(bw),injector:s}}))}function Kq(n){return n&&typeof n=="object"&&"default"in n}function HR(n){return Kq(n)?n.default:n}var xw=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=J({token:e,factory:()=>G(Qq),providedIn:"root"});let n=e;return n})(),Qq=(()=>{let e=class e{shouldProcessUrl(r){return!0}extract(r){return r}merge(r,i){return r}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=J({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),zR=new K(""),GR=new K("");function Yq(n,e,t){let r=n.get(GR),i=n.get(An);return n.get(De).runOutsideAngular(()=>{if(!i.startViewTransition||r.skipNextTransition)return r.skipNextTransition=!1,new Promise(l=>setTimeout(l));let s,o=new Promise(l=>{s=l}),a=i.startViewTransition(()=>(s(),Zq(n))),{onViewTransitionCreated:c}=r;return c&&pi(n,()=>c({transition:a,from:e,to:t})),o})}function Zq(n){return new Promise(e=>{Vf(e,{injector:n})})}var Rw=(()=>{let e=class e{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new _t,this.transitionAbortSubject=new _t,this.configLoader=G(Aw),this.environmentInjector=G(bn),this.urlSerializer=G(dl),this.rootContexts=G(hl),this.location=G(Pa),this.inputBindingEnabled=G(pp,{optional:!0})!==null,this.titleStrategy=G(qR),this.options=G(gl,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=G(xw),this.createViewTransition=G(zR,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>ne(void 0),this.rootComponentType=null;let r=s=>this.events.next(new aw(s)),i=s=>this.events.next(new cw(s));this.configLoader.onLoadEndListener=i,this.configLoader.onLoadStartListener=r}complete(){this.transitions?.complete()}handleNavigationRequest(r){let i=++this.navigationId;this.transitions?.next(nt(Q(Q({},this.transitions.value),r),{id:i}))}setupNavigations(r,i,s){return this.transitions=new Kt({id:0,currentUrlTree:i,currentRawUrl:i,extractedUrl:this.urlHandlingStrategy.extract(i),urlAfterRedirects:this.urlHandlingStrategy.extract(i),rawUrl:i,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:el,restoredState:null,currentSnapshot:s.snapshot,targetSnapshot:null,currentRouterState:s,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Qt(o=>o.id!==0),ee(o=>nt(Q({},o),{extractedUrl:this.urlHandlingStrategy.extract(o.rawUrl)})),We(o=>{let a=!1,c=!1;return ne(o).pipe(We(l=>{if(this.navigationId>o.id)return this.cancelNavigationTransition(o,"",Fn.SupersededByNewNavigation),un;this.currentTransition=o,this.currentNavigation={id:l.id,initialUrl:l.rawUrl,extractedUrl:l.extractedUrl,trigger:l.source,extras:l.extras,previousNavigation:this.lastSuccessfulNavigation?nt(Q({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let d=!r.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),f=l.extras.onSameUrlNavigation??r.onSameUrlNavigation;if(!d&&f!=="reload"){let g="";return this.events.next(new Zi(l.id,this.urlSerializer.serialize(l.rawUrl),g,ip.IgnoredSameUrlNavigation)),l.resolve(null),un}if(this.urlHandlingStrategy.shouldProcessUrl(l.rawUrl))return ne(l).pipe(We(g=>{let y=this.transitions?.getValue();return this.events.next(new ja(g.id,this.urlSerializer.serialize(g.extractedUrl),g.source,g.restoredState)),y!==this.transitions?.getValue()?un:Promise.resolve(g)}),Bq(this.environmentInjector,this.configLoader,this.rootComponentType,r.config,this.urlSerializer,this.paramsInheritanceStrategy),St(g=>{o.targetSnapshot=g.targetSnapshot,o.urlAfterRedirects=g.urlAfterRedirects,this.currentNavigation=nt(Q({},this.currentNavigation),{finalUrl:g.urlAfterRedirects});let y=new sp(g.id,this.urlSerializer.serialize(g.extractedUrl),this.urlSerializer.serialize(g.urlAfterRedirects),g.targetSnapshot);this.events.next(y)}));if(d&&this.urlHandlingStrategy.shouldProcessUrl(l.currentRawUrl)){let{id:g,extractedUrl:y,source:v,restoredState:b,extras:T}=l,V=new ja(g,this.urlSerializer.serialize(y),v,b);this.events.next(V);let B=NR(this.rootComponentType).snapshot;return this.currentTransition=o=nt(Q({},l),{targetSnapshot:B,urlAfterRedirects:y,extras:nt(Q({},T),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=y,ne(o)}else{let g="";return this.events.next(new Zi(l.id,this.urlSerializer.serialize(l.extractedUrl),g,ip.IgnoredByUrlHandlingStrategy)),l.resolve(null),un}}),St(l=>{let d=new rw(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(d)}),ee(l=>(this.currentTransition=o=nt(Q({},l),{guards:sq(l.targetSnapshot,l.currentSnapshot,this.rootContexts)}),o)),gq(this.environmentInjector,l=>this.events.next(l)),St(l=>{if(o.guardsResult=l.guardsResult,Ua(l.guardsResult))throw FR(this.urlSerializer,l.guardsResult);let d=new iw(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot,!!l.guardsResult);this.events.next(d)}),Qt(l=>l.guardsResult?!0:(this.cancelNavigationTransition(l,"",Fn.GuardRejected),!1)),Zv(l=>{if(l.guards.canActivateChecks.length)return ne(l).pipe(St(d=>{let f=new sw(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(f)}),We(d=>{let f=!1;return ne(d).pipe($q(this.paramsInheritanceStrategy,this.environmentInjector),St({next:()=>f=!0,complete:()=>{f||this.cancelNavigationTransition(d,"",Fn.NoDataFromResolver)}}))}),St(d=>{let f=new ow(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(f)}))}),Zv(l=>{let d=f=>{let g=[];f.routeConfig?.loadComponent&&!f.routeConfig._loadedComponent&&g.push(this.configLoader.loadComponent(f.routeConfig).pipe(St(y=>{f.component=y}),ee(()=>{})));for(let y of f.children)g.push(...d(y));return g};return Tu(d(l.targetSnapshot.root)).pipe(Ui(null),di(1))}),Zv(()=>this.afterPreactivation()),We(()=>{let{currentSnapshot:l,targetSnapshot:d}=o,f=this.createViewTransition?.(this.environmentInjector,l.root,d.root);return f?xe(f).pipe(ee(()=>o)):ne(o)}),ee(l=>{let d=Z$(r.routeReuseStrategy,l.targetSnapshot,l.currentRouterState);return this.currentTransition=o=nt(Q({},l),{targetRouterState:d}),this.currentNavigation.targetRouterState=d,o}),St(()=>{this.events.next(new sl)}),iq(this.rootContexts,r.routeReuseStrategy,l=>this.events.next(l),this.inputBindingEnabled),di(1),St({next:l=>{a=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new _i(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects))),this.titleStrategy?.updateTitle(l.targetRouterState.snapshot),l.resolve(!0)},complete:()=>{a=!0}}),Uy(this.transitionAbortSubject.pipe(St(l=>{throw l}))),bu(()=>{!a&&!c&&this.cancelNavigationTransition(o,"",Fn.SupersededByNewNavigation),this.currentTransition?.id===o.id&&(this.currentNavigation=null,this.currentTransition=null)}),Vi(l=>{if(c=!0,VR(l))this.events.next(new Yi(o.id,this.urlSerializer.serialize(o.extractedUrl),l.message,l.cancellationCode)),eq(l)?this.events.next(new ol(l.url)):o.resolve(!1);else{this.events.next(new il(o.id,this.urlSerializer.serialize(o.extractedUrl),l,o.targetSnapshot??void 0));try{o.resolve(r.errorHandler(l))}catch(d){this.options.resolveNavigationPromiseOnError?o.resolve(!1):o.reject(d)}}return un}))}))}cancelNavigationTransition(r,i,s){let o=new Yi(r.id,this.urlSerializer.serialize(r.extractedUrl),i,s);this.events.next(o),r.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=J({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function Xq(n){return n!==el}var Jq=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=J({token:e,factory:()=>G(eH),providedIn:"root"});let n=e;return n})(),Cw=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},eH=(()=>{let e=class e extends Cw{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=ev(e)))(s||e)}})(),e.\u0275prov=J({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),WR=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=J({token:e,factory:()=>G(tH),providedIn:"root"});let n=e;return n})(),tH=(()=>{let e=class e extends WR{constructor(){super(...arguments),this.location=G(Pa),this.urlSerializer=G(dl),this.options=G(gl,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=G(xw),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new Qi,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=NR(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(r){return this.location.subscribe(i=>{i.type==="popstate"&&r(i.url,i.state)})}handleRouterEvent(r,i){if(r instanceof ja)this.stateMemento=this.createStateMemento();else if(r instanceof Zi)this.rawUrlTree=i.initialUrl;else if(r instanceof sp){if(this.urlUpdateStrategy==="eager"&&!i.extras.skipLocationChange){let s=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl);this.setBrowserUrl(s,i)}}else r instanceof sl?(this.currentUrlTree=i.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl),this.routerState=i.targetRouterState,this.urlUpdateStrategy==="deferred"&&(i.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,i))):r instanceof Yi&&(r.code===Fn.GuardRejected||r.code===Fn.NoDataFromResolver)?this.restoreHistory(i):r instanceof il?this.restoreHistory(i,!0):r instanceof _i&&(this.lastSuccessfulId=r.id,this.currentPageId=this.browserPageId)}setBrowserUrl(r,i){let s=this.urlSerializer.serialize(r);if(this.location.isCurrentPathEqualTo(s)||i.extras.replaceUrl){let o=this.browserPageId,a=Q(Q({},i.extras.state),this.generateNgRouterState(i.id,o));this.location.replaceState(s,"",a)}else{let o=Q(Q({},i.extras.state),this.generateNgRouterState(i.id,this.browserPageId+1));this.location.go(s,"",o)}}restoreHistory(r,i=!1){if(this.canceledNavigationResolution==="computed"){let s=this.browserPageId,o=this.currentPageId-s;o!==0?this.location.historyGo(o):this.currentUrlTree===r.finalUrl&&o===0&&(this.resetState(r),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(i&&this.resetState(r),this.resetUrlToCurrentUrlTree())}resetState(r){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,r.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(r,i){return this.canceledNavigationResolution==="computed"?{navigationId:r,\u0275routerPageId:i}:{navigationId:r}}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=ev(e)))(s||e)}})(),e.\u0275prov=J({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Xu=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.FAILED=1]="FAILED",n[n.REDIRECTING=2]="REDIRECTING",n}(Xu||{});function KR(n,e){n.events.pipe(Qt(t=>t instanceof _i||t instanceof Yi||t instanceof il||t instanceof Zi),ee(t=>t instanceof _i||t instanceof Zi?Xu.COMPLETE:(t instanceof Yi?t.code===Fn.Redirect||t.code===Fn.SupersededByNewNavigation:!1)?Xu.REDIRECTING:Xu.FAILED),Qt(t=>t!==Xu.REDIRECTING),di(1)).subscribe(()=>{e()})}function nH(n){throw n}var rH={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},iH={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},lo=(()=>{let e=class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=G($f),this.stateManager=G(WR),this.options=G(gl,{optional:!0})||{},this.pendingTasks=G(jf),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=G(Rw),this.urlSerializer=G(dl),this.location=G(Pa),this.urlHandlingStrategy=G(xw),this._events=new _t,this.errorHandler=this.options.errorHandler||nH,this.navigated=!1,this.routeReuseStrategy=G(Jq),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=G(hp,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!G(pp,{optional:!0}),this.eventsSubscription=new yt,this.isNgZoneEnabled=G(De)instanceof De&&De.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:r=>{this.console.warn(r)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let r=this.navigationTransitions.events.subscribe(i=>{try{let s=this.navigationTransitions.currentTransition,o=this.navigationTransitions.currentNavigation;if(s!==null&&o!==null){if(this.stateManager.handleRouterEvent(i,o),i instanceof Yi&&i.code!==Fn.Redirect&&i.code!==Fn.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof _i)this.navigated=!0;else if(i instanceof ol){let a=this.urlHandlingStrategy.merge(i.url,s.currentRawUrl),c={info:s.extras.info,skipLocationChange:s.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||Xq(s.source)};this.scheduleNavigation(a,el,null,c,{resolve:s.resolve,reject:s.reject,promise:s.promise})}}oH(i)&&this._events.next(i)}catch(s){this.navigationTransitions.transitionAbortSubject.next(s)}});this.eventsSubscription.add(r)}resetRootComponentType(r){this.routerState.root.component=r,this.navigationTransitions.rootComponentType=r}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),el,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((r,i)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(r,"popstate",i)},0)})}navigateToSyncWithBrowser(r,i,s){let o={replaceUrl:!0},a=s?.navigationId?s:null;if(s){let l=Q({},s);delete l.navigationId,delete l.\u0275routerPageId,Object.keys(l).length!==0&&(o.state=l)}let c=this.parseUrl(r);this.scheduleNavigation(c,i,a,o)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(r){this.config=r.map(bw),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(r,i={}){let{relativeTo:s,queryParams:o,fragment:a,queryParamsHandling:c,preserveFragment:l}=i,d=l?this.currentUrlTree.fragment:a,f=null;switch(c){case"merge":f=Q(Q({},this.currentUrlTree.queryParams),o);break;case"preserve":f=this.currentUrlTree.queryParams;break;default:f=o||null}f!==null&&(f=this.removeEmptyProps(f));let g;try{let y=s?s.snapshot:this.routerState.snapshot.root;g=AR(y)}catch{(typeof r[0]!="string"||!r[0].startsWith("/"))&&(r=[]),g=this.currentUrlTree.root}return xR(g,r,f,d??null)}navigateByUrl(r,i={skipLocationChange:!1}){let s=Ua(r)?r:this.parseUrl(r),o=this.urlHandlingStrategy.merge(s,this.rawUrlTree);return this.scheduleNavigation(o,el,null,i)}navigate(r,i={skipLocationChange:!1}){return sH(r),this.navigateByUrl(this.createUrlTree(r,i),i)}serializeUrl(r){return this.urlSerializer.serialize(r)}parseUrl(r){try{return this.urlSerializer.parse(r)}catch{return this.urlSerializer.parse("/")}}isActive(r,i){let s;if(i===!0?s=Q({},rH):i===!1?s=Q({},iH):s=i,Ua(r))return lR(this.currentUrlTree,r,s);let o=this.parseUrl(r);return lR(this.currentUrlTree,o,s)}removeEmptyProps(r){return Object.entries(r).reduce((i,[s,o])=>(o!=null&&(i[s]=o),i),{})}scheduleNavigation(r,i,s,o,a){if(this.disposed)return Promise.resolve(!1);let c,l,d;a?(c=a.resolve,l=a.reject,d=a.promise):d=new Promise((g,y)=>{c=g,l=y});let f=this.pendingTasks.add();return KR(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(f))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:s,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:r,extras:o,resolve:c,reject:l,promise:d,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),d.catch(g=>Promise.reject(g))}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=J({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function sH(n){for(let e=0;e<n.length;e++)if(n[e]==null)throw new se(4008,!1)}function oH(n){return!(n instanceof sl)&&!(n instanceof ol)}var fp=class{};var aH=(()=>{let e=class e{constructor(r,i,s,o,a){this.router=r,this.injector=s,this.preloadingStrategy=o,this.loader=a}setUpPreloading(){this.subscription=this.router.events.pipe(Qt(r=>r instanceof _i),Hs(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(r,i){let s=[];for(let o of i){o.providers&&!o._injector&&(o._injector=Uf(o.providers,r,`Route: ${o.path}`));let a=o._injector??r,c=o._loadedInjector??a;(o.loadChildren&&!o._loadedRoutes&&o.canLoad===void 0||o.loadComponent&&!o._loadedComponent)&&s.push(this.preloadConfig(a,o)),(o.children||o._loadedRoutes)&&s.push(this.processRoutes(c,o.children??o._loadedRoutes))}return xe(s).pipe(Li())}preloadConfig(r,i){return this.preloadingStrategy.preload(i,()=>{let s;i.loadChildren&&i.canLoad===void 0?s=this.loader.loadChildren(r,i):s=ne(null);let o=s.pipe(bt(a=>a===null?ne(void 0):(i._loadedRoutes=a.routes,i._loadedInjector=a.injector,this.processRoutes(a.injector??r,a.routes))));if(i.loadComponent&&!i._loadedComponent){let a=this.loader.loadComponent(i);return xe([o,a]).pipe(Li())}else return o})}};e.\u0275fac=function(i){return new(i||e)(F(lo),F(Gf),F(bn),F(fp),F(Aw))},e.\u0275prov=J({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),QR=new K(""),cH=(()=>{let e=class e{constructor(r,i,s,o,a={}){this.urlSerializer=r,this.transitions=i,this.viewportScroller=s,this.zone=o,this.options=a,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},this.environmentInjector=G(bn),a.scrollPositionRestoration||="disabled",a.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(r=>{r instanceof ja?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=r.navigationTrigger,this.restoredId=r.restoredState?r.restoredState.navigationId:0):r instanceof _i?(this.lastId=r.id,this.scheduleScrollEvent(r,this.urlSerializer.parse(r.urlAfterRedirects).fragment)):r instanceof Zi&&r.code===ip.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(r,this.urlSerializer.parse(r.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(r=>{r instanceof op&&(r.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(r.position):r.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(r.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(r,i){this.zone.runOutsideAngular(()=>M(this,null,function*(){yield new Promise(s=>{setTimeout(()=>{s()}),Vf(()=>{s()},{injector:this.environmentInjector})}),this.zone.run(()=>{this.transitions.events.next(new op(r,this.lastSource==="popstate"?this.store[this.restoredId]:null,i))})}))}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}};e.\u0275fac=function(i){JA()},e.\u0275prov=J({token:e,factory:e.\u0275fac});let n=e;return n})();function uH(n){return n.routerState.root}function ml(n,e){return{\u0275kind:n,\u0275providers:e}}function lH(){let n=G(kr);return e=>{let t=n.get(Na);if(e!==t.components[0])return;let r=n.get(lo),i=n.get(YR);n.get(Mw)===1&&r.initialNavigation(),n.get(ZR,null,Te.Optional)?.setUpPreloading(),n.get(QR,null,Te.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}var YR=new K("",{factory:()=>new _t}),Mw=new K("",{providedIn:"root",factory:()=>1});function dH(){return ml(2,[{provide:Mw,useValue:0},{provide:zf,multi:!0,deps:[kr],useFactory:e=>{let t=e.get(qx,Promise.resolve());return()=>t.then(()=>new Promise(r=>{let i=e.get(lo),s=e.get(YR);KR(i,()=>{r(!0)}),e.get(Rw).afterPreactivation=()=>(r(!0),s.closed?ne(void 0):s),i.initialNavigation()}))}}])}function hH(){return ml(3,[{provide:zf,multi:!0,useFactory:()=>{let e=G(lo);return()=>{e.setUpLocationChangeListener()}}},{provide:Mw,useValue:2}])}var ZR=new K("");function fH(n){return ml(0,[{provide:ZR,useExisting:aH},{provide:fp,useExisting:n}])}function pH(){return ml(8,[pR,{provide:pp,useExisting:pR}])}function gH(n){let e=[{provide:zR,useValue:Yq},{provide:GR,useValue:Q({skipNextTransition:!!n?.skipInitialTransition},n)}];return ml(9,e)}var mR=new K("ROUTER_FORROOT_GUARD"),mH=[Pa,{provide:dl,useClass:nl},lo,hl,{provide:Ba,useFactory:uH,deps:[lo]},Aw,[]],Nw=(()=>{let e=class e{constructor(r){}static forRoot(r,i){return{ngModule:e,providers:[mH,[],{provide:hp,multi:!0,useValue:r},{provide:mR,useFactory:wH,deps:[[lo,new eo,new Cf]]},{provide:gl,useValue:i||{}},i?.useHash?_H():vH(),yH(),i?.preloadingStrategy?fH(i.preloadingStrategy).\u0275providers:[],i?.initialNavigation?EH(i):[],i?.bindToComponentInputs?pH().\u0275providers:[],i?.enableViewTransitions?gH().\u0275providers:[],IH()]}}static forChild(r){return{ngModule:e,providers:[{provide:hp,multi:!0,useValue:r}]}}};e.\u0275fac=function(i){return new(i||e)(F(mR,8))},e.\u0275mod=wt({type:e}),e.\u0275inj=vt({});let n=e;return n})();function yH(){return{provide:QR,useFactory:()=>{let n=G(Xx),e=G(De),t=G(gl),r=G(Rw),i=G(dl);return t.scrollOffset&&n.setOffset(t.scrollOffset),new cH(i,r,n,e,t)}}}function _H(){return{provide:oo,useClass:zx}}function vH(){return{provide:oo,useClass:Vv}}function wH(n){return"guarded"}function EH(n){return[n.initialNavigation==="disabled"?hH().\u0275providers:[],n.initialNavigation==="enabledBlocking"?dH().\u0275providers:[]]}var yR=new K("");function IH(){return[{provide:yR,useFactory:lH},{provide:Cv,multi:!0,useExisting:yR}]}var CH=[],XR=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=wt({type:e}),e.\u0275inj=vt({imports:[Nw.forRoot(CH),Nw]});let n=e;return n})();var Pw={};(function n(e,t,r,i){var s=!!(e.Worker&&e.Blob&&e.Promise&&e.OffscreenCanvas&&e.OffscreenCanvasRenderingContext2D&&e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype.transferControlToOffscreen&&e.URL&&e.URL.createObjectURL),o=typeof Path2D=="function"&&typeof DOMMatrix=="function",a=function(){if(!e.OffscreenCanvas)return!1;var N=new OffscreenCanvas(1,1),D=N.getContext("2d");D.fillRect(0,0,1,1);var X=N.transferToImageBitmap();try{D.createPattern(X,"no-repeat")}catch{return!1}return!0}();function c(){}function l(N){var D=t.exports.Promise,X=D!==void 0?D:e.Promise;return typeof X=="function"?new X(N):(N(c,c),null)}var d=function(N,D){return{transform:function(X){if(N)return X;if(D.has(X))return D.get(X);var Y=new OffscreenCanvas(X.width,X.height),ye=Y.getContext("2d");return ye.drawImage(X,0,0),D.set(X,Y),Y},clear:function(){D.clear()}}}(a,new Map),f=function(){var N=Math.floor(16.666666666666668),D,X,Y={},ye=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(D=function(fe){var Ie=Math.random();return Y[Ie]=requestAnimationFrame(function oe(Ce){ye===Ce||ye+N-1<Ce?(ye=Ce,delete Y[Ie],fe()):Y[Ie]=requestAnimationFrame(oe)}),Ie},X=function(fe){Y[fe]&&cancelAnimationFrame(Y[fe])}):(D=function(fe){return setTimeout(fe,N)},X=function(fe){return clearTimeout(fe)}),{frame:D,cancel:X}}(),g=function(){var N,D,X={};function Y(ye){function fe(Ie,oe){ye.postMessage({options:Ie||{},callback:oe})}ye.init=function(oe){var Ce=oe.transferControlToOffscreen();ye.postMessage({canvas:Ce},[Ce])},ye.fire=function(oe,Ce,He){if(D)return fe(oe,null),D;var ze=Math.random().toString(36).slice(2);return D=l(function(Be){function Ze(mt){mt.data.callback===ze&&(delete X[ze],ye.removeEventListener("message",Ze),D=null,d.clear(),He(),Be())}ye.addEventListener("message",Ze),fe(oe,ze),X[ze]=Ze.bind(null,{data:{callback:ze}})}),D},ye.reset=function(){ye.postMessage({reset:!0});for(var oe in X)X[oe](),delete X[oe]}}return function(){if(N)return N;if(!r&&s){var ye=["var CONFETTI, SIZE = {}, module = {};","("+n.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{N=new Worker(URL.createObjectURL(new Blob([ye])))}catch(fe){return typeof console!==void 0&&typeof console.warn=="function"&&console.warn("\u{1F38A} Could not load worker",fe),null}Y(N)}return N}}(),y={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function v(N,D){return D?D(N):N}function b(N){return N!=null}function T(N,D,X){return v(N&&b(N[D])?N[D]:y[D],X)}function V(N){return N<0?0:Math.floor(N)}function B(N,D){return Math.floor(Math.random()*(D-N))+N}function O(N){return parseInt(N,16)}function z(N){return N.map(re)}function re(N){var D=String(N).replace(/[^0-9a-f]/gi,"");return D.length<6&&(D=D[0]+D[0]+D[1]+D[1]+D[2]+D[2]),{r:O(D.substring(0,2)),g:O(D.substring(2,4)),b:O(D.substring(4,6))}}function Z(N){var D=T(N,"origin",Object);return D.x=T(D,"x",Number),D.y=T(D,"y",Number),D}function I(N){N.width=document.documentElement.clientWidth,N.height=document.documentElement.clientHeight}function _(N){var D=N.getBoundingClientRect();N.width=D.width,N.height=D.height}function w(N){var D=document.createElement("canvas");return D.style.position="fixed",D.style.top="0px",D.style.left="0px",D.style.pointerEvents="none",D.style.zIndex=N,D}function C(N,D,X,Y,ye,fe,Ie,oe,Ce){N.save(),N.translate(D,X),N.rotate(fe),N.scale(Y,ye),N.arc(0,0,1,Ie,oe,Ce),N.restore()}function S(N){var D=N.angle*(Math.PI/180),X=N.spread*(Math.PI/180);return{x:N.x,y:N.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:N.startVelocity*.5+Math.random()*N.startVelocity,angle2D:-D+(.5*X-Math.random()*X),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:N.color,shape:N.shape,tick:0,totalTicks:N.ticks,decay:N.decay,drift:N.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:N.gravity*3,ovalScalar:.6,scalar:N.scalar,flat:N.flat}}function x(N,D){D.x+=Math.cos(D.angle2D)*D.velocity+D.drift,D.y+=Math.sin(D.angle2D)*D.velocity+D.gravity,D.velocity*=D.decay,D.flat?(D.wobble=0,D.wobbleX=D.x+10*D.scalar,D.wobbleY=D.y+10*D.scalar,D.tiltSin=0,D.tiltCos=0,D.random=1):(D.wobble+=D.wobbleSpeed,D.wobbleX=D.x+10*D.scalar*Math.cos(D.wobble),D.wobbleY=D.y+10*D.scalar*Math.sin(D.wobble),D.tiltAngle+=.1,D.tiltSin=Math.sin(D.tiltAngle),D.tiltCos=Math.cos(D.tiltAngle),D.random=Math.random()+2);var X=D.tick++/D.totalTicks,Y=D.x+D.random*D.tiltCos,ye=D.y+D.random*D.tiltSin,fe=D.wobbleX+D.random*D.tiltCos,Ie=D.wobbleY+D.random*D.tiltSin;if(N.fillStyle="rgba("+D.color.r+", "+D.color.g+", "+D.color.b+", "+(1-X)+")",N.beginPath(),o&&D.shape.type==="path"&&typeof D.shape.path=="string"&&Array.isArray(D.shape.matrix))N.fill(Ns(D.shape.path,D.shape.matrix,D.x,D.y,Math.abs(fe-Y)*.1,Math.abs(Ie-ye)*.1,Math.PI/10*D.wobble));else if(D.shape.type==="bitmap"){var oe=Math.PI/10*D.wobble,Ce=Math.abs(fe-Y)*.1,He=Math.abs(Ie-ye)*.1,ze=D.shape.bitmap.width*D.scalar,Be=D.shape.bitmap.height*D.scalar,Ze=new DOMMatrix([Math.cos(oe)*Ce,Math.sin(oe)*Ce,-Math.sin(oe)*He,Math.cos(oe)*He,D.x,D.y]);Ze.multiplySelf(new DOMMatrix(D.shape.matrix));var mt=N.createPattern(d.transform(D.shape.bitmap),"no-repeat");mt.setTransform(Ze),N.globalAlpha=1-X,N.fillStyle=mt,N.fillRect(D.x-ze/2,D.y-Be/2,ze,Be),N.globalAlpha=1}else if(D.shape==="circle")N.ellipse?N.ellipse(D.x,D.y,Math.abs(fe-Y)*D.ovalScalar,Math.abs(Ie-ye)*D.ovalScalar,Math.PI/10*D.wobble,0,2*Math.PI):C(N,D.x,D.y,Math.abs(fe-Y)*D.ovalScalar,Math.abs(Ie-ye)*D.ovalScalar,Math.PI/10*D.wobble,0,2*Math.PI);else if(D.shape==="star")for(var Ae=Math.PI/2*3,Lt=4*D.scalar,vn=8*D.scalar,wn=D.x,sr=D.y,Ir=5,Rn=Math.PI/Ir;Ir--;)wn=D.x+Math.cos(Ae)*vn,sr=D.y+Math.sin(Ae)*vn,N.lineTo(wn,sr),Ae+=Rn,wn=D.x+Math.cos(Ae)*Lt,sr=D.y+Math.sin(Ae)*Lt,N.lineTo(wn,sr),Ae+=Rn;else N.moveTo(Math.floor(D.x),Math.floor(D.y)),N.lineTo(Math.floor(D.wobbleX),Math.floor(ye)),N.lineTo(Math.floor(fe),Math.floor(Ie)),N.lineTo(Math.floor(Y),Math.floor(D.wobbleY));return N.closePath(),N.fill(),D.tick<D.totalTicks}function E(N,D,X,Y,ye){var fe=D.slice(),Ie=N.getContext("2d"),oe,Ce,He=l(function(ze){function Be(){oe=Ce=null,Ie.clearRect(0,0,Y.width,Y.height),d.clear(),ye(),ze()}function Ze(){r&&!(Y.width===i.width&&Y.height===i.height)&&(Y.width=N.width=i.width,Y.height=N.height=i.height),!Y.width&&!Y.height&&(X(N),Y.width=N.width,Y.height=N.height),Ie.clearRect(0,0,Y.width,Y.height),fe=fe.filter(function(mt){return x(Ie,mt)}),fe.length?oe=f.frame(Ze):Be()}oe=f.frame(Ze),Ce=Be});return{addFettis:function(ze){return fe=fe.concat(ze),He},canvas:N,promise:He,reset:function(){oe&&f.cancel(oe),Ce&&Ce()}}}function Hn(N,D){var X=!N,Y=!!T(D||{},"resize"),ye=!1,fe=T(D,"disableForReducedMotion",Boolean),Ie=s&&!!T(D||{},"useWorker"),oe=Ie?g():null,Ce=X?I:_,He=N&&oe?!!N.__confetti_initialized:!1,ze=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,Be;function Ze(Ae,Lt,vn){for(var wn=T(Ae,"particleCount",V),sr=T(Ae,"angle",Number),Ir=T(Ae,"spread",Number),Rn=T(Ae,"startVelocity",Number),ru=T(Ae,"decay",Number),Jd=T(Ae,"gravity",Number),Km=T(Ae,"drift",Number),Qo=T(Ae,"colors",z),iu=T(Ae,"ticks",Number),Yo=T(Ae,"shapes"),Vt=T(Ae,"scalar"),Ht=!!T(Ae,"flat"),ks=Z(Ae),su=wn,Zo=[],Qm=N.width*ks.x,Os=N.height*ks.y;su--;)Zo.push(S({x:Qm,y:Os,angle:sr,spread:Ir,startVelocity:Rn,color:Qo[su%Qo.length],shape:Yo[B(0,Yo.length)],ticks:iu,decay:ru,gravity:Jd,drift:Km,scalar:Vt,flat:Ht}));return Be?Be.addFettis(Zo):(Be=E(N,Zo,Ce,Lt,vn),Be.promise)}function mt(Ae){var Lt=fe||T(Ae,"disableForReducedMotion",Boolean),vn=T(Ae,"zIndex",Number);if(Lt&&ze)return l(function(Rn){Rn()});X&&Be?N=Be.canvas:X&&!N&&(N=w(vn),document.body.appendChild(N)),Y&&!He&&Ce(N);var wn={width:N.width,height:N.height};oe&&!He&&oe.init(N),He=!0,oe&&(N.__confetti_initialized=!0);function sr(){if(oe){var Rn={getBoundingClientRect:function(){if(!X)return N.getBoundingClientRect()}};Ce(Rn),oe.postMessage({resize:{width:Rn.width,height:Rn.height}});return}wn.width=wn.height=null}function Ir(){Be=null,Y&&(ye=!1,e.removeEventListener("resize",sr)),X&&N&&(document.body.contains(N)&&document.body.removeChild(N),N=null,He=!1)}return Y&&!ye&&(ye=!0,e.addEventListener("resize",sr,!1)),oe?oe.fire(Ae,wn,Ir):Ze(Ae,wn,Ir)}return mt.reset=function(){oe&&oe.reset(),Be&&Be.reset()},mt}var ii;function Xd(){return ii||(ii=Hn(null,{useWorker:!0,resize:!0})),ii}function Ns(N,D,X,Y,ye,fe,Ie){var oe=new Path2D(N),Ce=new Path2D;Ce.addPath(oe,new DOMMatrix(D));var He=new Path2D;return He.addPath(Ce,new DOMMatrix([Math.cos(Ie)*ye,Math.sin(Ie)*ye,-Math.sin(Ie)*fe,Math.cos(Ie)*fe,X,Y])),He}function Ps(N){if(!o)throw new Error("path confetti are not supported in this browser");var D,X;typeof N=="string"?D=N:(D=N.path,X=N.matrix);var Y=new Path2D(D),ye=document.createElement("canvas"),fe=ye.getContext("2d");if(!X){for(var Ie=1e3,oe=Ie,Ce=Ie,He=0,ze=0,Be,Ze,mt=0;mt<Ie;mt+=2)for(var Ae=0;Ae<Ie;Ae+=2)fe.isPointInPath(Y,mt,Ae,"nonzero")&&(oe=Math.min(oe,mt),Ce=Math.min(Ce,Ae),He=Math.max(He,mt),ze=Math.max(ze,Ae));Be=He-oe,Ze=ze-Ce;var Lt=10,vn=Math.min(Lt/Be,Lt/Ze);X=[vn,0,0,vn,-Math.round(Be/2+oe)*vn,-Math.round(Ze/2+Ce)*vn]}return{type:"path",path:D,matrix:X}}function nu(N){var D,X=1,Y="#000000",ye='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof N=="string"?D=N:(D=N.text,X="scalar"in N?N.scalar:X,ye="fontFamily"in N?N.fontFamily:ye,Y="color"in N?N.color:Y);var fe=10*X,Ie=""+fe+"px "+ye,oe=new OffscreenCanvas(fe,fe),Ce=oe.getContext("2d");Ce.font=Ie;var He=Ce.measureText(D),ze=Math.ceil(He.actualBoundingBoxRight+He.actualBoundingBoxLeft),Be=Math.ceil(He.actualBoundingBoxAscent+He.actualBoundingBoxDescent),Ze=2,mt=He.actualBoundingBoxLeft+Ze,Ae=He.actualBoundingBoxAscent+Ze;ze+=Ze+Ze,Be+=Ze+Ze,oe=new OffscreenCanvas(ze,Be),Ce=oe.getContext("2d"),Ce.font=Ie,Ce.fillStyle=Y,Ce.fillText(D,mt,Ae);var Lt=1/X;return{type:"bitmap",bitmap:oe.transferToImageBitmap(),matrix:[Lt,0,0,Lt,-ze*Lt/2,-Be*Lt/2]}}t.exports=function(){return Xd().apply(this,arguments)},t.exports.reset=function(){Xd().reset()},t.exports.create=Hn,t.exports.shapeFromPath=Ps,t.exports.shapeFromText=nu})(function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}}(),Pw,!1);var kw=Pw.exports,AJ=Pw.exports.create;var TH="firebase",DH="10.13.1";In(TH,DH,"app");var Vr=new Gi("ANGULARFIRE2_VERSION");var bH=(n,e)=>{let t=e?[e]:gb(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},fr=class{constructor(){return bH(SH)}},SH="app-check";function Ow(){}var mp=class{zone;delegate;constructor(e,t=My){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},Fw=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Ow,{},Ow,Ow)),t.pipe(St({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},Ji=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new mp(Zone.current)),this.insideAngular=t.run(()=>new mp(Zone.current,ui)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(F(De))};static \u0275prov=J({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function JR(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function Lw(n){return n.pipe(Nn(JR().outsideAngular))}function st(n){return AH(JR())(n)}function AH(n){return function(t){return t=t.lift(new Fw(n.ngZone)),t.pipe(cr(n.outsideAngular),Nn(n.insideAngular))}}var xH=new Map,RH={activated:!1,tokenObservers:[]},MH={initialized:!1,enabled:!1};function pr(n){return xH.get(n)||Object.assign({},RH)}function iM(){return MH}var NH="https://content-firebaseappcheck.googleapis.com/v1";var PH="exchangeDebugToken",eM={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},GJ=24*60*60*1e3;var Uw=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return M(this,null,function*(){this.stop();try{this.pending=new Ut,this.pending.promise.catch(t=>{}),yield kH(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Ut,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function kH(n){return new Promise(e=>{setTimeout(e,n)})}var OH={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},es=new ub("appCheck","AppCheck",OH);function sM(n){if(!pr(n).activated)throw es.create("use-before-activation",{appName:n.name})}function oM(r,i){return M(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let y=yield o.getHeartbeatsHeader();y&&(s["X-Firebase-Client"]=y)}let a={method:"POST",body:JSON.stringify(e),headers:s},c;try{c=yield fetch(n,a)}catch(y){throw es.create("fetch-network-error",{originalErrorMessage:y?.message})}if(c.status!==200)throw es.create("fetch-status-error",{httpStatus:c.status});let l;try{l=yield c.json()}catch(y){throw es.create("fetch-parse-error",{originalErrorMessage:y?.message})}let d=l.ttl.match(/^([\d.]+)(s)$/);if(!d||!d[2]||isNaN(Number(d[1])))throw es.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${l.ttl}`});let f=Number(d[1])*1e3,g=Date.now();return{token:l.token,expireTimeMillis:g+f,issuedAtTimeMillis:g}})}function aM(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${NH}/projects/${t}/apps/${r}:${PH}?key=${i}`,body:{debug_token:e}}}var FH="firebase-app-check-database",LH=1,jw="firebase-app-check-store";var _p=null;function VH(){return _p||(_p=new Promise((n,e)=>{try{let t=indexedDB.open(FH,LH);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(es.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(jw,{keyPath:"compositeKey"})}}}catch(t){e(es.create("storage-open",{originalErrorMessage:t?.message}))}}),_p)}function UH(n,e){return jH(BH(n),e)}function jH(n,e){return M(this,null,function*(){let r=(yield VH()).transaction(jw,"readwrite"),s=r.objectStore(jw).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=c=>{o()},r.onerror=c=>{var l;a(es.create("storage-set",{originalErrorMessage:(l=c.target.error)===null||l===void 0?void 0:l.message}))}})})}function BH(n){return`${n.options.appId}-${n.name}`}var Bw=new Fi("@firebase/app-check");function Vw(n,e){return mh()?UH(n,e).catch(t=>{Bw.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function cM(){return iM().enabled}function uM(){return M(this,null,function*(){let n=iM();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var $H={error:"UNKNOWN_ERROR"};function qH(n){return gh.encodeString(JSON.stringify(n),!1)}function $w(n,e=!1){return M(this,null,function*(){let t=n.app;sM(t);let r=pr(t),i=r.token,s;if(i&&!yl(i)&&(r.token=void 0,i=void 0),!i){let c=yield r.cachedTokenPromise;c&&(yl(c)?i=c:yield Vw(t,void 0))}if(!e&&i&&yl(i))return{token:i.token};let o=!1;if(cM()){r.exchangeTokenPromise||(r.exchangeTokenPromise=oM(aM(t,yield uM()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let c=yield r.exchangeTokenPromise;return yield Vw(t,c),r.token=c,{token:c.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield pr(t).exchangeTokenPromise}catch(c){c.code==="appCheck/throttled"?Bw.warn(c.message):Bw.error(c),s=c}let a;return i?s?yl(i)?a={token:i.token,internalError:s}:a=nM(s):(a={token:i.token},r.token=i,yield Vw(t,i)):a=nM(s),o&&WH(t,a),a})}function HH(n){return M(this,null,function*(){let e=n.app;sM(e);let{provider:t}=pr(e);if(cM()){let r=yield uM(),{token:i}=yield oM(aM(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function zH(n,e,t,r){let{app:i}=n,s=pr(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&yl(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),tM(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>tM(n))}function lM(n,e){let t=pr(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function tM(n){let{app:e}=n,t=pr(e),r=t.tokenRefresher;r||(r=GH(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function GH(n){let{app:e}=n;return new Uw(()=>M(this,null,function*(){let t=pr(e),r;if(t.token?r=yield $w(n,!0):r=yield $w(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=pr(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},eM.RETRIAL_MIN_WAIT,eM.RETRIAL_MAX_WAIT)}function WH(n,e){let t=pr(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function yl(n){return n.expireTimeMillis-Date.now()>0}function nM(n){return{token:qH($H),error:n}}var qw=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=pr(this.app);for(let t of e)lM(this.app,t.next);return Promise.resolve()}};function KH(n,e){return new qw(n,e)}function QH(n){return{getToken:e=>$w(n,e),getLimitedUseToken:()=>HH(n),addTokenListener:e=>zH(n,"INTERNAL",e),removeTokenListener:e=>lM(n.app,e)}}var YH="@firebase/app-check",ZH="0.8.7";var XH="app-check",rM="app-check-internal";function JH(){ai(new Gt(XH,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return KH(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(rM).initialize()})),ai(new Gt(rM,n=>{let e=n.getProvider("app-check").getImmediate();return QH(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),In(YH,ZH)}JH();var e4=["localhost","0.0.0.0","127.0.0.1"],iee=typeof window<"u"&&e4.includes(window.location.hostname);var t4="firebase",n4="10.13.1";pt.registerVersion(t4,n4,"app-compat");var r4=["ngOnDestroy"],hM=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(r4.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let c=a?.[s];return typeof c=="function"?c.bind(a):c?.then?c.then(l=>t.run(()=>l)):t.run(()=>c)});return new Proxy(()=>{},{get:(a,c)=>o[c],apply:(a,c,l)=>o.then(d=>{let f=d?.(...l);return r?.spy?.apply&&r.spy.apply(s,l,f),f})})})});var wp=class{constructor(e){return e}},Ur=new K("angularfire2.app.options"),jr=new K("angularfire2.app.name");function vi(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=pt.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>pt.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;i4("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new wp(o)}var i4=(n,...e)=>{bv()&&typeof console<"u"&&console[n](...e)},s4={provide:wp,useFactory:vi,deps:[Ur,De,[new eo,jr]]},fM=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:Ur,useValue:t},{provide:jr,useValue:r}]}}constructor(t){pt.registerVersion("angularfire",Vr.full,"core"),pt.registerVersion("angularfire",Vr.full,"app-compat"),pt.registerVersion("angular",Sx.full,t.toString())}static \u0275fac=function(r){return new(r||n)(F(jt))};static \u0275mod=wt({type:n});static \u0275inj=vt({providers:[s4]})}return n})();function ts(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return o4(i,o)||(dM("error",`${e} was already initialized on the ${t} Firebase App with different settings.${a4?" You may need to reload as Firebase is not HMR aware.":""}`),dM("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function o4(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var a4=typeof module<"u"&&!!module.hot,dM=(n,...e)=>{bv()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var _l=new K("angularfire2.auth.use-emulator"),vl=new K("angularfire2.auth.settings"),wl=new K("angularfire2.auth.tenant-id"),El=new K("angularfire2.auth.langugage-code"),Il=new K("angularfire2.auth.use-device-language"),Cl=new K("angularfire.auth.persistence"),Tl=(n,e,t,r,i,s,o,a)=>ts(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let c=e.runOutsideAngular(()=>n.auth());if(t&&c.useEmulator(...t),r&&(c.tenantId=r),c.languageCode=i,s&&c.useDeviceLanguage(),o)for(let[l,d]of Object.entries(o))c.settings[l]=d;return a&&c.setPersistence(a),c},[t,r,i,s,o,a]),Ep=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,c,l,d,f,g,y){let v=new _t,b=ne(void 0).pipe(Nn(o.outsideAngular),We(()=>s.runOutsideAngular(()=>import("./chunk-LQGYCLSZ.js"))),ee(()=>vi(t,s,r)),ee(T=>Tl(T,s,a,l,d,f,c,g)),Hh({bufferSize:1,refCount:!1}));if(ao(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=ne(null);else{b.pipe(Wn()).subscribe();let T=b.pipe(We(O=>O.getRedirectResult().then(z=>z,()=>null)),st,Hh({bufferSize:1,refCount:!1})),V=b.pipe(We(O=>new ve(z=>({unsubscribe:s.runOutsideAngular(()=>O.onAuthStateChanged(re=>z.next(re),re=>z.error(re),()=>z.complete()))})))),B=b.pipe(We(O=>new ve(z=>({unsubscribe:s.runOutsideAngular(()=>O.onIdTokenChanged(re=>z.next(re),re=>z.error(re),()=>z.complete()))}))));this.authState=T.pipe(zh(V),cr(o.outsideAngular),Nn(o.insideAngular)),this.user=T.pipe(zh(B),cr(o.outsideAngular),Nn(o.insideAngular)),this.idToken=this.user.pipe(We(O=>O?xe(O.getIdToken()):ne(null))),this.idTokenResult=this.user.pipe(We(O=>O?xe(O.getIdTokenResult()):ne(null))),this.credential=ma(T,v,this.authState.pipe(Qt(O=>!O))).pipe(ee(O=>O?.user?O:null),cr(o.outsideAngular),Nn(o.insideAngular))}return hM(this,b,s,{spy:{apply:(T,V,B)=>{(T.startsWith("signIn")||T.startsWith("createUser"))&&B.then(O=>v.next(O))}}})}static \u0275fac=function(r){return new(r||n)(F(Ur),F(jr,8),F(jt),F(De),F(Ji),F(_l,8),F(vl,8),F(wl,8),F(El,8),F(Il,8),F(Cl,8),F(fr,8))};static \u0275prov=J({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var gM=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},mM={};var ns,Gw;(function(){var n;function e(I,_){function w(){}w.prototype=_.prototype,I.D=_.prototype,I.prototype=new w,I.prototype.constructor=I,I.C=function(C,S,x){for(var E=Array(arguments.length-2),Hn=2;Hn<arguments.length;Hn++)E[Hn-2]=arguments[Hn];return _.prototype[S].apply(C,E)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(I,_,w){w||(w=0);var C=Array(16);if(typeof _=="string")for(var S=0;16>S;++S)C[S]=_.charCodeAt(w++)|_.charCodeAt(w++)<<8|_.charCodeAt(w++)<<16|_.charCodeAt(w++)<<24;else for(S=0;16>S;++S)C[S]=_[w++]|_[w++]<<8|_[w++]<<16|_[w++]<<24;_=I.g[0],w=I.g[1],S=I.g[2];var x=I.g[3],E=_+(x^w&(S^x))+C[0]+3614090360&4294967295;_=w+(E<<7&4294967295|E>>>25),E=x+(S^_&(w^S))+C[1]+3905402710&4294967295,x=_+(E<<12&4294967295|E>>>20),E=S+(w^x&(_^w))+C[2]+606105819&4294967295,S=x+(E<<17&4294967295|E>>>15),E=w+(_^S&(x^_))+C[3]+3250441966&4294967295,w=S+(E<<22&4294967295|E>>>10),E=_+(x^w&(S^x))+C[4]+4118548399&4294967295,_=w+(E<<7&4294967295|E>>>25),E=x+(S^_&(w^S))+C[5]+1200080426&4294967295,x=_+(E<<12&4294967295|E>>>20),E=S+(w^x&(_^w))+C[6]+2821735955&4294967295,S=x+(E<<17&4294967295|E>>>15),E=w+(_^S&(x^_))+C[7]+4249261313&4294967295,w=S+(E<<22&4294967295|E>>>10),E=_+(x^w&(S^x))+C[8]+1770035416&4294967295,_=w+(E<<7&4294967295|E>>>25),E=x+(S^_&(w^S))+C[9]+2336552879&4294967295,x=_+(E<<12&4294967295|E>>>20),E=S+(w^x&(_^w))+C[10]+4294925233&4294967295,S=x+(E<<17&4294967295|E>>>15),E=w+(_^S&(x^_))+C[11]+2304563134&4294967295,w=S+(E<<22&4294967295|E>>>10),E=_+(x^w&(S^x))+C[12]+1804603682&4294967295,_=w+(E<<7&4294967295|E>>>25),E=x+(S^_&(w^S))+C[13]+4254626195&4294967295,x=_+(E<<12&4294967295|E>>>20),E=S+(w^x&(_^w))+C[14]+2792965006&4294967295,S=x+(E<<17&4294967295|E>>>15),E=w+(_^S&(x^_))+C[15]+1236535329&4294967295,w=S+(E<<22&4294967295|E>>>10),E=_+(S^x&(w^S))+C[1]+4129170786&4294967295,_=w+(E<<5&4294967295|E>>>27),E=x+(w^S&(_^w))+C[6]+3225465664&4294967295,x=_+(E<<9&4294967295|E>>>23),E=S+(_^w&(x^_))+C[11]+643717713&4294967295,S=x+(E<<14&4294967295|E>>>18),E=w+(x^_&(S^x))+C[0]+3921069994&4294967295,w=S+(E<<20&4294967295|E>>>12),E=_+(S^x&(w^S))+C[5]+3593408605&4294967295,_=w+(E<<5&4294967295|E>>>27),E=x+(w^S&(_^w))+C[10]+38016083&4294967295,x=_+(E<<9&4294967295|E>>>23),E=S+(_^w&(x^_))+C[15]+3634488961&4294967295,S=x+(E<<14&4294967295|E>>>18),E=w+(x^_&(S^x))+C[4]+3889429448&4294967295,w=S+(E<<20&4294967295|E>>>12),E=_+(S^x&(w^S))+C[9]+568446438&4294967295,_=w+(E<<5&4294967295|E>>>27),E=x+(w^S&(_^w))+C[14]+3275163606&4294967295,x=_+(E<<9&4294967295|E>>>23),E=S+(_^w&(x^_))+C[3]+4107603335&4294967295,S=x+(E<<14&4294967295|E>>>18),E=w+(x^_&(S^x))+C[8]+1163531501&4294967295,w=S+(E<<20&4294967295|E>>>12),E=_+(S^x&(w^S))+C[13]+2850285829&4294967295,_=w+(E<<5&4294967295|E>>>27),E=x+(w^S&(_^w))+C[2]+4243563512&4294967295,x=_+(E<<9&4294967295|E>>>23),E=S+(_^w&(x^_))+C[7]+1735328473&4294967295,S=x+(E<<14&4294967295|E>>>18),E=w+(x^_&(S^x))+C[12]+2368359562&4294967295,w=S+(E<<20&4294967295|E>>>12),E=_+(w^S^x)+C[5]+4294588738&4294967295,_=w+(E<<4&4294967295|E>>>28),E=x+(_^w^S)+C[8]+2272392833&4294967295,x=_+(E<<11&4294967295|E>>>21),E=S+(x^_^w)+C[11]+1839030562&4294967295,S=x+(E<<16&4294967295|E>>>16),E=w+(S^x^_)+C[14]+4259657740&4294967295,w=S+(E<<23&4294967295|E>>>9),E=_+(w^S^x)+C[1]+2763975236&4294967295,_=w+(E<<4&4294967295|E>>>28),E=x+(_^w^S)+C[4]+1272893353&4294967295,x=_+(E<<11&4294967295|E>>>21),E=S+(x^_^w)+C[7]+4139469664&4294967295,S=x+(E<<16&4294967295|E>>>16),E=w+(S^x^_)+C[10]+3200236656&4294967295,w=S+(E<<23&4294967295|E>>>9),E=_+(w^S^x)+C[13]+681279174&4294967295,_=w+(E<<4&4294967295|E>>>28),E=x+(_^w^S)+C[0]+3936430074&4294967295,x=_+(E<<11&4294967295|E>>>21),E=S+(x^_^w)+C[3]+3572445317&4294967295,S=x+(E<<16&4294967295|E>>>16),E=w+(S^x^_)+C[6]+76029189&4294967295,w=S+(E<<23&4294967295|E>>>9),E=_+(w^S^x)+C[9]+3654602809&4294967295,_=w+(E<<4&4294967295|E>>>28),E=x+(_^w^S)+C[12]+3873151461&4294967295,x=_+(E<<11&4294967295|E>>>21),E=S+(x^_^w)+C[15]+530742520&4294967295,S=x+(E<<16&4294967295|E>>>16),E=w+(S^x^_)+C[2]+3299628645&4294967295,w=S+(E<<23&4294967295|E>>>9),E=_+(S^(w|~x))+C[0]+4096336452&4294967295,_=w+(E<<6&4294967295|E>>>26),E=x+(w^(_|~S))+C[7]+1126891415&4294967295,x=_+(E<<10&4294967295|E>>>22),E=S+(_^(x|~w))+C[14]+2878612391&4294967295,S=x+(E<<15&4294967295|E>>>17),E=w+(x^(S|~_))+C[5]+4237533241&4294967295,w=S+(E<<21&4294967295|E>>>11),E=_+(S^(w|~x))+C[12]+1700485571&4294967295,_=w+(E<<6&4294967295|E>>>26),E=x+(w^(_|~S))+C[3]+2399980690&4294967295,x=_+(E<<10&4294967295|E>>>22),E=S+(_^(x|~w))+C[10]+4293915773&4294967295,S=x+(E<<15&4294967295|E>>>17),E=w+(x^(S|~_))+C[1]+2240044497&4294967295,w=S+(E<<21&4294967295|E>>>11),E=_+(S^(w|~x))+C[8]+1873313359&4294967295,_=w+(E<<6&4294967295|E>>>26),E=x+(w^(_|~S))+C[15]+4264355552&4294967295,x=_+(E<<10&4294967295|E>>>22),E=S+(_^(x|~w))+C[6]+2734768916&4294967295,S=x+(E<<15&4294967295|E>>>17),E=w+(x^(S|~_))+C[13]+1309151649&4294967295,w=S+(E<<21&4294967295|E>>>11),E=_+(S^(w|~x))+C[4]+4149444226&4294967295,_=w+(E<<6&4294967295|E>>>26),E=x+(w^(_|~S))+C[11]+3174756917&4294967295,x=_+(E<<10&4294967295|E>>>22),E=S+(_^(x|~w))+C[2]+718787259&4294967295,S=x+(E<<15&4294967295|E>>>17),E=w+(x^(S|~_))+C[9]+3951481745&4294967295,I.g[0]=I.g[0]+_&4294967295,I.g[1]=I.g[1]+(S+(E<<21&4294967295|E>>>11))&4294967295,I.g[2]=I.g[2]+S&4294967295,I.g[3]=I.g[3]+x&4294967295}r.prototype.u=function(I,_){_===void 0&&(_=I.length);for(var w=_-this.blockSize,C=this.B,S=this.h,x=0;x<_;){if(S==0)for(;x<=w;)i(this,I,x),x+=this.blockSize;if(typeof I=="string"){for(;x<_;)if(C[S++]=I.charCodeAt(x++),S==this.blockSize){i(this,C),S=0;break}}else for(;x<_;)if(C[S++]=I[x++],S==this.blockSize){i(this,C),S=0;break}}this.h=S,this.o+=_},r.prototype.v=function(){var I=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);I[0]=128;for(var _=1;_<I.length-8;++_)I[_]=0;var w=8*this.o;for(_=I.length-8;_<I.length;++_)I[_]=w&255,w/=256;for(this.u(I),I=Array(16),_=w=0;4>_;++_)for(var C=0;32>C;C+=8)I[w++]=this.g[_]>>>C&255;return I};function s(I,_){var w=a;return Object.prototype.hasOwnProperty.call(w,I)?w[I]:w[I]=_(I)}function o(I,_){this.h=_;for(var w=[],C=!0,S=I.length-1;0<=S;S--){var x=I[S]|0;C&&x==_||(w[S]=x,C=!1)}this.g=w}var a={};function c(I){return-128<=I&&128>I?s(I,function(_){return new o([_|0],0>_?-1:0)}):new o([I|0],0>I?-1:0)}function l(I){if(isNaN(I)||!isFinite(I))return f;if(0>I)return T(l(-I));for(var _=[],w=1,C=0;I>=w;C++)_[C]=I/w|0,w*=4294967296;return new o(_,0)}function d(I,_){if(I.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(I.charAt(0)=="-")return T(d(I.substring(1),_));if(0<=I.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=l(Math.pow(_,8)),C=f,S=0;S<I.length;S+=8){var x=Math.min(8,I.length-S),E=parseInt(I.substring(S,S+x),_);8>x?(x=l(Math.pow(_,x)),C=C.j(x).add(l(E))):(C=C.j(w),C=C.add(l(E)))}return C}var f=c(0),g=c(1),y=c(16777216);n=o.prototype,n.m=function(){if(b(this))return-T(this).m();for(var I=0,_=1,w=0;w<this.g.length;w++){var C=this.i(w);I+=(0<=C?C:4294967296+C)*_,_*=4294967296}return I},n.toString=function(I){if(I=I||10,2>I||36<I)throw Error("radix out of range: "+I);if(v(this))return"0";if(b(this))return"-"+T(this).toString(I);for(var _=l(Math.pow(I,6)),w=this,C="";;){var S=z(w,_).g;w=V(w,S.j(_));var x=((0<w.g.length?w.g[0]:w.h)>>>0).toString(I);if(w=S,v(w))return x+C;for(;6>x.length;)x="0"+x;C=x+C}},n.i=function(I){return 0>I?0:I<this.g.length?this.g[I]:this.h};function v(I){if(I.h!=0)return!1;for(var _=0;_<I.g.length;_++)if(I.g[_]!=0)return!1;return!0}function b(I){return I.h==-1}n.l=function(I){return I=V(this,I),b(I)?-1:v(I)?0:1};function T(I){for(var _=I.g.length,w=[],C=0;C<_;C++)w[C]=~I.g[C];return new o(w,~I.h).add(g)}n.abs=function(){return b(this)?T(this):this},n.add=function(I){for(var _=Math.max(this.g.length,I.g.length),w=[],C=0,S=0;S<=_;S++){var x=C+(this.i(S)&65535)+(I.i(S)&65535),E=(x>>>16)+(this.i(S)>>>16)+(I.i(S)>>>16);C=E>>>16,x&=65535,E&=65535,w[S]=E<<16|x}return new o(w,w[w.length-1]&-2147483648?-1:0)};function V(I,_){return I.add(T(_))}n.j=function(I){if(v(this)||v(I))return f;if(b(this))return b(I)?T(this).j(T(I)):T(T(this).j(I));if(b(I))return T(this.j(T(I)));if(0>this.l(y)&&0>I.l(y))return l(this.m()*I.m());for(var _=this.g.length+I.g.length,w=[],C=0;C<2*_;C++)w[C]=0;for(C=0;C<this.g.length;C++)for(var S=0;S<I.g.length;S++){var x=this.i(C)>>>16,E=this.i(C)&65535,Hn=I.i(S)>>>16,ii=I.i(S)&65535;w[2*C+2*S]+=E*ii,B(w,2*C+2*S),w[2*C+2*S+1]+=x*ii,B(w,2*C+2*S+1),w[2*C+2*S+1]+=E*Hn,B(w,2*C+2*S+1),w[2*C+2*S+2]+=x*Hn,B(w,2*C+2*S+2)}for(C=0;C<_;C++)w[C]=w[2*C+1]<<16|w[2*C];for(C=_;C<2*_;C++)w[C]=0;return new o(w,0)};function B(I,_){for(;(I[_]&65535)!=I[_];)I[_+1]+=I[_]>>>16,I[_]&=65535,_++}function O(I,_){this.g=I,this.h=_}function z(I,_){if(v(_))throw Error("division by zero");if(v(I))return new O(f,f);if(b(I))return _=z(T(I),_),new O(T(_.g),T(_.h));if(b(_))return _=z(I,T(_)),new O(T(_.g),_.h);if(30<I.g.length){if(b(I)||b(_))throw Error("slowDivide_ only works with positive integers.");for(var w=g,C=_;0>=C.l(I);)w=re(w),C=re(C);var S=Z(w,1),x=Z(C,1);for(C=Z(C,2),w=Z(w,2);!v(C);){var E=x.add(C);0>=E.l(I)&&(S=S.add(w),x=E),C=Z(C,1),w=Z(w,1)}return _=V(I,S.j(_)),new O(S,_)}for(S=f;0<=I.l(_);){for(w=Math.max(1,Math.floor(I.m()/_.m())),C=Math.ceil(Math.log(w)/Math.LN2),C=48>=C?1:Math.pow(2,C-48),x=l(w),E=x.j(_);b(E)||0<E.l(I);)w-=C,x=l(w),E=x.j(_);v(x)&&(x=g),S=S.add(x),I=V(I,E)}return new O(S,I)}n.A=function(I){return z(this,I).h},n.and=function(I){for(var _=Math.max(this.g.length,I.g.length),w=[],C=0;C<_;C++)w[C]=this.i(C)&I.i(C);return new o(w,this.h&I.h)},n.or=function(I){for(var _=Math.max(this.g.length,I.g.length),w=[],C=0;C<_;C++)w[C]=this.i(C)|I.i(C);return new o(w,this.h|I.h)},n.xor=function(I){for(var _=Math.max(this.g.length,I.g.length),w=[],C=0;C<_;C++)w[C]=this.i(C)^I.i(C);return new o(w,this.h^I.h)};function re(I){for(var _=I.g.length+1,w=[],C=0;C<_;C++)w[C]=I.i(C)<<1|I.i(C-1)>>>31;return new o(w,I.h)}function Z(I,_){var w=_>>5;_%=32;for(var C=I.g.length-w,S=[],x=0;x<C;x++)S[x]=0<_?I.i(x+w)>>>_|I.i(x+w+1)<<32-_:I.i(x+w);return new o(S,I.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Gw=mM.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=l,o.fromString=d,ns=mM.Integer=o}).apply(typeof gM<"u"?gM:typeof self<"u"?self:typeof window<"u"?window:{});var Ip=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},wi={};var Ww,Kw,Ha,Qw,Dl,Cp,Yw,Zw,Xw;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,h,p){return u==Array.prototype||u==Object.prototype||(u[h]=p.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ip=="object"&&Ip];for(var h=0;h<u.length;++h){var p=u[h];if(p&&p.Math==Math)return p}throw Error("Cannot find global object")}var r=t(this);function i(u,h){if(h)e:{var p=r;u=u.split(".");for(var m=0;m<u.length-1;m++){var A=u[m];if(!(A in p))break e;p=p[A]}u=u[u.length-1],m=p[u],h=h(m),h!=m&&h!=null&&e(p,u,{configurable:!0,writable:!0,value:h})}}function s(u,h){u instanceof String&&(u+="");var p=0,m=!1,A={next:function(){if(!m&&p<u.length){var k=p++;return{value:h(k,u[k]),done:!1}}return m=!0,{done:!0,value:void 0}}};return A[Symbol.iterator]=function(){return A},A}i("Array.prototype.values",function(u){return u||function(){return s(this,function(h,p){return p})}});var o=o||{},a=this||self;function c(u){var h=typeof u;return h=h!="object"?h:u?Array.isArray(u)?"array":h:"null",h=="array"||h=="object"&&typeof u.length=="number"}function l(u){var h=typeof u;return h=="object"&&u!=null||h=="function"}function d(u,h,p){return u.call.apply(u.bind,arguments)}function f(u,h,p){if(!u)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var A=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(A,m),u.apply(h,A)}}return function(){return u.apply(h,arguments)}}function g(u,h,p){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:f,g.apply(null,arguments)}function y(u,h){var p=Array.prototype.slice.call(arguments,1);return function(){var m=p.slice();return m.push.apply(m,arguments),u.apply(this,m)}}function v(u,h){function p(){}p.prototype=h.prototype,u.aa=h.prototype,u.prototype=new p,u.prototype.constructor=u,u.Qb=function(m,A,k){for(var $=Array(arguments.length-2),Ge=2;Ge<arguments.length;Ge++)$[Ge-2]=arguments[Ge];return h.prototype[A].apply(m,$)}}function b(u){let h=u.length;if(0<h){let p=Array(h);for(let m=0;m<h;m++)p[m]=u[m];return p}return[]}function T(u,h){for(let p=1;p<arguments.length;p++){let m=arguments[p];if(c(m)){let A=u.length||0,k=m.length||0;u.length=A+k;for(let $=0;$<k;$++)u[A+$]=m[$]}else u.push(m)}}class V{constructor(h,p){this.i=h,this.j=p,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function B(u){return/^[\s\xa0]*$/.test(u)}function O(){var u=a.navigator;return u&&(u=u.userAgent)?u:""}function z(u){return z[" "](u),u}z[" "]=function(){};var re=O().indexOf("Gecko")!=-1&&!(O().toLowerCase().indexOf("webkit")!=-1&&O().indexOf("Edge")==-1)&&!(O().indexOf("Trident")!=-1||O().indexOf("MSIE")!=-1)&&O().indexOf("Edge")==-1;function Z(u,h,p){for(let m in u)h.call(p,u[m],m,u)}function I(u,h){for(let p in u)h.call(void 0,u[p],p,u)}function _(u){let h={};for(let p in u)h[p]=u[p];return h}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function C(u,h){let p,m;for(let A=1;A<arguments.length;A++){m=arguments[A];for(p in m)u[p]=m[p];for(let k=0;k<w.length;k++)p=w[k],Object.prototype.hasOwnProperty.call(m,p)&&(u[p]=m[p])}}function S(u){var h=1;u=u.split(":");let p=[];for(;0<h&&u.length;)p.push(u.shift()),h--;return u.length&&p.push(u.join(":")),p}function x(u){a.setTimeout(()=>{throw u},0)}function E(){var u=nu;let h=null;return u.g&&(h=u.g,u.g=u.g.next,u.g||(u.h=null),h.next=null),h}class Hn{constructor(){this.h=this.g=null}add(h,p){let m=ii.get();m.set(h,p),this.h?this.h.next=m:this.g=m,this.h=m}}var ii=new V(()=>new Xd,u=>u.reset());class Xd{constructor(){this.next=this.g=this.h=null}set(h,p){this.h=h,this.g=p,this.next=null}reset(){this.next=this.g=this.h=null}}let Ns,Ps=!1,nu=new Hn,N=()=>{let u=a.Promise.resolve(void 0);Ns=()=>{u.then(D)}};var D=()=>{for(var u;u=E();){try{u.h.call(u.g)}catch(p){x(p)}var h=ii;h.j(u),100>h.h&&(h.h++,u.next=h.g,h.g=u)}Ps=!1};function X(){this.s=this.s,this.C=this.C}X.prototype.s=!1,X.prototype.ma=function(){this.s||(this.s=!0,this.N())},X.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Y(u,h){this.type=u,this.g=this.target=h,this.defaultPrevented=!1}Y.prototype.h=function(){this.defaultPrevented=!0};var ye=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,h=Object.defineProperty({},"passive",{get:function(){u=!0}});try{let p=()=>{};a.addEventListener("test",p,h),a.removeEventListener("test",p,h)}catch{}return u}();function fe(u,h){if(Y.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var p=this.type=u.type,m=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=h,h=u.relatedTarget){if(re){e:{try{z(h.nodeName);var A=!0;break e}catch{}A=!1}A||(h=null)}}else p=="mouseover"?h=u.fromElement:p=="mouseout"&&(h=u.toElement);this.relatedTarget=h,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:Ie[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&fe.aa.h.call(this)}}v(fe,Y);var Ie={2:"touch",3:"pen",4:"mouse"};fe.prototype.h=function(){fe.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var oe="closure_listenable_"+(1e6*Math.random()|0),Ce=0;function He(u,h,p,m,A){this.listener=u,this.proxy=null,this.src=h,this.type=p,this.capture=!!m,this.ha=A,this.key=++Ce,this.da=this.fa=!1}function ze(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function Be(u){this.src=u,this.g={},this.h=0}Be.prototype.add=function(u,h,p,m,A){var k=u.toString();u=this.g[k],u||(u=this.g[k]=[],this.h++);var $=mt(u,h,m,A);return-1<$?(h=u[$],p||(h.fa=!1)):(h=new He(h,this.src,k,!!m,A),h.fa=p,u.push(h)),h};function Ze(u,h){var p=h.type;if(p in u.g){var m=u.g[p],A=Array.prototype.indexOf.call(m,h,void 0),k;(k=0<=A)&&Array.prototype.splice.call(m,A,1),k&&(ze(h),u.g[p].length==0&&(delete u.g[p],u.h--))}}function mt(u,h,p,m){for(var A=0;A<u.length;++A){var k=u[A];if(!k.da&&k.listener==h&&k.capture==!!p&&k.ha==m)return A}return-1}var Ae="closure_lm_"+(1e6*Math.random()|0),Lt={};function vn(u,h,p,m,A){if(m&&m.once)return Ir(u,h,p,m,A);if(Array.isArray(h)){for(var k=0;k<h.length;k++)vn(u,h[k],p,m,A);return null}return p=Yo(p),u&&u[oe]?u.K(h,p,l(m)?!!m.capture:!!m,A):wn(u,h,p,!1,m,A)}function wn(u,h,p,m,A,k){if(!h)throw Error("Invalid event type");var $=l(A)?!!A.capture:!!A,Ge=Qo(u);if(Ge||(u[Ae]=Ge=new Be(u)),p=Ge.add(h,p,m,$,k),p.proxy)return p;if(m=sr(),p.proxy=m,m.src=u,m.listener=p,u.addEventListener)ye||(A=$),A===void 0&&(A=!1),u.addEventListener(h.toString(),m,A);else if(u.attachEvent)u.attachEvent(Jd(h.toString()),m);else if(u.addListener&&u.removeListener)u.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return p}function sr(){function u(p){return h.call(u.src,u.listener,p)}let h=Km;return u}function Ir(u,h,p,m,A){if(Array.isArray(h)){for(var k=0;k<h.length;k++)Ir(u,h[k],p,m,A);return null}return p=Yo(p),u&&u[oe]?u.L(h,p,l(m)?!!m.capture:!!m,A):wn(u,h,p,!0,m,A)}function Rn(u,h,p,m,A){if(Array.isArray(h))for(var k=0;k<h.length;k++)Rn(u,h[k],p,m,A);else m=l(m)?!!m.capture:!!m,p=Yo(p),u&&u[oe]?(u=u.i,h=String(h).toString(),h in u.g&&(k=u.g[h],p=mt(k,p,m,A),-1<p&&(ze(k[p]),Array.prototype.splice.call(k,p,1),k.length==0&&(delete u.g[h],u.h--)))):u&&(u=Qo(u))&&(h=u.g[h.toString()],u=-1,h&&(u=mt(h,p,m,A)),(p=-1<u?h[u]:null)&&ru(p))}function ru(u){if(typeof u!="number"&&u&&!u.da){var h=u.src;if(h&&h[oe])Ze(h.i,u);else{var p=u.type,m=u.proxy;h.removeEventListener?h.removeEventListener(p,m,u.capture):h.detachEvent?h.detachEvent(Jd(p),m):h.addListener&&h.removeListener&&h.removeListener(m),(p=Qo(h))?(Ze(p,u),p.h==0&&(p.src=null,h[Ae]=null)):ze(u)}}}function Jd(u){return u in Lt?Lt[u]:Lt[u]="on"+u}function Km(u,h){if(u.da)u=!0;else{h=new fe(h,this);var p=u.listener,m=u.ha||u.src;u.fa&&ru(u),u=p.call(m,h)}return u}function Qo(u){return u=u[Ae],u instanceof Be?u:null}var iu="__closure_events_fn_"+(1e9*Math.random()>>>0);function Yo(u){return typeof u=="function"?u:(u[iu]||(u[iu]=function(h){return u.handleEvent(h)}),u[iu])}function Vt(){X.call(this),this.i=new Be(this),this.M=this,this.F=null}v(Vt,X),Vt.prototype[oe]=!0,Vt.prototype.removeEventListener=function(u,h,p,m){Rn(this,u,h,p,m)};function Ht(u,h){var p,m=u.F;if(m)for(p=[];m;m=m.F)p.push(m);if(u=u.M,m=h.type||h,typeof h=="string")h=new Y(h,u);else if(h instanceof Y)h.target=h.target||u;else{var A=h;h=new Y(m,u),C(h,A)}if(A=!0,p)for(var k=p.length-1;0<=k;k--){var $=h.g=p[k];A=ks($,m,!0,h)&&A}if($=h.g=u,A=ks($,m,!0,h)&&A,A=ks($,m,!1,h)&&A,p)for(k=0;k<p.length;k++)$=h.g=p[k],A=ks($,m,!1,h)&&A}Vt.prototype.N=function(){if(Vt.aa.N.call(this),this.i){var u=this.i,h;for(h in u.g){for(var p=u.g[h],m=0;m<p.length;m++)ze(p[m]);delete u.g[h],u.h--}}this.F=null},Vt.prototype.K=function(u,h,p,m){return this.i.add(String(u),h,!1,p,m)},Vt.prototype.L=function(u,h,p,m){return this.i.add(String(u),h,!0,p,m)};function ks(u,h,p,m){if(h=u.i.g[String(h)],!h)return!0;h=h.concat();for(var A=!0,k=0;k<h.length;++k){var $=h[k];if($&&!$.da&&$.capture==p){var Ge=$.listener,zt=$.ha||$.src;$.fa&&Ze(u.i,$),A=Ge.call(zt,m)!==!1&&A}}return A&&!m.defaultPrevented}function su(u,h,p){if(typeof u=="function")p&&(u=g(u,p));else if(u&&typeof u.handleEvent=="function")u=g(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:a.setTimeout(u,h||0)}function Zo(u){u.g=su(()=>{u.g=null,u.i&&(u.i=!1,Zo(u))},u.l);let h=u.h;u.h=null,u.m.apply(null,h)}class Qm extends X{constructor(h,p){super(),this.m=h,this.l=p,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:Zo(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Os(u){X.call(this),this.h=u,this.g={}}v(Os,X);var lD=[];function dD(u){Z(u.g,function(h,p){this.g.hasOwnProperty(p)&&ru(h)},u),u.g={}}Os.prototype.N=function(){Os.aa.N.call(this),dD(this)},Os.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ym=a.JSON.stringify,pL=a.JSON.parse,gL=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function Zm(){}Zm.prototype.h=null;function hD(u){return u.h||(u.h=u.i())}function fD(){}var ou={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Xm(){Y.call(this,"d")}v(Xm,Y);function Jm(){Y.call(this,"c")}v(Jm,Y);var Fs={},pD=null;function eh(){return pD=pD||new Vt}Fs.La="serverreachability";function gD(u){Y.call(this,Fs.La,u)}v(gD,Y);function au(u){let h=eh();Ht(h,new gD(h))}Fs.STAT_EVENT="statevent";function mD(u,h){Y.call(this,Fs.STAT_EVENT,u),this.stat=h}v(mD,Y);function cn(u){let h=eh();Ht(h,new mD(h,u))}Fs.Ma="timingevent";function yD(u,h){Y.call(this,Fs.Ma,u),this.size=h}v(yD,Y);function cu(u,h){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},h)}function uu(){this.g=!0}uu.prototype.xa=function(){this.g=!1};function mL(u,h,p,m,A,k){u.info(function(){if(u.g)if(k)for(var $="",Ge=k.split("&"),zt=0;zt<Ge.length;zt++){var Le=Ge[zt].split("=");if(1<Le.length){var Xt=Le[0];Le=Le[1];var Jt=Xt.split("_");$=2<=Jt.length&&Jt[1]=="type"?$+(Xt+"="+Le+"&"):$+(Xt+"=redacted&")}}else $=null;else $=k;return"XMLHTTP REQ ("+m+") [attempt "+A+"]: "+h+`
`+p+`
`+$})}function yL(u,h,p,m,A,k,$){u.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+A+"]: "+h+`
`+p+`
`+k+" "+$})}function Xo(u,h,p,m){u.info(function(){return"XMLHTTP TEXT ("+h+"): "+vL(u,p)+(m?" "+m:"")})}function _L(u,h){u.info(function(){return"TIMEOUT: "+h})}uu.prototype.info=function(){};function vL(u,h){if(!u.g)return h;if(!h)return null;try{var p=JSON.parse(h);if(p){for(u=0;u<p.length;u++)if(Array.isArray(p[u])){var m=p[u];if(!(2>m.length)){var A=m[1];if(Array.isArray(A)&&!(1>A.length)){var k=A[0];if(k!="noop"&&k!="stop"&&k!="close")for(var $=1;$<A.length;$++)A[$]=""}}}}return Ym(p)}catch{return h}}var th={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},_D={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},ey;function nh(){}v(nh,Zm),nh.prototype.g=function(){return new XMLHttpRequest},nh.prototype.i=function(){return{}},ey=new nh;function Ni(u,h,p,m){this.j=u,this.i=h,this.l=p,this.R=m||1,this.U=new Os(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new vD}function vD(){this.i=null,this.g="",this.h=!1}var wD={},ty={};function ny(u,h,p){u.L=1,u.v=oh(si(h)),u.m=p,u.P=!0,ED(u,null)}function ED(u,h){u.F=Date.now(),rh(u),u.A=si(u.v);var p=u.A,m=u.R;Array.isArray(m)||(m=[String(m)]),OD(p.i,"t",m),u.C=0,p=u.j.J,u.h=new vD,u.g=JD(u.j,p?h:null,!u.m),0<u.O&&(u.M=new Qm(g(u.Y,u,u.g),u.O)),h=u.U,p=u.g,m=u.ca;var A="readystatechange";Array.isArray(A)||(A&&(lD[0]=A.toString()),A=lD);for(var k=0;k<A.length;k++){var $=vn(p,A[k],m||h.handleEvent,!1,h.h||h);if(!$)break;h.g[$.key]=$}h=u.H?_(u.H):{},u.m?(u.u||(u.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,h)):(u.u="GET",u.g.ea(u.A,u.u,null,h)),au(),mL(u.i,u.u,u.A,u.l,u.R,u.m)}Ni.prototype.ca=function(u){u=u.target;let h=this.M;h&&oi(u)==3?h.j():this.Y(u)},Ni.prototype.Y=function(u){try{if(u==this.g)e:{let Jt=oi(this.g);var h=this.g.Ba();let ta=this.g.Z();if(!(3>Jt)&&(Jt!=3||this.g&&(this.h.h||this.g.oa()||$D(this.g)))){this.J||Jt!=4||h==7||(h==8||0>=ta?au(3):au(2)),ry(this);var p=this.g.Z();this.X=p;t:if(ID(this)){var m=$D(this.g);u="";var A=m.length,k=oi(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ls(this),lu(this);var $="";break t}this.h.i=new a.TextDecoder}for(h=0;h<A;h++)this.h.h=!0,u+=this.h.i.decode(m[h],{stream:!(k&&h==A-1)});m.length=0,this.h.g+=u,this.C=0,$=this.h.g}else $=this.g.oa();if(this.o=p==200,yL(this.i,this.u,this.A,this.l,this.R,Jt,p),this.o){if(this.T&&!this.K){t:{if(this.g){var Ge,zt=this.g;if((Ge=zt.g?zt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(Ge)){var Le=Ge;break t}}Le=null}if(p=Le)Xo(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,iy(this,p);else{this.o=!1,this.s=3,cn(12),Ls(this),lu(this);break e}}if(this.P){p=!0;let or;for(;!this.J&&this.C<$.length;)if(or=wL(this,$),or==ty){Jt==4&&(this.s=4,cn(14),p=!1),Xo(this.i,this.l,null,"[Incomplete Response]");break}else if(or==wD){this.s=4,cn(15),Xo(this.i,this.l,$,"[Invalid Chunk]"),p=!1;break}else Xo(this.i,this.l,or,null),iy(this,or);if(ID(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Jt!=4||$.length!=0||this.h.h||(this.s=1,cn(16),p=!1),this.o=this.o&&p,!p)Xo(this.i,this.l,$,"[Invalid Chunked Response]"),Ls(this),lu(this);else if(0<$.length&&!this.W){this.W=!0;var Xt=this.j;Xt.g==this&&Xt.ba&&!Xt.M&&(Xt.j.info("Great, no buffering proxy detected. Bytes received: "+$.length),ly(Xt),Xt.M=!0,cn(11))}}else Xo(this.i,this.l,$,null),iy(this,$);Jt==4&&Ls(this),this.o&&!this.J&&(Jt==4?QD(this.j,this):(this.o=!1,rh(this)))}else LL(this.g),p==400&&0<$.indexOf("Unknown SID")?(this.s=3,cn(12)):(this.s=0,cn(13)),Ls(this),lu(this)}}}catch{}finally{}};function ID(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function wL(u,h){var p=u.C,m=h.indexOf(`
`,p);return m==-1?ty:(p=Number(h.substring(p,m)),isNaN(p)?wD:(m+=1,m+p>h.length?ty:(h=h.slice(m,m+p),u.C=m+p,h)))}Ni.prototype.cancel=function(){this.J=!0,Ls(this)};function rh(u){u.S=Date.now()+u.I,CD(u,u.I)}function CD(u,h){if(u.B!=null)throw Error("WatchDog timer not null");u.B=cu(g(u.ba,u),h)}function ry(u){u.B&&(a.clearTimeout(u.B),u.B=null)}Ni.prototype.ba=function(){this.B=null;let u=Date.now();0<=u-this.S?(_L(this.i,this.A),this.L!=2&&(au(),cn(17)),Ls(this),this.s=2,lu(this)):CD(this,this.S-u)};function lu(u){u.j.G==0||u.J||QD(u.j,u)}function Ls(u){ry(u);var h=u.M;h&&typeof h.ma=="function"&&h.ma(),u.M=null,dD(u.U),u.g&&(h=u.g,u.g=null,h.abort(),h.ma())}function iy(u,h){try{var p=u.j;if(p.G!=0&&(p.g==u||sy(p.h,u))){if(!u.K&&sy(p.h,u)&&p.G==3){try{var m=p.Da.g.parse(h)}catch{m=null}if(Array.isArray(m)&&m.length==3){var A=m;if(A[0]==0){e:if(!p.u){if(p.g)if(p.g.F+3e3<u.F)dh(p),uh(p);else break e;uy(p),cn(18)}}else p.za=A[1],0<p.za-p.T&&37500>A[2]&&p.F&&p.v==0&&!p.C&&(p.C=cu(g(p.Za,p),6e3));if(1>=bD(p.h)&&p.ca){try{p.ca()}catch{}p.ca=void 0}}else Us(p,11)}else if((u.K||p.g==u)&&dh(p),!B(h))for(A=p.Da.g.parse(h),h=0;h<A.length;h++){let Le=A[h];if(p.T=Le[0],Le=Le[1],p.G==2)if(Le[0]=="c"){p.K=Le[1],p.ia=Le[2];let Xt=Le[3];Xt!=null&&(p.la=Xt,p.j.info("VER="+p.la));let Jt=Le[4];Jt!=null&&(p.Aa=Jt,p.j.info("SVER="+p.Aa));let ta=Le[5];ta!=null&&typeof ta=="number"&&0<ta&&(m=1.5*ta,p.L=m,p.j.info("backChannelRequestTimeoutMs_="+m)),m=p;let or=u.g;if(or){let fh=or.g?or.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(fh){var k=m.h;k.g||fh.indexOf("spdy")==-1&&fh.indexOf("quic")==-1&&fh.indexOf("h2")==-1||(k.j=k.l,k.g=new Set,k.h&&(oy(k,k.h),k.h=null))}if(m.D){let dy=or.g?or.g.getResponseHeader("X-HTTP-Session-Id"):null;dy&&(m.ya=dy,tt(m.I,m.D,dy))}}p.G=3,p.l&&p.l.ua(),p.ba&&(p.R=Date.now()-u.F,p.j.info("Handshake RTT: "+p.R+"ms")),m=p;var $=u;if(m.qa=XD(m,m.J?m.ia:null,m.W),$.K){SD(m.h,$);var Ge=$,zt=m.L;zt&&(Ge.I=zt),Ge.B&&(ry(Ge),rh(Ge)),m.g=$}else WD(m);0<p.i.length&&lh(p)}else Le[0]!="stop"&&Le[0]!="close"||Us(p,7);else p.G==3&&(Le[0]=="stop"||Le[0]=="close"?Le[0]=="stop"?Us(p,7):cy(p):Le[0]!="noop"&&p.l&&p.l.ta(Le),p.v=0)}}au(4)}catch{}}var EL=class{constructor(u,h){this.g=u,this.map=h}};function TD(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function DD(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function bD(u){return u.h?1:u.g?u.g.size:0}function sy(u,h){return u.h?u.h==h:u.g?u.g.has(h):!1}function oy(u,h){u.g?u.g.add(h):u.h=h}function SD(u,h){u.h&&u.h==h?u.h=null:u.g&&u.g.has(h)&&u.g.delete(h)}TD.prototype.cancel=function(){if(this.i=AD(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let u of this.g.values())u.cancel();this.g.clear()}};function AD(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let h=u.i;for(let p of u.g.values())h=h.concat(p.D);return h}return b(u.i)}function IL(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(c(u)){for(var h=[],p=u.length,m=0;m<p;m++)h.push(u[m]);return h}h=[],p=0;for(m in u)h[p++]=u[m];return h}function CL(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(c(u)||typeof u=="string"){var h=[];u=u.length;for(var p=0;p<u;p++)h.push(p);return h}h=[],p=0;for(let m in u)h[p++]=m;return h}}}function xD(u,h){if(u.forEach&&typeof u.forEach=="function")u.forEach(h,void 0);else if(c(u)||typeof u=="string")Array.prototype.forEach.call(u,h,void 0);else for(var p=CL(u),m=IL(u),A=m.length,k=0;k<A;k++)h.call(void 0,m[k],p&&p[k],u)}var RD=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function TL(u,h){if(u){u=u.split("&");for(var p=0;p<u.length;p++){var m=u[p].indexOf("="),A=null;if(0<=m){var k=u[p].substring(0,m);A=u[p].substring(m+1)}else k=u[p];h(k,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function Vs(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof Vs){this.h=u.h,ih(this,u.j),this.o=u.o,this.g=u.g,sh(this,u.s),this.l=u.l;var h=u.i,p=new fu;p.i=h.i,h.g&&(p.g=new Map(h.g),p.h=h.h),MD(this,p),this.m=u.m}else u&&(h=String(u).match(RD))?(this.h=!1,ih(this,h[1]||"",!0),this.o=du(h[2]||""),this.g=du(h[3]||"",!0),sh(this,h[4]),this.l=du(h[5]||"",!0),MD(this,h[6]||"",!0),this.m=du(h[7]||"")):(this.h=!1,this.i=new fu(null,this.h))}Vs.prototype.toString=function(){var u=[],h=this.j;h&&u.push(hu(h,ND,!0),":");var p=this.g;return(p||h=="file")&&(u.push("//"),(h=this.o)&&u.push(hu(h,ND,!0),"@"),u.push(encodeURIComponent(String(p)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p=this.s,p!=null&&u.push(":",String(p))),(p=this.l)&&(this.g&&p.charAt(0)!="/"&&u.push("/"),u.push(hu(p,p.charAt(0)=="/"?SL:bL,!0))),(p=this.i.toString())&&u.push("?",p),(p=this.m)&&u.push("#",hu(p,xL)),u.join("")};function si(u){return new Vs(u)}function ih(u,h,p){u.j=p?du(h,!0):h,u.j&&(u.j=u.j.replace(/:$/,""))}function sh(u,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);u.s=h}else u.s=null}function MD(u,h,p){h instanceof fu?(u.i=h,RL(u.i,u.h)):(p||(h=hu(h,AL)),u.i=new fu(h,u.h))}function tt(u,h,p){u.i.set(h,p)}function oh(u){return tt(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function du(u,h){return u?h?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function hu(u,h,p){return typeof u=="string"?(u=encodeURI(u).replace(h,DL),p&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function DL(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var ND=/[#\/\?@]/g,bL=/[#\?:]/g,SL=/[#\?]/g,AL=/[#\?@]/g,xL=/#/g;function fu(u,h){this.h=this.g=null,this.i=u||null,this.j=!!h}function Pi(u){u.g||(u.g=new Map,u.h=0,u.i&&TL(u.i,function(h,p){u.add(decodeURIComponent(h.replace(/\+/g," ")),p)}))}n=fu.prototype,n.add=function(u,h){Pi(this),this.i=null,u=Jo(this,u);var p=this.g.get(u);return p||this.g.set(u,p=[]),p.push(h),this.h+=1,this};function PD(u,h){Pi(u),h=Jo(u,h),u.g.has(h)&&(u.i=null,u.h-=u.g.get(h).length,u.g.delete(h))}function kD(u,h){return Pi(u),h=Jo(u,h),u.g.has(h)}n.forEach=function(u,h){Pi(this),this.g.forEach(function(p,m){p.forEach(function(A){u.call(h,A,m,this)},this)},this)},n.na=function(){Pi(this);let u=Array.from(this.g.values()),h=Array.from(this.g.keys()),p=[];for(let m=0;m<h.length;m++){let A=u[m];for(let k=0;k<A.length;k++)p.push(h[m])}return p},n.V=function(u){Pi(this);let h=[];if(typeof u=="string")kD(this,u)&&(h=h.concat(this.g.get(Jo(this,u))));else{u=Array.from(this.g.values());for(let p=0;p<u.length;p++)h=h.concat(u[p])}return h},n.set=function(u,h){return Pi(this),this.i=null,u=Jo(this,u),kD(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[h]),this.h+=1,this},n.get=function(u,h){return u?(u=this.V(u),0<u.length?String(u[0]):h):h};function OD(u,h,p){PD(u,h),0<p.length&&(u.i=null,u.g.set(Jo(u,h),b(p)),u.h+=p.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let u=[],h=Array.from(this.g.keys());for(var p=0;p<h.length;p++){var m=h[p];let k=encodeURIComponent(String(m)),$=this.V(m);for(m=0;m<$.length;m++){var A=k;$[m]!==""&&(A+="="+encodeURIComponent(String($[m]))),u.push(A)}}return this.i=u.join("&")};function Jo(u,h){return h=String(h),u.j&&(h=h.toLowerCase()),h}function RL(u,h){h&&!u.j&&(Pi(u),u.i=null,u.g.forEach(function(p,m){var A=m.toLowerCase();m!=A&&(PD(this,m),OD(this,A,p))},u)),u.j=h}function ML(u,h){let p=new uu;if(a.Image){let m=new Image;m.onload=y(ki,p,"TestLoadImage: loaded",!0,h,m),m.onerror=y(ki,p,"TestLoadImage: error",!1,h,m),m.onabort=y(ki,p,"TestLoadImage: abort",!1,h,m),m.ontimeout=y(ki,p,"TestLoadImage: timeout",!1,h,m),a.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=u}else h(!1)}function NL(u,h){let p=new uu,m=new AbortController,A=setTimeout(()=>{m.abort(),ki(p,"TestPingServer: timeout",!1,h)},1e4);fetch(u,{signal:m.signal}).then(k=>{clearTimeout(A),k.ok?ki(p,"TestPingServer: ok",!0,h):ki(p,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(A),ki(p,"TestPingServer: error",!1,h)})}function ki(u,h,p,m,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),m(p)}catch{}}function PL(){this.g=new gL}function kL(u,h,p){let m=p||"";try{xD(u,function(A,k){let $=A;l(A)&&($=Ym(A)),h.push(m+k+"="+encodeURIComponent($))})}catch(A){throw h.push(m+"type="+encodeURIComponent("_badmap")),A}}function pu(u){this.l=u.Ub||null,this.j=u.eb||!1}v(pu,Zm),pu.prototype.g=function(){return new ah(this.l,this.j)},pu.prototype.i=function(u){return function(){return u}}({});function ah(u,h){Vt.call(this),this.D=u,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}v(ah,Vt),n=ah.prototype,n.open=function(u,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=h,this.readyState=1,mu(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(h.body=u),(this.D||a).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,gu(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,mu(this)),this.g&&(this.readyState=3,mu(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;FD(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function FD(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var h=u.value?u.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!u.done}))&&(this.response=this.responseText+=h)}u.done?gu(this):mu(this),this.readyState==3&&FD(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,gu(this))},n.Qa=function(u){this.g&&(this.response=u,gu(this))},n.ga=function(){this.g&&gu(this)};function gu(u){u.readyState=4,u.l=null,u.j=null,u.v=null,mu(u)}n.setRequestHeader=function(u,h){this.u.append(u,h)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let u=[],h=this.h.entries();for(var p=h.next();!p.done;)p=p.value,u.push(p[0]+": "+p[1]),p=h.next();return u.join(`\r
`)};function mu(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(ah.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function LD(u){let h="";return Z(u,function(p,m){h+=m,h+=":",h+=p,h+=`\r
`}),h}function ay(u,h,p){e:{for(m in p){var m=!1;break e}m=!0}m||(p=LD(p),typeof u=="string"?p!=null&&encodeURIComponent(String(p)):tt(u,h,p))}function ft(u){Vt.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}v(ft,Vt);var OL=/^https?$/i,FL=["POST","PUT"];n=ft.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,h,p,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);h=h?h.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ey.g(),this.v=this.o?hD(this.o):hD(ey),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(h,String(u),!0),this.B=!1}catch(k){VD(this,k);return}if(u=p||"",p=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var A in m)p.set(A,m[A]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(let k of m.keys())p.set(k,m.get(k));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(p.keys()).find(k=>k.toLowerCase()=="content-type"),A=a.FormData&&u instanceof a.FormData,!(0<=Array.prototype.indexOf.call(FL,h,void 0))||m||A||p.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[k,$]of p)this.g.setRequestHeader(k,$);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{BD(this),this.u=!0,this.g.send(u),this.u=!1}catch(k){VD(this,k)}};function VD(u,h){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=h,u.m=5,UD(u),ch(u)}function UD(u){u.A||(u.A=!0,Ht(u,"complete"),Ht(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,Ht(this,"complete"),Ht(this,"abort"),ch(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ch(this,!0)),ft.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?jD(this):this.bb())},n.bb=function(){jD(this)};function jD(u){if(u.h&&typeof o<"u"&&(!u.v[1]||oi(u)!=4||u.Z()!=2)){if(u.u&&oi(u)==4)su(u.Ea,0,u);else if(Ht(u,"readystatechange"),oi(u)==4){u.h=!1;try{let $=u.Z();e:switch($){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var p;if(!(p=h)){var m;if(m=$===0){var A=String(u.D).match(RD)[1]||null;!A&&a.self&&a.self.location&&(A=a.self.location.protocol.slice(0,-1)),m=!OL.test(A?A.toLowerCase():"")}p=m}if(p)Ht(u,"complete"),Ht(u,"success");else{u.m=6;try{var k=2<oi(u)?u.g.statusText:""}catch{k=""}u.l=k+" ["+u.Z()+"]",UD(u)}}finally{ch(u)}}}}function ch(u,h){if(u.g){BD(u);let p=u.g,m=u.v[0]?()=>{}:null;u.g=null,u.v=null,h||Ht(u,"ready");try{p.onreadystatechange=m}catch{}}}function BD(u){u.I&&(a.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function oi(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<oi(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var h=this.g.responseText;return u&&h.indexOf(u)==0&&(h=h.substring(u.length)),pL(h)}};function $D(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function LL(u){let h={};u=(u.g&&2<=oi(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<u.length;m++){if(B(u[m]))continue;var p=S(u[m]);let A=p[0];if(p=p[1],typeof p!="string")continue;p=p.trim();let k=h[A]||[];h[A]=k,k.push(p)}I(h,function(m){return m.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function yu(u,h,p){return p&&p.internalChannelParams&&p.internalChannelParams[u]||h}function qD(u){this.Aa=0,this.i=[],this.j=new uu,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=yu("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=yu("baseRetryDelayMs",5e3,u),this.cb=yu("retryDelaySeedMs",1e4,u),this.Wa=yu("forwardChannelMaxRetries",2,u),this.wa=yu("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new TD(u&&u.concurrentRequestLimit),this.Da=new PL,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=qD.prototype,n.la=8,n.G=1,n.connect=function(u,h,p,m){cn(0),this.W=u,this.H=h||{},p&&m!==void 0&&(this.H.OSID=p,this.H.OAID=m),this.F=this.X,this.I=XD(this,null,this.W),lh(this)};function cy(u){if(HD(u),u.G==3){var h=u.U++,p=si(u.I);if(tt(p,"SID",u.K),tt(p,"RID",h),tt(p,"TYPE","terminate"),_u(u,p),h=new Ni(u,u.j,h),h.L=2,h.v=oh(si(p)),p=!1,a.navigator&&a.navigator.sendBeacon)try{p=a.navigator.sendBeacon(h.v.toString(),"")}catch{}!p&&a.Image&&(new Image().src=h.v,p=!0),p||(h.g=JD(h.j,null),h.g.ea(h.v)),h.F=Date.now(),rh(h)}ZD(u)}function uh(u){u.g&&(ly(u),u.g.cancel(),u.g=null)}function HD(u){uh(u),u.u&&(a.clearTimeout(u.u),u.u=null),dh(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&a.clearTimeout(u.s),u.s=null)}function lh(u){if(!DD(u.h)&&!u.s){u.s=!0;var h=u.Ga;Ns||N(),Ps||(Ns(),Ps=!0),nu.add(h,u),u.B=0}}function VL(u,h){return bD(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=h.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=cu(g(u.Ga,u,h),YD(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;let A=new Ni(this,this.j,u),k=this.o;if(this.S&&(k?(k=_(k),C(k,this.S)):k=this.S),this.m!==null||this.O||(A.H=k,k=null),this.P)e:{for(var h=0,p=0;p<this.i.length;p++){t:{var m=this.i[p];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break t}m=void 0}if(m===void 0)break;if(h+=m,4096<h){h=p;break e}if(h===4096||p===this.i.length-1){h=p+1;break e}}h=1e3}else h=1e3;h=GD(this,A,h),p=si(this.I),tt(p,"RID",u),tt(p,"CVER",22),this.D&&tt(p,"X-HTTP-Session-Id",this.D),_u(this,p),k&&(this.O?h="headers="+encodeURIComponent(String(LD(k)))+"&"+h:this.m&&ay(p,this.m,k)),oy(this.h,A),this.Ua&&tt(p,"TYPE","init"),this.P?(tt(p,"$req",h),tt(p,"SID","null"),A.T=!0,ny(A,p,null)):ny(A,p,h),this.G=2}}else this.G==3&&(u?zD(this,u):this.i.length==0||DD(this.h)||zD(this))};function zD(u,h){var p;h?p=h.l:p=u.U++;let m=si(u.I);tt(m,"SID",u.K),tt(m,"RID",p),tt(m,"AID",u.T),_u(u,m),u.m&&u.o&&ay(m,u.m,u.o),p=new Ni(u,u.j,p,u.B+1),u.m===null&&(p.H=u.o),h&&(u.i=h.D.concat(u.i)),h=GD(u,p,1e3),p.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),oy(u.h,p),ny(p,m,h)}function _u(u,h){u.H&&Z(u.H,function(p,m){tt(h,m,p)}),u.l&&xD({},function(p,m){tt(h,m,p)})}function GD(u,h,p){p=Math.min(u.i.length,p);var m=u.l?g(u.l.Na,u.l,u):null;e:{var A=u.i;let k=-1;for(;;){let $=["count="+p];k==-1?0<p?(k=A[0].g,$.push("ofs="+k)):k=0:$.push("ofs="+k);let Ge=!0;for(let zt=0;zt<p;zt++){let Le=A[zt].g,Xt=A[zt].map;if(Le-=k,0>Le)k=Math.max(0,A[zt].g-100),Ge=!1;else try{kL(Xt,$,"req"+Le+"_")}catch{m&&m(Xt)}}if(Ge){m=$.join("&");break e}}}return u=u.i.splice(0,p),h.D=u,m}function WD(u){if(!u.g&&!u.u){u.Y=1;var h=u.Fa;Ns||N(),Ps||(Ns(),Ps=!0),nu.add(h,u),u.v=0}}function uy(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=cu(g(u.Fa,u),YD(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,KD(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=cu(g(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,cn(10),uh(this),KD(this))};function ly(u){u.A!=null&&(a.clearTimeout(u.A),u.A=null)}function KD(u){u.g=new Ni(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var h=si(u.qa);tt(h,"RID","rpc"),tt(h,"SID",u.K),tt(h,"AID",u.T),tt(h,"CI",u.F?"0":"1"),!u.F&&u.ja&&tt(h,"TO",u.ja),tt(h,"TYPE","xmlhttp"),_u(u,h),u.m&&u.o&&ay(h,u.m,u.o),u.L&&(u.g.I=u.L);var p=u.g;u=u.ia,p.L=1,p.v=oh(si(h)),p.m=null,p.P=!0,ED(p,u)}n.Za=function(){this.C!=null&&(this.C=null,uh(this),uy(this),cn(19))};function dh(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function QD(u,h){var p=null;if(u.g==h){dh(u),ly(u),u.g=null;var m=2}else if(sy(u.h,h))p=h.D,SD(u.h,h),m=1;else return;if(u.G!=0){if(h.o)if(m==1){p=h.m?h.m.length:0,h=Date.now()-h.F;var A=u.B;m=eh(),Ht(m,new yD(m,p)),lh(u)}else WD(u);else if(A=h.s,A==3||A==0&&0<h.X||!(m==1&&VL(u,h)||m==2&&uy(u)))switch(p&&0<p.length&&(h=u.h,h.i=h.i.concat(p)),A){case 1:Us(u,5);break;case 4:Us(u,10);break;case 3:Us(u,6);break;default:Us(u,2)}}}function YD(u,h){let p=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(p*=2),p*h}function Us(u,h){if(u.j.info("Error code "+h),h==2){var p=g(u.fb,u),m=u.Xa;let A=!m;m=new Vs(m||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||ih(m,"https"),oh(m),A?ML(m.toString(),p):NL(m.toString(),p)}else cn(2);u.G=0,u.l&&u.l.sa(h),ZD(u),HD(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),cn(2)):(this.j.info("Failed to ping google.com"),cn(1))};function ZD(u){if(u.G=0,u.ka=[],u.l){let h=AD(u.h);(h.length!=0||u.i.length!=0)&&(T(u.ka,h),T(u.ka,u.i),u.h.i.length=0,b(u.i),u.i.length=0),u.l.ra()}}function XD(u,h,p){var m=p instanceof Vs?si(p):new Vs(p);if(m.g!="")h&&(m.g=h+"."+m.g),sh(m,m.s);else{var A=a.location;m=A.protocol,h=h?h+"."+A.hostname:A.hostname,A=+A.port;var k=new Vs(null);m&&ih(k,m),h&&(k.g=h),A&&sh(k,A),p&&(k.l=p),m=k}return p=u.D,h=u.ya,p&&h&&tt(m,p,h),tt(m,"VER",u.la),_u(u,m),m}function JD(u,h,p){if(h&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=u.Ca&&!u.pa?new ft(new pu({eb:p})):new ft(u.pa),h.Ha(u.J),h}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function eb(){}n=eb.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function hh(){}hh.prototype.g=function(u,h){return new Mn(u,h)};function Mn(u,h){Vt.call(this),this.g=new qD(h),this.l=u,this.h=h&&h.messageUrlParams||null,u=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(u?u["X-WebChannel-Content-Type"]=h.messageContentType:u={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(u?u["X-WebChannel-Client-Profile"]=h.va:u={"X-WebChannel-Client-Profile":h.va}),this.g.S=u,(u=h&&h.Sb)&&!B(u)&&(this.g.m=u),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!B(h)&&(this.g.D=h,u=this.h,u!==null&&h in u&&(u=this.h,h in u&&delete u[h])),this.j=new ea(this)}v(Mn,Vt),Mn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Mn.prototype.close=function(){cy(this.g)},Mn.prototype.o=function(u){var h=this.g;if(typeof u=="string"){var p={};p.__data__=u,u=p}else this.u&&(p={},p.__data__=Ym(u),u=p);h.i.push(new EL(h.Ya++,u)),h.G==3&&lh(h)},Mn.prototype.N=function(){this.g.l=null,delete this.j,cy(this.g),delete this.g,Mn.aa.N.call(this)};function tb(u){Xm.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var h=u.__sm__;if(h){e:{for(let p in h){u=p;break e}u=void 0}(this.i=u)&&(u=this.i,h=h!==null&&u in h?h[u]:void 0),this.data=h}else this.data=u}v(tb,Xm);function nb(){Jm.call(this),this.status=1}v(nb,Jm);function ea(u){this.g=u}v(ea,eb),ea.prototype.ua=function(){Ht(this.g,"a")},ea.prototype.ta=function(u){Ht(this.g,new tb(u))},ea.prototype.sa=function(u){Ht(this.g,new nb)},ea.prototype.ra=function(){Ht(this.g,"b")},hh.prototype.createWebChannel=hh.prototype.g,Mn.prototype.send=Mn.prototype.o,Mn.prototype.open=Mn.prototype.m,Mn.prototype.close=Mn.prototype.close,Xw=wi.createWebChannelTransport=function(){return new hh},Zw=wi.getStatEventTarget=function(){return eh()},Yw=wi.Event=Fs,Cp=wi.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},th.NO_ERROR=0,th.TIMEOUT=8,th.HTTP_ERROR=6,Dl=wi.ErrorCode=th,_D.COMPLETE="complete",Qw=wi.EventType=_D,fD.EventType=ou,ou.OPEN="a",ou.CLOSE="b",ou.ERROR="c",ou.MESSAGE="d",Vt.prototype.listen=Vt.prototype.K,Ha=wi.WebChannel=fD,Kw=wi.FetchXmlHttpFactory=pu,ft.prototype.listenOnce=ft.prototype.L,ft.prototype.getLastError=ft.prototype.Ka,ft.prototype.getLastErrorCode=ft.prototype.Ba,ft.prototype.getStatus=ft.prototype.Z,ft.prototype.getResponseJson=ft.prototype.Oa,ft.prototype.getResponseText=ft.prototype.oa,ft.prototype.send=ft.prototype.ea,ft.prototype.setWithCredentials=ft.prototype.Ha,Ww=wi.XhrIo=ft}).apply(typeof Ip<"u"?Ip:typeof self<"u"?self:typeof window<"u"?window:{});var yM="@firebase/firestore";var Mt=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Mt.UNAUTHENTICATED=new Mt(null),Mt.GOOGLE_CREDENTIALS=new Mt("google-credentials-uid"),Mt.FIRST_PARTY=new Mt("first-party-uid"),Mt.MOCK_USER=new Mt("mock-user");var Ec="10.13.1";var us=new Fi("@firebase/firestore");function Qa(){return us.logLevel}function wN(n){us.setLogLevel(n)}function U(n,...e){if(us.logLevel<=Gn.DEBUG){let t=e.map(rC);us.debug(`Firestore (${Ec}): ${n}`,...t)}}function Et(n,...e){if(us.logLevel<=Gn.ERROR){let t=e.map(rC);us.error(`Firestore (${Ec}): ${n}`,...t)}}function Jn(n,...e){if(us.logLevel<=Gn.WARN){let t=e.map(rC);us.warn(`Firestore (${Ec}): ${n}`,...t)}}function rC(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function W(n="Unexpected state"){let e=`FIRESTORE (${Ec}) INTERNAL ASSERTION FAILED: `+n;throw Et(e),new Error(e)}function te(n,e){n||W()}function EN(n,e){n||W()}function q(n,e){return n}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},L=class extends yh{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Nt=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var kp=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},rE=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Mt.UNAUTHENTICATED))}shutdown(){}},iE=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},sE=class{constructor(e){this.t=e,this.currentUser=Mt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.i,i=c=>this.i!==r?(r=this.i,t(c)):Promise.resolve(),s=new Nt;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Nt,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let c=s;e.enqueueRetryable(()=>M(this,null,function*(){yield c.promise,yield i(this.currentUser)}))},a=c=>{U("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?a(c):(U("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Nt)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(U("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(te(typeof r.accessToken=="string"),new kp(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return te(e===null||typeof e=="string"),new Mt(e)}},oE=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Mt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},aE=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new oE(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Mt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},cE=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},uE=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){let r=s=>{s.error!=null&&U("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,U("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{U("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):U("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(te(typeof t.token=="string"),this.R=t.token,new cE(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function c4(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var Op=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=c4(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}};function pe(n,e){return n<e?-1:n>e?1:0}function ic(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function IN(n){return n+"\0"}var lt=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new L(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new L(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new L(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new L(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?pe(this.nanoseconds,e.nanoseconds):pe(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var ie=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new lt(0,0))}static max(){return new n(new lt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Fp=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&W(),r===void 0?r=e.length-t:r>e.length-t&&W(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},Oe=class n extends Fp{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new L(P.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},u4=/^[_a-zA-Z][_a-zA-Z0-9]*$/,It=class n extends Fp{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return u4.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new L(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new L(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new L(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new L(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var H=class n{constructor(e){this.path=e}static fromPath(e){return new n(Oe.fromString(e))}static fromName(e){return new n(Oe.fromString(e).popFirst(5))}static empty(){return new n(Oe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Oe.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Oe.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new Oe(e.slice()))}};var sc=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};function lE(n){return n.fields.find(e=>e.kind===2)}function fo(n){return n.fields.filter(e=>e.kind!==2)}sc.UNKNOWN_ID=-1;var tc=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Ll=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,er.min())}};function CN(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=ie.fromTimestamp(r===1e9?new lt(t+1,0):new lt(t,r));return new er(i,H.empty(),e)}function TN(n){return new er(n.readTime,n.key,-1)}var er=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(ie.min(),H.empty(),-1)}static max(){return new n(ie.max(),H.empty(),-1)}};function iC(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=H.comparator(n.documentKey,e.documentKey),t!==0?t:pe(n.largestBatchId,e.largestBatchId))}var DN="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Lp=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function vs(n){return M(this,null,function*(){if(n.code!==P.FAILED_PRECONDITION||n.message!==DN)throw n;U("LocalStore","Unexpectedly lost primary lease")})}var R=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&W(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},c=>r(c))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let c=0;c<s;c++){let l=c;t(e[l]).next(d=>{o[l]=d,++a,a===s&&r(o)},d=>i(d))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var Vp=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Nt,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new vo(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=sC(r.target.error);this.V.reject(new vo(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new vo(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(U("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new hE(t)}},ls=class n{constructor(e,t,r){this.name=e,this.version=t,this.p=r,n.S(vu())===12.2&&Et("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return U("SimpleDb","Removing database:",e),po(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!mh())return!1;if(n.v())return!0;let e=vu(),t=n.S(e),r=0<t&&t<10,i=bN(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}M(e){return M(this,null,function*(){return this.db||(U("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new vo(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new L(P.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new L(P.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new vo(e,o))},i.onupgradeneeded=s=>{U("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.O(o,i.transaction,s.oldVersion,this.version).next(()=>{U("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return M(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(e);let a=Vp.open(this.db,e,s?"readonly":"readwrite",r),c=i(a).next(l=>(a.g(),l)).catch(l=>(a.abort(l),R.reject(l))).toPromise();return c.catch(()=>{}),yield a.m,c}catch(a){let c=a,l=c.name!=="FirebaseError"&&o<3;if(U("SimpleDb","Transaction failed with error:",c.message,"Retrying:",l),this.close(),!l)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function bN(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var dE=class{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return po(this.B.delete())}},vo=class extends L{constructor(e,t){super(P.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function ws(n){return n.name==="IndexedDbTransactionError"}var hE=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(U("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(U("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),po(r)}add(e){return U("SimpleDb","ADD",this.store.name,e,e),po(this.store.add(e))}get(e){return po(this.store.get(e)).next(t=>(t===void 0&&(t=null),U("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return U("SimpleDb","DELETE",this.store.name,e),po(this.store.delete(e))}count(){return U("SimpleDb","COUNT",this.store.name),po(this.store.count())}U(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new R((o,a)=>{s.onerror=c=>{a(c.target.error)},s.onsuccess=c=>{o(c.target.result)}})}{let s=this.cursor(r),o=[];return this.W(s,(a,c)=>{o.push(c)}).next(()=>o)}}G(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new R((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}j(e,t){U("SimpleDb","DELETE ALL",this.store.name);let r=this.options(e,t);r.H=!1;let i=this.cursor(r);return this.W(i,(s,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.W(i,t)}Y(e){let t=this.cursor({});return new R((r,i)=>{t.onerror=s=>{let o=sC(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){let r=[];return new R((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void i();let c=new dE(a),l=t(a.primaryKey,a.value,c);if(l instanceof R){let d=l.catch(f=>(c.done(),R.reject(f)));r.push(d)}c.isDone?i():c.K===null?a.continue():a.continue(c.K)}}).next(()=>R.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function po(n){return new R((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=sC(r.target.error);t(i)}})}var _M=!1;function sC(n){let e=ls.S(vu());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new L("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return _M||(_M=!0,setTimeout(()=>{throw r},0)),r}}return n}var fE=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){U("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>M(this,null,function*(){this.task=null;try{U("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){ws(t)?U("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield vs(t)}yield this.X(6e4)}))}},pE=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return M(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let r=new Set,i=t,s=!0;return R.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return U("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>t-i)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(i,s)).next(a=>(U("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=TN(s);iC(o,r)>0&&(r=o)}),new er(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var Ln=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function od(n){return n==null}function Vl(n){return n===0&&1/n==-1/0}function SN(n){return typeof n=="number"&&Number.isInteger(n)&&!Vl(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function hn(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=vM(e)),e=l4(n.get(t),e);return vM(e)}function l4(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function vM(n){return n+""}function Br(n){let e=n.length;if(te(e>=2),e===2)return te(n.charAt(0)===""&&n.charAt(1)===""),Oe.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf("",s);switch((o<0||o>t)&&W(),n.charAt(o+1)){case"":let a=n.substring(s,o),c;i.length===0?c=a:(i+=a,c=i,i=""),r.push(c);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:W()}s=o+2}return new Oe(r)}var wM=["userId","batchId"];function Ap(n,e){return[n,hn(e)]}function AN(n,e,t){return[n,hn(e),t]}var d4={},h4=["prefixPath","collectionGroup","readTime","documentId"],f4=["prefixPath","collectionGroup","documentId"],p4=["collectionGroup","readTime","prefixPath","documentId"],g4=["canonicalId","targetId"],m4=["targetId","path"],y4=["path","targetId"],_4=["collectionId","parent"],v4=["indexId","uid"],w4=["uid","sequenceNumber"],E4=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],I4=["indexId","uid","orderedDocumentKey"],C4=["userId","collectionPath","documentId"],T4=["userId","collectionPath","largestBatchId"],D4=["userId","collectionGroup","largestBatchId"],xN=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],b4=[...xN,"documentOverlays"],RN=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],MN=RN,oC=[...MN,"indexConfiguration","indexState","indexEntries"],S4=oC,A4=[...oC,"globals"];var Ul=class extends Lp{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function Ot(n,e){let t=q(n);return ls.F(t._e,e)}function EM(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Mo(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function NN(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var it=class n{constructor(e,t){this.comparator=e,this.root=t||qr.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,qr.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,qr.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ec(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ec(this.root,e,this.comparator,!1)}getReverseIterator(){return new ec(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ec(this.root,e,this.comparator,!0)}},ec=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},qr=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw W();let e=this.left.check();if(e!==this.right.check())throw W();return e+(this.isRed()?0:1)}};qr.EMPTY=null,qr.RED=!0,qr.BLACK=!1;qr.EMPTY=new class{constructor(){this.size=0}get key(){throw W()}get value(){throw W()}get color(){throw W()}get left(){throw W()}get right(){throw W()}copy(e,t,r,i,s){return this}insert(e,t,r){return new qr(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var Qe=class n{constructor(e){this.comparator=e,this.data=new it(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Up(this.data.getIterator())}getIteratorFrom(e){return new Up(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Up=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function za(n){return n.hasNext()?n.getNext():void 0}var Vn=class n{constructor(e){this.fields=e,e.sort(It.comparator)}static empty(){return new n([])}unionWith(e){let t=new Qe(It.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ic(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var jp=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function PN(){return typeof atob<"u"}var Tt=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new jp("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return pe(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Tt.EMPTY_BYTE_STRING=new Tt("");var x4=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ci(n){if(te(!!n),typeof n=="string"){let e=0,t=x4.exec(n);if(te(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ot(n.seconds),nanos:ot(n.nanos)}}function ot(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ds(n){return typeof n=="string"?Tt.fromBase64String(n):Tt.fromUint8Array(n)}function Rg(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function aC(n){let e=n.mapValue.fields.__previous_value__;return Rg(e)?aC(e):e}function jl(n){let e=Ci(n.mapValue.fields.__local_write_time__.timestampValue);return new lt(e.seconds,e.nanos)}var gE=class{constructor(e,t,r,i,s,o,a,c,l){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=l}},hs=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var as={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},xp={nullValue:"NULL_VALUE"};function wo(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Rg(n)?4:kN(n)?9007199254740991:Mg(n)?10:11:W()}function Gr(n,e){if(n===e)return!0;let t=wo(n);if(t!==wo(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return jl(n).isEqual(jl(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=Ci(i.timestampValue),a=Ci(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return ds(i.bytesValue).isEqual(ds(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return ot(i.geoPointValue.latitude)===ot(s.geoPointValue.latitude)&&ot(i.geoPointValue.longitude)===ot(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ot(i.integerValue)===ot(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=ot(i.doubleValue),a=ot(s.doubleValue);return o===a?Vl(o)===Vl(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return ic(n.arrayValue.values||[],e.arrayValue.values||[],Gr);case 10:case 11:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(EM(o)!==EM(a))return!1;for(let c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!Gr(o[c],a[c])))return!1;return!0}(n,e);default:return W()}}function Bl(n,e){return(n.values||[]).find(t=>Gr(t,e))!==void 0}function fs(n,e){if(n===e)return 0;let t=wo(n),r=wo(e);if(t!==r)return pe(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return pe(n.booleanValue,e.booleanValue);case 2:return function(s,o){let a=ot(s.integerValue||s.doubleValue),c=ot(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(n,e);case 3:return IM(n.timestampValue,e.timestampValue);case 4:return IM(jl(n),jl(e));case 5:return pe(n.stringValue,e.stringValue);case 6:return function(s,o){let a=ds(s),c=ds(o);return a.compareTo(c)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),c=o.split("/");for(let l=0;l<a.length&&l<c.length;l++){let d=pe(a[l],c[l]);if(d!==0)return d}return pe(a.length,c.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let a=pe(ot(s.latitude),ot(o.latitude));return a!==0?a:pe(ot(s.longitude),ot(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return CM(n.arrayValue,e.arrayValue);case 10:return function(s,o){var a,c,l,d;let f=s.fields||{},g=o.fields||{},y=(a=f.value)===null||a===void 0?void 0:a.arrayValue,v=(c=g.value)===null||c===void 0?void 0:c.arrayValue,b=pe(((l=y?.values)===null||l===void 0?void 0:l.length)||0,((d=v?.values)===null||d===void 0?void 0:d.length)||0);return b!==0?b:CM(y,v)}(n.mapValue,e.mapValue);case 11:return function(s,o){if(s===as.mapValue&&o===as.mapValue)return 0;if(s===as.mapValue)return 1;if(o===as.mapValue)return-1;let a=s.fields||{},c=Object.keys(a),l=o.fields||{},d=Object.keys(l);c.sort(),d.sort();for(let f=0;f<c.length&&f<d.length;++f){let g=pe(c[f],d[f]);if(g!==0)return g;let y=fs(a[c[f]],l[d[f]]);if(y!==0)return y}return pe(c.length,d.length)}(n.mapValue,e.mapValue);default:throw W()}}function IM(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return pe(n,e);let t=Ci(n),r=Ci(e),i=pe(t.seconds,r.seconds);return i!==0?i:pe(t.nanos,r.nanos)}function CM(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=fs(t[i],r[i]);if(s)return s}return pe(t.length,r.length)}function oc(n){return mE(n)}function mE(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=Ci(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return ds(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return H.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=mE(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${mE(t.fields[o])}`;return i+"}"}(n.mapValue):W()}function Eo(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function yE(n){return!!n&&"integerValue"in n}function $l(n){return!!n&&"arrayValue"in n}function TM(n){return!!n&&"nullValue"in n}function DM(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Rp(n){return!!n&&"mapValue"in n}function Mg(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Nl(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Mo(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Nl(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Nl(n.arrayValue.values[t]);return e}return Object.assign({},n)}function kN(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var ON={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function R4(n){return"nullValue"in n?xp:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Eo(hs.empty(),H.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Mg(n)?ON:{mapValue:{}}:W()}function M4(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Eo(hs.empty(),H.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?ON:"mapValue"in n?Mg(n)?{mapValue:{}}:as:W()}function bM(n,e){let t=fs(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function SM(n,e){let t=fs(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var sn=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Rp(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Nl(t)}setAll(e){let t=It.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let c=this.getFieldsMap(t);this.applyChanges(c,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Nl(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());Rp(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Gr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Rp(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Mo(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Nl(this.value))}};function FN(n){let e=[];return Mo(n.fields,(t,r)=>{let i=new It([t]);if(Rp(r)){let s=FN(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new Vn(e)}var Pt=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,ie.min(),ie.min(),ie.min(),sn.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,ie.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,ie.min(),ie.min(),sn.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,ie.min(),ie.min(),sn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ie.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=sn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=sn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ie.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Wr=class{constructor(e,t){this.position=e,this.inclusive=t}};function AM(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField()?r=H.comparator(H.fromName(o.referenceValue),t.key):r=fs(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function xM(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Gr(n.position[t],e.position[t]))return!1;return!0}var Io=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function N4(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Bp=class{},Me=class n extends Bp{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new wE(e,t,r):t==="array-contains"?new CE(e,r):t==="in"?new $p(e,r):t==="not-in"?new TE(e,r):t==="array-contains-any"?new DE(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new EE(e,r):new IE(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(fs(t,this.value)):t!==null&&wo(this.value)===wo(t)&&this.matchesComparison(fs(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return W()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},qe=class n extends Bp{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new n(e,t)}matches(e){return ac(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function ac(n){return n.op==="and"}function _E(n){return n.op==="or"}function cC(n){return LN(n)&&ac(n)}function LN(n){for(let e of n.filters)if(e instanceof qe)return!1;return!0}function vE(n){if(n instanceof Me)return n.field.canonicalString()+n.op.toString()+oc(n.value);if(cC(n))return n.filters.map(e=>vE(e)).join(",");{let e=n.filters.map(t=>vE(t)).join(",");return`${n.op}(${e})`}}function VN(n,e){return n instanceof Me?function(r,i){return i instanceof Me&&r.op===i.op&&r.field.isEqual(i.field)&&Gr(r.value,i.value)}(n,e):n instanceof qe?function(r,i){return i instanceof qe&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&VN(o,i.filters[a]),!0):!1}(n,e):void W()}function UN(n,e){let t=n.filters.concat(e);return qe.create(t,n.op)}function jN(n){return n instanceof Me?function(t){return`${t.field.canonicalString()} ${t.op} ${oc(t.value)}`}(n):n instanceof qe?function(t){return t.op.toString()+" {"+t.getFilters().map(jN).join(" ,")+"}"}(n):"Filter"}var wE=class extends Me{constructor(e,t,r){super(e,t,r),this.key=H.fromName(r.referenceValue)}matches(e){let t=H.comparator(e.key,this.key);return this.matchesComparison(t)}},EE=class extends Me{constructor(e,t){super(e,"in",t),this.keys=BN("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},IE=class extends Me{constructor(e,t){super(e,"not-in",t),this.keys=BN("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function BN(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>H.fromName(r.referenceValue))}var CE=class extends Me{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return $l(t)&&Bl(t.arrayValue,this.value)}},$p=class extends Me{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Bl(this.value.arrayValue,t)}},TE=class extends Me{constructor(e,t){super(e,"not-in",t)}matches(e){if(Bl(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Bl(this.value.arrayValue,t)}},DE=class extends Me{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!$l(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Bl(this.value.arrayValue,r))}};var bE=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ue=null}};function SE(n,e=null,t=[],r=[],i=null,s=null,o=null){return new bE(n,e,t,r,i,s,o)}function Co(n){let e=q(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>vE(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),od(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>oc(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>oc(r)).join(",")),e.ue=t}return e.ue}function ad(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!N4(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!VN(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!xM(n.startAt,e.startAt)&&xM(n.endAt,e.endAt)}function qp(n){return H.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Hp(n,e){return n.filters.filter(t=>t instanceof Me&&t.field.isEqual(e))}function RM(n,e,t){let r=xp,i=!0;for(let s of Hp(n,e)){let o=xp,a=!0;switch(s.op){case"<":case"<=":o=R4(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=xp}bM({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];bM({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function MM(n,e,t){let r=as,i=!0;for(let s of Hp(n,e)){let o=as,a=!0;switch(s.op){case">=":case">":o=M4(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=as}SM({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];SM({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}var gr=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function $N(n,e,t,r,i,s,o,a){return new gr(n,e,t,r,i,s,o,a)}function Ic(n){return new gr(n)}function NM(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function uC(n){return n.collectionGroup!==null}function nc(n){let e=q(n);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Qe(It.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(l=>{l.isInequality()&&(a=a.add(l.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new Io(s,r))}),t.has(It.keyField().canonicalString())||e.ce.push(new Io(It.keyField(),r))}return e.ce}function fn(n){let e=q(n);return e.le||(e.le=P4(e,nc(n))),e.le}function P4(n,e){if(n.limitType==="F")return SE(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Io(i.field,s)});let t=n.endAt?new Wr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Wr(n.startAt.position,n.startAt.inclusive):null;return SE(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function AE(n,e){let t=n.filters.concat([e]);return new gr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function zp(n,e,t){return new gr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function cd(n,e){return ad(fn(n),fn(e))&&n.limitType===e.limitType}function qN(n){return`${Co(fn(n))}|lt:${n.limitType}`}function Ya(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>jN(i)).join(", ")}]`),od(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>oc(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>oc(i)).join(",")),`Target(${r})`}(fn(n))}; limitType=${n.limitType})`}function ud(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):H.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of nc(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,a,c){let l=AM(o,a,c);return o.inclusive?l<=0:l<0}(r.startAt,nc(r),i)||r.endAt&&!function(o,a,c){let l=AM(o,a,c);return o.inclusive?l>=0:l>0}(r.endAt,nc(r),i))}(n,e)}function HN(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function zN(n){return(e,t)=>{let r=!1;for(let i of nc(n)){let s=k4(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function k4(n,e,t){let r=n.field.isKeyField()?H.comparator(e.key,t.key):function(s,o,a){let c=o.data.field(s),l=a.data.field(s);return c!==null&&l!==null?fs(c,l):W()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return W()}}var Kr=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Mo(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return NN(this.inner)}size(){return this.innerSize}};var O4=new it(H.comparator);function xn(){return O4}var GN=new it(H.comparator);function Rl(...n){let e=GN;for(let t of n)e=e.insert(t.key,t);return e}function WN(n){let e=GN;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function $r(){return Pl()}function KN(){return Pl()}function Pl(){return new Kr(n=>n.toString(),(n,e)=>n.isEqual(e))}var F4=new it(H.comparator),L4=new Qe(H.comparator);function me(...n){let e=L4;for(let t of n)e=e.add(t);return e}var V4=new Qe(pe);function lC(){return V4}function dC(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Vl(e)?"-0":e}}function QN(n){return{integerValue:""+n}}function YN(n,e){return SN(e)?QN(e):dC(n,e)}var cc=class{constructor(){this._=void 0}};function U4(n,e,t){return n instanceof ps?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Rg(s)&&(s=aC(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof Ti?XN(n,e):n instanceof Di?JN(n,e):function(i,s){let o=ZN(i,s),a=PM(o)+PM(i.Pe);return yE(o)&&yE(i.Pe)?QN(a):dC(i.serializer,a)}(n,e)}function j4(n,e,t){return n instanceof Ti?XN(n,e):n instanceof Di?JN(n,e):t}function ZN(n,e){return n instanceof gs?function(r){return yE(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var ps=class extends cc{},Ti=class extends cc{constructor(e){super(),this.elements=e}};function XN(n,e){let t=eP(e);for(let r of n.elements)t.some(i=>Gr(i,r))||t.push(r);return{arrayValue:{values:t}}}var Di=class extends cc{constructor(e){super(),this.elements=e}};function JN(n,e){let t=eP(e);for(let r of n.elements)t=t.filter(i=>!Gr(i,r));return{arrayValue:{values:t}}}var gs=class extends cc{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function PM(n){return ot(n.integerValue||n.doubleValue)}function eP(n){return $l(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var To=class{constructor(e,t){this.field=e,this.transform=t}};function B4(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof Ti&&i instanceof Ti||r instanceof Di&&i instanceof Di?ic(r.elements,i.elements,Gr):r instanceof gs&&i instanceof gs?Gr(r.Pe,i.Pe):r instanceof ps&&i instanceof ps}(n.transform,e.transform)}var xE=class{constructor(e,t){this.version=e,this.transformResults=t}},gt=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Mp(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var uc=class{};function tP(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new ys(n.key,gt.none()):new ms(n.key,n.data,gt.none());{let t=n.data,r=sn.empty(),i=new Qe(It.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new mr(n.key,r,new Vn(i.toArray()),gt.none())}}function $4(n,e,t){n instanceof ms?function(i,s,o){let a=i.value.clone(),c=OM(i.fieldTransforms,s,o.transformResults);a.setAll(c),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof mr?function(i,s,o){if(!Mp(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=OM(i.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(nP(i)),c.setAll(a),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function kl(n,e,t,r){return n instanceof ms?function(s,o,a,c){if(!Mp(s.precondition,o))return a;let l=s.value.clone(),d=FM(s.fieldTransforms,c,o);return l.setAll(d),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),null}(n,e,t,r):n instanceof mr?function(s,o,a,c){if(!Mp(s.precondition,o))return a;let l=FM(s.fieldTransforms,c,o),d=o.data;return d.setAll(nP(s)),d.setAll(l),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(s,o,a){return Mp(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function q4(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=ZN(r.transform,i||null);s!=null&&(t===null&&(t=sn.empty()),t.set(r.field,s))}return t||null}function kM(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&ic(r,i,(s,o)=>B4(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var ms=class extends uc{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},mr=class extends uc{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function nP(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function OM(n,e,t){let r=new Map;te(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,j4(o,a,t[i]))}return r}function FM(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,U4(s,o,e))}return r}var ys=class extends uc{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},ql=class extends uc{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Hl=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&$4(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=kl(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=kl(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=KN();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let c=tP(o,a);c!==null&&r.set(i.key,c),o.isValidDocument()||o.convertToNoDocument(ie.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),me())}isEqual(e){return this.batchId===e.batchId&&ic(this.mutations,e.mutations,(t,r)=>kM(t,r))&&ic(this.baseMutations,e.baseMutations,(t,r)=>kM(t,r))}},RE=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){te(e.mutations.length===r.length);let i=function(){return F4}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var zl=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var ME=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var xt,ke;function rP(n){switch(n){default:return W();case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0}}function iP(n){if(n===void 0)return Et("GRPC error has no .code"),P.UNKNOWN;switch(n){case xt.OK:return P.OK;case xt.CANCELLED:return P.CANCELLED;case xt.UNKNOWN:return P.UNKNOWN;case xt.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case xt.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case xt.INTERNAL:return P.INTERNAL;case xt.UNAVAILABLE:return P.UNAVAILABLE;case xt.UNAUTHENTICATED:return P.UNAUTHENTICATED;case xt.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case xt.NOT_FOUND:return P.NOT_FOUND;case xt.ALREADY_EXISTS:return P.ALREADY_EXISTS;case xt.PERMISSION_DENIED:return P.PERMISSION_DENIED;case xt.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case xt.ABORTED:return P.ABORTED;case xt.OUT_OF_RANGE:return P.OUT_OF_RANGE;case xt.UNIMPLEMENTED:return P.UNIMPLEMENTED;case xt.DATA_LOSS:return P.DATA_LOSS;default:return W()}}(ke=xt||(xt={}))[ke.OK=0]="OK",ke[ke.CANCELLED=1]="CANCELLED",ke[ke.UNKNOWN=2]="UNKNOWN",ke[ke.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ke[ke.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ke[ke.NOT_FOUND=5]="NOT_FOUND",ke[ke.ALREADY_EXISTS=6]="ALREADY_EXISTS",ke[ke.PERMISSION_DENIED=7]="PERMISSION_DENIED",ke[ke.UNAUTHENTICATED=16]="UNAUTHENTICATED",ke[ke.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ke[ke.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ke[ke.ABORTED=10]="ABORTED",ke[ke.OUT_OF_RANGE=11]="OUT_OF_RANGE",ke[ke.UNIMPLEMENTED=12]="UNIMPLEMENTED",ke[ke.INTERNAL=13]="INTERNAL",ke[ke.UNAVAILABLE=14]="UNAVAILABLE",ke[ke.DATA_LOSS=15]="DATA_LOSS";var LM=null;function sP(){return new TextEncoder}var H4=new ns([4294967295,4294967295],0);function VM(n){let e=sP().encode(n),t=new Gw;return t.update(e),new Uint8Array(t.digest())}function UM(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new ns([t,r],0),new ns([i,s],0)]}var NE=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new _o(`Invalid padding: ${t}`);if(r<0)throw new _o(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new _o(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new _o(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=ns.fromNumber(this.Ie)}Ee(e,t,r){let i=e.add(t.multiply(ns.fromNumber(r)));return i.compare(H4)===1&&(i=new ns([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=VM(e),[r,i]=UM(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);if(!this.de(o))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;let t=VM(e),[r,i]=UM(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},_o=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Gl=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Wl.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(ie.min(),i,new it(pe),xn(),me())}},Wl=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,me(),me(),me())}};var rc=class{constructor(e,t,r,i){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=i}},Gp=class{constructor(e,t){this.targetId=e,this.me=t}},Wp=class{constructor(e,t,r=Tt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Kp=class{constructor(){this.fe=0,this.ge=BM(),this.pe=Tt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=me(),t=me(),r=me();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:W()}}),new Wl(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=BM()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,te(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},PE=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=xn(),this.qe=jM(),this.Qe=new it(pe)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:W()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,i)=>{this.ze(i)&&t(i)})}He(e){let t=e.targetId,r=e.me.count,i=this.Je(t);if(i){let s=i.target;if(qp(s))if(r===0){let o=new H(s.path);this.Ue(t,o,Pt.newNoDocument(o,ie.min()))}else te(r===1);else{let o=this.Ye(t);if(o!==r){let a=this.Ze(e),c=a?this.Xe(a,e,o):1;if(c!==0){this.je(t);let l=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,l)}LM?.et(function(d,f,g,y,v){var b,T,V,B,O,z;let re={localCacheCount:d,existenceFilterCount:f.count,databaseId:g.database,projectId:g.projectId},Z=f.unchangedNames;return Z&&(re.bloomFilter={applied:v===0,hashCount:(b=Z?.hashCount)!==null&&b!==void 0?b:0,bitmapLength:(B=(V=(T=Z?.bits)===null||T===void 0?void 0:T.bitmap)===null||V===void 0?void 0:V.length)!==null&&B!==void 0?B:0,padding:(z=(O=Z?.bits)===null||O===void 0?void 0:O.padding)!==null&&z!==void 0?z:0,mightContain:I=>{var _;return(_=y?.mightContain(I))!==null&&_!==void 0&&_}}),re}(o,e.me,this.Le.tt(),a,c))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o,a;try{o=ds(r).toUint8Array()}catch(c){if(c instanceof jp)return Jn("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new NE(o,i,s)}catch(c){return Jn(c instanceof _o?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){let r=this.Le.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,s,null),i++)}),i}rt(e){let t=new Map;this.Be.forEach((s,o)=>{let a=this.Je(o);if(a){if(s.current&&qp(a.target)){let c=new H(a.target.path);this.ke.get(c)!==null||this.it(o,c)||this.Ue(o,c,Pt.newNoDocument(c,e))}s.be&&(t.set(o,s.ve()),s.Ce())}});let r=me();this.qe.forEach((s,o)=>{let a=!0;o.forEachWhile(c=>{let l=this.Je(c);return!l||l.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));let i=new Gl(e,t,this.Qe,this.ke,r);return this.ke=xn(),this.qe=jM(),this.Qe=new it(pe),i}$e(e,t){if(!this.ze(e))return;let r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Kp,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Qe(pe),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||U("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Kp),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function jM(){return new it(H.comparator)}function BM(){return new it(H.comparator)}var z4={asc:"ASCENDING",desc:"DESCENDING"},G4={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},W4={and:"AND",or:"OR"},kE=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function OE(n,e){return n.useProto3Json||od(e)?e:{value:e}}function lc(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function oP(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function K4(n,e){return lc(n,e.toTimestamp())}function Ct(n){return te(!!n),ie.fromTimestamp(function(t){let r=Ci(t);return new lt(r.seconds,r.nanos)}(n))}function hC(n,e){return FE(n,e).canonicalString()}function FE(n,e){let t=function(i){return new Oe(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function aP(n){let e=Oe.fromString(n);return te(yP(e)),e}function Kl(n,e){return hC(n.databaseId,e.path)}function Hr(n,e){let t=aP(e);if(t.get(1)!==n.databaseId.projectId)throw new L(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new L(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new H(lP(t))}function cP(n,e){return hC(n.databaseId,e)}function uP(n){let e=aP(n);return e.length===4?Oe.emptyPath():lP(e)}function LE(n){return new Oe(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function lP(n){return te(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function $M(n,e,t){return{name:Kl(n,e),fields:t.value.mapValue.fields}}function dP(n,e,t){let r=Hr(n,e.name),i=Ct(e.updateTime),s=e.createTime?Ct(e.createTime):ie.min(),o=new sn({mapValue:{fields:e.fields}}),a=Pt.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function Q4(n,e){return"found"in e?function(r,i){te(!!i.found),i.found.name,i.found.updateTime;let s=Hr(r,i.found.name),o=Ct(i.found.updateTime),a=i.found.createTime?Ct(i.found.createTime):ie.min(),c=new sn({mapValue:{fields:i.found.fields}});return Pt.newFoundDocument(s,o,a,c)}(n,e):"missing"in e?function(r,i){te(!!i.missing),te(!!i.readTime);let s=Hr(r,i.missing),o=Ct(i.readTime);return Pt.newNoDocument(s,o)}(n,e):W()}function Y4(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(l){return l==="NO_CHANGE"?0:l==="ADD"?1:l==="REMOVE"?2:l==="CURRENT"?3:l==="RESET"?4:W()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(l,d){return l.useProto3Json?(te(d===void 0||typeof d=="string"),Tt.fromBase64String(d||"")):(te(d===void 0||d instanceof Buffer||d instanceof Uint8Array),Tt.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(l){let d=l.code===void 0?P.UNKNOWN:iP(l.code);return new L(d,l.message||"")}(o);t=new Wp(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Hr(n,r.document.name),s=Ct(r.document.updateTime),o=r.document.createTime?Ct(r.document.createTime):ie.min(),a=new sn({mapValue:{fields:r.document.fields}}),c=Pt.newFoundDocument(i,s,o,a),l=r.targetIds||[],d=r.removedTargetIds||[];t=new rc(l,d,c.key,c)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Hr(n,r.document),s=r.readTime?Ct(r.readTime):ie.min(),o=Pt.newNoDocument(i,s),a=r.removedTargetIds||[];t=new rc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Hr(n,r.document),s=r.removedTargetIds||[];t=new rc([],s,i,null)}else{if(!("filter"in e))return W();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new ME(i,s),a=r.targetId;t=new Gp(a,o)}}return t}function Ql(n,e){let t;if(e instanceof ms)t={update:$M(n,e.key,e.value)};else if(e instanceof ys)t={delete:Kl(n,e.key)};else if(e instanceof mr)t={update:$M(n,e.key,e.data),updateMask:nz(e.fieldMask)};else{if(!(e instanceof ql))return W();t={verify:Kl(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){let a=o.transform;if(a instanceof ps)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Ti)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Di)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof gs)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw W()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:K4(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:W()}(n,e.precondition)),t}function VE(n,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?gt.updateTime(Ct(s.updateTime)):s.exists!==void 0?gt.exists(s.exists):gt.none()}(e.currentDocument):gt.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let c=null;if("setToServerValue"in a)te(a.setToServerValue==="REQUEST_TIME"),c=new ps;else if("appendMissingElements"in a){let d=a.appendMissingElements.values||[];c=new Ti(d)}else if("removeAllFromArray"in a){let d=a.removeAllFromArray.values||[];c=new Di(d)}else"increment"in a?c=new gs(o,a.increment):W();let l=It.fromServerFormat(a.fieldPath);return new To(l,c)}(n,i)):[];if(e.update){e.update.name;let i=Hr(n,e.update.name),s=new sn({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(c){let l=c.fieldPaths||[];return new Vn(l.map(d=>It.fromServerFormat(d)))}(e.updateMask);return new mr(i,s,o,t,r)}return new ms(i,s,t,r)}if(e.delete){let i=Hr(n,e.delete);return new ys(i,t)}if(e.verify){let i=Hr(n,e.verify);return new ql(i,t)}return W()}function Z4(n,e){return n&&n.length>0?(te(e!==void 0),n.map(t=>function(i,s){let o=i.updateTime?Ct(i.updateTime):Ct(s);return o.isEqual(ie.min())&&(o=Ct(s)),new xE(o,i.transformResults||[])}(t,e))):[]}function hP(n,e){return{documents:[cP(n,e.path)]}}function fP(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=cP(n,i);let s=function(l){if(l.length!==0)return mP(qe.create(l,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(l){if(l.length!==0)return l.map(d=>function(g){return{field:Za(g.field),direction:J4(g.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=OE(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(l){return{before:l.inclusive,values:l.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(l){return{before:!l.inclusive,values:l.position}}(e.endAt)),{_t:t,parent:i}}function pP(n){let e=uP(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){te(r===1);let d=t.from[0];d.allDescendants?i=d.collectionId:e=e.child(d.collectionId)}let s=[];t.where&&(s=function(f){let g=gP(f);return g instanceof qe&&cC(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(g=>function(v){return new Io(Xa(v.field),function(T){switch(T){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(v.direction))}(g))}(t.orderBy));let a=null;t.limit&&(a=function(f){let g;return g=typeof f=="object"?f.value:f,od(g)?null:g}(t.limit));let c=null;t.startAt&&(c=function(f){let g=!!f.before,y=f.values||[];return new Wr(y,g)}(t.startAt));let l=null;return t.endAt&&(l=function(f){let g=!f.before,y=f.values||[];return new Wr(y,g)}(t.endAt)),$N(e,i,o,s,a,"F",c,l)}function X4(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return W()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function gP(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=Xa(t.unaryFilter.field);return Me.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=Xa(t.unaryFilter.field);return Me.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Xa(t.unaryFilter.field);return Me.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=Xa(t.unaryFilter.field);return Me.create(o,"!=",{nullValue:"NULL_VALUE"});default:return W()}}(n):n.fieldFilter!==void 0?function(t){return Me.create(Xa(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return W()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return qe.create(t.compositeFilter.filters.map(r=>gP(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return W()}}(t.compositeFilter.op))}(n):W()}function J4(n){return z4[n]}function ez(n){return G4[n]}function tz(n){return W4[n]}function Za(n){return{fieldPath:n.canonicalString()}}function Xa(n){return It.fromServerFormat(n.fieldPath)}function mP(n){return n instanceof Me?function(t){if(t.op==="=="){if(DM(t.value))return{unaryFilter:{field:Za(t.field),op:"IS_NAN"}};if(TM(t.value))return{unaryFilter:{field:Za(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(DM(t.value))return{unaryFilter:{field:Za(t.field),op:"IS_NOT_NAN"}};if(TM(t.value))return{unaryFilter:{field:Za(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Za(t.field),op:ez(t.op),value:t.value}}}(n):n instanceof qe?function(t){let r=t.getFilters().map(i=>mP(i));return r.length===1?r[0]:{compositeFilter:{op:tz(t.op),filters:r}}}(n):W()}function nz(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function yP(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var dc=class n{constructor(e,t,r,i,s=ie.min(),o=ie.min(),a=Tt.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Qp=class{constructor(e){this.ct=e}};function rz(n,e){let t;if(e.document)t=dP(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=H.fromSegments(e.noDocument.path),i=bo(e.noDocument.readTime);t=Pt.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return W();{let r=H.fromSegments(e.unknownDocument.path),i=bo(e.unknownDocument.version);t=Pt.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){let s=new lt(i[0],i[1]);return ie.fromTimestamp(s)}(e.readTime)),t}function qM(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Yp(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,o){return{name:Kl(s,o.key),fields:o.data.value.mapValue.fields,updateTime:lc(s,o.version.toTimestamp()),createTime:lc(s,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Do(e.version)};else{if(!e.isUnknownDocument())return W();r.unknownDocument={path:t.path.toArray(),version:Do(e.version)}}return r}function Yp(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Do(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function bo(n){let e=new lt(n.seconds,n.nanoseconds);return ie.fromTimestamp(e)}function go(n,e){let t=(e.baseMutations||[]).map(s=>VE(n.ct,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>VE(n.ct,s)),i=lt.fromMillis(e.localWriteTimeMs);return new Hl(e.batchId,i,t,r)}function Ml(n){let e=bo(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?bo(n.lastLimboFreeSnapshotVersion):ie.min(),r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){return te(s.documents.length===1),fn(Ic(uP(s.documents[0])))}(n.query):function(s){return fn(pP(s))}(n.query),new dc(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Tt.fromBase64String(n.resumeToken))}function _P(n,e){let t=Do(e.snapshotVersion),r=Do(e.lastLimboFreeSnapshotVersion),i;i=qp(e.target)?hP(n.ct,e.target):fP(n.ct,e.target)._t;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Co(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function fC(n){let e=pP({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?zp(e,e.limit,"L"):e}function Jw(n,e){return new zl(e.largestBatchId,VE(n.ct,e.overlayMutation))}function HM(n,e){let t=e.path.lastSegment();return[n,hn(e.path.popLast()),t]}function zM(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Do(r.readTime),documentKey:hn(r.documentKey.path),largestBatchId:r.largestBatchId}}var UE=class{getBundleMetadata(e,t){return GM(e).get(t).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:bo(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,t){return GM(e).put(function(i){return{bundleId:i.id,createTime:Do(Ct(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return WM(e).get(t).next(r=>{if(r)return function(s){return{name:s.name,query:fC(s.bundledQuery),readTime:bo(s.readTime)}}(r)})}saveNamedQuery(e,t){return WM(e).put(function(i){return{name:i.name,readTime:Do(Ct(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};function GM(n){return Ot(n,"bundles")}function WM(n){return Ot(n,"namedQueries")}var Zp=class n{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return bl(e).get(HM(this.userId,t)).next(r=>r?Jw(this.serializer,r):null)}getOverlays(e,t){let r=$r();return R.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new zl(t,o);i.push(this.ht(e,a))}),R.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(hn(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(bl(e).j("collectionPathOverlayIndex",a))}),R.waitFor(s)}getOverlaysForCollection(e,t,r){let i=$r(),s=hn(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return bl(e).U("collectionPathOverlayIndex",o).next(a=>{for(let c of a){let l=Jw(this.serializer,c);i.set(l.getKey(),l)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=$r(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return bl(e).J({index:"collectionGroupOverlayIndex",range:a},(c,l,d)=>{let f=Jw(this.serializer,l);s.size()<i||f.largestBatchId===o?(s.set(f.getKey(),f),o=f.largestBatchId):d.done()}).next(()=>s)}ht(e,t){return bl(e).put(function(i,s,o){let[a,c,l]=HM(s,o.mutation.key);return{userId:s,collectionPath:c,documentId:l,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Ql(i.ct,o.mutation)}}(this.serializer,this.userId,t))}};function bl(n){return Ot(n,"documentOverlays")}var jE=class{Pt(e){return Ot(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{let r=t?.value;return r?Tt.fromUint8Array(r):Tt.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}};var Ei=class{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(ot(e.integerValue));else if("doubleValue"in e){let r=ot(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),Vl(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=Ci(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(ds(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?kN(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Mg(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):W()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){let r=e.fields||{};this.dt(t,55);for(let i of Object.keys(r))this.Vt(i,t),this.Tt(r[i],t)}wt(e,t){var r,i;let s=e.fields||{};this.dt(t,53);let o="value",a=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.dt(t,15),t.At(ot(a)),this.Vt(o,t),this.Tt(s[o],t)}bt(e,t){let r=e.values||[];this.dt(t,50);for(let i of r)this.Tt(i,t)}yt(e,t){this.dt(t,37),H.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}};Ei.vt=new Ei;function iz(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function KM(n){let e=64-function(r){let i=0;for(let s=0;s<8;++s){let o=iz(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(e/8)}var BE=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{let i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Bt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{let i=t.codePointAt(0);this.Ot(240|i>>>18),this.Ot(128|63&i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i)}}this.Nt()}kt(e){let t=this.qt(e),r=KM(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Kt(e){let t=this.qt(e),r=KM(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Ft(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){let t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},$E=class{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}},qE=class{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}},mo=class{constructor(){this.jt=new BE,this.Ht=new $E(this.jt),this.Jt=new qE(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}};var yo=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Zt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function rs(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=QM(n.arrayValue,e.arrayValue),t!==0?t:(t=QM(n.directionalValue,e.directionalValue),t!==0?t:H.comparator(n.documentKey,e.documentKey)))}function QM(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var Xp=class{constructor(e){this.Xt=new Qe((t,r)=>It.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(let t of e.filters){let r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(te(e.collectionGroup===this.collectionId),this.nn)return!1;let t=lE(e);if(t!==void 0&&!this.sn(t))return!1;let r=fo(e),i=new Set,s=0,o=0;for(;s<r.length&&this.sn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Xt.size>0){let a=this.Xt.getIterator().getNext();if(!i.has(a.field.canonicalString())){let c=r[s];if(!this.on(a,c)||!this._n(this.en[o++],c))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new Qe(It.comparator),t=[];for(let r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new tc(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new tc(r.field,0))}for(let r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new tc(r.field,r.dir==="asc"?0:1)));return new sc(sc.UNKNOWN_ID,this.collectionId,t,Ll.empty())}sn(e){for(let t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function vP(n){var e,t;if(te(n instanceof Me||n instanceof qe),n instanceof Me){if(n instanceof $p){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>Me.create(n.field,"==",s)))||[];return qe.create(i,"or")}return n}let r=n.filters.map(i=>vP(i));return qe.create(r,n.op)}function sz(n){if(n.getFilters().length===0)return[];let e=GE(vP(n));return te(wP(e)),HE(e)||zE(e)?[e]:e.getFilters()}function HE(n){return n instanceof Me}function zE(n){return n instanceof qe&&cC(n)}function wP(n){return HE(n)||zE(n)||function(t){if(t instanceof qe&&_E(t)){for(let r of t.getFilters())if(!HE(r)&&!zE(r))return!1;return!0}return!1}(n)}function GE(n){if(te(n instanceof Me||n instanceof qe),n instanceof Me)return n;if(n.filters.length===1)return GE(n.filters[0]);let e=n.filters.map(r=>GE(r)),t=qe.create(e,n.op);return t=Jp(t),wP(t)?t:(te(t instanceof qe),te(ac(t)),te(t.filters.length>1),t.filters.reduce((r,i)=>pC(r,i)))}function pC(n,e){let t;return te(n instanceof Me||n instanceof qe),te(e instanceof Me||e instanceof qe),t=n instanceof Me?e instanceof Me?function(i,s){return qe.create([i,s],"and")}(n,e):YM(n,e):e instanceof Me?YM(e,n):function(i,s){if(te(i.filters.length>0&&s.filters.length>0),ac(i)&&ac(s))return UN(i,s.getFilters());let o=_E(i)?i:s,a=_E(i)?s:i,c=o.filters.map(l=>pC(l,a));return qe.create(c,"or")}(n,e),Jp(t)}function YM(n,e){if(ac(e))return UN(e,n.getFilters());{let t=e.filters.map(r=>pC(n,r));return qe.create(t,"or")}}function Jp(n){if(te(n instanceof Me||n instanceof qe),n instanceof Me)return n;let e=n.getFilters();if(e.length===1)return Jp(e[0]);if(LN(n))return n;let t=e.map(i=>Jp(i)),r=[];return t.forEach(i=>{i instanceof Me?r.push(i):i instanceof qe&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:qe.create(r,n.op)}var WE=class{constructor(){this.un=new Yl}addToCollectionParentIndex(e,t){return this.un.add(t),R.resolve()}getCollectionParents(e,t){return R.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return R.resolve()}deleteFieldIndex(e,t){return R.resolve()}deleteAllFieldIndexes(e){return R.resolve()}createTargetIndexes(e,t){return R.resolve()}getDocumentsMatchingTarget(e,t){return R.resolve(null)}getIndexType(e,t){return R.resolve(0)}getFieldIndexes(e,t){return R.resolve([])}getNextCollectionGroupToUpdate(e){return R.resolve(null)}getMinOffset(e,t){return R.resolve(er.min())}getMinOffsetFromCollectionGroup(e,t){return R.resolve(er.min())}updateCollectionGroup(e,t,r){return R.resolve()}updateIndexEntries(e,t){return R.resolve()}},Yl=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Qe(Oe.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Qe(Oe.comparator)).toArray()}};var Tp=new Uint8Array(0),KE=class{constructor(e,t){this.databaseId=t,this.cn=new Yl,this.ln=new Kr(r=>Co(r),(r,i)=>ad(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});let s={collectionId:r,parent:hn(i)};return ZM(e).put(s)}return R.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[IN(t),""],!1,!0);return ZM(e).U(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(Br(o.parent))}return r})}addFieldIndex(e,t){let r=Sl(e),i=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=Wa(e);return s.next(a=>{o.put(zM(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let r=Sl(e),i=Wa(e),s=Ga(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Sl(e),r=Ga(e),i=Wa(e);return t.j().next(()=>r.j()).next(()=>i.j())}createTargetIndexes(e,t){return R.forEach(this.hn(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let s=new Xp(r).an();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let r=Ga(e),i=!0,s=new Map;return R.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=me(),a=[];return R.forEach(s,(c,l)=>{U("IndexedDbIndexManager",`Using index ${function(O){return`id=${O.indexId}|cg=${O.collectionGroup}|f=${O.fields.map(z=>`${z.fieldPath}:${z.kind}`).join(",")}`}(c)} to execute ${Co(t)}`);let d=function(O,z){let re=lE(z);if(re===void 0)return null;for(let Z of Hp(O,re.fieldPath))switch(Z.op){case"array-contains-any":return Z.value.arrayValue.values||[];case"array-contains":return[Z.value]}return null}(l,c),f=function(O,z){let re=new Map;for(let Z of fo(z))for(let I of Hp(O,Z.fieldPath))switch(I.op){case"==":case"in":re.set(Z.fieldPath.canonicalString(),I.value);break;case"not-in":case"!=":return re.set(Z.fieldPath.canonicalString(),I.value),Array.from(re.values())}return null}(l,c),g=function(O,z){let re=[],Z=!0;for(let I of fo(z)){let _=I.kind===0?RM(O,I.fieldPath,O.startAt):MM(O,I.fieldPath,O.startAt);re.push(_.value),Z&&(Z=_.inclusive)}return new Wr(re,Z)}(l,c),y=function(O,z){let re=[],Z=!0;for(let I of fo(z)){let _=I.kind===0?MM(O,I.fieldPath,O.endAt):RM(O,I.fieldPath,O.endAt);re.push(_.value),Z&&(Z=_.inclusive)}return new Wr(re,Z)}(l,c),v=this.In(c,l,g),b=this.In(c,l,y),T=this.Tn(c,l,f),V=this.En(c.indexId,d,v,g.inclusive,b,y.inclusive,T);return R.forEach(V,B=>r.G(B,t.limit).next(O=>{O.forEach(z=>{let re=H.fromSegments(z.documentKey);o.has(re)||(o=o.add(re),a.push(re))})}))}).next(()=>a)}return R.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=sz(qe.create(e.filters,"and")).map(r=>SE(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,i,s,o,a){let c=(t!=null?t.length:1)*Math.max(r.length,s.length),l=c/(t!=null?t.length:1),d=[];for(let f=0;f<c;++f){let g=t?this.dn(t[f/l]):Tp,y=this.An(e,g,r[f%l],i),v=this.Rn(e,g,s[f%l],o),b=a.map(T=>this.An(e,g,T,!0));d.push(...this.createRange(y,v,b))}return d}An(e,t,r,i){let s=new yo(e,H.empty(),t,r);return i?s:s.Zt()}Rn(e,t,r,i){let s=new yo(e,H.empty(),t,r);return i?s.Zt():s}Pn(e,t){let r=new Xp(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.hn(t);return R.forEach(i,s=>this.Pn(e,s).next(o=>{o?r!==0&&o.fields.length<function(c){let l=new Qe(It.comparator),d=!1;for(let f of c.filters)for(let g of f.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?d=!0:l=l.add(g.field));for(let f of c.orderBy)f.field.isKeyField()||(l=l.add(f.field));return l.size+(d?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&r===2?1:r)}Vn(e,t){let r=new mo;for(let i of fo(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.Yt(i.kind);Ei.vt.It(s,o)}return r.zt()}dn(e){let t=new mo;return Ei.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){let r=new mo;return Ei.vt.It(Eo(this.databaseId,t),r.Yt(function(s){let o=fo(s);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let i=[];i.push(new mo);let s=0;for(let o of fo(e)){let a=r[s++];for(let c of i)if(this.fn(t,o.fieldPath)&&$l(a))i=this.gn(i,o,a);else{let l=c.Yt(o.kind);Ei.vt.It(a,l)}}return this.pn(i)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let c=new mo;c.seed(a.zt()),Ei.vt.It(o,c.Yt(t.kind)),s.push(c)}return s}fn(e,t){return!!e.filters.find(r=>r instanceof Me&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=Sl(e),i=Wa(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(s=>{let o=[];return R.forEach(s,a=>i.get([a.indexId,this.uid]).next(c=>{o.push(function(d,f){let g=f?new Ll(f.sequenceNumber,new er(bo(f.readTime),new H(Br(f.documentKey)),f.largestBatchId)):Ll.empty(),y=d.fields.map(([v,b])=>new tc(It.fromServerFormat(v),b));return new sc(d.indexId,d.collectionGroup,y,g)}(a,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:pe(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=Sl(e),s=Wa(e);return this.yn(e).next(o=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>R.forEach(a,c=>s.put(zM(c.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return R.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?R.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),R.forEach(a,c=>this.wn(e,i,c).next(l=>{let d=this.Sn(s,c);return l.isEqual(d)?R.resolve():this.bn(e,s,c,l,d)}))))})}Dn(e,t,r,i){return Ga(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,i){return Ga(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){let i=Ga(e),s=new Qe(rs);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{s=s.add(new yo(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}Sn(e,t){let r=new Qe(rs),i=this.Vn(t,e);if(i==null)return r;let s=lE(t);if(s!=null){let o=e.data.field(s.fieldPath);if($l(o))for(let a of o.arrayValue.values||[])r=r.add(new yo(t.indexId,e.key,this.dn(a),i))}else r=r.add(new yo(t.indexId,e.key,Tp,i));return r}bn(e,t,r,i,s){U("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(c,l,d,f,g){let y=c.getIterator(),v=l.getIterator(),b=za(y),T=za(v);for(;b||T;){let V=!1,B=!1;if(b&&T){let O=d(b,T);O<0?B=!0:O>0&&(V=!0)}else b!=null?B=!0:V=!0;V?(f(T),T=za(v)):B?(g(b),b=za(y)):(b=za(y),T=za(v))}}(i,s,rs,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),R.waitFor(o)}yn(e){let t=1;return Wa(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>rs(o,a)).filter((o,a,c)=>!a||rs(o,c[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=rs(o,e),c=rs(o,t);if(a===0)i[0]=e.Zt();else if(a>0&&c<0)i.push(o),i.push(o.Zt());else if(c>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.Cn(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Tp,[]],c=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Tp,[]];s.push(IDBKeyRange.bound(a,c))}return s}Cn(e,t){return rs(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(XM)}getMinOffset(e,t){return R.mapArray(this.hn(t),r=>this.Pn(e,r).next(i=>i||W())).next(XM)}};function ZM(n){return Ot(n,"collectionParents")}function Ga(n){return Ot(n,"indexEntries")}function Sl(n){return Ot(n,"indexConfiguration")}function Wa(n){return Ot(n,"indexState")}function XM(n){te(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;iC(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new er(e.readTime,e.documentKey,t)}var JM={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Xn=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function EP(n,e,t){let r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId),a=0,c=r.J({range:o},(d,f,g)=>(a++,g.delete()));s.push(c.next(()=>{te(a===1)}));let l=[];for(let d of t.mutations){let f=AN(e,d.key.path,t.batchId);s.push(i.delete(f)),l.push(d.key)}return R.waitFor(s).next(()=>l)}function eg(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw W();e=n.noDocument}return JSON.stringify(e).length}Xn.DEFAULT_COLLECTION_PERCENTILE=10,Xn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Xn.DEFAULT=new Xn(41943040,Xn.DEFAULT_COLLECTION_PERCENTILE,Xn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Xn.DISABLED=new Xn(-1,0,0);var tg=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Fn={}}static lt(e,t,r,i){te(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return is(e).J({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=Ja(e),o=is(e);return o.add({}).next(a=>{te(typeof a=="number");let c=new Hl(a,t,r,i),l=function(y,v,b){let T=b.baseMutations.map(B=>Ql(y.ct,B)),V=b.mutations.map(B=>Ql(y.ct,B));return{userId:v,batchId:b.batchId,localWriteTimeMs:b.localWriteTime.toMillis(),baseMutations:T,mutations:V}}(this.serializer,this.userId,c),d=[],f=new Qe((g,y)=>pe(g.canonicalString(),y.canonicalString()));for(let g of i){let y=AN(this.userId,g.key.path,a);f=f.add(g.key.path.popLast()),d.push(o.put(l)),d.push(s.put(y,d4))}return f.forEach(g=>{d.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Fn[a]=c.keys()}),R.waitFor(d).next(()=>c)})}lookupMutationBatch(e,t){return is(e).get(t).next(r=>r?(te(r.userId===this.userId),go(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?R.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.Fn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return is(e).J({index:"userMutationsIndex",range:i},(o,a,c)=>{a.userId===this.userId&&(te(a.batchId>=r),s=go(this.serializer,a)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return is(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return is(e).U("userMutationsIndex",t).next(r=>r.map(i=>go(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=Ap(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Ja(e).J({range:i},(o,a,c)=>{let[l,d,f]=o,g=Br(d);if(l===this.userId&&t.path.isEqual(g))return is(e).get(f).next(y=>{if(!y)throw W();te(y.userId===this.userId),s.push(go(this.serializer,y))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Qe(pe),i=[];return t.forEach(s=>{let o=Ap(this.userId,s.path),a=IDBKeyRange.lowerBound(o),c=Ja(e).J({range:a},(l,d,f)=>{let[g,y,v]=l,b=Br(y);g===this.userId&&s.path.isEqual(b)?r=r.add(v):f.done()});i.push(c)}),R.waitFor(i).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=Ap(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new Qe(pe);return Ja(e).J({range:o},(c,l,d)=>{let[f,g,y]=c,v=Br(g);f===this.userId&&r.isPrefixOf(v)?v.length===i&&(a=a.add(y)):d.done()}).next(()=>this.xn(e,a))}xn(e,t){let r=[],i=[];return t.forEach(s=>{i.push(is(e).get(s).next(o=>{if(o===null)throw W();te(o.userId===this.userId),r.push(go(this.serializer,o))}))}),R.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return EP(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),R.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return R.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return Ja(e).J({range:r},(s,o,a)=>{if(s[0]===this.userId){let c=Br(s[1]);i.push(c)}else a.done()}).next(()=>{te(i.length===0)})})}containsKey(e,t){return IP(e,this.userId,t)}Nn(e){return CP(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function IP(n,e,t){let r=Ap(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return Ja(n).J({range:s,H:!0},(a,c,l)=>{let[d,f,g]=a;d===e&&f===i&&(o=!0),l.done()}).next(()=>o)}function is(n){return Ot(n,"mutations")}function Ja(n){return Ot(n,"documentMutations")}function CP(n){return Ot(n,"mutationQueues")}var hc=class n{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new n(0)}static kn(){return new n(-1)}};var QE=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{let r=new hc(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>ie.fromTimestamp(new lt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Qn(e,i)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Ka(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(te(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let i=0,s=[];return Ka(e).J((o,a)=>{let c=Ml(a);c.sequenceNumber<=t&&r.get(c.targetId)===null&&(i++,s.push(this.removeTargetData(e,c)))}).next(()=>R.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Ka(e).J((r,i)=>{let s=Ml(i);t(s)})}qn(e){return eN(e).get("targetGlobalKey").next(t=>(te(t!==null),t))}Qn(e,t){return eN(e).put("targetGlobalKey",t)}Kn(e,t){return Ka(e).put(_P(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){let r=Co(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Ka(e).J({range:i,index:"queryTargetsIndex"},(o,a,c)=>{let l=Ml(a);ad(t,l.target)&&(s=l,c.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=ss(e);return t.forEach(o=>{let a=hn(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),R.waitFor(i)}removeMatchingKeys(e,t,r){let i=ss(e);return R.forEach(t,s=>{let o=hn(s.path);return R.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=ss(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=ss(e),s=me();return i.J({range:r,H:!0},(o,a,c)=>{let l=Br(o[1]),d=new H(l);s=s.add(d)}).next(()=>s)}containsKey(e,t){let r=hn(t.path),i=IDBKeyRange.bound([r],[IN(r)],!1,!0),s=0;return ss(e).J({index:"documentTargetsIndex",H:!0,range:i},([o,a],c,l)=>{o!==0&&(s++,l.done())}).next(()=>s>0)}ot(e,t){return Ka(e).get(t).next(r=>r?Ml(r):null)}};function Ka(n){return Ot(n,"targets")}function eN(n){return Ot(n,"targetGlobal")}function ss(n){return Ot(n,"targetDocuments")}function tN([n,e],[t,r]){let i=pe(n,t);return i===0?pe(e,r):i}var YE=class{constructor(e){this.Un=e,this.buffer=new Qe(tN),this.Wn=0}Gn(){return++this.Wn}zn(e){let t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();tN(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},ZE=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){U("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>M(this,null,function*(){this.jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){ws(t)?U("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield vs(t)}yield this.Hn(3e5)}))}},XE=class{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return R.resolve(Ln.oe);let r=new YE(t);return this.Jn.forEachTarget(e,i=>r.zn(i.sequenceNumber)).next(()=>this.Jn.Zn(e,i=>r.zn(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(U("LruGarbageCollector","Garbage collection skipped; disabled"),R.resolve(JM)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(U("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),JM):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,i,s,o,a,c,l,d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(U("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),i=this.params.maximumSequenceNumbersToCollect):i=f,o=Date.now(),this.nthSequenceNumber(e,i))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(s=f,c=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(l=Date.now(),Qa()<=Gn.DEBUG&&U("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(c-a)+`ms
	Removed ${f} documents in `+(l-c)+`ms
Total Duration: ${l-d}ms`),R.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:f})))}};function oz(n,e){return new XE(n,e)}var JE=class{constructor(e,t){this.db=e,this.garbageCollector=oz(this,t)}Yn(e){let t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,i)=>t(i))}addReference(e,t,r){return Dp(e,r)}removeReference(e,t,r){return Dp(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Dp(e,t)}nr(e,t){return function(i,s){let o=!1;return CP(i).Y(a=>IP(i,a,s).next(c=>(c&&(o=!0),R.resolve(!c)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.tr(e,(o,a)=>{if(a<=t){let c=this.nr(e,o).next(l=>{if(!l)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,ie.min()),ss(e).delete(function(f){return[0,hn(f.path)]}(o))))});i.push(c)}}).next(()=>R.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Dp(e,t)}tr(e,t){let r=ss(e),i,s=Ln.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:c,sequenceNumber:l})=>{o===0?(s!==Ln.oe&&t(new H(Br(i)),s),s=l,i=c):s=Ln.oe}).next(()=>{s!==Ln.oe&&t(new H(Br(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function Dp(n,e){return ss(n).put(function(r,i){return{targetId:0,path:hn(r.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}var ng=class{constructor(){this.changes=new Kr(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Pt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?R.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var eI=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return ho(e).put(r)}removeEntry(e,t,r){return ho(e).delete(function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Yp(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=Pt.newInvalidDocument(t);return ho(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Al(t))},(i,s)=>{r=this.ir(t,s)}).next(()=>r)}sr(e,t){let r={size:0,document:Pt.newInvalidDocument(t)};return ho(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Al(t))},(i,s)=>{r={document:this.ir(t,s),size:eg(s)}}).next(()=>r)}getEntries(e,t){let r=xn();return this._r(e,t,(i,s)=>{let o=this.ir(i,s);r=r.insert(i,o)}).next(()=>r)}ar(e,t){let r=xn(),i=new it(H.comparator);return this._r(e,t,(s,o)=>{let a=this.ir(s,o);r=r.insert(s,a),i=i.insert(s,eg(o))}).next(()=>({documents:r,ur:i}))}_r(e,t,r){if(t.isEmpty())return R.resolve();let i=new Qe(iN);t.forEach(c=>i=i.add(c));let s=IDBKeyRange.bound(Al(i.first()),Al(i.last())),o=i.getIterator(),a=o.getNext();return ho(e).J({index:"documentKeyIndex",range:s},(c,l,d)=>{let f=H.fromSegments([...l.prefixPath,l.collectionGroup,l.documentId]);for(;a&&iN(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,l),a=o.hasNext()?o.getNext():null),a?d.$(Al(a)):d.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Yp(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ho(e).U(IDBKeyRange.bound(a,c,!0)).next(l=>{s?.incrementDocumentReadCount(l.length);let d=xn();for(let f of l){let g=this.ir(H.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);g.isFoundDocument()&&(ud(t,g)||i.has(g.key))&&(d=d.insert(g.key,g))}return d})}getAllFromCollectionGroup(e,t,r,i){let s=xn(),o=rN(t,r),a=rN(t,er.max());return ho(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(c,l,d)=>{let f=this.ir(H.fromSegments(l.prefixPath.concat(l.collectionGroup,l.documentId)),l);s=s.insert(f.key,f),s.size===i&&d.done()}).next(()=>s)}newChangeBuffer(e){return new tI(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return nN(e).get("remoteDocumentGlobalKey").next(t=>(te(!!t),t))}rr(e,t){return nN(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){let r=rz(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(ie.min())))return r}return Pt.newInvalidDocument(e)}};function TP(n){return new eI(n)}var tI=class extends ng{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Kr(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new Qe((s,o)=>pe(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.lr.get(s);if(t.push(this.cr.removeEntry(e,s,a.readTime)),o.isValidDocument()){let c=qM(this.cr.serializer,o);i=i.add(s.path.popLast());let l=eg(c);r+=l-a.size,t.push(this.cr.addEntry(e,s,c))}else if(r-=a.size,this.trackRemovals){let c=qM(this.cr.serializer,o.convertToNoDocument(ie.min()));t.push(this.cr.addEntry(e,s,c))}}),i.forEach(s=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.cr.updateMetadata(e,r)),R.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:i})=>(i.forEach((s,o)=>{this.lr.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function nN(n){return Ot(n,"remoteDocumentGlobal")}function ho(n){return Ot(n,"remoteDocumentsV14")}function Al(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function rN(n,e){let t=e.documentKey.path.toArray();return[n,Yp(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function iN(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=pe(t[s],r[s]),i)return i;return i=pe(t.length,r.length),i||(i=pe(t[t.length-2],r[r.length-2]),i||pe(t[t.length-1],r[r.length-1]))}var nI=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var rg=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&kl(r.mutation,i,Vn.empty(),lt.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,me()).next(()=>r))}getLocalViewOfDocuments(e,t,r=me()){let i=$r();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Rl();return s.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=$r();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,me()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=xn(),o=Pl(),a=function(){return Pl()}();return t.forEach((c,l)=>{let d=r.get(l.key);i.has(l.key)&&(d===void 0||d.mutation instanceof mr)?s=s.insert(l.key,l):d!==void 0?(o.set(l.key,d.mutation.getFieldMask()),kl(d.mutation,l,d.mutation.getFieldMask(),lt.now())):o.set(l.key,Vn.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((l,d)=>o.set(l,d)),t.forEach((l,d)=>{var f;return a.set(l,new nI(d,(f=o.get(l))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){let r=Pl(),i=new it((o,a)=>o-a),s=me();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(c=>{let l=t.get(c);if(l===null)return;let d=r.get(c)||Vn.empty();d=a.applyToLocalView(l,d),r.set(c,d);let f=(i.get(a.batchId)||me()).add(c);i=i.insert(a.batchId,f)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let c=a.getNext(),l=c.key,d=c.value,f=KN();d.forEach(g=>{if(!s.has(g)){let y=tP(t.get(g),r.get(g));y!==null&&f.set(g,y),s=s.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,l,f))}return R.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(o){return H.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):uC(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):R.resolve($r()),a=-1,c=s;return o.next(l=>R.forEach(l,(d,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),s.get(d)?R.resolve():this.remoteDocumentCache.getEntry(e,d).next(g=>{c=c.insert(d,g)}))).next(()=>this.populateOverlays(e,l,s)).next(()=>this.computeViews(e,c,l,me())).next(d=>({batchId:a,changes:WN(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new H(t)).next(r=>{let i=Rl();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=Rl();return this.indexManager.getCollectionParents(e,s).next(a=>R.forEach(a,c=>{let l=function(f,g){return new gr(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,c.child(s));return this.getDocumentsMatchingCollectionQuery(e,l,r,i).next(d=>{d.forEach((f,g)=>{o=o.insert(f,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((c,l)=>{let d=l.getKey();o.get(d)===null&&(o=o.insert(d,Pt.newInvalidDocument(d)))});let a=Rl();return o.forEach((c,l)=>{let d=s.get(c);d!==void 0&&kl(d.mutation,l,Vn.empty(),lt.now()),ud(t,l)&&(a=a.insert(c,l))}),a})}};var rI=class{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return R.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:Ct(i.createTime)}}(t)),R.resolve()}getNamedQuery(e,t){return R.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(i){return{name:i.name,query:fC(i.bundledQuery),readTime:Ct(i.readTime)}}(t)),R.resolve()}};var iI=class{constructor(){this.overlays=new it(H.comparator),this.Ir=new Map}getOverlay(e,t){return R.resolve(this.overlays.get(t))}getOverlays(e,t){let r=$r();return R.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ht(e,t,s)}),R.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.Ir.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(r)),R.resolve()}getOverlaysForCollection(e,t,r){let i=$r(),s=t.length+1,o=new H(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,l=c.getKey();if(!t.isPrefixOf(l.path))break;l.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return R.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new it((l,d)=>l-d),o=this.overlays.getIterator();for(;o.hasNext();){let l=o.getNext().value;if(l.getKey().getCollectionGroup()===t&&l.largestBatchId>r){let d=s.get(l.largestBatchId);d===null&&(d=$r(),s=s.insert(l.largestBatchId,d)),d.set(l.getKey(),l)}}let a=$r(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((l,d)=>a.set(l,d)),!(a.size()>=i)););return R.resolve(a)}ht(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.Ir.get(i.largestBatchId).delete(r.key);this.Ir.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new zl(t,r));let s=this.Ir.get(t);s===void 0&&(s=me(),this.Ir.set(t,s)),this.Ir.set(t,s.add(r.key))}};var sI=class{constructor(){this.sessionToken=Tt.EMPTY_BYTE_STRING}getSessionToken(e){return R.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,R.resolve()}};var Zl=class{constructor(){this.Tr=new Qe(Rt.Er),this.dr=new Qe(Rt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){let r=new Rt(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new Rt(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){let t=new H(new Oe([])),r=new Rt(t,e),i=new Rt(t,e+1),s=[];return this.dr.forEachInRange([r,i],o=>{this.Vr(o),s.push(o.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){let t=new H(new Oe([])),r=new Rt(t,e),i=new Rt(t,e+1),s=me();return this.dr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new Rt(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},Rt=class{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return H.comparator(e.key,t.key)||pe(e.wr,t.wr)}static Ar(e,t){return pe(e.wr,t.wr)||H.comparator(e.key,t.key)}};var oI=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Qe(Rt.Er)}checkEmpty(e){return R.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Hl(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.br=this.br.add(new Rt(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return R.resolve(o)}lookupMutationBatch(e,t){return R.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.vr(r),s=i<0?0:i;return R.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return R.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return R.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new Rt(t,0),i=new Rt(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([r,i],o=>{let a=this.Dr(o.wr);s.push(a)}),R.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Qe(pe);return t.forEach(i=>{let s=new Rt(i,0),o=new Rt(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,o],a=>{r=r.add(a.wr)})}),R.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;H.isDocumentKey(s)||(s=s.child(""));let o=new Rt(new H(s),0),a=new Qe(pe);return this.br.forEachWhile(c=>{let l=c.key.path;return!!r.isPrefixOf(l)&&(l.length===i&&(a=a.add(c.wr)),!0)},o),R.resolve(this.Cr(a))}Cr(e){let t=[];return e.forEach(r=>{let i=this.Dr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){te(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return R.forEach(t.mutations,i=>{let s=new Rt(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){let r=new Rt(t,0),i=this.br.firstAfterOrEqual(r);return R.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,R.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){let t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var aI=class{constructor(e){this.Mr=e,this.docs=function(){return new it(H.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return R.resolve(r?r.document.mutableCopy():Pt.newInvalidDocument(t))}getEntries(e,t){let r=xn();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Pt.newInvalidDocument(i))}),R.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=xn(),o=t.path,a=new H(o.child("")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){let{key:l,value:{document:d}}=c.getNext();if(!o.isPrefixOf(l.path))break;l.path.length>o.length+1||iC(TN(d),r)<=0||(i.has(d.key)||ud(t,d))&&(s=s.insert(d.key,d.mutableCopy()))}return R.resolve(s)}getAllFromCollectionGroup(e,t,r,i){W()}Or(e,t){return R.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new cI(this)}getSize(e){return R.resolve(this.size)}},cI=class extends ng{constructor(e){super(),this.cr=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.cr.addEntry(e,i)):this.cr.removeEntry(r)}),R.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}};var uI=class{constructor(e){this.persistence=e,this.Nr=new Kr(t=>Co(t),ad),this.lastRemoteSnapshotVersion=ie.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Zl,this.targetCount=0,this.kr=hc.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,i)=>t(i)),R.resolve()}getLastRemoteSnapshotVersion(e){return R.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return R.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),R.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),R.resolve()}Kn(e){this.Nr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.kr=new hc(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,R.resolve()}updateTargetData(e,t){return this.Kn(t),R.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,R.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),R.waitFor(s).next(()=>i)}getTargetCount(e){return R.resolve(this.targetCount)}getTargetData(e,t){let r=this.Nr.get(t)||null;return R.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),R.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),R.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),R.resolve()}getMatchingKeysForTargetId(e,t){let r=this.Br.yr(t);return R.resolve(r)}containsKey(e,t){return R.resolve(this.Br.containsKey(t))}};var ig=class{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Ln(0),this.Kr=!1,this.Kr=!0,this.$r=new sI,this.referenceDelegate=e(this),this.Ur=new uI(this),this.indexManager=new WE,this.remoteDocumentCache=function(i){return new aI(i)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new Qp(t),this.Gr=new rI(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new iI,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new oI(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){U("MemoryPersistence","Starting transaction:",e);let i=new lI(this.Qr.next());return this.referenceDelegate.zr(),r(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(e,t){return R.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}},lI=class extends Lp{constructor(e){super(),this.currentSequenceNumber=e}},sg=class n{constructor(e){this.persistence=e,this.Jr=new Zl,this.Yr=null}static Zr(e){return new n(e)}get Xr(){if(this.Yr)return this.Yr;throw W()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),R.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),R.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),R.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(i=>this.Xr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return R.forEach(this.Xr,r=>{let i=H.fromPath(r);return this.ei(e,i).next(s=>{s||t.removeEntry(i,ie.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return R.or([()=>R.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}};var dI=class{constructor(e){this.serializer=e}O(e,t,r,i){let s=new Vp("createOrUpgrade",t);r<1&&i>=1&&(function(c){c.createObjectStore("owner")}(e),function(c){c.createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",wM,{unique:!0}),c.createObjectStore("documentMutations")}(e),sN(e),function(c){c.createObjectStore("remoteDocuments")}(e));let o=R.resolve();return r<3&&i>=3&&(r!==0&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),sN(e)),o=o.next(()=>function(c){let l=c.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ie.min().toTimestamp(),targetCount:0};return l.put("targetGlobalKey",d)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(c,l){return l.store("mutations").U().next(d=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",wM,{unique:!0});let f=l.store("mutations"),g=d.map(y=>f.put(y));return R.waitFor(g)})}(e,s))),o=o.next(()=>{(function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.ni(s))),r<6&&i>=6&&(o=o.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ri(s)))),r<7&&i>=7&&(o=o.next(()=>this.ii(s))),r<8&&i>=8&&(o=o.next(()=>this.si(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.oi(s))),r<11&&i>=11&&(o=o.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(c){let l=c.createObjectStore("documentOverlays",{keyPath:C4});l.createIndex("collectionPathOverlayIndex",T4,{unique:!1}),l.createIndex("collectionGroupOverlayIndex",D4,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>function(c){let l=c.createObjectStore("remoteDocumentsV14",{keyPath:h4});l.createIndex("documentKeyIndex",f4),l.createIndex("collectionGroupIndex",p4)}(e)).next(()=>this._i(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.ai(e,s))),r<15&&i>=15&&(o=o.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:v4}).createIndex("sequenceNumberIndex",w4,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:E4}).createIndex("documentKeyIndex",I4,{unique:!1})}(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&i>=17&&(o=o.next(()=>{(function(c){c.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,i)=>{t+=eg(i)}).next(()=>{let r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){let t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(i=>R.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>R.forEach(a,c=>{te(c.userId===s.userId);let l=go(this.serializer,c);return EP(e,s.userId,l).next(()=>{})}))}))}ii(e){let t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return r.J((o,a)=>{let c=new Oe(o),l=function(f){return[0,hn(f)]}(c);s.push(t.get(l).next(d=>d?R.resolve():(f=>t.put({targetId:0,path:hn(f),sequenceNumber:i.highestListenSequenceNumber}))(c)))}).next(()=>R.waitFor(s))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:_4});let r=t.store("collectionParents"),i=new Yl,s=o=>{if(i.add(o)){let a=o.lastSegment(),c=o.popLast();return r.put({collectionId:a,parent:hn(c)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{let c=new Oe(o);return s(c.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,c],l)=>{let d=Br(a);return s(d.popLast())}))}oi(e){let t=e.store("targets");return t.J((r,i)=>{let s=Ml(i),o=_P(this.serializer,s);return t.put(o)})}_i(e,t){let r=t.store("remoteDocuments"),i=[];return r.J((s,o)=>{let a=t.store("remoteDocumentsV14"),c=function(f){return f.document?new H(Oe.fromString(f.document.name).popFirst(5)):f.noDocument?H.fromSegments(f.noDocument.path):f.unknownDocument?H.fromSegments(f.unknownDocument.path):W()}(o).path.toArray(),l={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(l))}).next(()=>R.waitFor(i))}ai(e,t){let r=t.store("mutations"),i=TP(this.serializer),s=new ig(sg.Zr,this.serializer.ct);return r.U().next(o=>{let a=new Map;return o.forEach(c=>{var l;let d=(l=a.get(c.userId))!==null&&l!==void 0?l:me();go(this.serializer,c).keys().forEach(f=>d=d.add(f)),a.set(c.userId,d)}),R.forEach(a,(c,l)=>{let d=new Mt(l),f=Zp.lt(this.serializer,d),g=s.getIndexManager(d),y=tg.lt(d,this.serializer,g,s.referenceDelegate);return new rg(i,y,f,g).recalculateAndSaveOverlaysForDocumentKeys(new Ul(t,Ln.oe),c).next()})})}};function sN(n){n.createObjectStore("targetDocuments",{keyPath:m4}).createIndex("documentTargetsIndex",y4,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",g4,{unique:!0}),n.createObjectStore("targetGlobal")}var eE="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",hI=class n{constructor(e,t,r,i,s,o,a,c,l,d,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=s,this.window=o,this.document=a,this.ci=l,this.li=d,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=g=>Promise.resolve(),!n.D())throw new L(P.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new JE(this,i),this.Ai=t+"main",this.serializer=new Qp(c),this.Ri=new ls(this.Ai,this.hi,new dI(this.serializer)),this.$r=new jE,this.Ur=new QE(this.referenceDelegate,this.serializer),this.remoteDocumentCache=TP(this.serializer),this.Gr=new UE,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,d===!1&&Et("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new L(P.FAILED_PRECONDITION,eE);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Ln(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=t=>M(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(t=>M(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(()=>M(this,null,function*(){this.started&&(yield this.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>bp(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(ws(e))return U("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return U("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return xl(e).get("owner").next(t=>R.resolve(this.vi(t)))}Ci(e){return bp(e).delete(this.clientId)}Fi(){return M(this,null,function*(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=Ot(t,"clientMetadata");return r.U().next(i=>{let s=this.xi(i,18e5),o=i.filter(a=>s.indexOf(a)===-1);return R.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(let t of e)this.Vi.removeItem(this.Oi(t.clientId))}})}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?R.resolve(!0):xl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new L(P.FAILED_PRECONDITION,eE);return!1}}return!(!this.networkEnabled||!this.inForeground)||bp(e).U().next(r=>this.xi(r,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&U("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return M(this,null,function*(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),yield this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new Ul(e,Ln.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()})}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>bp(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return tg.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new KE(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Zp.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){U("IndexedDbPersistence","Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(c){return c===17?A4:c===16?S4:c===15?oC:c===14?MN:c===13?RN:c===12?b4:c===11?xN:void W()}(this.hi),o;return this.Ri.runTransaction(e,i,s,a=>(o=new Ul(a,this.Qr?this.Qr.next():Ln.oe),t==="readwrite-primary"?this.wi(o).next(c=>!!c||this.Si(o)).next(c=>{if(!c)throw Et(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new L(P.FAILED_PRECONDITION,DN);return r(o)}).next(c=>this.Di(o).next(()=>c)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return xl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new L(P.FAILED_PRECONDITION,eE)})}Di(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return xl(e).put("owner",t)}static D(){return ls.D()}bi(e){let t=xl(e);return t.get("owner").next(r=>this.vi(r)?(U("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):R.resolve())}Mi(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(Et(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();let t=/(?:Version|Mobile)\/1[456]/;py()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{let r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return U("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Et("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Et("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function xl(n){return Ot(n,"owner")}function bp(n){return Ot(n,"clientMetadata")}function gC(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}var fI=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=i}static Wi(e,t){let r=me(),i=me();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var pI=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var og=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return py()?8:bN(vu())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.Yi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Zi(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new pI;return this.Xi(e,t,o).next(a=>{if(s.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>s.result)}es(e,t,r,i){return r.documentReadCount<this.ji?(Qa()<=Gn.DEBUG&&U("QueryEngine","SDK will not create cache indexes for query:",Ya(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),R.resolve()):(Qa()<=Gn.DEBUG&&U("QueryEngine","Query:",Ya(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Hi*i?(Qa()<=Gn.DEBUG&&U("QueryEngine","The SDK decides to create cache indexes for query:",Ya(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,fn(t))):R.resolve())}Yi(e,t){if(NM(t))return R.resolve(null);let r=fn(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=zp(t,null,"F"),r=fn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=me(...s);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(c=>{let l=this.ts(t,a);return this.ns(t,l,o,c.readTime)?this.Yi(e,zp(t,null,"F")):this.rs(e,l,t,c)}))})))}Zi(e,t,r,i){return NM(t)||i.isEqual(ie.min())?R.resolve(null):this.Ji.getDocuments(e,r).next(s=>{let o=this.ts(t,s);return this.ns(t,o,r,i)?R.resolve(null):(Qa()<=Gn.DEBUG&&U("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ya(t)),this.rs(e,o,t,CN(i,-1)).next(a=>a))})}ts(e,t){let r=new Qe(zN(e));return t.forEach((i,s)=>{ud(e,s)&&(r=r.add(s))}),r}ns(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(e,t,r){return Qa()<=Gn.DEBUG&&U("QueryEngine","Using full collection scan to execute query:",Ya(t)),this.Ji.getDocumentsMatchingQuery(e,t,er.min(),r)}rs(e,t,r,i){return this.Ji.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var gI=class{constructor(e,t,r,i){this.persistence=e,this.ss=t,this.serializer=i,this.os=new it(pe),this._s=new Kr(s=>Co(s),ad),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new rg(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}};function DP(n,e,t,r){return new gI(n,e,t,r)}function bP(n,e){return M(this,null,function*(){let t=q(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],c=me();for(let l of i){o.push(l.batchId);for(let d of l.mutations)c=c.add(d.key)}for(let l of s){a.push(l.batchId);for(let d of l.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(r,c).next(l=>({hs:l,removedBatchIds:o,addedBatchIds:a}))})})})}function az(n,e){let t=q(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,c,l,d){let f=l.batch,g=f.keys(),y=R.resolve();return g.forEach(v=>{y=y.next(()=>d.getEntry(c,v)).next(b=>{let T=l.docVersions.get(v);te(T!==null),b.version.compareTo(T)<0&&(f.applyToRemoteDocument(b,l),b.isValidDocument()&&(b.setReadTime(l.commitVersion),d.addEntry(b)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(c,f))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let c=me();for(let l=0;l<a.mutationResults.length;++l)a.mutationResults[l].transformResults.length>0&&(c=c.add(a.batch.mutations[l].key));return c}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function SP(n){let e=q(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function cz(n,e){let t=q(n),r=e.snapshotVersion,i=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.cs.newChangeBuffer({trackRemovals:!0});i=t.os;let a=[];e.targetChanges.forEach((d,f)=>{let g=i.get(f);if(!g)return;a.push(t.Ur.removeMatchingKeys(s,d.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(s,d.addedDocuments,f)));let y=g.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(f)!==null?y=y.withResumeToken(Tt.EMPTY_BYTE_STRING,ie.min()).withLastLimboFreeSnapshotVersion(ie.min()):d.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(d.resumeToken,r)),i=i.insert(f,y),function(b,T,V){return b.resumeToken.approximateByteSize()===0||T.snapshotVersion.toMicroseconds()-b.snapshotVersion.toMicroseconds()>=3e8?!0:V.addedDocuments.size+V.modifiedDocuments.size+V.removedDocuments.size>0}(g,y,d)&&a.push(t.Ur.updateTargetData(s,y))});let c=xn(),l=me();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,d))}),a.push(AP(s,o,e.documentUpdates).next(d=>{c=d.Ps,l=d.Is})),!r.isEqual(ie.min())){let d=t.Ur.getLastRemoteSnapshotVersion(s).next(f=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(d)}return R.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,l)).next(()=>c)}).then(s=>(t.os=i,s))}function AP(n,e,t){let r=me(),i=me();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=xn();return t.forEach((a,c)=>{let l=s.get(a);c.isFoundDocument()!==l.isFoundDocument()&&(i=i.add(a)),c.isNoDocument()&&c.version.isEqual(ie.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!l.isValidDocument()||c.version.compareTo(l.version)>0||c.version.compareTo(l.version)===0&&l.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):U("LocalStore","Ignoring outdated watch update for ",a,". Current version:",l.version," Watch version:",c.version)}),{Ps:o,Is:i}})}function uz(n,e){let t=q(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function fc(n,e){let t=q(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Ur.getTargetData(r,e).next(s=>s?(i=s,R.resolve(i)):t.Ur.allocateTargetId(r).next(o=>(i=new dc(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.os.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}function pc(n,e,t){return M(this,null,function*(){let r=q(n),i=r.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!ws(o))throw o;U("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(i.target)})}function ag(n,e,t){let r=q(n),i=ie.min(),s=me();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,l,d){let f=q(c),g=f._s.get(d);return g!==void 0?R.resolve(f.os.get(g)):f.Ur.getTargetData(l,d)}(r,o,fn(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(c=>{s=c})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?i:ie.min(),t?s:me())).next(a=>(MP(r,HN(e),a),{documents:a,Ts:s})))}function xP(n,e){let t=q(n),r=q(t.Ur),i=t.os.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.ot(s,e).next(o=>o?o.target:null))}function RP(n,e){let t=q(n),r=t.us.get(e)||ie.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.cs.getAllFromCollectionGroup(i,e,CN(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(MP(t,e,i),i))}function MP(n,e,t){let r=n.us.get(e)||ie.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.us.set(e,r)}function lz(n,e,t,r){return M(this,null,function*(){let i=q(n),s=me(),o=xn();for(let l of t){let d=e.Es(l.metadata.name);l.document&&(s=s.add(d));let f=e.ds(l);f.setReadTime(e.As(l.metadata.readTime)),o=o.insert(d,f)}let a=i.cs.newChangeBuffer({trackRemovals:!0}),c=yield fc(i,function(d){return fn(Ic(Oe.fromString(`__bundle__/docs/${d}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",l=>AP(l,a,o).next(d=>(a.apply(l),d)).next(d=>i.Ur.removeMatchingKeysForTargetId(l,c.targetId).next(()=>i.Ur.addMatchingKeys(l,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(l,d.Ps,d.Is)).next(()=>d.Ps)))})}function dz(r,i){return M(this,arguments,function*(n,e,t=me()){let s=yield fc(n,fn(fC(e.bundledQuery))),o=q(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let c=Ct(e.readTime);if(s.snapshotVersion.compareTo(c)>=0)return o.Gr.saveNamedQuery(a,e);let l=s.withResumeToken(Tt.EMPTY_BYTE_STRING,c);return o.os=o.os.insert(l.targetId,l),o.Ur.updateTargetData(a,l).next(()=>o.Ur.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.Ur.addMatchingKeys(a,t,s.targetId)).next(()=>o.Gr.saveNamedQuery(a,e))})})}function oN(n,e){return`firestore_clients_${n}_${e}`}function aN(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function tE(n,e){return`firestore_targets_${n}_${e}`}var cg=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Rs(e,t,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new L(i.error.code,i.error.message))),o?new n(e,t,i.state,s):(Et("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Ol=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){let r=JSON.parse(t),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new L(r.error.code,r.error.message))),s?new n(e,r.state,i):(Et("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},ug=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=lC();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=SN(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(Et("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},mI=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Et("SharedClientState",`Failed to parse online state: ${e}`),null)}},Xl=class{constructor(){this.activeTargetIds=lC()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Fl=class{constructor(e,t,r,i,s){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new it(pe),this.started=!1,this.bs=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ds=oN(this.persistenceKey,this.ps),this.vs=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new Xl),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.Os=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}start(){return M(this,null,function*(){let e=yield this.syncEngine.Qi();for(let r of e){if(r===this.ps)continue;let i=this.getItem(oN(this.persistenceKey,r));if(i){let s=ug.Rs(r,i);s&&(this.Ss=this.Ss.insert(s.clientId,s))}}this.Ns();let t=this.storage.getItem(this.xs);if(t){let r=this.Ls(t);r&&this.Bs(r)}for(let r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(tE(this.persistenceKey,e));if(r){let i=Ol.Rs(e,r);i&&(t=i.state)}}return this.Ks.fs(e),this.Ns(),t}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(tE(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Qs(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return U("SharedClientState","READ",e,t),t}setItem(e,t){U("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){U("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){let t=e;if(t.storageArea===this.storage){if(U("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void Et("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(()=>M(this,null,function*(){if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){let r=this.Gs(t.key);return this.zs(r,null)}{let r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){let r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){let r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){let r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){let r=function(s){let o=Ln.oe;if(s!=null)try{let a=JSON.parse(s);te(typeof a=="number"),o=a}catch(a){Et("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==Ln.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){let r=this.Xs(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.eo(i)))}}}else this.bs.push(t)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){let i=new cg(this.currentUser,e,t,r),s=aN(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Vs())}Qs(e){let t=aN(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){let t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){let i=tE(this.persistenceKey,e),s=new Ol(e,t,r);this.setItem(i,s.Vs())}Ws(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){let t=this.Cs.exec(e);return t?t[1]:null}js(e,t){let r=this.Gs(e);return ug.Rs(r,t)}Hs(e,t){let r=this.Fs.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return cg.Rs(new Mt(s),i,t)}Ys(e,t){let r=this.Ms.exec(e),i=Number(r[1]);return Ol.Rs(i,t)}Ls(e){return mI.Rs(e)}Xs(e){return JSON.parse(e)}Js(e){return M(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);U("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){let r=t?this.Ss.insert(e,t):this.Ss.remove(e),i=this.ks(this.Ss),s=this.ks(r),o=[],a=[];return s.forEach(c=>{i.has(c)||o.push(c)}),i.forEach(c=>{s.has(c)||a.push(c)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=lC();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},lg=class{constructor(){this.so=new Xl,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Xl,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var yI=class{_o(e){}shutdown(){}};var dg=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){U("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ho)e(0)}lo(){U("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Sp=null;function nE(){return Sp===null?Sp=function(){return 268435456+Math.round(2147483648*Math.random())}():Sp++,"0x"+Sp.toString(16)}var hz={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var _I=class{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}};var rn="WebChannelConnection",vI=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${i}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(t,r,i,s,o){let a=nE(),c=this.xo(t,r.toUriEncodedString());U("RestConnection",`Sending RPC '${t}' ${a}:`,c,i);let l={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(l,s,o),this.No(t,c,l,i).then(d=>(U("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw Jn("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",c,"request:",i),d})}Lo(t,r,i,s,o,a){return this.Mo(t,r,i,s,o)}Oo(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ec}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}xo(t,r){let i=hz[t];return`${this.Do}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,i){let s=nE();return new Promise((o,a)=>{let c=new Ww;c.setWithCredentials(!0),c.listenOnce(Qw.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Dl.NO_ERROR:let d=c.getResponseJson();U(rn,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(d)),o(d);break;case Dl.TIMEOUT:U(rn,`RPC '${e}' ${s} timed out`),a(new L(P.DEADLINE_EXCEEDED,"Request time out"));break;case Dl.HTTP_ERROR:let f=c.getStatus();if(U(rn,`RPC '${e}' ${s} failed with status:`,f,"response text:",c.getResponseText()),f>0){let g=c.getResponseJson();Array.isArray(g)&&(g=g[0]);let y=g?.error;if(y&&y.status&&y.message){let v=function(T){let V=T.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(V)>=0?V:P.UNKNOWN}(y.status);a(new L(v,y.message))}else a(new L(P.UNKNOWN,"Server responded with status "+c.getStatus()))}else a(new L(P.UNAVAILABLE,"Connection failed."));break;default:W()}}finally{U(rn,`RPC '${e}' ${s} completed.`)}});let l=JSON.stringify(i);U(rn,`RPC '${e}' ${s} sending request:`,i),c.send(t,"POST",l,r,15)})}Bo(e,t,r){let i=nE(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Xw(),a=Zw(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;l!==void 0&&(c.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(c.xmlHttpFactory=new Kw({})),this.Oo(c.initMessageHeaders,t,r),c.encodeInitMessageHeaders=!0;let d=s.join("");U(rn,`Creating RPC '${e}' stream ${i}: ${d}`,c);let f=o.createWebChannel(d,c),g=!1,y=!1,v=new _I({Io:T=>{y?U(rn,`Not sending because RPC '${e}' stream ${i} is closed:`,T):(g||(U(rn,`Opening RPC '${e}' stream ${i} transport.`),f.open(),g=!0),U(rn,`RPC '${e}' stream ${i} sending:`,T),f.send(T))},To:()=>f.close()}),b=(T,V,B)=>{T.listen(V,O=>{try{B(O)}catch(z){setTimeout(()=>{throw z},0)}})};return b(f,Ha.EventType.OPEN,()=>{y||(U(rn,`RPC '${e}' stream ${i} transport opened.`),v.yo())}),b(f,Ha.EventType.CLOSE,()=>{y||(y=!0,U(rn,`RPC '${e}' stream ${i} transport closed`),v.So())}),b(f,Ha.EventType.ERROR,T=>{y||(y=!0,Jn(rn,`RPC '${e}' stream ${i} transport errored:`,T),v.So(new L(P.UNAVAILABLE,"The operation could not be completed")))}),b(f,Ha.EventType.MESSAGE,T=>{var V;if(!y){let B=T.data[0];te(!!B);let O=B,z=O.error||((V=O[0])===null||V===void 0?void 0:V.error);if(z){U(rn,`RPC '${e}' stream ${i} received error:`,z);let re=z.status,Z=function(w){let C=xt[w];if(C!==void 0)return iP(C)}(re),I=z.message;Z===void 0&&(Z=P.INTERNAL,I="Unknown error status: "+re+" with message "+z.message),y=!0,v.So(new L(Z,I)),f.close()}else U(rn,`RPC '${e}' stream ${i} received:`,B),v.bo(B)}}),b(a,Yw.STAT_EVENT,T=>{T.stat===Cp.PROXY?U(rn,`RPC '${e}' stream ${i} detected buffering proxy`):T.stat===Cp.NOPROXY&&U(rn,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{v.wo()},0),v}};function NP(){return typeof window<"u"?window:null}function Np(){return typeof document<"u"?document:null}function ld(n){return new kE(n,!0)}var Jl=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();let t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-r);i>0&&U("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var hg=class{constructor(e,t,r,i,s,o,a,c){this.ui=e,this.Ho=r,this.Jo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Jl(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return M(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return M(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return M(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(Et(t.toString()),Et("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;let e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Yo===t&&this.P_(r,i)},r=>{e(()=>{let i=new L(P.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(i)})})}P_(e,t){let r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{r(()=>this.I_(i))}),this.stream.onMessage(i=>{r(()=>++this.e_==1?this.E_(i):this.onNext(i))})}i_(){this.state=5,this.t_.Go(()=>M(this,null,function*(){this.state=0,this.start()}))}I_(e){return U("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(U("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},wI=class extends hg{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();let t=Y4(this.serializer,e),r=function(s){if(!("targetChange"in s))return ie.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?ie.min():o.readTime?Ct(o.readTime):ie.min()}(e);return this.listener.d_(t,r)}A_(e){let t={};t.database=LE(this.serializer),t.addTarget=function(s,o){let a,c=o.target;if(a=qp(c)?{documents:hP(s,c)}:{query:fP(s,c)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=oP(s,o.resumeToken);let l=OE(s,o.expectedCount);l!==null&&(a.expectedCount=l)}else if(o.snapshotVersion.compareTo(ie.min())>0){a.readTime=lc(s,o.snapshotVersion.toTimestamp());let l=OE(s,o.expectedCount);l!==null&&(a.expectedCount=l)}return a}(this.serializer,e);let r=X4(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){let t={};t.database=LE(this.serializer),t.removeTarget=e,this.a_(t)}},EI=class extends hg{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return te(!!e.streamToken),this.lastStreamToken=e.streamToken,te(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){te(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();let t=Z4(e.writeResults,e.commitTime),r=Ct(e.commitTime);return this.listener.g_(r,t)}p_(){let e={};e.database=LE(this.serializer),this.a_(e)}m_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>Ql(this.serializer,r))};this.a_(t)}};var II=class extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new L(P.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Mo(e,FE(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new L(P.UNKNOWN,s.toString())})}Lo(e,t,r,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,FE(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new L(P.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},CI=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Et(t),this.D_=!1):U("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var TI=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(o=>{r.enqueueAndForget(()=>M(this,null,function*(){Es(this)&&(U("RemoteStore","Restarting streams for network reachability change."),yield function(c){return M(this,null,function*(){let l=q(c);l.L_.add(4),yield Cc(l),l.q_.set("Unknown"),l.L_.delete(4),yield dd(l)})}(this))}))}),this.q_=new CI(r,i)}};function dd(n){return M(this,null,function*(){if(Es(n))for(let e of n.B_)yield e(!0)})}function Cc(n){return M(this,null,function*(){for(let e of n.B_)yield e(!1)})}function Ng(n,e){let t=q(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),_C(t)?yC(t):Dc(t).r_()&&mC(t,e))}function gc(n,e){let t=q(n),r=Dc(t);t.N_.delete(e),r.r_()&&PP(t,e),t.N_.size===0&&(r.r_()?r.o_():Es(t)&&t.q_.set("Unknown"))}function mC(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ie.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Dc(n).A_(e)}function PP(n,e){n.Q_.xe(e),Dc(n).R_(e)}function yC(n){n.Q_=new PE({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Dc(n).start(),n.q_.v_()}function _C(n){return Es(n)&&!Dc(n).n_()&&n.N_.size>0}function Es(n){return q(n).L_.size===0}function kP(n){n.Q_=void 0}function fz(n){return M(this,null,function*(){n.q_.set("Online")})}function pz(n){return M(this,null,function*(){n.N_.forEach((e,t)=>{mC(n,e)})})}function gz(n,e){return M(this,null,function*(){kP(n),_C(n)?(n.q_.M_(e),yC(n)):n.q_.set("Unknown")})}function mz(n,e,t){return M(this,null,function*(){if(n.q_.set("Online"),e instanceof Wp&&e.state===2&&e.cause)try{yield function(i,s){return M(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.N_.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.N_.delete(a),i.Q_.removeTarget(a))})}(n,e)}catch(r){U("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield fg(n,r)}else if(e instanceof rc?n.Q_.Ke(e):e instanceof Gp?n.Q_.He(e):n.Q_.We(e),!t.isEqual(ie.min()))try{let r=yield SP(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){let a=s.Q_.rt(o);return a.targetChanges.forEach((c,l)=>{if(c.resumeToken.approximateByteSize()>0){let d=s.N_.get(l);d&&s.N_.set(l,d.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,l)=>{let d=s.N_.get(c);if(!d)return;s.N_.set(c,d.withResumeToken(Tt.EMPTY_BYTE_STRING,d.snapshotVersion)),PP(s,c);let f=new dc(d.target,c,l,d.sequenceNumber);mC(s,f)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){U("RemoteStore","Failed to raise snapshot:",r),yield fg(n,r)}})}function fg(n,e,t){return M(this,null,function*(){if(!ws(e))throw e;n.L_.add(1),yield Cc(n),n.q_.set("Offline"),t||(t=()=>SP(n.localStore)),n.asyncQueue.enqueueRetryable(()=>M(this,null,function*(){U("RemoteStore","Retrying IndexedDB access"),yield t(),n.L_.delete(1),yield dd(n)}))})}function OP(n,e){return e().catch(t=>fg(n,t,e))}function Tc(n){return M(this,null,function*(){let e=q(n),t=_s(e),r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;yz(e);)try{let i=yield uz(e.localStore,r);if(i===null){e.O_.length===0&&t.o_();break}r=i.batchId,_z(e,i)}catch(i){yield fg(e,i)}FP(e)&&LP(e)})}function yz(n){return Es(n)&&n.O_.length<10}function _z(n,e){n.O_.push(e);let t=_s(n);t.r_()&&t.V_&&t.m_(e.mutations)}function FP(n){return Es(n)&&!_s(n).n_()&&n.O_.length>0}function LP(n){_s(n).start()}function vz(n){return M(this,null,function*(){_s(n).p_()})}function wz(n){return M(this,null,function*(){let e=_s(n);for(let t of n.O_)e.m_(t.mutations)})}function Ez(n,e,t){return M(this,null,function*(){let r=n.O_.shift(),i=RE.from(r,e,t);yield OP(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Tc(n)})}function Iz(n,e){return M(this,null,function*(){e&&_s(n).V_&&(yield function(r,i){return M(this,null,function*(){if(function(o){return rP(o)&&o!==P.ABORTED}(i.code)){let s=r.O_.shift();_s(r).s_(),yield OP(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Tc(r)}})}(n,e)),FP(n)&&LP(n)})}function cN(n,e){return M(this,null,function*(){let t=q(n);t.asyncQueue.verifyOperationInProgress(),U("RemoteStore","RemoteStore received new credentials");let r=Es(t);t.L_.add(3),yield Cc(t),r&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield dd(t)})}function DI(n,e){return M(this,null,function*(){let t=q(n);e?(t.L_.delete(2),yield dd(t)):e||(t.L_.add(2),yield Cc(t),t.q_.set("Unknown"))})}function Dc(n){return n.K_||(n.K_=function(t,r,i){let s=q(t);return s.w_(),new wI(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Eo:fz.bind(null,n),Ro:pz.bind(null,n),mo:gz.bind(null,n),d_:mz.bind(null,n)}),n.B_.push(e=>M(this,null,function*(){e?(n.K_.s_(),_C(n)?yC(n):n.q_.set("Unknown")):(yield n.K_.stop(),kP(n))}))),n.K_}function _s(n){return n.U_||(n.U_=function(t,r,i){let s=q(t);return s.w_(),new EI(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:vz.bind(null,n),mo:Iz.bind(null,n),f_:wz.bind(null,n),g_:Ez.bind(null,n)}),n.B_.push(e=>M(this,null,function*(){e?(n.U_.s_(),yield Tc(n)):(yield n.U_.stop(),n.O_.length>0&&(U("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))}))),n.U_}var bI=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Nt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new L(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function bc(n,e){if(Et("AsyncQueue",`${e}: ${n}`),ws(n))return new L(P.UNAVAILABLE,`${e}: ${n}`);throw n}var pg=class n{constructor(e){this.comparator=e?(t,r)=>e(t,r)||H.comparator(t.key,r.key):(t,r)=>H.comparator(t.key,r.key),this.keyedMap=Rl(),this.sortedSet=new it(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var gg=class{constructor(){this.W_=new it(H.comparator)}track(e){let t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):W():this.W_=this.W_.insert(t,e)}G_(){let e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}},mc=class n{constructor(e,t,r,i,s,o,a,c,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,pg.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&cd(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var SI=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}},AI=class{constructor(){this.queries=uN(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){let i=q(t),s=i.queries;i.queries=uN(),s.forEach((o,a)=>{for(let c of a.j_)c.onError(r)})})(this,new L(P.ABORTED,"Firestore shutting down"))}};function uN(){return new Kr(n=>qN(n),cd)}function vC(n,e){return M(this,null,function*(){let t=q(n),r=3,i=e.query,s=t.queries.get(i);s?!s.H_()&&e.J_()&&(r=2):(s=new SI,r=e.J_()?0:1);try{switch(r){case 0:s.z_=yield t.onListen(i,!0);break;case 1:s.z_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let a=bc(o,`Initialization of query '${Ya(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&EC(t)})}function wC(n,e){return M(this,null,function*(){let t=q(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.j_.indexOf(e);o>=0&&(s.j_.splice(o,1),s.j_.length===0?i=e.J_()?0:1:!s.H_()&&e.J_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function Cz(n,e){let t=q(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.j_)a.X_(i)&&(r=!0);o.z_=i}}r&&EC(t)}function Tz(n,e,t){let r=q(n),i=r.queries.get(e);if(i)for(let s of i.j_)s.onError(t);r.queries.delete(e)}function EC(n){n.Y_.forEach(e=>{e.next()})}var xI,lN;(lN=xI||(xI={})).ea="default",lN.Cache="cache";var ed=class{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new mc(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;let r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;let t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=mc.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==xI.Cache}};var RI=class{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}};var mg=class{constructor(e){this.serializer=e}Es(e){return Hr(this.serializer,e)}ds(e){return e.metadata.exists?dP(this.serializer,e.document,!1):Pt.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Ct(e)}},MI=class{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=VP(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;let r=Oe.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){let t=new Map,r=new mg(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.Es(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||me()).add(s);t.set(o,a)}}return t}complete(){return M(this,null,function*(){let e=yield lz(this.localStore,new mg(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(let r of this.queries)yield dz(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}})}};function VP(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var yg=class{constructor(e){this.key=e}},_g=class{constructor(e){this.key=e}},vg=class{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=me(),this.mutatedKeys=me(),this.Aa=zN(e),this.Ra=new pg(this.Aa)}get Va(){return this.Ta}ma(e,t){let r=t?t.fa:new gg,i=t?t.Ra:this.Ra,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,l=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((d,f)=>{let g=i.get(d),y=ud(this.query,f)?f:null,v=!!g&&this.mutatedKeys.has(g.key),b=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations),T=!1;g&&y?g.data.isEqual(y.data)?v!==b&&(r.track({type:3,doc:y}),T=!0):this.ga(g,y)||(r.track({type:2,doc:y}),T=!0,(c&&this.Aa(y,c)>0||l&&this.Aa(y,l)<0)&&(a=!0)):!g&&y?(r.track({type:0,doc:y}),T=!0):g&&!y&&(r.track({type:1,doc:g}),T=!0,(c||l)&&(a=!0)),T&&(y?(o=o.add(y),s=b?s.add(d):s.delete(d)):(o=o.delete(d),s=s.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),s=s.delete(d.key),r.track({type:1,doc:d})}return{Ra:o,fa:r,ns:a,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;let o=e.fa.G_();o.sort((d,f)=>function(y,v){let b=T=>{switch(T){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return W()}};return b(y)-b(v)}(d.type,f.type)||this.Aa(d.doc,f.doc)),this.pa(r),i=i!=null&&i;let a=t&&!i?this.ya():[],c=this.da.size===0&&this.current&&!i?1:0,l=c!==this.Ea;return this.Ea=c,o.length!==0||l?{snapshot:new mc(this.query,e.Ra,s,o,e.mutatedKeys,c===0,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new gg,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];let e=this.da;this.da=me(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});let t=[];return e.forEach(r=>{this.da.has(r)||t.push(new _g(r))}),this.da.forEach(r=>{e.has(r)||t.push(new yg(r))}),t}ba(e){this.Ta=e.Ts,this.da=me();let t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return mc.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},NI=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},PI=class{constructor(e){this.key=e,this.va=!1}},kI=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Kr(a=>qN(a),cd),this.Ma=new Map,this.xa=new Set,this.Oa=new it(H.comparator),this.Na=new Map,this.La=new Zl,this.Ba={},this.ka=new Map,this.qa=hc.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function Dz(n,e,t=!0){return M(this,null,function*(){let r=Pg(n),i,s=r.Fa.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=yield UP(r,e,t,!0),i})}function bz(n,e){return M(this,null,function*(){let t=Pg(n);yield UP(t,e,!0,!1)})}function UP(n,e,t,r){return M(this,null,function*(){let i=yield fc(n.localStore,fn(e)),s=i.targetId,o=t?n.sharedClientState.addLocalQueryTarget(s):"not-current",a;return r&&(a=yield IC(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&Ng(n.remoteStore,i),a})}function IC(n,e,t,r,i){return M(this,null,function*(){n.Ka=(f,g,y)=>function(b,T,V,B){return M(this,null,function*(){let O=T.view.ma(V);O.ns&&(O=yield ag(b.localStore,T.query,!1).then(({documents:I})=>T.view.ma(I,O)));let z=B&&B.targetChanges.get(T.targetId),re=B&&B.targetMismatches.get(T.targetId)!=null,Z=T.view.applyChanges(O,b.isPrimaryClient,z,re);return OI(b,T.targetId,Z.wa),Z.snapshot})}(n,f,g,y);let s=yield ag(n.localStore,e,!0),o=new vg(e,s.Ts),a=o.ma(s.documents),c=Wl.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),l=o.applyChanges(a,n.isPrimaryClient,c);OI(n,t,l.wa);let d=new NI(e,t,o);return n.Fa.set(e,d),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),l.snapshot})}function Sz(n,e,t){return M(this,null,function*(){let r=q(n),i=r.Fa.get(e),s=r.Ma.get(i.targetId);if(s.length>1)return r.Ma.set(i.targetId,s.filter(o=>!cd(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield pc(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&gc(r.remoteStore,i.targetId),yc(r,i.targetId)}).catch(vs))):(yc(r,i.targetId),yield pc(r.localStore,i.targetId,!0))})}function Az(n,e){return M(this,null,function*(){let t=q(n),r=t.Fa.get(e),i=t.Ma.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),gc(t.remoteStore,r.targetId))})}function xz(n,e,t){return M(this,null,function*(){let r=bC(n);try{let i=yield function(o,a){let c=q(o),l=lt.now(),d=a.reduce((y,v)=>y.add(v.key),me()),f,g;return c.persistence.runTransaction("Locally write mutations","readwrite",y=>{let v=xn(),b=me();return c.cs.getEntries(y,d).next(T=>{v=T,v.forEach((V,B)=>{B.isValidDocument()||(b=b.add(V))})}).next(()=>c.localDocuments.getOverlayedDocuments(y,v)).next(T=>{f=T;let V=[];for(let B of a){let O=q4(B,f.get(B.key).overlayedDocument);O!=null&&V.push(new mr(B.key,O,FN(O.value.mapValue),gt.exists(!0)))}return c.mutationQueue.addMutationBatch(y,l,V,a)}).next(T=>{g=T;let V=T.applyToLocalDocumentSet(f,b);return c.documentOverlayCache.saveOverlays(y,T.batchId,V)})}).then(()=>({batchId:g.batchId,changes:WN(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,c){let l=o.Ba[o.currentUser.toKey()];l||(l=new it(pe)),l=l.insert(a,c),o.Ba[o.currentUser.toKey()]=l}(r,i.batchId,t),yield Ai(r,i.changes),yield Tc(r.remoteStore)}catch(i){let s=bc(i,"Failed to persist write");t.reject(s)}})}function jP(n,e){return M(this,null,function*(){let t=q(n);try{let r=yield cz(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Na.get(s);o&&(te(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.va=!0:i.modifiedDocuments.size>0?te(o.va):i.removedDocuments.size>0&&(te(o.va),o.va=!1))}),yield Ai(t,r,e)}catch(r){yield vs(r)}})}function dN(n,e,t){let r=q(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Fa.forEach((s,o)=>{let a=o.view.Z_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){let c=q(o);c.onlineState=a;let l=!1;c.queries.forEach((d,f)=>{for(let g of f.j_)g.Z_(a)&&(l=!0)}),l&&EC(c)}(r.eventManager,e),i.length&&r.Ca.d_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Rz(n,e,t){return M(this,null,function*(){let r=q(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Na.get(e),s=i&&i.key;if(s){let o=new it(H.comparator);o=o.insert(s,Pt.newNoDocument(s,ie.min()));let a=me().add(s),c=new Gl(ie.min(),new Map,new it(pe),o,a);yield jP(r,c),r.Oa=r.Oa.remove(s),r.Na.delete(e),DC(r)}else yield pc(r.localStore,e,!1).then(()=>yc(r,e,t)).catch(vs)})}function Mz(n,e){return M(this,null,function*(){let t=q(n),r=e.batch.batchId;try{let i=yield az(t.localStore,e);TC(t,r,null),CC(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Ai(t,i)}catch(i){yield vs(i)}})}function Nz(n,e,t){return M(this,null,function*(){let r=q(n);try{let i=yield function(o,a){let c=q(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",l=>{let d;return c.mutationQueue.lookupMutationBatch(l,a).next(f=>(te(f!==null),d=f.keys(),c.mutationQueue.removeMutationBatch(l,f))).next(()=>c.mutationQueue.performConsistencyCheck(l)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(l,d,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,d)).next(()=>c.localDocuments.getDocuments(l,d))})}(r.localStore,e);TC(r,e,t),CC(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Ai(r,i)}catch(i){yield vs(i)}})}function Pz(n,e){return M(this,null,function*(){let t=q(n);Es(t.remoteStore)||U("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield function(o){let a=q(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>a.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(r===-1)return void e.resolve();let i=t.ka.get(r)||[];i.push(e),t.ka.set(r,i)}catch(r){let i=bc(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function CC(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function TC(n,e,t){let r=q(n),i=r.Ba[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Ba[r.currentUser.toKey()]=i}}function yc(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||BP(n,r)})}function BP(n,e){n.xa.delete(e.path.canonicalString());let t=n.Oa.get(e);t!==null&&(gc(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),DC(n))}function OI(n,e,t){for(let r of t)r instanceof yg?(n.La.addReference(r.key,e),kz(n,r)):r instanceof _g?(U("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||BP(n,r.key)):W()}function kz(n,e){let t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(U("SyncEngine","New document in limbo: "+t),n.xa.add(r),DC(n))}function DC(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){let e=n.xa.values().next().value;n.xa.delete(e);let t=new H(Oe.fromString(e)),r=n.qa.next();n.Na.set(r,new PI(t)),n.Oa=n.Oa.insert(t,r),Ng(n.remoteStore,new dc(fn(Ic(t.path)),r,"TargetPurposeLimboResolution",Ln.oe))}}function Ai(n,e,t){return M(this,null,function*(){let r=q(n),i=[],s=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,c)=>{o.push(r.Ka(c,e,t).then(l=>{var d;if((l||t)&&r.isPrimaryClient){let f=l?!l.fromCache:(d=t?.targetChanges.get(c.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(c.targetId,f?"current":"not-current")}if(l){i.push(l);let f=fI.Wi(c.targetId,l);s.push(f)}}))}),yield Promise.all(o),r.Ca.d_(i),yield function(c,l){return M(this,null,function*(){let d=q(c);try{yield d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>R.forEach(l,g=>R.forEach(g.$i,y=>d.persistence.referenceDelegate.addReference(f,g.targetId,y)).next(()=>R.forEach(g.Ui,y=>d.persistence.referenceDelegate.removeReference(f,g.targetId,y)))))}catch(f){if(!ws(f))throw f;U("LocalStore","Failed to update sequence numbers: "+f)}for(let f of l){let g=f.targetId;if(!f.fromCache){let y=d.os.get(g),v=y.snapshotVersion,b=y.withLastLimboFreeSnapshotVersion(v);d.os=d.os.insert(g,b)}}})}(r.localStore,s))})}function Oz(n,e){return M(this,null,function*(){let t=q(n);if(!t.currentUser.isEqual(e)){U("SyncEngine","User change. New user:",e.toKey());let r=yield bP(t.localStore,e);t.currentUser=e,function(s,o){s.ka.forEach(a=>{a.forEach(c=>{c.reject(new L(P.CANCELLED,o))})}),s.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Ai(t,r.hs)}})}function Fz(n,e){let t=q(n),r=t.Na.get(e);if(r&&r.va)return me().add(r.key);{let i=me(),s=t.Ma.get(e);if(!s)return i;for(let o of s){let a=t.Fa.get(o);i=i.unionWith(a.view.Va)}return i}}function Lz(n,e){return M(this,null,function*(){let t=q(n),r=yield ag(t.localStore,e.query,!0),i=e.view.ba(r);return t.isPrimaryClient&&OI(t,e.targetId,i.wa),i})}function Vz(n,e){return M(this,null,function*(){let t=q(n);return RP(t.localStore,e).then(r=>Ai(t,r))})}function Uz(n,e,t,r){return M(this,null,function*(){let i=q(n),s=yield function(a,c){let l=q(a),d=q(l.mutationQueue);return l.persistence.runTransaction("Lookup mutation documents","readonly",f=>d.Mn(f,c).next(g=>g?l.localDocuments.getDocuments(f,g):R.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?yield Tc(i.remoteStore):t==="acknowledged"||t==="rejected"?(TC(i,e,r||null),CC(i,e),function(a,c){q(q(a).mutationQueue).On(c)}(i.localStore,e)):W(),yield Ai(i,s)):U("SyncEngine","Cannot apply mutation batch with id: "+e)})}function jz(n,e){return M(this,null,function*(){let t=q(n);if(Pg(t),bC(t),e===!0&&t.Qa!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield hN(t,r.toArray());t.Qa=!0,yield DI(t.remoteStore,!0);for(let s of i)Ng(t.remoteStore,s)}else if(e===!1&&t.Qa!==!1){let r=[],i=Promise.resolve();t.Ma.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(yc(t,o),pc(t.localStore,o,!0))),gc(t.remoteStore,o)}),yield i,yield hN(t,r),function(o){let a=q(o);a.Na.forEach((c,l)=>{gc(a.remoteStore,l)}),a.La.pr(),a.Na=new Map,a.Oa=new it(H.comparator)}(t),t.Qa=!1,yield DI(t.remoteStore,!1)}})}function hN(n,e,t){return M(this,null,function*(){let r=q(n),i=[],s=[];for(let o of e){let a,c=r.Ma.get(o);if(c&&c.length!==0){a=yield fc(r.localStore,fn(c[0]));for(let l of c){let d=r.Fa.get(l),f=yield Lz(r,d);f.snapshot&&s.push(f.snapshot)}}else{let l=yield xP(r.localStore,o);a=yield fc(r.localStore,l),yield IC(r,$P(l),o,!1,a.resumeToken)}i.push(a)}return r.Ca.d_(s),i})}function $P(n){return $N(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function Bz(n){return function(t){return q(q(t).persistence).Qi()}(q(n).localStore)}function $z(n,e,t,r){return M(this,null,function*(){let i=q(n);if(i.Qa)return void U("SyncEngine","Ignoring unexpected query state notification.");let s=i.Ma.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield RP(i.localStore,HN(s[0])),a=Gl.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Tt.EMPTY_BYTE_STRING);yield Ai(i,o,a);break}case"rejected":yield pc(i.localStore,e,!0),yc(i,e,r);break;default:W()}})}function qz(n,e,t){return M(this,null,function*(){let r=Pg(n);if(r.Qa){for(let i of e){if(r.Ma.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){U("SyncEngine","Adding an already active target "+i);continue}let s=yield xP(r.localStore,i),o=yield fc(r.localStore,s);yield IC(r,$P(s),o.targetId,!1,o.resumeToken),Ng(r.remoteStore,o)}for(let i of t)r.Ma.has(i)&&(yield pc(r.localStore,i,!1).then(()=>{gc(r.remoteStore,i),yc(r,i)}).catch(vs))}})}function Pg(n){let e=q(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=jP.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Fz.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Rz.bind(null,e),e.Ca.d_=Cz.bind(null,e.eventManager),e.Ca.$a=Tz.bind(null,e.eventManager),e}function bC(n){let e=q(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Mz.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Nz.bind(null,e),e}function Hz(n,e,t){let r=q(n);(function(s,o,a){return M(this,null,function*(){try{let c=yield o.getMetadata();if(yield function(y,v){let b=q(y),T=Ct(v.createTime);return b.persistence.runTransaction("hasNewerBundle","readonly",V=>b.Gr.getBundleMetadata(V,v.id)).then(V=>!!V&&V.createTime.compareTo(T)>=0)}(s.localStore,c))return yield o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(c)),Promise.resolve(new Set);a._updateProgress(VP(c));let l=new MI(c,s.localStore,o.serializer),d=yield o.Ua();for(;d;){let g=yield l.la(d);g&&a._updateProgress(g),d=yield o.Ua()}let f=yield l.complete();return yield Ai(s,f.Ia,void 0),yield function(y,v){let b=q(y);return b.persistence.runTransaction("Save bundle","readwrite",T=>b.Gr.saveBundleMetadata(T,v))}(s.localStore,c),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(c){return Jn("SyncEngine",`Loading bundle failed with ${c}`),a._failWith(c),Promise.resolve(new Set)}})})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var td=class{constructor(){this.synchronizeTabs=!1}initialize(e){return M(this,null,function*(){this.serializer=ld(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return DP(this.persistence,new og,e.initialUser,this.serializer)}createPersistence(e){return new ig(sg.Zr,this.serializer)}createSharedClientState(e){return new lg}terminate(){return M(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var wg=class n extends td{constructor(e,t,r){super(),this.Wa=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){return M(this,null,function*(){yield hy(n.prototype,this,"initialize").call(this,e),yield this.Wa.initialize(this,e),yield bC(this.Wa.syncEngine),yield Tc(this.Wa.remoteStore),yield this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return DP(this.persistence,new og,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new ZE(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new pE(t,this.persistence);return new fE(e.asyncQueue,r)}createPersistence(e){let t=gC(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Xn.withCacheSize(this.cacheSizeBytes):Xn.DEFAULT;return new hI(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,NP(),Np(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new lg}},FI=class n extends wg{constructor(e,t){super(e,t,!1),this.Wa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return M(this,null,function*(){yield hy(n.prototype,this,"initialize").call(this,e);let t=this.Wa.syncEngine;this.sharedClientState instanceof Fl&&(this.sharedClientState.syncEngine={no:Uz.bind(null,t),ro:$z.bind(null,t),io:qz.bind(null,t),Qi:Bz.bind(null,t),eo:Vz.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.yi(r=>M(this,null,function*(){yield jz(this.Wa.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=NP();if(!Fl.D(t))throw new L(P.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=gC(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Fl(t,e.asyncQueue,r,e.clientId,e.initialUser)}},nd=class{initialize(e,t){return M(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>dN(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Oz.bind(null,this.syncEngine),yield DI(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new AI}()}createDatastore(e){let t=ld(e.databaseInfo.databaseId),r=function(s){return new vI(s)}(e.databaseInfo);return function(s,o,a,c){return new II(s,o,a,c)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,s,o,a){return new TI(r,i,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>dN(this.syncEngine,t,0),function(){return dg.D()?new dg:new yI}())}createSyncEngine(e,t){return function(i,s,o,a,c,l,d){let f=new kI(i,s,o,a,c,l);return d&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return M(this,null,function*(){var e,t;yield function(i){return M(this,null,function*(){let s=q(i);U("RemoteStore","RemoteStore shutting down."),s.L_.add(5),yield Cc(s),s.k_.shutdown(),s.q_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()})}};function fN(n,e=10240){let t=0;return{read(){return M(this,null,function*(){if(t<n.byteLength){let i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return M(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var _c=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ga(this.observer.next,e)}error(e){this.observer.error?this.Ga(this.observer.error,e):Et("Uncaught Error in snapshot listener:",e.toString())}za(){this.muted=!0}Ga(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var LI=class{constructor(e,t){this.ja=e,this.serializer=t,this.metadata=new Nt,this.buffer=new Uint8Array,this.Ha=function(){return new TextDecoder("utf-8")}(),this.Ja().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.aa)}`))},r=>this.metadata.reject(r))}close(){return this.ja.cancel()}getMetadata(){return M(this,null,function*(){return this.metadata.promise})}Ua(){return M(this,null,function*(){return yield this.getMetadata(),this.Ja()})}Ja(){return M(this,null,function*(){let e=yield this.Ya();if(e===null)return null;let t=this.Ha.decode(e),r=Number(t);isNaN(r)&&this.Za(`length string (${t}) is not valid number`);let i=yield this.Xa(r);return new RI(JSON.parse(i),e.length+r)})}eu(){return this.buffer.findIndex(e=>e===123)}Ya(){return M(this,null,function*(){for(;this.eu()<0&&!(yield this.tu()););if(this.buffer.length===0)return null;let e=this.eu();e<0&&this.Za("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}Xa(e){return M(this,null,function*(){for(;this.buffer.length<e;)(yield this.tu())&&this.Za("Reached the end of bundle when more is expected.");let t=this.Ha.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}Za(e){throw this.ja.cancel(),new Error(`Invalid bundle format: ${e}`)}tu(){return M(this,null,function*(){let e=yield this.ja.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var VI=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return M(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new L(P.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(i,s){return M(this,null,function*(){let o=q(i),a={documents:s.map(f=>Kl(o.serializer,f))},c=yield o.Lo("BatchGetDocuments",o.serializer.databaseId,Oe.emptyPath(),a,s.length),l=new Map;c.forEach(f=>{let g=Q4(o.serializer,f);l.set(g.key.toString(),g)});let d=[];return s.forEach(f=>{let g=l.get(f.toString());te(!!g),d.push(g)}),d})}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new ys(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return M(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=H.fromPath(r);this.mutations.push(new ql(i,this.precondition(i)))}),yield function(r,i){return M(this,null,function*(){let s=q(r),o={writes:i.map(a=>Ql(s.serializer,a))};yield s.Mo("Commit",s.serializer.databaseId,Oe.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw W();t=ie.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new L(P.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ie.min())?gt.exists(!1):gt.updateTime(t):gt.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ie.min()))throw new L(P.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return gt.updateTime(t)}return gt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var UI=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.nu=r.maxAttempts,this.t_=new Jl(this.asyncQueue,"transaction_retry")}ru(){this.nu-=1,this.iu()}iu(){this.t_.Go(()=>M(this,null,function*(){let e=new VI(this.datastore),t=this.su(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.ou(i)}))}).catch(r=>{this.ou(r)})}))}su(e){try{let t=this.updateFunction(e);return!od(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}ou(e){this.nu>0&&this._u(e)?(this.nu-=1,this.asyncQueue.enqueueAndForget(()=>(this.iu(),Promise.resolve()))):this.deferred.reject(e)}_u(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!rP(t)}return!1}};var jI=class{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Mt.UNAUTHENTICATED,this.clientId=Op.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>M(this,null,function*(){U("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(U("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new L(P.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Nt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>M(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=bc(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Pp(n,e){return M(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),U("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>M(this,null,function*(){r.isEqual(i)||(yield bP(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function BI(n,e){return M(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield SC(n);U("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>cN(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>cN(e.remoteStore,i)),n._onlineComponents=e})}function qP(n){return n.name==="FirebaseError"?n.code===P.FAILED_PRECONDITION||n.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}function SC(n){return M(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){U("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Pp(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!qP(t))throw t;Jn("Error using user provided cache. Falling back to memory cache: "+t),yield Pp(n,new td)}}else U("FirestoreClient","Using default OfflineComponentProvider"),yield Pp(n,new td);return n._offlineComponents})}function kg(n){return M(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(U("FirestoreClient","Using user provided OnlineComponentProvider"),yield BI(n,n._uninitializedComponentsProvider._online)):(U("FirestoreClient","Using default OnlineComponentProvider"),yield BI(n,new nd))),n._onlineComponents})}function HP(n){return SC(n).then(e=>e.persistence)}function AC(n){return SC(n).then(e=>e.localStore)}function zP(n){return kg(n).then(e=>e.remoteStore)}function xC(n){return kg(n).then(e=>e.syncEngine)}function zz(n){return kg(n).then(e=>e.datastore)}function vc(n){return M(this,null,function*(){let e=yield kg(n),t=e.eventManager;return t.onListen=Dz.bind(null,e.syncEngine),t.onUnlisten=Sz.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=bz.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Az.bind(null,e.syncEngine),t})}function Gz(n){return n.asyncQueue.enqueue(()=>M(this,null,function*(){let e=yield HP(n),t=yield zP(n);return e.setNetworkEnabled(!0),function(i){let s=q(i);return s.L_.delete(0),dd(s)}(t)}))}function Wz(n){return n.asyncQueue.enqueue(()=>M(this,null,function*(){let e=yield HP(n),t=yield zP(n);return e.setNetworkEnabled(!1),function(i){return M(this,null,function*(){let s=q(i);s.L_.add(0),yield Cc(s),s.q_.set("Offline")})}(t)}))}function Kz(n,e){let t=new Nt;return n.asyncQueue.enqueueAndForget(()=>M(this,null,function*(){return function(i,s,o){return M(this,null,function*(){try{let a=yield function(l,d){let f=q(l);return f.persistence.runTransaction("read document","readonly",g=>f.localDocuments.getDocument(g,d))}(i,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new L(P.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let c=bc(a,`Failed to get document '${s} from cache`);o.reject(c)}})}(yield AC(n),e,t)})),t.promise}function GP(n,e,t={}){let r=new Nt;return n.asyncQueue.enqueueAndForget(()=>M(this,null,function*(){return function(s,o,a,c,l){let d=new _c({next:g=>{o.enqueueAndForget(()=>wC(s,f));let y=g.docs.has(a);!y&&g.fromCache?l.reject(new L(P.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&g.fromCache&&c&&c.source==="server"?l.reject(new L(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):l.resolve(g)},error:g=>l.reject(g)}),f=new ed(Ic(a.path),d,{includeMetadataChanges:!0,_a:!0});return vC(s,f)}(yield vc(n),n.asyncQueue,e,t,r)})),r.promise}function Qz(n,e){let t=new Nt;return n.asyncQueue.enqueueAndForget(()=>M(this,null,function*(){return function(i,s,o){return M(this,null,function*(){try{let a=yield ag(i,s,!0),c=new vg(s,a.Ts),l=c.ma(a.documents),d=c.applyChanges(l,!1);o.resolve(d.snapshot)}catch(a){let c=bc(a,`Failed to execute query '${s} against cache`);o.reject(c)}})}(yield AC(n),e,t)})),t.promise}function WP(n,e,t={}){let r=new Nt;return n.asyncQueue.enqueueAndForget(()=>M(this,null,function*(){return function(s,o,a,c,l){let d=new _c({next:g=>{o.enqueueAndForget(()=>wC(s,f)),g.fromCache&&c.source==="server"?l.reject(new L(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(g)},error:g=>l.reject(g)}),f=new ed(a,d,{includeMetadataChanges:!0,_a:!0});return vC(s,f)}(yield vc(n),n.asyncQueue,e,t,r)})),r.promise}function Yz(n,e){let t=new _c(e);return n.asyncQueue.enqueueAndForget(()=>M(this,null,function*(){return function(i,s){q(i).Y_.add(s),s.next()}(yield vc(n),t)})),()=>{t.za(),n.asyncQueue.enqueueAndForget(()=>M(this,null,function*(){return function(i,s){q(i).Y_.delete(s)}(yield vc(n),t)}))}}function Zz(n,e,t,r){let i=function(o,a){let c;return c=typeof o=="string"?sP().encode(o):o,function(d,f){return new LI(d,f)}(function(d,f){if(d instanceof Uint8Array)return fN(d,f);if(d instanceof ArrayBuffer)return fN(new Uint8Array(d),f);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),a)}(t,ld(e));n.asyncQueue.enqueueAndForget(()=>M(this,null,function*(){Hz(yield xC(n),i,r)}))}function Xz(n,e){return n.asyncQueue.enqueue(()=>M(this,null,function*(){return function(r,i){let s=q(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Gr.getNamedQuery(o,i))}(yield AC(n),e)}))}function KP(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var pN=new Map;function RC(n,e,t){if(!t)throw new L(P.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function MC(n,e,t,r){if(e===!0&&r===!0)throw new L(P.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function gN(n){if(!H.isDocumentKey(n))throw new L(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function mN(n){if(H.isDocumentKey(n))throw new L(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Og(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":W()}function Fe(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new L(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Og(n);throw new L(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function QP(n,e){if(e<=0)throw new L(P.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}var Eg=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new L(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new L(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}MC("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=KP((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new L(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new L(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new L(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},So=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Eg({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new L(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new L(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Eg(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new rE;switch(r.type){case"firstParty":return new aE(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new L(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=pN.get(t);r&&(U("ComponentProvider","Removing Datastore"),pN.delete(t),r.terminate())}(this),Promise.resolve()}};function YP(n,e,t,r={}){var i;let s=(n=Fe(n,So))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&Jn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,c;if(typeof r.mockUserToken=="string")a=r.mockUserToken,c=Mt.MOCK_USER;else{a=ra(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let l=r.mockUserToken.sub||r.mockUserToken.user_id;if(!l)throw new L(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Mt(l)}n._authCredentials=new iE(new kp(a,c))}}var Yt=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},Je=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new zr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},zr=class n extends Yt{constructor(e,t,r){super(e,t,Ic(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Je(this.firestore,null,new H(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function NC(n,e,...t){if(n=ce(n),RC("collection","path",e),n instanceof So){let r=Oe.fromString(e,...t);return mN(r),new zr(n,null,r)}{if(!(n instanceof Je||n instanceof zr))throw new L(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(Oe.fromString(e,...t));return mN(r),new zr(n.firestore,null,r)}}function ZP(n,e){if(n=Fe(n,So),RC("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new L(P.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Yt(n,null,function(r){return new gr(Oe.emptyPath(),r)}(e))}function hd(n,e,...t){if(n=ce(n),arguments.length===1&&(e=Op.newId()),RC("doc","path",e),n instanceof So){let r=Oe.fromString(e,...t);return gN(r),new Je(n,null,new H(r))}{if(!(n instanceof Je||n instanceof zr))throw new L(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(Oe.fromString(e,...t));return gN(r),new Je(n.firestore,n instanceof zr?n.converter:null,new H(r))}}function PC(n,e){return n=ce(n),e=ce(e),(n instanceof Je||n instanceof zr)&&(e instanceof Je||e instanceof zr)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function kC(n,e){return n=ce(n),e=ce(e),n instanceof Yt&&e instanceof Yt&&n.firestore===e.firestore&&cd(n._query,e._query)&&n.converter===e.converter}var $I=class{constructor(){this.au=Promise.resolve(),this.uu=[],this.cu=!1,this.lu=[],this.hu=null,this.Pu=!1,this.Iu=!1,this.Tu=[],this.t_=new Jl(this,"async_queue_retry"),this.Eu=()=>{let t=Np();t&&U("AsyncQueue","Visibility state changed to "+t.visibilityState),this.t_.jo()};let e=Np();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Eu)}get isShuttingDown(){return this.cu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.du(),this.Au(e)}enterRestrictedMode(e){if(!this.cu){this.cu=!0,this.Iu=e||!1;let t=Np();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Eu)}}enqueue(e){if(this.du(),this.cu)return new Promise(()=>{});let t=new Nt;return this.Au(()=>this.cu&&this.Iu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.uu.push(e),this.Ru()))}Ru(){return M(this,null,function*(){if(this.uu.length!==0){try{yield this.uu[0](),this.uu.shift(),this.t_.reset()}catch(e){if(!ws(e))throw e;U("AsyncQueue","Operation failed with retryable error: "+e)}this.uu.length>0&&this.t_.Go(()=>this.Ru())}})}Au(e){let t=this.au.then(()=>(this.Pu=!0,e().catch(r=>{this.hu=r,this.Pu=!1;let i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw Et("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.Pu=!1,r))));return this.au=t,t}enqueueAfterDelay(e,t,r){this.du(),this.Tu.indexOf(e)>-1&&(t=0);let i=bI.createAndSchedule(this,e,t,r,s=>this.Vu(s));return this.lu.push(i),i}du(){this.hu&&W()}verifyOperationInProgress(){}mu(){return M(this,null,function*(){let e;do e=this.au,yield e;while(e!==this.au)})}fu(e){for(let t of this.lu)if(t.timerId===e)return!0;return!1}gu(e){return this.mu().then(()=>{this.lu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.lu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.mu()})}pu(e){this.Tu.push(e)}Vu(e){let t=this.lu.indexOf(e);this.lu.splice(t,1)}};function qI(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var HI=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new Nt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var XP=-1,at=class extends So{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=function(){return new $I}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||JP(this),this._firestoreClient.terminate()}};function Ft(n){return n._firestoreClient||JP(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function JP(n){var e,t,r;let i=n._freezeSettings(),s=function(a,c,l,d){return new gE(a,c,l,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,KP(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new jI(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function ek(n,e){uk(n=Fe(n,at));let t=Ft(n);if(t._uninitializedComponentsProvider)throw new L(P.FAILED_PRECONDITION,"SDK cache is already specified.");Jn("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new nd;return nk(t,i,new wg(i,r.cacheSizeBytes,e?.forceOwnership))}function tk(n){uk(n=Fe(n,at));let e=Ft(n);if(e._uninitializedComponentsProvider)throw new L(P.FAILED_PRECONDITION,"SDK cache is already specified.");Jn("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings(),r=new nd;return nk(e,r,new FI(r,t.cacheSizeBytes))}function nk(n,e,t){let r=new Nt;return n.asyncQueue.enqueue(()=>M(this,null,function*(){try{yield Pp(n,t),yield BI(n,e),r.resolve()}catch(i){let s=i;if(!qP(s))throw s;Jn("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function rk(n){if(n._initialized&&!n._terminated)throw new L(P.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new Nt;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>M(this,null,function*(){try{yield function(r){return M(this,null,function*(){if(!ls.D())return Promise.resolve();let i=r+"main";yield ls.delete(i)})}(gC(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function ik(n){return function(t){let r=new Nt;return t.asyncQueue.enqueueAndForget(()=>M(this,null,function*(){return Pz(yield xC(t),r)})),r.promise}(Ft(n=Fe(n,at)))}function sk(n){return Gz(Ft(n=Fe(n,at)))}function ok(n){return Wz(Ft(n=Fe(n,at)))}function ak(n,e){let t=Ft(n=Fe(n,at)),r=new HI;return Zz(t,n._databaseId,e,r),r}function ck(n,e){return Xz(Ft(n=Fe(n,at)),e).then(t=>t?new Yt(n,null,t.query):null)}function uk(n){if(n._initialized||n._terminated)throw new L(P.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Qr=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Tt.fromBase64String(e))}catch(t){throw new L(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Tt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var yr=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new L(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new It(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var bi=class{constructor(e){this._methodName=e}};var Ao=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new L(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new L(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return pe(this._lat,e._lat)||pe(this._long,e._long)}};var rd=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}};var Jz=/^__.*__$/,zI=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new mr(e,this.data,this.fieldMask,t,this.fieldTransforms):new ms(e,this.data,t,this.fieldTransforms)}},Ig=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new mr(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function lk(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw W()}}var Cg=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.yu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get wu(){return this.settings.wu}Su(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}bu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Su({path:r,Du:!1});return i.vu(e),i}Cu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Su({path:r,Du:!1});return i.yu(),i}Fu(e){return this.Su({path:void 0,Du:!0})}Mu(e){return Tg(e,this.settings.methodName,this.settings.xu||!1,this.path,this.settings.Ou)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}yu(){if(this.path)for(let e=0;e<this.path.length;e++)this.vu(this.path.get(e))}vu(e){if(e.length===0)throw this.Mu("Document fields must not be empty");if(lk(this.wu)&&Jz.test(e))throw this.Mu('Document fields cannot begin and end with "__"')}},GI=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||ld(e)}Nu(e,t,r,i=!1){return new Cg({wu:e,methodName:t,Ou:r,path:It.emptyPath(),Du:!1,xu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function No(n){let e=n._freezeSettings(),t=ld(n._databaseId);return new GI(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Fg(n,e,t,r,i,s={}){let o=n.Nu(s.merge||s.mergeFields?2:0,e,t,i);LC("Data must be an object, but it was:",o,r);let a=fk(r,o),c,l;if(s.merge)c=new Vn(o.fieldMask),l=o.fieldTransforms;else if(s.mergeFields){let d=[];for(let f of s.mergeFields){let g=ZI(e,f,t);if(!o.contains(g))throw new L(P.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);gk(d,g)||d.push(g)}c=new Vn(d),l=o.fieldTransforms.filter(f=>c.covers(f.field))}else c=null,l=o.fieldTransforms;return new zI(new sn(a),c,l)}var id=class n extends bi{_toFieldTransform(e){if(e.wu!==2)throw e.wu===1?e.Mu(`${this._methodName}() can only appear at the top level of your update data`):e.Mu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function dk(n,e,t){return new Cg({wu:3,Ou:e.settings.Ou,methodName:n._methodName,Du:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var WI=class n extends bi{_toFieldTransform(e){return new To(e.path,new ps)}isEqual(e){return e instanceof n}},KI=class n extends bi{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){let t=dk(this,e,!0),r=this.Lu.map(s=>Po(s,t)),i=new Ti(r);return new To(e.path,i)}isEqual(e){return e instanceof n&&gy(this.Lu,e.Lu)}},QI=class n extends bi{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){let t=dk(this,e,!0),r=this.Lu.map(s=>Po(s,t)),i=new Di(r);return new To(e.path,i)}isEqual(e){return e instanceof n&&gy(this.Lu,e.Lu)}},YI=class n extends bi{constructor(e,t){super(e),this.Bu=t}_toFieldTransform(e){let t=new gs(e.serializer,YN(e.serializer,this.Bu));return new To(e.path,t)}isEqual(e){return e instanceof n&&this.Bu===e.Bu}};function OC(n,e,t,r){let i=n.Nu(1,e,t);LC("Data must be an object, but it was:",i,r);let s=[],o=sn.empty();Mo(r,(c,l)=>{let d=VC(e,c,t);l=ce(l);let f=i.Cu(d);if(l instanceof id)s.push(d);else{let g=Po(l,f);g!=null&&(s.push(d),o.set(d,g))}});let a=new Vn(s);return new Ig(o,a,i.fieldTransforms)}function FC(n,e,t,r,i,s){let o=n.Nu(1,e,t),a=[ZI(e,r,t)],c=[i];if(s.length%2!=0)throw new L(P.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<s.length;g+=2)a.push(ZI(e,s[g])),c.push(s[g+1]);let l=[],d=sn.empty();for(let g=a.length-1;g>=0;--g)if(!gk(l,a[g])){let y=a[g],v=c[g];v=ce(v);let b=o.Cu(y);if(v instanceof id)l.push(y);else{let T=Po(v,b);T!=null&&(l.push(y),d.set(y,T))}}let f=new Vn(l);return new Ig(d,f,o.fieldTransforms)}function hk(n,e,t,r=!1){return Po(t,n.Nu(r?4:3,e))}function Po(n,e){if(pk(n=ce(n)))return LC("Unsupported field value:",e,n),fk(n,e);if(n instanceof bi)return function(r,i){if(!lk(i.wu))throw i.Mu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Mu(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Du&&e.wu!==4)throw e.Mu("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let a of r){let c=Po(a,i.Fu(o));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=ce(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return YN(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=lt.fromDate(r);return{timestampValue:lc(i.serializer,s)}}if(r instanceof lt){let s=new lt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:lc(i.serializer,s)}}if(r instanceof Ao)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Qr)return{bytesValue:oP(i.serializer,r._byteString)};if(r instanceof Je){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Mu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:hC(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof rd)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(c=>{if(typeof c!="number")throw a.Mu("VectorValues must only contain numeric values.");return dC(a.serializer,c)})}}}}}}(r,i);throw i.Mu(`Unsupported field value: ${Og(r)}`)}(n,e)}function fk(n,e){let t={};return NN(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Mo(n,(r,i)=>{let s=Po(i,e.bu(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function pk(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof lt||n instanceof Ao||n instanceof Qr||n instanceof Je||n instanceof bi||n instanceof rd)}function LC(n,e,t){if(!pk(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let r=Og(t);throw r==="an object"?e.Mu(n+" a custom object"):e.Mu(n+" "+r)}}function ZI(n,e,t){if((e=ce(e))instanceof yr)return e._internalPath;if(typeof e=="string")return VC(n,e);throw Tg("Field path arguments must be of type string or ",n,!1,void 0,t)}var eG=new RegExp("[~\\*/\\[\\]]");function VC(n,e,t){if(e.search(eG)>=0)throw Tg(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new yr(...e.split("."))._internalPath}catch{throw Tg(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Tg(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new L(P.INVALID_ARGUMENT,a+n+c)}function gk(n,e){return n.some(t=>t.isEqual(e))}var xo=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Je(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new XI(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Lg("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},XI=class extends xo{data(){return super.data()}};function Lg(n,e){return typeof e=="string"?VC(n,e):e instanceof yr?e._internalPath:e._delegate._internalPath}function mk(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new L(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var sd=class{},Ro=class extends sd{};function xi(n,e,...t){let r=[];e instanceof sd&&r.push(e),r=r.concat(t),function(s){let o=s.filter(c=>c instanceof JI).length,a=s.filter(c=>c instanceof Dg).length;if(o>1||o>0&&a>0)throw new L(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var Dg=class n extends Ro{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return bk(e._query,t),new Yt(e.firestore,e.converter,AE(e._query,t))}_parse(e){let t=No(e.firestore);return function(s,o,a,c,l,d,f){let g;if(l.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new L(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){_N(f,d);let y=[];for(let v of f)y.push(yN(c,s,v));g={arrayValue:{values:y}}}else g=yN(c,s,f)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||_N(f,d),g=hk(a,o,f,d==="in"||d==="not-in");return Me.create(l,d,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function yk(n,e,t){let r=e,i=Lg("where",n);return Dg._create(i,r,t)}var JI=class n extends sd{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:qe.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i,a=s.getFlattenedFilters();for(let c of a)bk(o,c),o=AE(o,c)}(e._query,t),new Yt(e.firestore,e.converter,AE(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var eC=class n extends Ro{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(i,s,o){if(i.startAt!==null)throw new L(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new L(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Io(s,o)}(e._query,this._field,this._direction);return new Yt(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new gr(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function _k(n,e="asc"){let t=e,r=Lg("orderBy",n);return eC._create(r,t)}var bg=class n extends Ro{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new Yt(e.firestore,e.converter,zp(e._query,this._limit,this._limitType))}};function vk(n){return QP("limit",n),bg._create("limit",n,"F")}function wk(n){return QP("limitToLast",n),bg._create("limitToLast",n,"L")}var Sg=class n extends Ro{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=Dk(e,this.type,this._docOrFields,this._inclusive);return new Yt(e.firestore,e.converter,function(i,s){return new gr(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};function Ek(...n){return Sg._create("startAt",n,!0)}function Ik(...n){return Sg._create("startAfter",n,!1)}var Ag=class n extends Ro{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=Dk(e,this.type,this._docOrFields,this._inclusive);return new Yt(e.firestore,e.converter,function(i,s){return new gr(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};function Ck(...n){return Ag._create("endBefore",n,!1)}function Tk(...n){return Ag._create("endAt",n,!0)}function Dk(n,e,t,r){if(t[0]=ce(t[0]),t[0]instanceof xo)return function(s,o,a,c,l){if(!c)throw new L(P.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let d=[];for(let f of nc(s))if(f.field.isKeyField())d.push(Eo(o,c.key));else{let g=c.data.field(f.field);if(Rg(g))throw new L(P.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){let y=f.field.canonicalString();throw new L(P.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}d.push(g)}return new Wr(d,l)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=No(n.firestore);return function(o,a,c,l,d,f){let g=o.explicitOrderBy;if(d.length>g.length)throw new L(P.INVALID_ARGUMENT,`Too many arguments provided to ${l}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let y=[];for(let v=0;v<d.length;v++){let b=d[v];if(g[v].field.isKeyField()){if(typeof b!="string")throw new L(P.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${l}(), but got a ${typeof b}`);if(!uC(o)&&b.indexOf("/")!==-1)throw new L(P.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${l}() must be a plain document ID, but '${b}' contains a slash.`);let T=o.path.child(Oe.fromString(b));if(!H.isDocumentKey(T))throw new L(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${l}() must result in a valid document path, but '${T}' is not because it contains an odd number of segments.`);let V=new H(T);y.push(Eo(a,V))}else{let T=hk(c,l,b);y.push(T)}}return new Wr(y,f)}(n._query,n.firestore._databaseId,i,e,t,r)}}function yN(n,e,t){if(typeof(t=ce(t))=="string"){if(t==="")throw new L(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!uC(e)&&t.indexOf("/")!==-1)throw new L(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(Oe.fromString(t));if(!H.isDocumentKey(r))throw new L(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Eo(n,new H(r))}if(t instanceof Je)return Eo(n,t._key);throw new L(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Og(t)}.`)}function _N(n,e){if(!Array.isArray(n)||n.length===0)throw new L(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function bk(n,e){let t=function(i,s){for(let o of i)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new L(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new L(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var wc=class{convertValue(e,t="none"){switch(wo(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ot(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ds(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw W()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Mo(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>ot(o.doubleValue));return new rd(s)}convertGeoPoint(e){return new Ao(ot(e.latitude),ot(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=aC(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(jl(e));default:return null}}convertTimestamp(e){let t=Ci(e);return new lt(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=Oe.fromString(e);te(yP(r));let i=new hs(r.get(1),r.get(3)),s=new H(r.popFirst(5));return i.isEqual(t)||Et(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Vg(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var tC=class extends wc{constructor(e){super(),this.firestore=e}convertBytes(e){return new Qr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Je(this.firestore,null,t)}};var Ii=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},tr=class extends xo{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new cs(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(Lg("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},cs=class extends tr{data(e={}){return super.data(e)}},_r=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Ii(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new cs(this._firestore,this._userDataWriter,r.key,r,new Ii(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new L(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let c=new cs(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Ii(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let c=new cs(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Ii(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),l=-1,d=-1;return a.type!==0&&(l=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:tG(a.type),doc:c,oldIndex:l,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function tG(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return W()}}function UC(n,e){return n instanceof tr&&e instanceof tr?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof _r&&e instanceof _r&&n._firestore===e._firestore&&kC(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function Sk(n){n=Fe(n,Je);let e=Fe(n.firestore,at);return GP(Ft(e),n._key).then(t=>qC(e,n,t))}var Si=class extends wc{constructor(e){super(),this.firestore=e}convertBytes(e){return new Qr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Je(this.firestore,null,t)}};function Ak(n){n=Fe(n,Je);let e=Fe(n.firestore,at),t=Ft(e),r=new Si(e);return Kz(t,n._key).then(i=>new tr(e,r,n._key,i,new Ii(i!==null&&i.hasLocalMutations,!0),n.converter))}function xk(n){n=Fe(n,Je);let e=Fe(n.firestore,at);return GP(Ft(e),n._key,{source:"server"}).then(t=>qC(e,n,t))}function Rk(n){n=Fe(n,Yt);let e=Fe(n.firestore,at),t=Ft(e),r=new Si(e);return mk(n._query),WP(t,n._query).then(i=>new _r(e,r,n,i))}function Mk(n){n=Fe(n,Yt);let e=Fe(n.firestore,at),t=Ft(e),r=new Si(e);return Qz(t,n._query).then(i=>new _r(e,r,n,i))}function Nk(n){n=Fe(n,Yt);let e=Fe(n.firestore,at),t=Ft(e),r=new Si(e);return WP(t,n._query,{source:"server"}).then(i=>new _r(e,r,n,i))}function jC(n,e,t){n=Fe(n,Je);let r=Fe(n.firestore,at),i=Vg(n.converter,e,t);return Sc(r,[Fg(No(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,gt.none())])}function BC(n,e,t,...r){n=Fe(n,Je);let i=Fe(n.firestore,at),s=No(i),o;return o=typeof(e=ce(e))=="string"||e instanceof yr?FC(s,"updateDoc",n._key,e,t,r):OC(s,"updateDoc",n._key,e),Sc(i,[o.toMutation(n._key,gt.exists(!0))])}function Pk(n){return Sc(Fe(n.firestore,at),[new ys(n._key,gt.none())])}function kk(n,e){let t=Fe(n.firestore,at),r=hd(n),i=Vg(n.converter,e);return Sc(t,[Fg(No(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,gt.exists(!1))]).then(()=>r)}function $C(n,...e){var t,r,i;n=ce(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||qI(e[o])||(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(qI(e[o])){let f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(i=f.complete)===null||i===void 0?void 0:i.bind(f)}let c,l,d;if(n instanceof Je)l=Fe(n.firestore,at),d=Ic(n._key.path),c={next:f=>{e[o]&&e[o](qC(l,n,f))},error:e[o+1],complete:e[o+2]};else{let f=Fe(n,Yt);l=Fe(f.firestore,at),d=f._query;let g=new Si(l);c={next:y=>{e[o]&&e[o](new _r(l,g,f,y))},error:e[o+1],complete:e[o+2]},mk(n._query)}return function(g,y,v,b){let T=new _c(b),V=new ed(y,T,v);return g.asyncQueue.enqueueAndForget(()=>M(this,null,function*(){return vC(yield vc(g),V)})),()=>{T.za(),g.asyncQueue.enqueueAndForget(()=>M(this,null,function*(){return wC(yield vc(g),V)}))}}(Ft(l),d,a,c)}function Ok(n,e){return Yz(Ft(n=Fe(n,at)),qI(e)?e:{next:e})}function Sc(n,e){return function(r,i){let s=new Nt;return r.asyncQueue.enqueueAndForget(()=>M(this,null,function*(){return xz(yield xC(r),i,s)})),s.promise}(Ft(n),e)}function qC(n,e,t){let r=t.docs.get(e._key),i=new Si(n);return new tr(n,i,e._key,r,new Ii(t.hasPendingWrites,t.fromCache),e.converter)}var nG={maxAttempts:5};var xg=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=No(e)}set(e,t,r){this._verifyNotCommitted();let i=os(e,this._firestore),s=Vg(i.converter,t,r),o=Fg(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,gt.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=os(e,this._firestore),o;return o=typeof(t=ce(t))=="string"||t instanceof yr?FC(this._dataReader,"WriteBatch.update",s._key,t,r,i):OC(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,gt.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=os(e,this._firestore);return this._mutations=this._mutations.concat(new ys(t._key,gt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new L(P.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function os(n,e){if((n=ce(n)).firestore!==e)throw new L(P.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var nC=class extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=No(t)}get(t){let r=os(t,this._firestore),i=new tC(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return W();let o=s[0];if(o.isFoundDocument())return new xo(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new xo(this._firestore,i,r._key,null,r.converter);throw W()})}set(t,r,i){let s=os(t,this._firestore),o=Vg(s.converter,r,i),a=Fg(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,a),this}update(t,r,i,...s){let o=os(t,this._firestore),a;return a=typeof(r=ce(r))=="string"||r instanceof yr?FC(this._dataReader,"Transaction.update",o._key,r,i,s):OC(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){let r=os(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=os(e,this._firestore),r=new Si(this._firestore);return super.get(e).then(i=>new tr(this._firestore,r,t._key,i._document,new Ii(!1,!1),t.converter))}};function Fk(n,e,t){n=Fe(n,at);let r=Object.assign(Object.assign({},nG),t);return function(s){if(s.maxAttempts<1)throw new L(P.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){let c=new Nt;return s.asyncQueue.enqueueAndForget(()=>M(this,null,function*(){let l=yield zz(s);new UI(s.asyncQueue,l,a,o,c).ru()})),c.promise}(Ft(n),i=>e(new nC(n,i)),r)}function Lk(){return new id("deleteField")}function Vk(){return new WI("serverTimestamp")}function Uk(...n){return new KI("arrayUnion",n)}function jk(...n){return new QI("arrayRemove",n)}function Bk(n){return new YI("increment",n)}(function(e,t=!0){(function(i){Ec=i})(ia),ai(new Gt("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new at(new sE(r.getProvider("auth-internal")),new uE(r.getProvider("app-check-internal")),function(l,d){if(!Object.prototype.hasOwnProperty.apply(l.options,["projectId"]))throw new L(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new hs(l.options.projectId,d)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),In(yM,"4.7.1",e),In(yM,"4.7.1","esm2017")})();var rG="@firebase/firestore-compat",iG="0.3.36";function QC(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new L("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function $k(){if(typeof Uint8Array>"u")throw new L("unimplemented","Uint8Arrays are not available in this environment.")}function qk(){if(!PN())throw new L("unimplemented","Blobs are unavailable in Firestore in this environment.")}var Ug=class n{constructor(e){this._delegate=e}static fromBase64String(e){return qk(),new n(Qr.fromBase64String(e))}static fromUint8Array(e){return $k(),new n(Qr.fromUint8Array(e))}toBase64(){return qk(),this._delegate.toBase64()}toUint8Array(){return $k(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function HC(n){return sG(n,["next","error","complete"])}function sG(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var zC=class{enableIndexedDbPersistence(e,t){return ek(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return tk(e._delegate)}clearIndexedDbPersistence(e){return rk(e._delegate)}},jg=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof hs||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Jn("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){YP(this._delegate,e,t,r)}enableNetwork(){return sk(this._delegate)}disableNetwork(){return ok(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,MC("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return ik(this._delegate)}onSnapshotsInSync(e){return Ok(this._delegate,e)}get app(){if(!this._appCompat)throw new L("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Rc(this,NC(this._delegate,e))}catch(t){throw pn(t,"collection()","Firestore.collection()")}}doc(e){try{return new Yr(this,hd(this._delegate,e))}catch(t){throw pn(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Lo(this,ZP(this._delegate,e))}catch(t){throw pn(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return Fk(this._delegate,t=>e(new Bg(this,t)))}batch(){return Ft(this._delegate),new $g(new xg(this._delegate,e=>Sc(this._delegate,e)))}loadBundle(e){return ak(this._delegate,e)}namedQuery(e){return ck(this._delegate,e).then(t=>t?new Lo(this,t):null)}},Ac=class extends wc{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ug(new Qr(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return Yr.forKey(t,this.firestore,null)}};function oG(n){wN(n)}var Bg=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Ac(e)}get(e){let t=ko(e);return this._delegate.get(t).then(r=>new Oo(this._firestore,new tr(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=ko(e);return r?(QC("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=ko(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=ko(e);return this._delegate.delete(t),this}},$g=class{constructor(e){this._delegate=e}set(e,t,r){let i=ko(e);return r?(QC("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=ko(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=ko(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},xc=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new cs(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Fo(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new Ac(e),t),i.set(t,s)),s}};xc.INSTANCES=new WeakMap;var Yr=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ac(e)}static forPath(e,t,r){if(e.length%2!==0)throw new L("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new Je(t._delegate,r,new H(e)))}static forKey(e,t,r){return new n(t,new Je(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Rc(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Rc(this.firestore,NC(this._delegate,e))}catch(t){throw pn(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=ce(e),e instanceof Je?PC(this._delegate,e):!1}set(e,t){t=QC("DocumentReference.set",t);try{return t?jC(this._delegate,e,t):jC(this._delegate,e)}catch(r){throw pn(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?BC(this._delegate,e):BC(this._delegate,e,t,...r)}catch(i){throw pn(i,"updateDoc()","DocumentReference.update()")}}delete(){return Pk(this._delegate)}onSnapshot(...e){let t=Hk(e),r=zk(e,i=>new Oo(this.firestore,new tr(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return $C(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=Ak(this._delegate):e?.source==="server"?t=xk(this._delegate):t=Sk(this._delegate),t.then(r=>new Oo(this.firestore,new tr(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(xc.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function pn(n,e,t){return n.message=n.message.replace(e,t),n}function Hk(n){for(let e of n)if(typeof e=="object"&&!HC(e))return e;return{}}function zk(n,e){var t,r;let i;return HC(n[0])?i=n[0]:HC(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Oo=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Yr(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return UC(this._delegate,e._delegate)}},Fo=class extends Oo{data(e){let t=this._delegate.data(e);return this._delegate._converter||EN(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},Lo=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ac(e)}where(e,t,r){try{return new n(this.firestore,xi(this._delegate,yk(e,t,r)))}catch(i){throw pn(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,xi(this._delegate,_k(e,t)))}catch(r){throw pn(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,xi(this._delegate,vk(e)))}catch(t){throw pn(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,xi(this._delegate,wk(e)))}catch(t){throw pn(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,xi(this._delegate,Ek(...e)))}catch(t){throw pn(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,xi(this._delegate,Ik(...e)))}catch(t){throw pn(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,xi(this._delegate,Ck(...e)))}catch(t){throw pn(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,xi(this._delegate,Tk(...e)))}catch(t){throw pn(t,"endAt()","Query.endAt()")}}isEqual(e){return kC(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=Mk(this._delegate):e?.source==="server"?t=Nk(this._delegate):t=Rk(this._delegate),t.then(r=>new fd(this.firestore,new _r(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=Hk(e),r=zk(e,i=>new fd(this.firestore,new _r(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return $C(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(xc.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},GC=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Fo(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},fd=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Lo(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Fo(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new GC(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Fo(this._firestore,r))})}isEqual(e){return UC(this._delegate,e._delegate)}},Rc=class n extends Lo{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new Yr(this.firestore,e):null}doc(e){try{return e===void 0?new Yr(this.firestore,hd(this._delegate)):new Yr(this.firestore,hd(this._delegate,e))}catch(t){throw pn(t,"doc()","CollectionReference.doc()")}}add(e){return kk(this._delegate,e).then(t=>new Yr(this.firestore,t))}isEqual(e){return PC(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(xc.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function ko(n){return Fe(n,Je)}var WC=class n{constructor(...e){this._delegate=new yr(...e)}static documentId(){return new n(It.keyField().canonicalString())}isEqual(e){return e=ce(e),e instanceof yr?this._delegate._internalPath.isEqual(e._internalPath):!1}};var KC=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=Vk();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=Lk();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=Uk(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=jk(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=Bk(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var aG={Firestore:jg,GeoPoint:Ao,Timestamp:lt,Blob:Ug,Transaction:Bg,WriteBatch:$g,DocumentReference:Yr,DocumentSnapshot:Oo,Query:Lo,QueryDocumentSnapshot:Fo,QuerySnapshot:fd,CollectionReference:Rc,FieldPath:WC,FieldValue:KC,setLogLevel:oG,CACHE_SIZE_UNLIMITED:XP};function cG(n,e){n.INTERNAL.registerComponent(new Gt("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},aG)))}function uG(n){cG(n,(e,t)=>new jg(e,t,new zC)),n.registerVersion(rG,iG)}uG(pt);function lG(n,e=ui){return new ve(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function Gk(n,e){return lG(n,e)}function dG(n,e){return Gk(n,e).pipe(zs(void 0),Su(),ee(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function XC(n,e){return Gk(n,e).pipe(ee(t=>({payload:t,type:"query"})))}var qg=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=Zk(r,t);return new zg(i,s,this.afs)}snapshotChanges(){return dG(this.ref,this.afs.schedulers.outsideAngular).pipe(st)}valueChanges(e={}){return this.snapshotChanges().pipe(ee(({payload:t})=>e.idField?nt(Q({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return xe(this.ref.get(e)).pipe(st)}};function Hg(n,e){return XC(n,e).pipe(zs(void 0),Su(),ee(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,c)=>{let l=s.find(f=>f.doc.ref.isEqual(a.ref)),d=r?.payload.docs.find(f=>f.ref.isEqual(a.ref));l&&JSON.stringify(l.doc.metadata)===JSON.stringify(a.metadata)||!l&&d&&JSON.stringify(d.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:c,newIndex:c,type:"modified",doc:a}})}),o}))}function Wk(n,e,t){return Hg(n,t).pipe(Dr((r,i)=>hG(r,i.map(s=>s.payload),e),[]),Du(),ee(r=>r.map(i=>({type:i.type,payload:i}))))}function hG(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=fG(n,r))}),n}function YC(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function fG(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return YC(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return YC(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return YC(n,e.oldIndex,1);break}return n}function Kk(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var zg=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=Hg(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(ee(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(zs(void 0),Su(),Qt(([r,i])=>i.length>0||!r),ee(([,r])=>r),st)}auditTrail(e){return this.stateChanges(e).pipe(Dr((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=Kk(e);return Wk(this.query,t,this.afs.schedulers.outsideAngular).pipe(st)}valueChanges(e={}){return XC(this.query,this.afs.schedulers.outsideAngular).pipe(ee(t=>t.payload.docs.map(r=>e.idField?nt(Q({},r.data()),{[e.idField]:r.id}):r.data())),st)}get(e){return xe(this.query.get(e)).pipe(st)}add(e){return this.ref.add(e)}doc(e){return new qg(this.ref.doc(e),this.afs)}},ZC=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?Hg(this.query,this.afs.schedulers.outsideAngular).pipe(st):Hg(this.query,this.afs.schedulers.outsideAngular).pipe(ee(t=>t.filter(r=>e.indexOf(r.type)>-1)),Qt(t=>t.length>0),st)}auditTrail(e){return this.stateChanges(e).pipe(Dr((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=Kk(e);return Wk(this.query,t,this.afs.schedulers.outsideAngular).pipe(st)}valueChanges(e={}){return XC(this.query,this.afs.schedulers.outsideAngular).pipe(ee(r=>r.payload.docs.map(i=>e.idField?Q({[e.idField]:i.id},i.data()):i.data())),st)}get(e){return xe(this.query.get(e)).pipe(st)}},Qk=new K("angularfire2.enableFirestorePersistence"),Yk=new K("angularfire2.firestore.persistenceSettings"),pG=new K("angularfire2.firestore.settings"),gG=new K("angularfire2.firestore.use-emulator");function Zk(n,e=t=>t){return{query:e(n),ref:n}}var JC=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,c,l,d,f,g,y,v,b,T,V,B){this.schedulers=c;let O=vi(t,a,r),z=d;f&&Tl(O,a,g,v,b,T,y,V),[this.firestore,this.persistenceEnabled$]=ts(`${O.name}.firestore`,"AngularFirestore",O.name,()=>{let re=a.runOutsideAngular(()=>O.firestore());if(s&&re.settings(s),z&&re.useEmulator(...z),i&&!ao(o)){let Z=()=>{try{return xe(re.enablePersistence(l||void 0).then(()=>!0,()=>!1))}catch(I){return typeof console<"u"&&console.warn(I),ne(!1)}};return[re,a.runOutsideAngular(Z)]}else return[re,ne(!1)]},[s,z,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=Zk(i,r),a=this.schedulers.ngZone.run(()=>s);return new zg(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new ZC(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new qg(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(F(Ur),F(jr,8),F(Qk,8),F(pG,8),F(jt),F(De),F(Ji),F(Yk,8),F(gG,8),F(Ep,8),F(_l,8),F(vl,8),F(wl,8),F(El,8),F(Il,8),F(Cl,8),F(fr,8))};static \u0275prov=J({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),Xk=(()=>{class n{constructor(){pt.registerVersion("angularfire",Vr.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:Qk,useValue:!0},{provide:Yk,useValue:t}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=wt({type:n});static \u0275inj=vt({providers:[JC]})}return n})();var yG=n=>({color:n});function _G(n,e){if(n&1&&(Re(0,"li",11)(1,"span",12),Xe(2),be(),Re(3,"span",13),Xe(4),be(),Re(5,"span",14),Xe(6),be()()),n&2){let t=e.$implicit,r=e.index;dn(2),Or(r+1),dn(2),Or(t.score.player),dn(2),Or(t.score.score)}}function vG(n,e){if(n&1&&(Re(0,"ul",9),ro(1,_G,7,3,"li",10),be()),n&2){let t=e.ngIf;dn(),Ki("ngForOf",t.slice(0,3))}}function wG(n,e){if(n&1&&(Re(0,"li",16)(1,"span",12),Xe(2),be(),Re(3,"span",13),Xe(4),be(),Re(5,"span",14),Xe(6),be()()),n&2){let t=e.$implicit,r=e.index,i=yv(2);Ki("ngStyle",Tx(4,yG,i.getBackgroundColor(r))),dn(2),Or(r+4),dn(2),Or(t.score.player),dn(2),Or(t.score.score)}}function EG(n,e){if(n&1&&(Re(0,"ul",9),ro(1,wG,7,6,"li",15),be()),n&2){let t=e.ngIf;dn(),Ki("ngForOf",t.slice(3))}}function IG(n,e){n&1&&(Re(0,"p"),Xe(1,"Loading..."),be())}function CG(n,e){if(n&1&&(Re(0,"div",17)(1,"div",18)(2,"h3"),Xe(3,"New Score!"),be(),Re(4,"div",12),Xe(5),be(),Re(6,"div",19)(7,"span",20),Xe(8,"Player:"),be(),Re(9,"span",21),Xe(10),be()(),Re(11,"div",19)(12,"span",20),Xe(13,"Score:"),be(),Re(14,"span",21),Xe(15),be()()()()),n&2){let t=yv();dn(5),Bf("Rank: ",t.alertData.rank,""),dn(5),Or(t.alertData.player),dn(5),Or(t.alertData.score)}}var Jk=(()=>{let e=class e{constructor(r){this.firestore=r,this.previousScores=[],this.colors=["#7f00ff","#0000ff","#007fff","#00ffff","#00ff7f","#00ff00","#7fff00","#ffff00","#ff7f00","#ff0000"],this.newScoreAlert=null,this.alertData=null,this.scores$=this.firestore.collection("scoreboard",i=>i.orderBy("score","desc")).snapshotChanges().pipe(ee(i=>i.map(s=>{let o=s.payload.doc.data();return{id:s.payload.doc.id,score:o}})))}ngOnInit(){this.scores$.subscribe(r=>{if(this.previousScores.length===0){this.previousScores=r;return}let i=r.filter(s=>!this.previousScores.some(o=>o.id===s.id));if(i.length>0){let s=[...r];s.sort((o,a)=>a.score.score-o.score.score),i.forEach(o=>{let a=s.findIndex(c=>c.id===o.id)+1;this.showAlert(o.score,a),a<=3&&this.triggerConfetti()})}this.previousScores=r},r=>{console.error("Error fetching scores:",r)})}getBackgroundColor(r){return this.colors[r%this.colors.length]}showAlert(r,i){this.alertData={player:r.player,score:r.score,rank:i},this.newScoreAlert="New High Score!",this.alertTimeout&&clearTimeout(this.alertTimeout),this.alertTimeout=setTimeout(()=>{this.newScoreAlert=null,this.alertData=null},4e3)}closeAlert(){this.newScoreAlert=null,this.alertData=null,this.alertTimeout&&clearTimeout(this.alertTimeout)}triggerConfetti(){kw({particleCount:100,spread:70,origin:{x:.2,y:1},colors:["#ff0000","#00ff00","#0000ff","#ffff00"]}),kw({particleCount:100,spread:70,origin:{x:.8,y:1},colors:["#ff0000","#00ff00","#0000ff","#ffff00"]})}};e.\u0275fac=function(i){return new(i||e)(tn(JC))},e.\u0275cmp=Yn({type:e,selectors:[["app-scoreboard"]],decls:22,vars:9,consts:[["loading",""],[1,"scoreboard-container"],[1,"header"],[1,"header-rank"],[1,"header-player"],[1,"header-score"],[1,"fixed"],["class","scrollable-list",4,"ngIf","ngIfElse"],["class","overlay",4,"ngIf"],[1,"scrollable-list"],["class","top3",4,"ngFor","ngForOf"],[1,"top3"],[1,"rank"],[1,"player"],[1,"score"],[3,"ngStyle",4,"ngFor","ngForOf"],[3,"ngStyle"],[1,"overlay"],[1,"overlay-content"],[1,"alert-item"],[1,"alert-key"],[1,"alert-value"]],template:function(i,s){if(i&1&&(Re(0,"h1"),Xe(1,"GAMESP32"),be(),Re(2,"p"),Xe(3,"by David Gianadda"),be(),Re(4,"h2"),Xe(5,"Scoreboard"),be(),Re(6,"div",1)(7,"div",2)(8,"span",3),Xe(9,"Rank"),be(),Re(10,"span",4),Xe(11,"Player"),be(),Re(12,"span",5),Xe(13,"Score"),be()(),Re(14,"div",6),ro(15,vG,2,1,"ul",7),_v(16,"async"),be(),ro(17,EG,2,1,"ul",7),_v(18,"async"),be(),ro(19,IG,2,0,"ng-template",null,0,bx)(21,CG,16,3,"div",8)),i&2){let o=Ix(20);dn(15),Ki("ngIf",vv(16,5,s.scores$))("ngIfElse",o),dn(2),Ki("ngIf",vv(18,7,s.scores$))("ngIfElse",o),dn(4),Ki("ngIf",s.alertData)}},dependencies:[Wx,Kx,Qx,Yx],styles:['@font-face{font-family:"Press Start 2P";font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/pressstart2p/v15/e3t4euO8T-267oIAQAu6jDQyK3nYivN04w.woff2) format("woff2");unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:"Press Start 2P";font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/pressstart2p/v15/e3t4euO8T-267oIAQAu6jDQyK3nRivN04w.woff2) format("woff2");unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:"Press Start 2P";font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/pressstart2p/v15/e3t4euO8T-267oIAQAu6jDQyK3nWivN04w.woff2) format("woff2");unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:"Press Start 2P";font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/pressstart2p/v15/e3t4euO8T-267oIAQAu6jDQyK3nbivN04w.woff2) format("woff2");unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:"Press Start 2P";font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/pressstart2p/v15/e3t4euO8T-267oIAQAu6jDQyK3nVivM.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}[_nghost-%COMP%]{display:block;font-family:"Press Start 2P",cursive;background:#000;color:#fff;text-align:center;padding:90px 20px 20px;margin:20px}h1[_ngcontent-%COMP%]{font-size:72px;padding:0;color:#fff;text-shadow:4px 4px 0 #343434;letter-spacing:1px}p[_ngcontent-%COMP%]{margin-top:-10px;padding-bottom:20px;align-self:flex-end;text-align:right;font-size:small}h2[_ngcontent-%COMP%]{font-size:large;padding-bottom:0;color:#fff;text-shadow:1px 1px 0 #000;letter-spacing:1px}.scoreboard-container[_ngcontent-%COMP%]{display:inline-block;width:80%;max-width:800px;text-align:left}.header[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 3fr 2fr;margin-bottom:10px;font-size:large;font-weight:700;color:#ff0;border-bottom:2px solid #ffff00;padding-bottom:5px}.header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding:5px 10px}ul[_ngcontent-%COMP%]{list-style-type:none;padding:0;margin:0;max-height:400px;overflow-y:scroll;scrollbar-width:thin;scrollbar-color:transparent transparent}ul[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;background:transparent}ul[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:transparent}.fixed[_ngcontent-%COMP%]{position:sticky;top:0;background:#000000e6;z-index:1}li[_ngcontent-%COMP%]{font-size:1em;margin:5px 0;padding:5px 10px;border-radius:5px;border:solid 2px;display:grid;grid-template-columns:1fr 3fr 2fr;align-items:center;background:#000000b3}.top3[_ngcontent-%COMP%]:nth-child(1){color:gold!important;border:5px solid;font-weight:700}.top3[_ngcontent-%COMP%]:nth-child(2){color:silver!important;border:5px solid;font-weight:700}.top3[_ngcontent-%COMP%]:nth-child(3){color:#cd7f32!important;border:5px solid;font-weight:700}.rank[_ngcontent-%COMP%], .player[_ngcontent-%COMP%], .score[_ngcontent-%COMP%]{padding:5px}ng-template[_ngcontent-%COMP%]{color:#fff;font-size:1em}.overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#000c;display:flex;align-items:center;justify-content:center;z-index:1000;transition:opacity .5s ease-out}.overlay-content[_ngcontent-%COMP%]{background:#000;border:2px solid #fff;padding:20px;border-radius:8px;color:#fff;text-align:center;box-shadow:0 0 15px #00000080;max-width:400px;width:100%}.overlay-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 20px;font-size:1.5em}.overlay-content[_ngcontent-%COMP%]   .alert-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:15px;font-size:1.2em}.overlay-content[_ngcontent-%COMP%]   .alert-key[_ngcontent-%COMP%]{font-weight:700}.overlay-content[_ngcontent-%COMP%]   .alert-value[_ngcontent-%COMP%]{font-weight:400}.overlay-content[_ngcontent-%COMP%]   .rank[_ngcontent-%COMP%]{font-size:1.4em;color:red;font-weight:700;margin-bottom:15px}.overlay-content[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border:none;border-radius:4px;padding:10px 20px;cursor:pointer}.overlay-content[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#0056b3}@media (max-width: 1100px){[_nghost-%COMP%]{padding-top:0}p[_ngcontent-%COMP%]{margin-top:-20px;padding-bottom:20px;align-self:flex-end;text-align:right;font-size:small}.header[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 3fr 2fr;margin-bottom:10px;font-size:x-small;font-weight:700;color:#ff0;border-bottom:2px solid #ffff00;padding-bottom:5px}}']});let n=e;return n})();var eO=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Yn({type:e,selectors:[["app-linked-in-qr"]],decls:4,vars:0,consts:[[1,"left-section"],["src","assets/LinkdIn.png","alt","LinkedIn QR Code",1,"qr-code"]],template:function(i,s){i&1&&(Re(0,"div",0)(1,"h3"),Xe(2,"Connect on LinkedIn"),be(),kn(3,"img",1),be())},styles:['.left-section[_ngcontent-%COMP%]{text-align:center;padding:6px;border:4px solid #0072b1;border-radius:6px}.qr-code[_ngcontent-%COMP%]{width:150px;height:150px;margin:12px}.left-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#0072b1;font-family:"Press Start 2P",sans-serif;margin:12px}']});let n=e;return n})();var tO=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Yn({type:e,selectors:[["app-self-link"]],decls:4,vars:0,consts:[[1,"right-section"],["src","assets/Scoreboard.png","alt","LinkedIn QR Code",1,"qr-code"]],template:function(i,s){i&1&&(Re(0,"div",0)(1,"h3"),Xe(2,"Track your Rank!"),be(),kn(3,"img",1),be())},styles:['.right-section[_ngcontent-%COMP%]{text-align:center;padding:6px;border:4px solid red;border-radius:6px}.right-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:red;font-family:"Press Start 2P",sans-serif;margin:12px}.qr-code[_ngcontent-%COMP%]{width:150px;height:150px;margin:12px}']});let n=e;return n})();var nO=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Yn({type:e,selectors:[["app-github-qr"]],decls:4,vars:0,consts:[[1,"right-section"],["src","assets/Github.png","alt","LinkedIn QR Code",1,"qr-code"]],template:function(i,s){i&1&&(Re(0,"div",0),kn(1,"img",1),Re(2,"h3"),Xe(3,"More Games on my Github"),be()())},styles:['.right-section[_ngcontent-%COMP%]{text-align:center;padding:6px;border:4px solid green;border-radius:6px}.right-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:green;font-family:"Press Start 2P",sans-serif;margin:12px}.qr-code[_ngcontent-%COMP%]{width:150px;height:150px;margin:12px}']});let n=e;return n})();var rO=(()=>{let e=class e{constructor(){this.title="snake-like-scoreboard"}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Yn({type:e,selectors:[["app-root"]],decls:8,vars:0,consts:[[1,"main-container"],[1,"left-section"],[1,"center-section"],[1,"right-section"]],template:function(i,s){i&1&&(Re(0,"div",0)(1,"div",1),kn(2,"app-linked-in-qr"),be(),Re(3,"div",2),kn(4,"app-scoreboard"),be(),Re(5,"div",3),kn(6,"app-self-link")(7,"app-github-qr"),be()())},dependencies:[Jk,eO,tO,nO],styles:["html[_ngcontent-%COMP%], body[_ngcontent-%COMP%]{height:100%;margin:0}.main-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;height:100vh;padding:20px;box-sizing:border-box}.left-section[_ngcontent-%COMP%], .center-section[_ngcontent-%COMP%], .right-section[_ngcontent-%COMP%]{flex:1;height:100%}.left-section[_ngcontent-%COMP%], .right-section[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:15%}.right-section[_ngcontent-%COMP%]{flex-direction:column;justify-content:space-around}.center-section[_ngcontent-%COMP%]{text-align:center;display:flex;justify-content:center;align-items:center;width:70%}@media (max-width: 1100px){.main-container[_ngcontent-%COMP%]{flex-direction:column;align-items:center;padding:10px}.left-section[_ngcontent-%COMP%], .center-section[_ngcontent-%COMP%], .right-section[_ngcontent-%COMP%]{width:100%;height:auto;margin-bottom:20px}.center-section[_ngcontent-%COMP%]{margin-bottom:40px}}"]});let n=e;return n})();var iO={firebaseConfig:{apiKey:"AIzaSyCmoXw-iaBEYNq2BIirBdFDejx8WrwBx4M",authDomain:"gamesp32-snake-like.firebaseapp.com",projectId:"gamesp32-snake-like",storageBucket:"gamesp32-snake-like.appspot.com",messagingSenderId:"1027497563231",appId:"1:1027497563231:web:a1a253d7d08e1f9900f7ea"}};var sO="@firebase/database",oO="1.0.7";var d0="";function h0(n){d0=n}var aT=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Dt(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:_h(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var cT=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return zn(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var LO=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new aT(e)}}catch{}return new cT},Uo=LO("localStorage"),uT=LO("sessionStorage");var kc=new Fi("@firebase/database"),VO=function(){let n=1;return function(){return n++}}(),UO=function(n){let e=pb(n),t=new fb;t.update(e);let r=t.digest();return gh.encodeByteArray(r)},Ld=function(...n){let e="";for(let t=0;t<n.length;t++){let r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=Ld.apply(null,r):typeof r=="object"?e+=Dt(r):e+=r,e+=" "}return e},jo=null,aO=!0,jO=function(n,e){j(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(kc.logLevel=Gn.VERBOSE,jo=kc.log.bind(kc),e&&uT.set("logging_enabled",!0)):typeof n=="function"?jo=n:(jo=null,uT.remove("logging_enabled"))},$t=function(...n){if(aO===!0&&(aO=!1,jo===null&&uT.get("logging_enabled")===!0&&jO(!0)),jo){let e=Ld.apply(null,n);jo(e)}},Vd=function(n){return function(...e){$t(n,...e)}},lT=function(...n){let e="FIREBASE INTERNAL ERROR: "+Ld(...n);kc.error(e)},Jr=function(...n){let e=`FIREBASE FATAL ERROR: ${Ld(...n)}`;throw kc.error(e),new Error(e)},on=function(...n){let e="FIREBASE WARNING: "+Ld(...n);kc.warn(e)},AG=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&on("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},vm=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},xG=function(n){if(Cr()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Ds="[MIN_NAME]",Ri="[MAX_NAME]",$o=function(n,e){if(n===e)return 0;if(n===Ds||e===Ri)return-1;if(e===Ds||n===Ri)return 1;{let t=cO(n),r=cO(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},RG=function(n,e){return n===e?0:n<e?-1:1},pd=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Dt(e))},f0=function(n){if(typeof n!="object"||n===null)return Dt(n);let e=[];for(let r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=Dt(e[r]),t+=":",t+=f0(n[e[r]]);return t+="}",t},BO=function(n,e){let t=n.length;if(t<=e)return[n];let r=[];for(let i=0;i<t;i+=e)i+e>t?r.push(n.substring(i,t)):r.push(n.substring(i,i+e));return r};function qt(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var $O=function(n){j(!vm(n),"Invalid JSON number");let e=11,t=52,r=(1<<e-1)-1,i,s,o,a,c;n===0?(s=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),s=a+r,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-r-t))));let l=[];for(c=t;c;c-=1)l.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)l.push(s%2?1:0),s=Math.floor(s/2);l.push(i?1:0),l.reverse();let d=l.join(""),f="";for(c=0;c<64;c+=8){let g=parseInt(d.substr(c,8),2).toString(16);g.length===1&&(g="0"+g),f=f+g}return f.toLowerCase()},MG=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},NG=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function PG(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}var kG=new RegExp("^-?(0*)\\d{1,10}$"),OG=-2147483648,FG=2147483647,cO=function(n){if(kG.test(n)){let e=Number(n);if(e>=OG&&e<=FG)return e}return null},qc=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw on("Exception was thrown by user callback.",t),e},Math.floor(0))}},LG=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},_d=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var dT=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(r=>this.appCheck=r)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){on(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var hT=class{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?($t("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',on(e)}},vd=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),Wg="5",qO="v",HO="s",zO="r",GO="f",WO=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,KO="ls",QO="p",fT="ac",YO="websocket",ZO="long_polling";var Kg=class{constructor(e,t,r,i,s=!1,o="",a=!1,c=!1){this.secure=t,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Uo.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Uo.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function VG(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function XO(n,e,t){j(typeof e=="string","typeof type must == string"),j(typeof t=="object","typeof params must == object");let r;if(e===YO)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===ZO)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);VG(n)&&(t.ns=n.namespace);let i=[];return qt(t,(s,o)=>{i.push(s+"="+o)}),r+i.join("&")}var pT=class{constructor(){this.counters_={}}incrementCounter(e,t=1){zn(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return ab(this.counters_)}};var eT={},tT={};function p0(n){let e=n.toString();return eT[e]||(eT[e]=new pT),eT[e]}function UG(n,e){let t=n.toString();return tT[t]||(tT[t]=e()),tT[t]}var gT=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&qc(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var uO="start",jG="close",BG="pLPCommand",$G="pRTLPCB",JO="id",e1="pw",t1="ser",qG="cb",HG="seg",zG="ts",GG="d",WG="dframe",n1=1870,r1=30,KG=n1-r1,QG=25e3,YG=3e4,Cd=class n{constructor(e,t,r,i,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Vd(e),this.stats_=p0(t),this.urlFn=c=>(this.appCheckToken&&(c[fT]=this.appCheckToken),XO(t,ZO,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new gT(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(YG)),xG(()=>{if(this.isClosed_)return;this.scriptTagHolder=new mT((...s)=>{let[o,a,c,l,d]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===uO)this.id=a,this.password=c;else if(o===jG)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{let[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let r={};r[uO]="t",r[t1]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[qG]=this.scriptTagHolder.uniqueCallbackIdentifier),r[qO]=Wg,this.transportSessionId&&(r[HO]=this.transportSessionId),this.lastSessionId&&(r[KO]=this.lastSessionId),this.applicationId&&(r[QO]=this.applicationId),this.appCheckToken&&(r[fT]=this.appCheckToken),typeof location<"u"&&location.hostname&&WO.test(location.hostname)&&(r[zO]=GO);let i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return Cr()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!MG()&&!NG()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=Dt(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let r=ob(t),i=BO(r,KG);for(let s=0;s<i.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(Cr())return;this.myDisconnFrame=document.createElement("iframe");let r={};r[WG]="t",r[JO]=e,r[e1]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=Dt(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},mT=class n{constructor(e,t,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,Cr())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=VO(),window[BG+this.uniqueCallbackIdentifier]=e,window[$G+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){$t("frame writing exception"),a.stack&&$t(a.stack),$t(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||$t("No IE domain setting required")}catch{let r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[JO]=this.myID,e[e1]=this.myPW,e[t1]=this.currentSerial;let t=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+r1+r.length<=n1;){let o=this.pendingSegs.shift();r=r+"&"+HG+i+"="+o.seg+"&"+zG+i+"="+o.ts+"&"+GG+i+"="+o.d,i++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(r,Math.floor(QG)),s=()=>{clearTimeout(i),r()};this.addTag(e,s)}addTag(e,t){Cr()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){let i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{$t("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}};var ZG=16384,XG=45e3,Qg=null;typeof MozWebSocket<"u"?Qg=MozWebSocket:typeof WebSocket<"u"&&(Qg=WebSocket);var Nc=(()=>{class n{constructor(t,r,i,s,o,a,c){this.connId=t,this.applicationId=i,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Vd(this.connId),this.stats_=p0(r),this.connURL=n.connectionURL_(r,a,c,s,i),this.nodeAdmin=r.nodeAdmin}static connectionURL_(t,r,i,s,o){let a={};return a[qO]=Wg,!Cr()&&typeof location<"u"&&location.hostname&&WO.test(location.hostname)&&(a[zO]=GO),r&&(a[HO]=r),i&&(a[KO]=i),s&&(a[fT]=s),o&&(a[QO]=o),XO(t,YO,a)}open(t,r){this.onDisconnect=r,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Uo.set("previous_websocket_failure",!0);try{let i;if(Cr()){let s=this.nodeAdmin?"AdminNode":"Node";i={headers:{"User-Agent":`Firebase/${Wg}/${d0}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(i.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(i.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a})}this.mySock=new Qg(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let r=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(r);i&&i.length>1&&parseFloat(i[1])<4.4&&(t=!0)}return!t&&Qg!==null&&!n.forceDisallow_}static previouslyFailed(){return Uo.isInMemoryStorage||Uo.get("previous_websocket_failure")===!0}markConnectionHealthy(){Uo.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let r=this.frames.join("");this.frames=null;let i=_h(r);this.onMessage(i)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(j(this.frames===null,"We already have a frame buffer"),t.length<=6){let r=Number(t);if(!isNaN(r))return this.handleNewFrameCount_(r),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let r=t.data;if(this.bytesReceived+=r.length,this.stats_.incrementCounter("bytes_received",r.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(r);else{let i=this.extractFrameCount_(r);i!==null&&this.appendFrame_(i)}}send(t){this.resetKeepAlive();let r=Dt(t);this.bytesSent+=r.length,this.stats_.incrementCounter("bytes_sent",r.length);let i=BO(r,ZG);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(XG))}sendString_(t){try{this.mySock.send(t)}catch(r){this.log_("Exception thrown from WebSocket.send():",r.message||r.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),i1=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[Cd,Nc]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let r=Nc&&Nc.isAvailable(),i=r&&!Nc.previouslyFailed();if(t.webSocketOnly&&(r||on("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[Nc];else{let s=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),JG=6e4,e3=5e3,t3=10*1024,n3=100*1024,nT="t",lO="d",r3="s",dO="r",i3="e",hO="o",fO="a",pO="n",gO="p",s3="h",yT=class{constructor(e,t,r,i,s,o,a,c,l,d){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=l,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Vd("c:"+this.id+":"),this.transportManager_=new i1(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=_d(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>n3?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>t3?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(nT in e){let t=e[nT];t===fO?this.upgradeIfSecondaryHealthy_():t===dO?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===hO&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=pd("t",e),r=pd("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:gO,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:fO,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:pO,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=pd("t",e),r=pd("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=pd(nT,e);if(lO in e){let r=e[lO];if(t===s3){let i=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===pO){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===r3?this.onConnectionShutdown_(r):t===dO?this.onReset_(r):t===i3?lT("Server Error: "+r):t===hO?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):lT("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Wg!==r&&on("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),_d(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(JG))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):_d(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(e3))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:gO,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Uo.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var Yg=class{put(e,t,r,i){}merge(e,t,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}};var Zg=class{constructor(e){this.allowedEvents_=e,this.listeners_={},j(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});let i=this.getInitialEvent(e);i&&t.apply(r,i)}off(e,t,r){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let s=0;s<i.length;s++)if(i[s].callback===t&&(!r||r===i[s].context)){i.splice(s,1);return}}validateEventType_(e){j(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var Xg=class n extends Zg{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!fy()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new n}getInitialEvent(e){return j(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var mO=32,yO=768,Ue=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function Ve(){return new Ue("")}function we(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function bs(n){return n.pieces_.length-n.pieceNum_}function Ye(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new Ue(n.pieces_,e)}function g0(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function o3(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Td(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function s1(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new Ue(e,0)}function ct(n,e){let t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof Ue)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{let r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&t.push(r[i])}return new Ue(t,0)}function Ee(n){return n.pieceNum_>=n.pieces_.length}function gn(n,e){let t=we(n),r=we(e);if(t===null)return e;if(t===r)return gn(Ye(n),Ye(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function a3(n,e){let t=Td(n,0),r=Td(e,0);for(let i=0;i<t.length&&i<r.length;i++){let s=$o(t[i],r[i]);if(s!==0)return s}return t.length===r.length?0:t.length<r.length?-1:1}function m0(n,e){if(bs(n)!==bs(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function nr(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(bs(n)>bs(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}var _T=class{constructor(e,t){this.errorPrefix_=t,this.parts_=Td(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Eu(this.parts_[r]);o1(this)}};function c3(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Eu(e),o1(n)}function u3(n){let e=n.parts_.pop();n.byteLength_-=Eu(e),n.parts_.length>0&&(n.byteLength_-=1)}function o1(n){if(n.byteLength_>yO)throw new Error(n.errorPrefix_+"has a key path longer than "+yO+" bytes ("+n.byteLength_+").");if(n.parts_.length>mO)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+mO+") or object contains a cycle "+Vo(n))}function Vo(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var vT=class n extends Zg{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}static getInstance(){return new n}getInitialEvent(e){return j(e==="visible","Unknown event type: "+e),[this.visible_]}};var gd=1e3,l3=60*5*1e3,_O=30*1e3,d3=1.3,h3=3e4,f3="server_kill",vO=3,y0=(()=>{class n extends Yg{constructor(t,r,i,s,o,a,c,l){if(super(),this.repoInfo_=t,this.applicationId_=r,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=c,this.authOverride_=l,this.id=n.nextPersistentConnectionId_++,this.log_=Vd("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=gd,this.maxReconnectDelay_=l3,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l&&!Cr())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");vT.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&Xg.getInstance().on("online",this.onOnline_,this)}sendRequest(t,r,i){let s=++this.requestNumber_,o={r:s,a:t,b:r};this.log_(Dt(o)),j(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),i&&(this.requestCBHash_[s]=i)}get(t){this.initConnection_();let r=new Ut,s={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let c=a.d;a.s==="ok"?r.resolve(c):r.reject(c)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),r.promise}listen(t,r,i,s){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),j(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),j(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let c={onComplete:s,hashFn:r,query:t,tag:i};this.listens.get(a).set(o,c),this.connected_&&this.sendListen_(c)}sendGet_(t){let r=this.outstandingGets_[t];this.sendRequest("g",r.request,i=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),r.onComplete&&r.onComplete(i)})}sendListen_(t){let r=t.query,i=r._path.toString(),s=r._queryIdentifier;this.log_("Listen on "+i+" for "+s);let o={p:i},a="q";t.tag&&(o.q=r._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,c=>{let l=c.d,d=c.s;n.warnOnListenWarnings_(l,r),(this.listens.get(i)&&this.listens.get(i).get(s))===t&&(this.log_("listen response",c),d!=="ok"&&this.removeListen_(i,s),t.onComplete&&t.onComplete(d,l))})}static warnOnListenWarnings_(t,r){if(t&&typeof t=="object"&&zn(t,"w")){let i=Oi(t,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){let s='".indexOn": "'+r._queryParams.getIndex().toString()+'"',o=r._path.toString();on(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||db(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=_O)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,r=lb(t)?"auth":"gauth",i={cred:t};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(r,i,s=>{let o=s.s,a=s.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let r=t.s,i=t.d||"error";r==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(r,i)})}unlisten(t,r){let i=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),j(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,t._queryObject,r)}sendUnlisten_(t,r,i,s){this.log_("Unlisten on "+t+" for "+r);let o={p:t},a="n";s&&(o.q=i,o.t=s),this.sendRequest(a,o)}onDisconnectPut(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:r,onComplete:i})}onDisconnectMerge(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:r,onComplete:i})}onDisconnectCancel(t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:r})}sendOnDisconnect_(t,r,i,s){let o={p:r,d:i};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(t,r,i,s){this.putInternal("p",t,r,i,s)}merge(t,r,i,s){this.putInternal("m",t,r,i,s)}putInternal(t,r,i,s,o){this.initConnection_();let a={p:r,d:i};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:s}),this.outstandingPutCount_++;let c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+r)}sendPut_(t){let r=this.outstandingPuts_[t].action,i=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(r,i,o=>{this.log_(r+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(t){if(this.connected_){let r={c:t};this.log_("reportStats",r),this.sendRequest("s",r,i=>{if(i.s!=="ok"){let o=i.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+Dt(t));let r=t.r,i=this.requestCBHash_[r];i&&(delete this.requestCBHash_[r],i(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,r){this.log_("handleServerMessage",t,r),t==="d"?this.onDataUpdate_(r.p,r.d,!1,r.t):t==="m"?this.onDataUpdate_(r.p,r.d,!0,r.t):t==="c"?this.onListenRevoked_(r.p,r.q):t==="ac"?this.onAuthRevoked_(r.s,r.d):t==="apc"?this.onAppCheckRevoked_(r.s,r.d):t==="sd"?this.onSecurityDebugPacket_(r):lT("Unrecognized action received from server: "+Dt(t)+`
Are you using the latest client?`)}onReady_(t,r){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=r,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){j(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=gd,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=gd,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>h3&&(this.reconnectDelay_=gd),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,r=Math.max(0,this.reconnectDelay_-t);r=Math.random()*r,this.log_("Trying to reconnect in "+r+"ms"),this.scheduleConnect_(r),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*d3)}this.onConnectStatus_(!1)}establishConnection_(){return M(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),r=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,c=null,l=function(){c?c.close():(a=!0,i())},d=function(g){j(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(g)};this.realtime_={close:l,sendRequest:d};let f=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[g,y]=yield Promise.all([this.authTokenProvider_.getToken(f),this.appCheckTokenProvider_.getToken(f)]);a?$t("getToken() completed but was canceled"):($t("getToken() completed. Creating connection."),this.authToken_=g&&g.accessToken,this.appCheckToken_=y&&y.token,c=new yT(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,r,i,v=>{on(v+" ("+this.repoInfo_.toString()+")"),this.interrupt(f3)},o))}catch(g){this.log_("Failed to get token: "+g),a||(this.repoInfo_.nodeAdmin&&on(g),l())}}})}interrupt(t){$t("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){$t("Resuming connection for reason: "+t),delete this.interruptReasons_[t],vh(this.interruptReasons_)&&(this.reconnectDelay_=gd,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let r=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:r})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let r=this.outstandingPuts_[t];r&&"h"in r.request&&r.queued&&(r.onComplete&&r.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,r){let i;r?i=r.map(o=>f0(o)).join("$"):i="default";let s=this.removeListen_(t,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,r){let i=new Ue(t).toString(),s;if(this.listens.has(i)){let o=this.listens.get(i);s=o.get(r),o.delete(r),o.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(t,r){$t("Auth token revoked: "+t+"/"+r),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=vO&&(this.reconnectDelay_=_O,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,r){$t("App check token revoked: "+t+"/"+r),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=vO&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let r of t.values())this.sendListen_(r);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},r="js";Cr()&&(this.repoInfo_.nodeAdmin?r="admin_node":r="node"),t["sdk."+r+"."+d0.replace(/\./g,"-")]=1,fy()?t["framework.cordova"]=1:cb()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=Xg.getInstance().currentlyOnline();return vh(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),Se=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var Oc=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let r=new Se(Ds,e),i=new Se(Ds,t);return this.compare(r,i)!==0}minPost(){return Se.MIN}};var Gg,Jg=class extends Oc{static get __EMPTY_NODE(){return Gg}static set __EMPTY_NODE(e){Gg=e}compare(e,t){return $o(e.name,t.name)}isDefinedOn(e){throw na("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Se.MIN}maxPost(){return new Se(Ri,Gg)}makePost(e,t){return j(typeof e=="string","KeyIndex indexValue must always be a string."),new Se(e,Gg)}toString(){return".key"}},Xr=new Jg;var Pc=class{constructor(e,t,r,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},vr=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??rr.EMPTY_NODE,this.right=o??rr.EMPTY_NODE}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return rr.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,r){let i,s;if(i=this,r(t,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(t,r),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),r(t,i.key)===0){if(i.right.isEmpty())return rr.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(t,r))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),wT=class{copy(e,t,r,i,s){return this}insert(e,t,r){return new vr(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},rr=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,vr.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,vr.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,i=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Pc(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Pc(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Pc(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Pc(this.root_,null,this.comparator_,!0,e)}};rr.EMPTY_NODE=new wT;function p3(n,e){return $o(n.name,e.name)}function _0(n,e){return $o(n,e)}var ET;function g3(n){ET=n}var a1=function(n){return typeof n=="number"?"number:"+$O(n):"string:"+n},c1=function(n){if(n.isLeafNode()){let e=n.val();j(typeof e=="string"||typeof e=="number"||typeof e=="object"&&zn(e,".sv"),"Priority must be a string or number.")}else j(n===ET||n.isEmpty(),"priority of unexpected type.");j(n===ET||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var wO,Fc=(()=>{class n{constructor(t,r=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=r,this.lazyHash_=null,j(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),c1(this.priorityNode_)}static set __childrenNodeConstructor(t){wO=t}static get __childrenNodeConstructor(){return wO}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return Ee(t)?this:we(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,r){return null}updateImmediateChild(t,r){return t===".priority"?this.updatePriority(r):r.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,r).updatePriority(this.priorityNode_)}updateChild(t,r){let i=we(t);return i===null?r:r.isEmpty()&&i!==".priority"?this:(j(i!==".priority"||bs(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(Ye(t),r)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,r){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+a1(this.priorityNode_.val())+":");let r=typeof this.value_;t+=r+":",r==="number"?t+=$O(this.value_):t+=this.value_,this.lazyHash_=UO(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(j(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let r=typeof t.value_,i=typeof this.value_,s=n.VALUE_TYPE_ORDER.indexOf(r),o=n.VALUE_TYPE_ORDER.indexOf(i);return j(s>=0,"Unknown leaf type: "+r),j(o>=0,"Unknown leaf type: "+i),s===o?i==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let r=t;return this.value_===r.value_&&this.priorityNode_.equals(r.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),u1,l1;function m3(n){u1=n}function y3(n){l1=n}var IT=class extends Oc{compare(e,t){let r=e.node.getPriority(),i=t.node.getPriority(),s=r.compareTo(i);return s===0?$o(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Se.MIN}maxPost(){return new Se(Ri,new Fc("[PRIORITY-POST]",l1))}makePost(e,t){let r=u1(e);return new Se(t,new Fc("[PRIORITY-POST]",r))}toString(){return".priority"}},et=new IT;var _3=Math.log(2),CT=class{constructor(e){let t=s=>parseInt(Math.log(s)/_3,10),r=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},em=function(n,e,t,r){n.sort(e);let i=function(c,l){let d=l-c,f,g;if(d===0)return null;if(d===1)return f=n[c],g=t?t(f):f,new vr(g,f.node,vr.BLACK,null,null);{let y=parseInt(d/2,10)+c,v=i(c,y),b=i(y+1,l);return f=n[y],g=t?t(f):f,new vr(g,f.node,vr.BLACK,v,b)}},s=function(c){let l=null,d=null,f=n.length,g=function(v,b){let T=f-v,V=f;f-=v;let B=i(T+1,V),O=n[T],z=t?t(O):O;y(new vr(z,O.node,b,null,B))},y=function(v){l?(l.left=v,l=v):(d=v,l=v)};for(let v=0;v<c.count;++v){let b=c.nextBitIsOne(),T=Math.pow(2,c.count-(v+1));b?g(T,vr.BLACK):(g(T,vr.BLACK),g(T,vr.RED))}return d},o=new CT(n.length),a=s(o);return new rr(r||e,a)};var rT,Mc={},Lc=class n{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return j(Mc&&et,"ChildrenNode.ts has not been loaded"),rT=rT||new n({".priority":Mc},{".priority":et}),rT}get(e){let t=Oi(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof rr?t:null}hasIndex(e){return zn(this.indexSet_,e.toString())}addIndex(e,t){j(e!==Xr,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let r=[],i=!1,s=t.getIterator(Se.Wrap),o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();let a;i?a=em(r,e.getCompare()):a=Mc;let c=e.toString(),l=Object.assign({},this.indexSet_);l[c]=e;let d=Object.assign({},this.indexes_);return d[c]=a,new n(d,l)}addToIndexes(e,t){let r=wu(this.indexes_,(i,s)=>{let o=Oi(this.indexSet_,s);if(j(o,"Missing index implementation for "+s),i===Mc)if(o.isDefinedOn(e.node)){let a=[],c=t.getIterator(Se.Wrap),l=c.getNext();for(;l;)l.name!==e.name&&a.push(l),l=c.getNext();return a.push(e),em(a,o.getCompare())}else return Mc;else{let a=t.get(e.name),c=i;return a&&(c=c.remove(new Se(e.name,a))),c.insert(e,e.node)}});return new n(r,this.indexSet_)}removeFromIndexes(e,t){let r=wu(this.indexes_,i=>{if(i===Mc)return i;{let s=t.get(e.name);return s?i.remove(new Se(e.name,s)):i}});return new n(r,this.indexSet_)}};var md,ge=(()=>{class n{constructor(t,r,i){this.children_=t,this.priorityNode_=r,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&c1(this.priorityNode_),this.children_.isEmpty()&&j(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return md||(md=new n(new rr(_0),null,Lc.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||md}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let r=this.children_.get(t);return r===null?md:r}}getChild(t){let r=we(t);return r===null?this:this.getImmediateChild(r).getChild(Ye(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,r){if(j(r,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(r);{let i=new Se(t,r),s,o;r.isEmpty()?(s=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(t,r),o=this.indexMap_.addToIndexes(i,this.children_));let a=s.isEmpty()?md:this.priorityNode_;return new n(s,a,o)}}updateChild(t,r){let i=we(t);if(i===null)return r;{j(we(t)!==".priority"||bs(t)===1,".priority must be the last token in a path");let s=this.getImmediateChild(i).updateChild(Ye(t),r);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let r={},i=0,s=0,o=!0;if(this.forEachChild(et,(a,c)=>{r[a]=c.val(t),i++,o&&n.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):o=!1}),!t&&o&&s<2*i){let a=[];for(let c in r)a[c]=r[c];return a}else return t&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+a1(this.getPriority().val())+":"),this.forEachChild(et,(r,i)=>{let s=i.hash();s!==""&&(t+=":"+r+":"+s)}),this.lazyHash_=t===""?"":UO(t)}return this.lazyHash_}getPredecessorChildName(t,r,i){let s=this.resolveIndex_(i);if(s){let o=s.getPredecessorKey(new Se(t,r));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(t){let r=this.getFirstChildName(t);return r?new Se(r,this.children_.get(r)):null}getLastChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(t){let r=this.getLastChildName(t);return r?new Se(r,this.children_.get(r)):null}forEachChild(t,r){let i=this.resolveIndex_(t);return i?i.inorderTraversal(s=>r(s.name,s.node)):this.children_.inorderTraversal(r)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getIteratorFrom(t,s=>s);{let s=this.children_.getIteratorFrom(t.name,Se.Wrap),o=s.peek();for(;o!=null&&r.compare(o,t)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getReverseIteratorFrom(t,s=>s);{let s=this.children_.getReverseIteratorFrom(t.name,Se.Wrap),o=s.peek();for(;o!=null&&r.compare(o,t)>0;)s.getNext(),o=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Ud?-1:0}withIndex(t){if(t===Xr||this.indexMap_.hasIndex(t))return this;{let r=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,r)}}isIndexed(t){return t===Xr||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let r=t;if(this.getPriority().equals(r.getPriority()))if(this.children_.count()===r.children_.count()){let i=this.getIterator(et),s=r.getIterator(et),o=i.getNext(),a=s.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=i.getNext(),a=s.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===Xr?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),TT=class extends ge{constructor(){super(new rr(_0),ge.EMPTY_NODE,Lc.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ge.EMPTY_NODE}isEmpty(){return!1}},Ud=new TT;Object.defineProperties(Se,{MIN:{value:new Se(Ds,ge.EMPTY_NODE)},MAX:{value:new Se(Ri,Ud)}});Jg.__EMPTY_NODE=ge.EMPTY_NODE;Fc.__childrenNodeConstructor=ge;g3(Ud);y3(Ud);var v3=!0;function dt(n,e=null){if(n===null)return ge.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),j(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new Fc(t,dt(e))}if(!(n instanceof Array)&&v3){let t=[],r=!1;if(qt(n,(o,a)=>{if(o.substring(0,1)!=="."){let c=dt(a);c.isEmpty()||(r=r||!c.getPriority().isEmpty(),t.push(new Se(o,c)))}}),t.length===0)return ge.EMPTY_NODE;let s=em(t,p3,o=>o.name,_0);if(r){let o=em(t,et.getCompare());return new ge(s,dt(e),new Lc({".priority":o},{".priority":et}))}else return new ge(s,dt(e),Lc.Default)}else{let t=ge.EMPTY_NODE;return qt(n,(r,i)=>{if(zn(n,r)&&r.substring(0,1)!=="."){let s=dt(i);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(r,s))}}),t.updatePriority(dt(e))}}m3(dt);var Dd=class extends Oc{constructor(e){super(),this.indexPath_=e,j(!Ee(e)&&we(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let r=this.extractChild(e.node),i=this.extractChild(t.node),s=r.compareTo(i);return s===0?$o(e.name,t.name):s}makePost(e,t){let r=dt(e),i=ge.EMPTY_NODE.updateChild(this.indexPath_,r);return new Se(t,i)}maxPost(){let e=ge.EMPTY_NODE.updateChild(this.indexPath_,Ud);return new Se(Ri,e)}toString(){return Td(this.indexPath_,0).join("/")}};var DT=class extends Oc{compare(e,t){let r=e.node.compareTo(t.node);return r===0?$o(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Se.MIN}maxPost(){return Se.MAX}makePost(e,t){let r=dt(e);return new Se(t,r)}toString(){return".value"}},v0=new DT;function d1(n){return{type:"value",snapshotNode:n}}function Vc(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function bd(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Sd(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function w3(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var Ad=class{constructor(e){this.index_=e}updateChild(e,t,r,i,s,o){j(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(i).equals(r.getChild(i))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(bd(t,a)):j(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Vc(t,r)):o.trackChildChange(Sd(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(et,(i,s)=>{t.hasChild(i)||r.trackChildChange(bd(i,s))}),t.isLeafNode()||t.forEachChild(et,(i,s)=>{if(e.hasChild(i)){let o=e.getImmediateChild(i);o.equals(s)||r.trackChildChange(Sd(i,s,o))}else r.trackChildChange(Vc(i,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?ge.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var tm=class n{constructor(e){this.indexedFilter_=new Ad(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,i,s,o){return this.matches(new Se(t,r))||(r=ge.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,i,s,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=ge.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(ge.EMPTY_NODE);let s=this;return t.forEachChild(et,(o,a)=>{s.matches(new Se(o,a))||(i=i.updateImmediateChild(o,ge.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var bT=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{let r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new tm(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,i,s,o){return this.rangedFilter_.matches(new Se(t,r))||(r=ge.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,i,s,o):this.fullLimitUpdateChild_(e,t,r,s,o)}updateFullNode(e,t,r){let i;if(t.isLeafNode()||t.isEmpty())i=ge.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=ge.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){let a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))i=i.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(ge.EMPTY_NODE);let s;this.reverse_?s=i.getReverseIterator(this.index_):s=i.getIterator(this.index_);let o=0;for(;s.hasNext();){let a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:i=i.updateImmediateChild(a.name,ge.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,i,s){let o;if(this.reverse_){let f=this.index_.getCompare();o=(g,y)=>f(y,g)}else o=this.index_.getCompare();let a=e;j(a.numChildren()===this.limit_,"");let c=new Se(t,r),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(c);if(a.hasChild(t)){let f=a.getImmediateChild(t),g=i.getChildAfterChild(this.index_,l,this.reverse_);for(;g!=null&&(g.name===t||a.hasChild(g.name));)g=i.getChildAfterChild(this.index_,g,this.reverse_);let y=g==null?1:o(g,c);if(d&&!r.isEmpty()&&y>=0)return s?.trackChildChange(Sd(t,r,f)),a.updateImmediateChild(t,r);{s?.trackChildChange(bd(t,f));let b=a.updateImmediateChild(t,ge.EMPTY_NODE);return g!=null&&this.rangedFilter_.matches(g)?(s?.trackChildChange(Vc(g.name,g.node)),b.updateImmediateChild(g.name,g.node)):b}}else return r.isEmpty()?e:d&&o(l,c)>=0?(s!=null&&(s.trackChildChange(bd(l.name,l.node)),s.trackChildChange(Vc(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(l.name,ge.EMPTY_NODE)):e}};var xd=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=et}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return j(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return j(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Ds}hasEnd(){return this.endSet_}getIndexEndValue(){return j(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return j(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ri}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return j(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===et}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function E3(n){return n.loadsAllData()?new Ad(n.getIndex()):n.hasLimit()?new bT(n):new tm(n)}function I3(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function C3(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function ST(n,e,t){let r=n.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,t!=null?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function T3(n,e,t){let r;return n.index_===Xr||t?r=ST(n,e,t):r=ST(n,e,Ri),r.startAfterSet_=!0,r}function AT(n,e,t){let r=n.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,t!==void 0?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function D3(n,e,t){let r;return n.index_===Xr||t?r=AT(n,e,t):r=AT(n,e,Ds),r.endBeforeSet_=!0,r}function wm(n,e){let t=n.copy();return t.index_=e,t}function EO(n){let e={};if(n.isDefault())return e;let t;if(n.index_===et?t="$priority":n.index_===v0?t="$value":n.index_===Xr?t="$key":(j(n.index_ instanceof Dd,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Dt(t),n.startSet_){let r=n.startAfterSet_?"startAfter":"startAt";e[r]=Dt(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+Dt(n.indexStartName_))}if(n.endSet_){let r=n.endBeforeSet_?"endBefore":"endAt";e[r]=Dt(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+Dt(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function IO(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==et&&(e.i=n.index_.toString()),e}var xT=class n extends Yg{constructor(e,t,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=Vd("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(j(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){let s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);let o=n.getListenId_(e,r),a={};this.listens_[o]=a;let c=EO(e._queryParams);this.restRequest_(s+".json",c,(l,d)=>{let f=d;if(l===404&&(f=null,l=null),l===null&&this.onDataUpdate_(s,f,!1,r),Oi(this.listens_,o)===a){let g;l?l===401?g="permission_denied":g="rest_error:"+l:g="ok",i(g,null)}})}unlisten(e,t){let r=n.getListenId_(e,t);delete this.listens_[r]}get(e){let t=EO(e._queryParams),r=e._path.toString(),i=new Ut;return this.restRequest_(r+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(r,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,s])=>{i&&i.accessToken&&(t.auth=i.accessToken),s&&s.token&&(t.ac=s.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+hb(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=_h(a.responseText)}catch{on("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,c)}else a.status!==401&&a.status!==404&&on("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}};var RT=class{constructor(){this.rootNode_=ge.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function nm(){return{value:null,children:new Map}}function Hc(n,e,t){if(Ee(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let r=we(e);n.children.has(r)||n.children.set(r,nm());let i=n.children.get(r);e=Ye(e),Hc(i,e,t)}}function MT(n,e){if(Ee(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{let t=n.value;return n.value=null,t.forEachChild(et,(r,i)=>{Hc(n,new Ue(r),i)}),MT(n,e)}}else if(n.children.size>0){let t=we(e);return e=Ye(e),n.children.has(t)&&MT(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function NT(n,e,t){n.value!==null?t(e,n.value):b3(n,(r,i)=>{let s=new Ue(e.toString()+"/"+r);NT(i,s,t)})}function b3(n,e){n.children.forEach((t,r)=>{e(r,t)})}var PT=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&qt(this.last_,(r,i)=>{t[r]=t[r]-i}),this.last_=e,t}};var CO=10*1e3,S3=30*1e3,A3=5*60*1e3,kT=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new PT(e);let r=CO+(S3-CO)*Math.random();_d(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){let e=this.statsListener_.get(),t={},r=!1;qt(e,(i,s)=>{s>0&&zn(this.statsToReport_,i)&&(t[i]=s,r=!0)}),r&&this.server_.reportStats(t),_d(this.reportStats_.bind(this),Math.floor(Math.random()*2*A3))}};var Zr=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(Zr||{});function w0(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function E0(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function I0(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var OT=class n{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=Zr.ACK_USER_WRITE,this.source=w0()}operationForChild(e){if(Ee(this.path)){if(this.affectedTree.value!=null)return j(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new Ue(e));return new n(Ve(),t,this.revert)}}else return j(we(this.path)===e,"operationForChild called for unrelated child."),new n(Ye(this.path),this.affectedTree,this.revert)}};var rm=class n{constructor(e,t){this.source=e,this.path=t,this.type=Zr.LISTEN_COMPLETE}operationForChild(e){return Ee(this.path)?new n(this.source,Ve()):new n(this.source,Ye(this.path))}};var Uc=class n{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=Zr.OVERWRITE}operationForChild(e){return Ee(this.path)?new n(this.source,Ve(),this.snap.getImmediateChild(e)):new n(this.source,Ye(this.path),this.snap)}};var Rd=class n{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=Zr.MERGE}operationForChild(e){if(Ee(this.path)){let t=this.children.subtree(new Ue(e));return t.isEmpty()?null:t.value?new Uc(this.source,Ve(),t.value):new n(this.source,Ve(),t)}else return j(we(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,Ye(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var ei=class{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Ee(e))return this.isFullyInitialized()&&!this.filtered_;let t=we(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var FT=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function x3(n,e,t,r){let i=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(w3(o.childName,o.snapshotNode))}),yd(n,i,"child_removed",e,r,t),yd(n,i,"child_added",e,r,t),yd(n,i,"child_moved",s,r,t),yd(n,i,"child_changed",e,r,t),yd(n,i,"value",e,r,t),i}function yd(n,e,t,r,i,s){let o=r.filter(a=>a.type===t);o.sort((a,c)=>M3(n,a,c)),o.forEach(a=>{let c=R3(n,a,s);i.forEach(l=>{l.respondsTo(a.type)&&e.push(l.createEvent(c,n.query_))})})}function R3(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function M3(n,e,t){if(e.childName==null||t.childName==null)throw na("Should only compare child_ events.");let r=new Se(e.childName,e.snapshotNode),i=new Se(t.childName,t.snapshotNode);return n.index_.compare(r,i)}function Em(n,e){return{eventCache:n,serverCache:e}}function wd(n,e,t,r){return Em(new ei(e,t,r),n.serverCache)}function h1(n,e,t,r){return Em(n.eventCache,new ei(e,t,r))}function im(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Bo(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var iT,N3=()=>(iT||(iT=new rr(RG)),iT),mn=class n{constructor(e,t=N3()){this.value=e,this.children=t}static fromObject(e){let t=new n(null);return qt(e,(r,i)=>{t=t.set(new Ue(r),i)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:Ve(),value:this.value};if(Ee(e))return null;{let r=we(e),i=this.children.get(r);if(i!==null){let s=i.findRootMostMatchingPathAndValue(Ye(e),t);return s!=null?{path:ct(new Ue(r),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Ee(e))return this;{let t=we(e),r=this.children.get(t);return r!==null?r.subtree(Ye(e)):new n(null)}}set(e,t){if(Ee(e))return new n(t,this.children);{let r=we(e),s=(this.children.get(r)||new n(null)).set(Ye(e),t),o=this.children.insert(r,s);return new n(this.value,o)}}remove(e){if(Ee(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=we(e),r=this.children.get(t);if(r){let i=r.remove(Ye(e)),s;return i.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,i),this.value===null&&s.isEmpty()?new n(null):new n(this.value,s)}else return this}}get(e){if(Ee(e))return this.value;{let t=we(e),r=this.children.get(t);return r?r.get(Ye(e)):null}}setTree(e,t){if(Ee(e))return t;{let r=we(e),s=(this.children.get(r)||new n(null)).setTree(Ye(e),t),o;return s.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,s),new n(this.value,o)}}fold(e){return this.fold_(Ve(),e)}fold_(e,t){let r={};return this.children.inorderTraversal((i,s)=>{r[i]=s.fold_(ct(e,i),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,Ve(),t)}findOnPath_(e,t,r){let i=this.value?r(t,this.value):!1;if(i)return i;if(Ee(e))return null;{let s=we(e),o=this.children.get(s);return o?o.findOnPath_(Ye(e),ct(t,s),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Ve(),t)}foreachOnPath_(e,t,r){if(Ee(e))return this;{this.value&&r(t,this.value);let i=we(e),s=this.children.get(i);return s?s.foreachOnPath_(Ye(e),ct(t,i),r):new n(null)}}foreach(e){this.foreach_(Ve(),e)}foreach_(e,t){this.children.inorderTraversal((r,i)=>{i.foreach_(ct(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}};var wr=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new mn(null))}};function Ed(n,e,t){if(Ee(e))return new wr(new mn(t));{let r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){let i=r.path,s=r.value,o=gn(i,e);return s=s.updateChild(o,t),new wr(n.writeTree_.set(i,s))}else{let i=new mn(t),s=n.writeTree_.setTree(e,i);return new wr(s)}}}function LT(n,e,t){let r=n;return qt(t,(i,s)=>{r=Ed(r,ct(e,i),s)}),r}function TO(n,e){if(Ee(e))return wr.empty();{let t=n.writeTree_.setTree(e,new mn(null));return new wr(t)}}function VT(n,e){return qo(n,e)!=null}function qo(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(gn(t.path,e)):null}function DO(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(et,(r,i)=>{e.push(new Se(r,i))}):n.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new Se(r,i.value))}),e}function Cs(n,e){if(Ee(e))return n;{let t=qo(n,e);return t!=null?new wr(new mn(t)):new wr(n.writeTree_.subtree(e))}}function UT(n){return n.writeTree_.isEmpty()}function jc(n,e){return f1(Ve(),n.writeTree_,e)}function f1(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((i,s)=>{i===".priority"?(j(s.value!==null,"Priority writes must always be leaf nodes"),r=s.value):t=f1(ct(n,i),s,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(ct(n,".priority"),r)),t}}function Im(n,e){return y1(e,n)}function P3(n,e,t,r,i){j(r>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:i}),i&&(n.visibleWrites=Ed(n.visibleWrites,e,t)),n.lastWriteId=r}function k3(n,e,t,r){j(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=LT(n.visibleWrites,e,t),n.lastWriteId=r}function O3(n,e){for(let t=0;t<n.allWrites.length;t++){let r=n.allWrites[t];if(r.writeId===e)return r}return null}function F3(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);j(t>=0,"removeWrite called with nonexistent writeId.");let r=n.allWrites[t];n.allWrites.splice(t,1);let i=r.visible,s=!1,o=n.allWrites.length-1;for(;i&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&L3(a,r.path)?i=!1:nr(r.path,a.path)&&(s=!0)),o--}if(i){if(s)return V3(n),!0;if(r.snap)n.visibleWrites=TO(n.visibleWrites,r.path);else{let a=r.children;qt(a,c=>{n.visibleWrites=TO(n.visibleWrites,ct(r.path,c))})}return!0}else return!1}function L3(n,e){if(n.snap)return nr(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&nr(ct(n.path,t),e))return!0;return!1}function V3(n){n.visibleWrites=p1(n.allWrites,U3,Ve()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function U3(n){return n.visible}function p1(n,e,t){let r=wr.empty();for(let i=0;i<n.length;++i){let s=n[i];if(e(s)){let o=s.path,a;if(s.snap)nr(t,o)?(a=gn(t,o),r=Ed(r,a,s.snap)):nr(o,t)&&(a=gn(o,t),r=Ed(r,Ve(),s.snap.getChild(a)));else if(s.children){if(nr(t,o))a=gn(t,o),r=LT(r,a,s.children);else if(nr(o,t))if(a=gn(o,t),Ee(a))r=LT(r,Ve(),s.children);else{let c=Oi(s.children,we(a));if(c){let l=c.getChild(Ye(a));r=Ed(r,Ve(),l)}}}else throw na("WriteRecord should have .snap or .children")}}return r}function g1(n,e,t,r,i){if(!r&&!i){let s=qo(n.visibleWrites,e);if(s!=null)return s;{let o=Cs(n.visibleWrites,e);if(UT(o))return t;if(t==null&&!VT(o,Ve()))return null;{let a=t||ge.EMPTY_NODE;return jc(o,a)}}}else{let s=Cs(n.visibleWrites,e);if(!i&&UT(s))return t;if(!i&&t==null&&!VT(s,Ve()))return null;{let o=function(l){return(l.visible||i)&&(!r||!~r.indexOf(l.writeId))&&(nr(l.path,e)||nr(e,l.path))},a=p1(n.allWrites,o,e),c=t||ge.EMPTY_NODE;return jc(a,c)}}}function j3(n,e,t){let r=ge.EMPTY_NODE,i=qo(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(et,(s,o)=>{r=r.updateImmediateChild(s,o)}),r;if(t){let s=Cs(n.visibleWrites,e);return t.forEachChild(et,(o,a)=>{let c=jc(Cs(s,new Ue(o)),a);r=r.updateImmediateChild(o,c)}),DO(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{let s=Cs(n.visibleWrites,e);return DO(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function B3(n,e,t,r,i){j(r||i,"Either existingEventSnap or existingServerSnap must exist");let s=ct(e,t);if(VT(n.visibleWrites,s))return null;{let o=Cs(n.visibleWrites,s);return UT(o)?i.getChild(t):jc(o,i.getChild(t))}}function $3(n,e,t,r){let i=ct(e,t),s=qo(n.visibleWrites,i);if(s!=null)return s;if(r.isCompleteForChild(t)){let o=Cs(n.visibleWrites,i);return jc(o,r.getNode().getImmediateChild(t))}else return null}function q3(n,e){return qo(n.visibleWrites,e)}function H3(n,e,t,r,i,s,o){let a,c=Cs(n.visibleWrites,e),l=qo(c,Ve());if(l!=null)a=l;else if(t!=null)a=jc(c,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let d=[],f=o.getCompare(),g=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o),y=g.getNext();for(;y&&d.length<i;)f(y,r)!==0&&d.push(y),y=g.getNext();return d}else return[]}function z3(){return{visibleWrites:wr.empty(),allWrites:[],lastWriteId:-1}}function sm(n,e,t,r){return g1(n.writeTree,n.treePath,e,t,r)}function C0(n,e){return j3(n.writeTree,n.treePath,e)}function bO(n,e,t,r){return B3(n.writeTree,n.treePath,e,t,r)}function om(n,e){return q3(n.writeTree,ct(n.treePath,e))}function G3(n,e,t,r,i,s){return H3(n.writeTree,n.treePath,e,t,r,i,s)}function T0(n,e,t){return $3(n.writeTree,n.treePath,e,t)}function m1(n,e){return y1(ct(n.treePath,e),n.writeTree)}function y1(n,e){return{treePath:n,writeTree:e}}var jT=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,r=e.childName;j(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),j(r!==".priority","Only non-priority child changes can be tracked.");let i=this.changeMap.get(r);if(i){let s=i.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(r,Sd(r,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(r,bd(r,i.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(r,Vc(r,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(r,Sd(r,e.snapshotNode,i.oldSnap));else throw na("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}};var BT=class{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}},_1=new BT,Md=class{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let r=this.optCompleteServerCache_!=null?new ei(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return T0(this.writes_,e,r)}}getChildAfterChild(e,t,r){let i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Bo(this.viewCache_),s=G3(this.writes_,i,t,1,r,e);return s.length===0?null:s[0]}};function W3(n){return{filter:n}}function K3(n,e){j(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),j(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function Q3(n,e,t,r,i){let s=new jT,o,a;if(t.type===Zr.OVERWRITE){let l=t;l.source.fromUser?o=$T(n,e,l.path,l.snap,r,i,s):(j(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered()&&!Ee(l.path),o=am(n,e,l.path,l.snap,r,i,a,s))}else if(t.type===Zr.MERGE){let l=t;l.source.fromUser?o=Z3(n,e,l.path,l.children,r,i,s):(j(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered(),o=qT(n,e,l.path,l.children,r,i,a,s))}else if(t.type===Zr.ACK_USER_WRITE){let l=t;l.revert?o=e9(n,e,l.path,r,i,s):o=X3(n,e,l.path,l.affectedTree,r,i,s)}else if(t.type===Zr.LISTEN_COMPLETE)o=J3(n,e,t.path,r,s);else throw na("Unknown operation type: "+t.type);let c=s.getChanges();return Y3(e,o,c),{viewCache:o,changes:c}}function Y3(n,e,t){let r=e.eventCache;if(r.isFullyInitialized()){let i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=im(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&t.push(d1(im(e)))}}function v1(n,e,t,r,i,s){let o=e.eventCache;if(om(r,t)!=null)return e;{let a,c;if(Ee(t))if(j(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let l=Bo(e),d=l instanceof ge?l:ge.EMPTY_NODE,f=C0(r,d);a=n.filter.updateFullNode(e.eventCache.getNode(),f,s)}else{let l=sm(r,Bo(e));a=n.filter.updateFullNode(e.eventCache.getNode(),l,s)}else{let l=we(t);if(l===".priority"){j(bs(t)===1,"Can't have a priority with additional path components");let d=o.getNode();c=e.serverCache.getNode();let f=bO(r,t,d,c);f!=null?a=n.filter.updatePriority(d,f):a=o.getNode()}else{let d=Ye(t),f;if(o.isCompleteForChild(l)){c=e.serverCache.getNode();let g=bO(r,t,o.getNode(),c);g!=null?f=o.getNode().getImmediateChild(l).updateChild(d,g):f=o.getNode().getImmediateChild(l)}else f=T0(r,l,e.serverCache);f!=null?a=n.filter.updateChild(o.getNode(),l,f,d,i,s):a=o.getNode()}}return wd(e,a,o.isFullyInitialized()||Ee(t),n.filter.filtersNodes())}}function am(n,e,t,r,i,s,o,a){let c=e.serverCache,l,d=o?n.filter:n.filter.getIndexedFilter();if(Ee(t))l=d.updateFullNode(c.getNode(),r,null);else if(d.filtersNodes()&&!c.isFiltered()){let y=c.getNode().updateChild(t,r);l=d.updateFullNode(c.getNode(),y,null)}else{let y=we(t);if(!c.isCompleteForPath(t)&&bs(t)>1)return e;let v=Ye(t),T=c.getNode().getImmediateChild(y).updateChild(v,r);y===".priority"?l=d.updatePriority(c.getNode(),T):l=d.updateChild(c.getNode(),y,T,v,_1,null)}let f=h1(e,l,c.isFullyInitialized()||Ee(t),d.filtersNodes()),g=new Md(i,f,s);return v1(n,f,t,i,g,a)}function $T(n,e,t,r,i,s,o){let a=e.eventCache,c,l,d=new Md(i,e,s);if(Ee(t))l=n.filter.updateFullNode(e.eventCache.getNode(),r,o),c=wd(e,l,!0,n.filter.filtersNodes());else{let f=we(t);if(f===".priority")l=n.filter.updatePriority(e.eventCache.getNode(),r),c=wd(e,l,a.isFullyInitialized(),a.isFiltered());else{let g=Ye(t),y=a.getNode().getImmediateChild(f),v;if(Ee(g))v=r;else{let b=d.getCompleteChild(f);b!=null?g0(g)===".priority"&&b.getChild(s1(g)).isEmpty()?v=b:v=b.updateChild(g,r):v=ge.EMPTY_NODE}if(y.equals(v))c=e;else{let b=n.filter.updateChild(a.getNode(),f,v,g,d,o);c=wd(e,b,a.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function SO(n,e){return n.eventCache.isCompleteForChild(e)}function Z3(n,e,t,r,i,s,o){let a=e;return r.foreach((c,l)=>{let d=ct(t,c);SO(e,we(d))&&(a=$T(n,a,d,l,i,s,o))}),r.foreach((c,l)=>{let d=ct(t,c);SO(e,we(d))||(a=$T(n,a,d,l,i,s,o))}),a}function AO(n,e,t){return t.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function qT(n,e,t,r,i,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,l;Ee(t)?l=r:l=new mn(null).setTree(t,r);let d=e.serverCache.getNode();return l.children.inorderTraversal((f,g)=>{if(d.hasChild(f)){let y=e.serverCache.getNode().getImmediateChild(f),v=AO(n,y,g);c=am(n,c,new Ue(f),v,i,s,o,a)}}),l.children.inorderTraversal((f,g)=>{let y=!e.serverCache.isCompleteForChild(f)&&g.value===null;if(!d.hasChild(f)&&!y){let v=e.serverCache.getNode().getImmediateChild(f),b=AO(n,v,g);c=am(n,c,new Ue(f),b,i,s,o,a)}}),c}function X3(n,e,t,r,i,s,o){if(om(i,t)!=null)return e;let a=e.serverCache.isFiltered(),c=e.serverCache;if(r.value!=null){if(Ee(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return am(n,e,t,c.getNode().getChild(t),i,s,a,o);if(Ee(t)){let l=new mn(null);return c.getNode().forEachChild(Xr,(d,f)=>{l=l.set(new Ue(d),f)}),qT(n,e,t,l,i,s,a,o)}else return e}else{let l=new mn(null);return r.foreach((d,f)=>{let g=ct(t,d);c.isCompleteForPath(g)&&(l=l.set(d,c.getNode().getChild(g)))}),qT(n,e,t,l,i,s,a,o)}}function J3(n,e,t,r,i){let s=e.serverCache,o=h1(e,s.getNode(),s.isFullyInitialized()||Ee(t),s.isFiltered());return v1(n,o,t,r,_1,i)}function e9(n,e,t,r,i,s){let o;if(om(r,t)!=null)return e;{let a=new Md(r,e,i),c=e.eventCache.getNode(),l;if(Ee(t)||we(t)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=sm(r,Bo(e));else{let f=e.serverCache.getNode();j(f instanceof ge,"serverChildren would be complete if leaf node"),d=C0(r,f)}d=d,l=n.filter.updateFullNode(c,d,s)}else{let d=we(t),f=T0(r,d,e.serverCache);f==null&&e.serverCache.isCompleteForChild(d)&&(f=c.getImmediateChild(d)),f!=null?l=n.filter.updateChild(c,d,f,Ye(t),a,s):e.eventCache.getNode().hasChild(d)?l=n.filter.updateChild(c,d,ge.EMPTY_NODE,Ye(t),a,s):l=c,l.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=sm(r,Bo(e)),o.isLeafNode()&&(l=n.filter.updateFullNode(l,o,s)))}return o=e.serverCache.isFullyInitialized()||om(r,Ve())!=null,wd(e,l,o,n.filter.filtersNodes())}}var HT=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let r=this.query_._queryParams,i=new Ad(r.getIndex()),s=E3(r);this.processor_=W3(s);let o=t.serverCache,a=t.eventCache,c=i.updateFullNode(ge.EMPTY_NODE,o.getNode(),null),l=s.updateFullNode(ge.EMPTY_NODE,a.getNode(),null),d=new ei(c,o.isFullyInitialized(),i.filtersNodes()),f=new ei(l,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=Em(f,d),this.eventGenerator_=new FT(this.query_)}get query(){return this.query_}};function t9(n){return n.viewCache_.serverCache.getNode()}function n9(n){return im(n.viewCache_)}function r9(n,e){let t=Bo(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!Ee(e)&&!t.getImmediateChild(we(e)).isEmpty())?t.getChild(e):null}function xO(n){return n.eventRegistrations_.length===0}function i9(n,e){n.eventRegistrations_.push(e)}function RO(n,e,t){let r=[];if(t){j(e==null,"A cancel should cancel all event registrations.");let i=n.query._path;n.eventRegistrations_.forEach(s=>{let o=s.createCancelEvent(t,i);o&&r.push(o)})}if(e){let i=[];for(let s=0;s<n.eventRegistrations_.length;++s){let o=n.eventRegistrations_[s];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=i}else n.eventRegistrations_=[];return r}function MO(n,e,t,r){e.type===Zr.MERGE&&e.source.queryId!==null&&(j(Bo(n.viewCache_),"We should always have a full cache before handling merges"),j(im(n.viewCache_),"Missing event cache, even though we have a server cache"));let i=n.viewCache_,s=Q3(n.processor_,i,e,t,r);return K3(n.processor_,s.viewCache),j(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,w1(n,s.changes,s.viewCache.eventCache.getNode(),null)}function s9(n,e){let t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(et,(s,o)=>{r.push(Vc(s,o))}),t.isFullyInitialized()&&r.push(d1(t.getNode())),w1(n,r,t.getNode(),e)}function w1(n,e,t,r){let i=r?[r]:n.eventRegistrations_;return x3(n.eventGenerator_,e,t,i)}var cm,um=class{constructor(){this.views=new Map}};function o9(n){j(!cm,"__referenceConstructor has already been defined"),cm=n}function a9(){return j(cm,"Reference.ts has not been loaded"),cm}function c9(n){return n.views.size===0}function D0(n,e,t,r){let i=e.source.queryId;if(i!==null){let s=n.views.get(i);return j(s!=null,"SyncTree gave us an op for an invalid query."),MO(s,e,t,r)}else{let s=[];for(let o of n.views.values())s=s.concat(MO(o,e,t,r));return s}}function E1(n,e,t,r,i){let s=e._queryIdentifier,o=n.views.get(s);if(!o){let a=sm(t,i?r:null),c=!1;a?c=!0:r instanceof ge?(a=C0(t,r),c=!1):(a=ge.EMPTY_NODE,c=!1);let l=Em(new ei(a,c,!1),new ei(r,i,!1));return new HT(e,l)}return o}function u9(n,e,t,r,i,s){let o=E1(n,e,r,i,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),i9(o,t),s9(o,t)}function l9(n,e,t,r){let i=e._queryIdentifier,s=[],o=[],a=Ss(n);if(i==="default")for(let[c,l]of n.views.entries())o=o.concat(RO(l,t,r)),xO(l)&&(n.views.delete(c),l.query._queryParams.loadsAllData()||s.push(l.query));else{let c=n.views.get(i);c&&(o=o.concat(RO(c,t,r)),xO(c)&&(n.views.delete(i),c.query._queryParams.loadsAllData()||s.push(c.query)))}return a&&!Ss(n)&&s.push(new(a9())(e._repo,e._path)),{removed:s,events:o}}function I1(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Ts(n,e){let t=null;for(let r of n.views.values())t=t||r9(r,e);return t}function C1(n,e){if(e._queryParams.loadsAllData())return Cm(n);{let r=e._queryIdentifier;return n.views.get(r)}}function T1(n,e){return C1(n,e)!=null}function Ss(n){return Cm(n)!=null}function Cm(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var lm;function d9(n){j(!lm,"__referenceConstructor has already been defined"),lm=n}function h9(){return j(lm,"Reference.ts has not been loaded"),lm}var f9=1,dm=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new mn(null),this.pendingWriteTree_=z3(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function b0(n,e,t,r,i){return P3(n.pendingWriteTree_,e,t,r,i),i?zc(n,new Uc(w0(),e,t)):[]}function p9(n,e,t,r){k3(n.pendingWriteTree_,e,t,r);let i=mn.fromObject(t);return zc(n,new Rd(w0(),e,i))}function Is(n,e,t=!1){let r=O3(n.pendingWriteTree_,e);if(F3(n.pendingWriteTree_,e)){let s=new mn(null);return r.snap!=null?s=s.set(Ve(),!0):qt(r.children,o=>{s=s.set(new Ue(o),!0)}),zc(n,new OT(r.path,s,t))}else return[]}function jd(n,e,t){return zc(n,new Uc(E0(),e,t))}function g9(n,e,t){let r=mn.fromObject(t);return zc(n,new Rd(E0(),e,r))}function m9(n,e){return zc(n,new rm(E0(),e))}function y9(n,e,t){let r=S0(n,t);if(r){let i=A0(r),s=i.path,o=i.queryId,a=gn(s,e),c=new rm(I0(o),a);return x0(n,s,c)}else return[]}function hm(n,e,t,r,i=!1){let s=e._path,o=n.syncPointTree_.get(s),a=[];if(o&&(e._queryIdentifier==="default"||T1(o,e))){let c=l9(o,e,t,r);c9(o)&&(n.syncPointTree_=n.syncPointTree_.remove(s));let l=c.removed;if(a=c.events,!i){let d=l.findIndex(g=>g._queryParams.loadsAllData())!==-1,f=n.syncPointTree_.findOnPath(s,(g,y)=>Ss(y));if(d&&!f){let g=n.syncPointTree_.subtree(s);if(!g.isEmpty()){let y=w9(g);for(let v=0;v<y.length;++v){let b=y[v],T=b.query,V=A1(n,b);n.listenProvider_.startListening(Id(T),Nd(n,T),V.hashFn,V.onComplete)}}}!f&&l.length>0&&!r&&(d?n.listenProvider_.stopListening(Id(e),null):l.forEach(g=>{let y=n.queryToTagMap.get(Dm(g));n.listenProvider_.stopListening(Id(g),y)}))}E9(n,l)}return a}function D1(n,e,t,r){let i=S0(n,r);if(i!=null){let s=A0(i),o=s.path,a=s.queryId,c=gn(o,e),l=new Uc(I0(a),c,t);return x0(n,o,l)}else return[]}function _9(n,e,t,r){let i=S0(n,r);if(i){let s=A0(i),o=s.path,a=s.queryId,c=gn(o,e),l=mn.fromObject(t),d=new Rd(I0(a),c,l);return x0(n,o,d)}else return[]}function zT(n,e,t,r=!1){let i=e._path,s=null,o=!1;n.syncPointTree_.foreachOnPath(i,(g,y)=>{let v=gn(g,i);s=s||Ts(y,v),o=o||Ss(y)});let a=n.syncPointTree_.get(i);a?(o=o||Ss(a),s=s||Ts(a,Ve())):(a=new um,n.syncPointTree_=n.syncPointTree_.set(i,a));let c;s!=null?c=!0:(c=!1,s=ge.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((y,v)=>{let b=Ts(v,Ve());b&&(s=s.updateImmediateChild(y,b))}));let l=T1(a,e);if(!l&&!e._queryParams.loadsAllData()){let g=Dm(e);j(!n.queryToTagMap.has(g),"View does not exist, but we have a tag");let y=I9();n.queryToTagMap.set(g,y),n.tagToQueryMap.set(y,g)}let d=Im(n.pendingWriteTree_,i),f=u9(a,e,t,d,s,c);if(!l&&!o&&!r){let g=C1(a,e);f=f.concat(C9(n,e,g))}return f}function Tm(n,e,t){let i=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,a)=>{let c=gn(o,e),l=Ts(a,c);if(l)return l});return g1(i,e,s,t,!0)}function v9(n,e){let t=e._path,r=null;n.syncPointTree_.foreachOnPath(t,(l,d)=>{let f=gn(l,t);r=r||Ts(d,f)});let i=n.syncPointTree_.get(t);i?r=r||Ts(i,Ve()):(i=new um,n.syncPointTree_=n.syncPointTree_.set(t,i));let s=r!=null,o=s?new ei(r,!0,!1):null,a=Im(n.pendingWriteTree_,e._path),c=E1(i,e,a,s?o.getNode():ge.EMPTY_NODE,s);return n9(c)}function zc(n,e){return b1(e,n.syncPointTree_,null,Im(n.pendingWriteTree_,Ve()))}function b1(n,e,t,r){if(Ee(n.path))return S1(n,e,t,r);{let i=e.get(Ve());t==null&&i!=null&&(t=Ts(i,Ve()));let s=[],o=we(n.path),a=n.operationForChild(o),c=e.children.get(o);if(c&&a){let l=t?t.getImmediateChild(o):null,d=m1(r,o);s=s.concat(b1(a,c,l,d))}return i&&(s=s.concat(D0(i,n,r,t))),s}}function S1(n,e,t,r){let i=e.get(Ve());t==null&&i!=null&&(t=Ts(i,Ve()));let s=[];return e.children.inorderTraversal((o,a)=>{let c=t?t.getImmediateChild(o):null,l=m1(r,o),d=n.operationForChild(o);d&&(s=s.concat(S1(d,a,c,l)))}),i&&(s=s.concat(D0(i,n,r,t))),s}function A1(n,e){let t=e.query,r=Nd(n,t);return{hashFn:()=>(t9(e)||ge.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return r?y9(n,t._path,r):m9(n,t._path);{let s=PG(i,t);return hm(n,t,null,s)}}}}function Nd(n,e){let t=Dm(e);return n.queryToTagMap.get(t)}function Dm(n){return n._path.toString()+"$"+n._queryIdentifier}function S0(n,e){return n.tagToQueryMap.get(e)}function A0(n){let e=n.indexOf("$");return j(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new Ue(n.substr(0,e))}}function x0(n,e,t){let r=n.syncPointTree_.get(e);j(r,"Missing sync point for query tag that we're tracking");let i=Im(n.pendingWriteTree_,e);return D0(r,t,i,null)}function w9(n){return n.fold((e,t,r)=>{if(t&&Ss(t))return[Cm(t)];{let i=[];return t&&(i=I1(t)),qt(r,(s,o)=>{i=i.concat(o)}),i}})}function Id(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(h9())(n._repo,n._path):n}function E9(n,e){for(let t=0;t<e.length;++t){let r=e[t];if(!r._queryParams.loadsAllData()){let i=Dm(r),s=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(s)}}}function I9(){return f9++}function C9(n,e,t){let r=e._path,i=Nd(n,e),s=A1(n,t),o=n.listenProvider_.startListening(Id(e),i,s.hashFn,s.onComplete),a=n.syncPointTree_.subtree(r);if(i)j(!Ss(a.value),"If we're adding a query, it shouldn't be shadowed");else{let c=a.fold((l,d,f)=>{if(!Ee(l)&&d&&Ss(d))return[Cm(d).query];{let g=[];return d&&(g=g.concat(I1(d).map(y=>y.query))),qt(f,(y,v)=>{g=g.concat(v)}),g}});for(let l=0;l<c.length;++l){let d=c[l];n.listenProvider_.stopListening(Id(d),Nd(n,d))}}return o}var GT=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},WT=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=ct(this.path_,e);return new n(this.syncTree_,t)}node(){return Tm(this.syncTree_,this.path_)}},T9=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},NO=function(n,e,t){if(!n||typeof n!="object")return n;if(j(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return D9(n[".sv"],e,t);if(typeof n[".sv"]=="object")return b9(n[".sv"],e);j(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},D9=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:j(!1,"Unexpected server value: "+n)}},b9=function(n,e,t){n.hasOwnProperty("increment")||j(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let r=n.increment;typeof r!="number"&&j(!1,"Unexpected increment value: "+r);let i=e.node();if(j(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;let o=i.getValue();return typeof o!="number"?r:o+r},x1=function(n,e,t,r){return M0(e,new WT(t,n),r)},R0=function(n,e,t){return M0(n,new GT(e),t)};function M0(n,e,t){let r=n.getPriority().val(),i=NO(r,e.getImmediateChild(".priority"),t),s;if(n.isLeafNode()){let o=n,a=NO(o.getValue(),e,t);return a!==o.getValue()||i!==o.getPriority().val()?new Fc(a,dt(i)):n}else{let o=n;return s=o,i!==o.getPriority().val()&&(s=s.updatePriority(new Fc(i))),o.forEachChild(et,(a,c)=>{let l=M0(c,e.getImmediateChild(a),t);l!==c&&(s=s.updateImmediateChild(a,l))}),s}}var Pd=class{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}};function bm(n,e){let t=e instanceof Ue?e:new Ue(e),r=n,i=we(t);for(;i!==null;){let s=Oi(r.node.children,i)||{children:{},childCount:0};r=new Pd(i,r,s),t=Ye(t),i=we(t)}return r}function Ho(n){return n.node.value}function N0(n,e){n.node.value=e,KT(n)}function R1(n){return n.node.childCount>0}function S9(n){return Ho(n)===void 0&&!R1(n)}function Sm(n,e){qt(n.node.children,(t,r)=>{e(new Pd(t,n,r))})}function M1(n,e,t,r){t&&!r&&e(n),Sm(n,i=>{M1(i,e,!0,r)}),t&&r&&e(n)}function A9(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function Bd(n){return new Ue(n.parent===null?n.name:Bd(n.parent)+"/"+n.name)}function KT(n){n.parent!==null&&x9(n.parent,n.name,n)}function x9(n,e,t){let r=S9(t),i=zn(n.node.children,e);r&&i?(delete n.node.children[e],n.node.childCount--,KT(n)):!r&&!i&&(n.node.children[e]=t.node,n.node.childCount++,KT(n))}var R9=/[\[\].#$\/\u0000-\u001F\u007F]/,M9=/[\[\].#$\u0000-\u001F\u007F]/,sT=10*1024*1024,Am=function(n){return typeof n=="string"&&n.length!==0&&!R9.test(n)},N1=function(n){return typeof n=="string"&&n.length!==0&&!M9.test(n)},N9=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),N1(n)},kd=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!vm(n)||n&&typeof n=="object"&&zn(n,".sv")},ti=function(n,e,t,r){r&&e===void 0||$d(En(n,"value"),e,t)},$d=function(n,e,t){let r=t instanceof Ue?new _T(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+Vo(r));if(typeof e=="function")throw new Error(n+"contains a function "+Vo(r)+" with contents = "+e.toString());if(vm(e))throw new Error(n+"contains "+e.toString()+" "+Vo(r));if(typeof e=="string"&&e.length>sT/3&&Eu(e)>sT)throw new Error(n+"contains a string greater than "+sT+" utf8 bytes "+Vo(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,s=!1;if(qt(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!Am(o)))throw new Error(n+" contains an invalid key ("+o+") "+Vo(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);c3(r,o),$d(n,a,r),u3(r)}),i&&s)throw new Error(n+' contains ".value" child '+Vo(r)+" in addition to actual children.")}},P9=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];let s=Td(r);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!Am(s[o]))throw new Error(n+"contains an invalid key ("+s[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(a3);let i=null;for(t=0;t<e.length;t++){if(r=e[t],i!==null&&nr(i,r))throw new Error(n+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},P1=function(n,e,t,r){if(r&&e===void 0)return;let i=En(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");let s=[];qt(e,(o,a)=>{let c=new Ue(o);if($d(i,a,ct(t,c)),g0(c)===".priority"&&!kd(a))throw new Error(i+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(c)}),P9(i,s)},P0=function(n,e,t){if(!(t&&e===void 0)){if(vm(e))throw new Error(En(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!kd(e))throw new Error(En(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},qd=function(n,e,t,r){if(!(r&&t===void 0)&&!Am(t))throw new Error(En(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Gc=function(n,e,t,r){if(!(r&&t===void 0)&&!N1(t))throw new Error(En(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},k9=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Gc(n,e,t,r)},Un=function(n,e){if(we(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},k1=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Am(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!N9(t))throw new Error(En(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var QT=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function xm(n,e){let t=null;for(let r=0;r<e.length;r++){let i=e[r],s=i.getPath();t!==null&&!m0(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(i)}t&&n.eventLists_.push(t)}function O1(n,e,t){xm(n,t),F1(n,r=>m0(r,e))}function jn(n,e,t){xm(n,t),F1(n,r=>nr(r,e)||nr(e,r))}function F1(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){let i=n.eventLists_[r];if(i){let s=i.path;e(s)?(O9(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function O9(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let r=t.getEventRunner();jo&&$t("event: "+t.toString()),qc(r)}}}var L1="repo_interrupt",F9=25,YT=class{constructor(e,t,r,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new QT,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=nm(),this.transactionQueueTree_=new Pd,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function L9(n,e,t){if(n.stats_=p0(n.repoInfo_),n.forceRestClient_||LG())n.server_=new xT(n.repoInfo_,(r,i,s,o)=>{PO(n,r,i,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>kO(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Dt(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new y0(n.repoInfo_,e,(r,i,s,o)=>{PO(n,r,i,s,o)},r=>{kO(n,r)},r=>{V9(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=UG(n.repoInfo_,()=>new kT(n.stats_,n.server_)),n.infoData_=new RT,n.infoSyncTree_=new dm({startListening:(r,i,s,o)=>{let a=[],c=n.infoData_.getNode(r._path);return c.isEmpty()||(a=jd(n.infoSyncTree_,r._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),k0(n,"connected",!1),n.serverSyncTree_=new dm({startListening:(r,i,s,o)=>(n.server_.listen(r,s,i,(a,c)=>{let l=o(a,c);jn(n.eventQueue_,r._path,l)}),[]),stopListening:(r,i)=>{n.server_.unlisten(r,i)}})}function V1(n){let t=n.infoData_.getNode(new Ue(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Hd(n){return T9({timestamp:V1(n)})}function PO(n,e,t,r,i){n.dataUpdateCount++;let s=new Ue(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(r){let c=wu(t,l=>dt(l));o=_9(n.serverSyncTree_,s,c,i)}else{let c=dt(t);o=D1(n.serverSyncTree_,s,c,i)}else if(r){let c=wu(t,l=>dt(l));o=g9(n.serverSyncTree_,s,c)}else{let c=dt(t);o=jd(n.serverSyncTree_,s,c)}let a=s;o.length>0&&(a=Bc(n,s)),jn(n.eventQueue_,a,o)}function kO(n,e){k0(n,"connected",e),e===!1&&B9(n)}function V9(n,e){qt(e,(t,r)=>{k0(n,t,r)})}function k0(n,e,t){let r=new Ue("/.info/"+e),i=dt(t);n.infoData_.updateSnapshot(r,i);let s=jd(n.infoSyncTree_,r,i);jn(n.eventQueue_,r,s)}function Rm(n){return n.nextWriteId_++}function U9(n,e,t){let r=v9(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(i=>{let s=dt(i).withIndex(e._queryParams.getIndex());zT(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=jd(n.serverSyncTree_,e._path,s);else{let a=Nd(n.serverSyncTree_,e);o=D1(n.serverSyncTree_,e._path,s,a)}return jn(n.eventQueue_,e._path,o),hm(n.serverSyncTree_,e,t,null,!0),s},i=>(Wc(n,"get for query "+Dt(e)+" failed: "+i),Promise.reject(new Error(i))))}function O0(n,e,t,r,i){Wc(n,"set",{path:e.toString(),value:t,priority:r});let s=Hd(n),o=dt(t,r),a=Tm(n.serverSyncTree_,e),c=R0(o,a,s),l=Rm(n),d=b0(n.serverSyncTree_,e,c,l,!0);xm(n.eventQueue_,d),n.server_.put(e.toString(),o.val(!0),(g,y)=>{let v=g==="ok";v||on("set at "+e+" failed: "+g);let b=Is(n.serverSyncTree_,l,!v);jn(n.eventQueue_,e,b),As(n,i,g,y)});let f=L0(n,e);Bc(n,f),jn(n.eventQueue_,f,[])}function j9(n,e,t,r){Wc(n,"update",{path:e.toString(),value:t});let i=!0,s=Hd(n),o={};if(qt(t,(a,c)=>{i=!1,o[a]=x1(ct(e,a),dt(c),n.serverSyncTree_,s)}),i)$t("update() called with empty data.  Don't do anything."),As(n,r,"ok",void 0);else{let a=Rm(n),c=p9(n.serverSyncTree_,e,o,a);xm(n.eventQueue_,c),n.server_.merge(e.toString(),t,(l,d)=>{let f=l==="ok";f||on("update at "+e+" failed: "+l);let g=Is(n.serverSyncTree_,a,!f),y=g.length>0?Bc(n,e):e;jn(n.eventQueue_,y,g),As(n,r,l,d)}),qt(t,l=>{let d=L0(n,ct(e,l));Bc(n,d)}),jn(n.eventQueue_,e,[])}}function B9(n){Wc(n,"onDisconnectEvents");let e=Hd(n),t=nm();NT(n.onDisconnect_,Ve(),(i,s)=>{let o=x1(i,s,n.serverSyncTree_,e);Hc(t,i,o)});let r=[];NT(t,Ve(),(i,s)=>{r=r.concat(jd(n.serverSyncTree_,i,s));let o=L0(n,i);Bc(n,o)}),n.onDisconnect_=nm(),jn(n.eventQueue_,Ve(),r)}function $9(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,i)=>{r==="ok"&&MT(n.onDisconnect_,e),As(n,t,r,i)})}function OO(n,e,t,r){let i=dt(t);n.server_.onDisconnectPut(e.toString(),i.val(!0),(s,o)=>{s==="ok"&&Hc(n.onDisconnect_,e,i),As(n,r,s,o)})}function q9(n,e,t,r,i){let s=dt(t,r);n.server_.onDisconnectPut(e.toString(),s.val(!0),(o,a)=>{o==="ok"&&Hc(n.onDisconnect_,e,s),As(n,i,o,a)})}function H9(n,e,t,r){if(vh(t)){$t("onDisconnect().update() called with empty data.  Don't do anything."),As(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(i,s)=>{i==="ok"&&qt(t,(o,a)=>{let c=dt(a);Hc(n.onDisconnect_,ct(e,o),c)}),As(n,r,i,s)})}function z9(n,e,t){let r;we(e._path)===".info"?r=zT(n.infoSyncTree_,e,t):r=zT(n.serverSyncTree_,e,t),O1(n.eventQueue_,e._path,r)}function ZT(n,e,t){let r;we(e._path)===".info"?r=hm(n.infoSyncTree_,e,t):r=hm(n.serverSyncTree_,e,t),O1(n.eventQueue_,e._path,r)}function U1(n){n.persistentConnection_&&n.persistentConnection_.interrupt(L1)}function G9(n){n.persistentConnection_&&n.persistentConnection_.resume(L1)}function Wc(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),$t(t,...e)}function As(n,e,t,r){e&&qc(()=>{if(t==="ok")e(null);else{let i=(t||"error").toUpperCase(),s=i;r&&(s+=": "+r);let o=new Error(s);o.code=i,e(o)}})}function W9(n,e,t,r,i,s){Wc(n,"transaction on "+e);let o={path:e,update:t,onComplete:r,status:null,order:VO(),applyLocally:s,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=F0(n,e,void 0);o.currentInputSnapshot=a;let c=o.update(a.val());if(c===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{$d("transaction failed: Data returned ",c,o.path),o.status=0;let l=bm(n.transactionQueueTree_,e),d=Ho(l)||[];d.push(o),N0(l,d);let f;typeof c=="object"&&c!==null&&zn(c,".priority")?(f=Oi(c,".priority"),j(kd(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(Tm(n.serverSyncTree_,e)||ge.EMPTY_NODE).getPriority().val();let g=Hd(n),y=dt(c,f),v=R0(y,a,g);o.currentOutputSnapshotRaw=y,o.currentOutputSnapshotResolved=v,o.currentWriteId=Rm(n);let b=b0(n.serverSyncTree_,e,v,o.currentWriteId,o.applyLocally);jn(n.eventQueue_,e,b),Mm(n,n.transactionQueueTree_)}}function F0(n,e,t){return Tm(n.serverSyncTree_,e,t)||ge.EMPTY_NODE}function Mm(n,e=n.transactionQueueTree_){if(e||Nm(n,e),Ho(e)){let t=B1(n,e);j(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&K9(n,Bd(e),t)}else R1(e)&&Sm(e,t=>{Mm(n,t)})}function K9(n,e,t){let r=t.map(l=>l.currentWriteId),i=F0(n,e,r),s=i,o=i.hash();for(let l=0;l<t.length;l++){let d=t[l];j(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;let f=gn(e,d.path);s=s.updateChild(f,d.currentOutputSnapshotRaw)}let a=s.val(!0),c=e;n.server_.put(c.toString(),a,l=>{Wc(n,"transaction put response",{path:c.toString(),status:l});let d=[];if(l==="ok"){let f=[];for(let g=0;g<t.length;g++)t[g].status=2,d=d.concat(Is(n.serverSyncTree_,t[g].currentWriteId)),t[g].onComplete&&f.push(()=>t[g].onComplete(null,!0,t[g].currentOutputSnapshotResolved)),t[g].unwatcher();Nm(n,bm(n.transactionQueueTree_,e)),Mm(n,n.transactionQueueTree_),jn(n.eventQueue_,e,d);for(let g=0;g<f.length;g++)qc(f[g])}else{if(l==="datastale")for(let f=0;f<t.length;f++)t[f].status===3?t[f].status=4:t[f].status=0;else{on("transaction at "+c.toString()+" failed: "+l);for(let f=0;f<t.length;f++)t[f].status=4,t[f].abortReason=l}Bc(n,e)}},o)}function Bc(n,e){let t=j1(n,e),r=Bd(t),i=B1(n,t);return Q9(n,i,r),r}function Q9(n,e,t){if(e.length===0)return;let r=[],i=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let c=e[a],l=gn(t,c.path),d=!1,f;if(j(l!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)d=!0,f=c.abortReason,i=i.concat(Is(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=F9)d=!0,f="maxretry",i=i.concat(Is(n.serverSyncTree_,c.currentWriteId,!0));else{let g=F0(n,c.path,o);c.currentInputSnapshot=g;let y=e[a].update(g.val());if(y!==void 0){$d("transaction failed: Data returned ",y,c.path);let v=dt(y);typeof y=="object"&&y!=null&&zn(y,".priority")||(v=v.updatePriority(g.getPriority()));let T=c.currentWriteId,V=Hd(n),B=R0(v,g,V);c.currentOutputSnapshotRaw=v,c.currentOutputSnapshotResolved=B,c.currentWriteId=Rm(n),o.splice(o.indexOf(T),1),i=i.concat(b0(n.serverSyncTree_,c.path,B,c.currentWriteId,c.applyLocally)),i=i.concat(Is(n.serverSyncTree_,T,!0))}else d=!0,f="nodata",i=i.concat(Is(n.serverSyncTree_,c.currentWriteId,!0))}jn(n.eventQueue_,t,i),i=[],d&&(e[a].status=2,function(g){setTimeout(g,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(f==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(f),!1,null))))}Nm(n,n.transactionQueueTree_);for(let a=0;a<r.length;a++)qc(r[a]);Mm(n,n.transactionQueueTree_)}function j1(n,e){let t,r=n.transactionQueueTree_;for(t=we(e);t!==null&&Ho(r)===void 0;)r=bm(r,t),e=Ye(e),t=we(e);return r}function B1(n,e){let t=[];return $1(n,e,t),t.sort((r,i)=>r.order-i.order),t}function $1(n,e,t){let r=Ho(e);if(r)for(let i=0;i<r.length;i++)t.push(r[i]);Sm(e,i=>{$1(n,i,t)})}function Nm(n,e){let t=Ho(e);if(t){let r=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[r]=t[i],r++);t.length=r,N0(e,t.length>0?t:void 0)}Sm(e,r=>{Nm(n,r)})}function L0(n,e){let t=Bd(j1(n,e)),r=bm(n.transactionQueueTree_,e);return A9(r,i=>{oT(n,i)}),oT(n,r),M1(r,i=>{oT(n,i)}),t}function oT(n,e){let t=Ho(e);if(t){let r=[],i=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(j(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(j(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(Is(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?N0(e,void 0):t.length=s+1,jn(n.eventQueue_,Bd(e),i);for(let o=0;o<r.length;o++)qc(r[o])}}function Y9(n){let e="",t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let i=t[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function Z9(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):on(`Invalid query segment '${t}' in query '${n}'`)}return e}var XT=function(n,e){let t=X9(n),r=t.namespace;t.domain==="firebase.com"&&Jr(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&Jr("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||AG();let i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new Kg(t.host,t.secure,r,i,e,"",r!==t.subdomain),path:new Ue(t.pathString)}},X9=function(n){let e="",t="",r="",i="",s="",o=!0,a="https",c=443;if(typeof n=="string"){let l=n.indexOf("//");l>=0&&(a=n.substring(0,l-1),n=n.substring(l+2));let d=n.indexOf("/");d===-1&&(d=n.length);let f=n.indexOf("?");f===-1&&(f=n.length),e=n.substring(0,Math.min(d,f)),d<f&&(i=Y9(n.substring(d,f)));let g=Z9(n.substring(Math.min(n.length,f)));l=e.indexOf(":"),l>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(l+1),10)):l=e.length;let y=e.slice(0,l);if(y.toLowerCase()==="localhost")t="localhost";else if(y.split(".").length<=2)t=y;else{let v=e.indexOf(".");r=e.substring(0,v).toLowerCase(),t=e.substring(v+1),s=r}"ns"in g&&(s=g.ns)}return{host:e,port:c,domain:t,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};var FO="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",J9=function(){let n=0,e=[];return function(t){let r=t===n;n=t;let i,s=new Array(8);for(i=7;i>=0;i--)s[i]=FO.charAt(t%64),t=Math.floor(t/64);j(t===0,"Cannot push at time == 0");let o=s.join("");if(r){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=FO.charAt(e[i]);return j(o.length===20,"nextPushId: Length should be 20."),o}}();var fm=class{constructor(e,t,r,i){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=i}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Dt(this.snapshot.exportVal())}},pm=class{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var Od=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return j(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var gm=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new Ut;return $9(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Un("OnDisconnect.remove",this._path);let e=new Ut;return OO(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Un("OnDisconnect.set",this._path),ti("OnDisconnect.set",e,this._path,!1);let t=new Ut;return OO(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Un("OnDisconnect.setWithPriority",this._path),ti("OnDisconnect.setWithPriority",e,this._path,!1),P0("OnDisconnect.setWithPriority",t,!1);let r=new Ut;return q9(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){Un("OnDisconnect.update",this._path),P1("OnDisconnect.update",e,this._path,!1);let t=new Ut;return H9(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var yn=class n{constructor(e,t,r,i){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=i}get key(){return Ee(this._path)?null:g0(this._path)}get ref(){return new Bn(this._repo,this._path)}get _queryIdentifier(){let e=IO(this._queryParams),t=f0(e);return t==="{}"?"default":t}get _queryObject(){return IO(this._queryParams)}isEqual(e){if(e=ce(e),!(e instanceof n))return!1;let t=this._repo===e._repo,r=m0(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+o3(this._path)}};function Pm(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Rs(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===Xr){let r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Ds)throw new Error(r);if(typeof e!="string")throw new Error(i)}if(n.hasEnd()){if(n.getIndexEndName()!==Ri)throw new Error(r);if(typeof t!="string")throw new Error(i)}}else if(n.getIndex()===et){if(e!=null&&!kd(e)||t!=null&&!kd(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(j(n.getIndex()instanceof Dd||n.getIndex()===v0,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function km(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var Bn=class n extends yn{constructor(e,t){super(e,t,new xd,!1)}get parent(){let e=s1(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},$c=class n{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new Ue(e),r=xs(this.ref,e);return new n(this._node.getChild(t),r,et)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,i)=>e(new n(i,xs(this.ref,r),et)))}hasChild(e){let t=new Ue(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function V0(n,e){return n=ce(n),n._checkNotDeleted("ref"),e!==void 0?xs(n._root,e):n._root}function U0(n,e){n=ce(n),n._checkNotDeleted("refFromURL");let t=XT(e,n._repo.repoInfo_.nodeAdmin);k1("refFromURL",t);let r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&Jr("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),V0(n,t.path.toString())}function xs(n,e){return n=ce(n),we(n._path)===null?k9("child","path",e,!1):Gc("child","path",e,!1),new Bn(n._repo,ct(n._path,e))}function q1(n,e){n=ce(n),Un("push",n._path),ti("push",e,n._path,!0);let t=V1(n._repo),r=J9(t),i=xs(n,r),s=xs(n,r),o;return e!=null?o=Om(s,e).then(()=>s):o=Promise.resolve(s),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function H1(n){return Un("remove",n._path),Om(n,null)}function Om(n,e){n=ce(n),Un("set",n._path),ti("set",e,n._path,!1);let t=new Ut;return O0(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function z1(n,e){n=ce(n),Un("setPriority",n._path),P0("setPriority",e,!1);let t=new Ut;return O0(n._repo,ct(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function G1(n,e,t){if(Un("setWithPriority",n._path),ti("setWithPriority",e,n._path,!1),P0("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";let r=new Ut;return O0(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}function W1(n,e){P1("update",e,n._path,!1);let t=new Ut;return j9(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function K1(n){n=ce(n);let e=new Od(()=>{}),t=new Fd(e);return U9(n._repo,n,t).then(r=>new $c(r,new Bn(n._repo,n._path),n._queryParams.getIndex()))}var Fd=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let r=t._queryParams.getIndex();return new fm("value",this,new $c(e.snapshotNode,new Bn(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new pm(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},mm=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new pm(this,e,t):null}createEvent(e,t){j(e.childName!=null,"Child events should have a childName.");let r=xs(new Bn(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new fm(e.type,this,new $c(e.snapshotNode,r,i),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function zd(n,e,t,r,i){let s;if(typeof r=="object"&&(s=void 0,i=r),typeof r=="function"&&(s=r),i&&i.onlyOnce){let c=t,l=(d,f)=>{ZT(n._repo,n,a),c(d,f)};l.userCallback=t.userCallback,l.context=t.context,t=l}let o=new Od(t,s||void 0),a=e==="value"?new Fd(o):new mm(e,o);return z9(n._repo,n,a),()=>ZT(n._repo,n,a)}function Fm(n,e,t,r){return zd(n,"value",e,t,r)}function j0(n,e,t,r){return zd(n,"child_added",e,t,r)}function B0(n,e,t,r){return zd(n,"child_changed",e,t,r)}function $0(n,e,t,r){return zd(n,"child_moved",e,t,r)}function q0(n,e,t,r){return zd(n,"child_removed",e,t,r)}function H0(n,e,t){let r=null,i=t?new Od(t):null;e==="value"?r=new Fd(i):e&&(r=new mm(e,i)),ZT(n._repo,n,r)}var $n=class{},ym=class extends $n{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){ti("endAt",this._value,e._path,!0);let t=AT(e._queryParams,this._value,this._key);if(km(t),Rs(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new yn(e._repo,e._path,t,e._orderByCalled)}};function Q1(n,e){return qd("endAt","key",e,!0),new ym(n,e)}var JT=class extends $n{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){ti("endBefore",this._value,e._path,!1);let t=D3(e._queryParams,this._value,this._key);if(km(t),Rs(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new yn(e._repo,e._path,t,e._orderByCalled)}};function Y1(n,e){return qd("endBefore","key",e,!0),new JT(n,e)}var _m=class extends $n{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){ti("startAt",this._value,e._path,!0);let t=ST(e._queryParams,this._value,this._key);if(km(t),Rs(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new yn(e._repo,e._path,t,e._orderByCalled)}};function Z1(n=null,e){return qd("startAt","key",e,!0),new _m(n,e)}var e0=class extends $n{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){ti("startAfter",this._value,e._path,!1);let t=T3(e._queryParams,this._value,this._key);if(km(t),Rs(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new yn(e._repo,e._path,t,e._orderByCalled)}};function X1(n,e){return qd("startAfter","key",e,!0),new e0(n,e)}var t0=class extends $n{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new yn(e._repo,e._path,I3(e._queryParams,this._limit),e._orderByCalled)}};function J1(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new t0(n)}var n0=class extends $n{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new yn(e._repo,e._path,C3(e._queryParams,this._limit),e._orderByCalled)}};function eF(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new n0(n)}var r0=class extends $n{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){Pm(e,"orderByChild");let t=new Ue(this._path);if(Ee(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let r=new Dd(t),i=wm(e._queryParams,r);return Rs(i),new yn(e._repo,e._path,i,!0)}};function tF(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Gc("orderByChild","path",n,!1),new r0(n)}var i0=class extends $n{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){Pm(e,"orderByKey");let t=wm(e._queryParams,Xr);return Rs(t),new yn(e._repo,e._path,t,!0)}};function nF(){return new i0}var s0=class extends $n{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){Pm(e,"orderByPriority");let t=wm(e._queryParams,et);return Rs(t),new yn(e._repo,e._path,t,!0)}};function rF(){return new s0}var o0=class extends $n{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){Pm(e,"orderByValue");let t=wm(e._queryParams,v0);return Rs(t),new yn(e._repo,e._path,t,!0)}};function iF(){return new o0}var a0=class extends $n{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(ti("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new ym(this._value,this._key)._apply(new _m(this._value,this._key)._apply(e))}};function sF(n,e){return qd("equalTo","key",e,!0),new a0(n,e)}function ir(n,...e){let t=ce(n);for(let r of e)t=r._apply(t);return t}o9(Bn);d9(Bn);var eW="FIREBASE_DATABASE_EMULATOR_HOST",c0={},tW=!1;function nW(n,e,t,r){n.repoInfo_=new Kg(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),r&&(n.authTokenProvider_=r)}function z0(n,e,t,r,i){let s=r||n.options.databaseURL;s===void 0&&(n.options.projectId||Jr("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),$t("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=XT(s,i),a=o.repoInfo,c,l;typeof process<"u"&&process.env&&(l=process.env[eW]),l?(c=!0,s=`http://${l}?ns=${a.namespace}`,o=XT(s,i),a=o.repoInfo):c=!o.repoInfo.secure;let d=i&&c?new vd(vd.OWNER):new hT(n.name,n.options,e);k1("Invalid Firebase Database URL",o),Ee(o.path)||Jr("Database URL must point to the root of a Firebase Database (not including a child path).");let f=iW(a,n,d,new dT(n.name,t));return new u0(f,n)}function rW(n,e){let t=c0[e];(!t||t[n.key]!==n)&&Jr(`Database ${e}(${n.repoInfo_}) has already been deleted.`),U1(n),delete t[n.key]}function iW(n,e,t,r){let i=c0[e.name];i||(i={},c0[e.name]=i);let s=i[n.toURLString()];return s&&Jr("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new YT(n,tW,t,r),i[n.toURLString()]=s,s}var u0=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(L9(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Bn(this._repo,Ve())),this._rootInternal}_delete(){return this._rootInternal!==null&&(rW(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Jr("Cannot call "+e+" on a deleted database.")}};function oF(){i1.IS_TRANSPORT_INITIALIZED&&on("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function aF(){oF(),Cd.forceDisallow()}function cF(){oF(),Nc.forceDisallow(),Cd.forceAllow()}function uF(n,e,t,r={}){n=ce(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&Jr("Cannot call useEmulator() after instance has already been initialized.");let i=n._repoInternal,s;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&Jr('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new vd(vd.OWNER);else if(r.mockUserToken){let o=typeof r.mockUserToken=="string"?r.mockUserToken:ra(r.mockUserToken,n.app.options.projectId);s=new vd(o)}nW(i,e,t,s)}function lF(n){n=ce(n),n._checkNotDeleted("goOffline"),U1(n._repo)}function dF(n){n=ce(n),n._checkNotDeleted("goOnline"),G9(n._repo)}function hF(n,e){jO(n,e)}function sW(n){h0(ia),ai(new Gt("database",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return z0(r,i,s,t)},"PUBLIC").setMultipleInstances(!0)),In(sO,oO,n),In(sO,oO,"esm2017")}var oW={".sv":"timestamp"};function fF(){return oW}function pF(n){return{".sv":{increment:n}}}var l0=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function gF(n,e,t){var r;if(n=ce(n),Un("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";let i=(r=t?.applyLocally)!==null&&r!==void 0?r:!0,s=new Ut,o=(c,l,d)=>{let f=null;c?s.reject(c):(f=new $c(d,new Bn(n._repo,n._path),et),s.resolve(new l0(l,f)))},a=Fm(n,()=>{});return W9(n._repo,n._path,e,o,a,i),s.promise}y0.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};y0.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};sW();var aW="@firebase/database-compat",cW="1.0.7";var uW=new Fi("@firebase/database-compat"),mF=function(n){let e="FIREBASE WARNING: "+n;uW.warn(e)};var lW=function(n,e,t,r){if(!(r&&t===void 0)&&typeof t!="boolean")throw new Error(En(n,e)+"must be a boolean.")},dW=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(En(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var G0=class{constructor(e){this._delegate=e}cancel(e){ae("OnDisconnect.cancel",0,1,arguments.length),kt("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),r=>e(r)),t}remove(e){ae("OnDisconnect.remove",0,1,arguments.length),kt("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),r=>e(r)),t}set(e,t){ae("OnDisconnect.set",1,2,arguments.length),kt("OnDisconnect.set","onComplete",t,!0);let r=this._delegate.set(e);return t&&r.then(()=>t(null),i=>t(i)),r}setWithPriority(e,t,r){ae("OnDisconnect.setWithPriority",2,3,arguments.length),kt("OnDisconnect.setWithPriority","onComplete",r,!0);let i=this._delegate.setWithPriority(e,t);return r&&i.then(()=>r(null),s=>r(s)),i}update(e,t){if(ae("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,mF("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}kt("OnDisconnect.update","onComplete",t,!0);let r=this._delegate.update(e);return t&&r.then(()=>t(null),i=>t(i)),r}};var W0=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return ae("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var zo=class n{constructor(e,t){this._database=e,this._delegate=t}val(){return ae("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return ae("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return ae("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return ae("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return ae("DataSnapshot.child",0,1,arguments.length),e=String(e),Gc("DataSnapshot.child","path",e,!1),new n(this._database,this._delegate.child(e))}hasChild(e){return ae("DataSnapshot.hasChild",1,1,arguments.length),Gc("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return ae("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return ae("DataSnapshot.forEach",1,1,arguments.length),kt("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new n(this._database,t)))}hasChildren(){return ae("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return ae("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return ae("DataSnapshot.ref",0,0,arguments.length),new Mi(this._database,this._delegate.ref)}get ref(){return this.getRef()}},Lm=class n{constructor(e,t){this.database=e,this._delegate=t}on(e,t,r,i){var s;ae("Query.on",2,4,arguments.length),kt("Query.on","callback",t,!1);let o=n.getCancelAndContextArgs_("Query.on",r,i),a=(l,d)=>{t.call(o.context,new zo(this.database,l),d)};a.userCallback=t,a.context=o.context;let c=(s=o.cancel)===null||s===void 0?void 0:s.bind(o.context);switch(e){case"value":return Fm(this._delegate,a,c),t;case"child_added":return j0(this._delegate,a,c),t;case"child_removed":return q0(this._delegate,a,c),t;case"child_changed":return B0(this._delegate,a,c),t;case"child_moved":return $0(this._delegate,a,c),t;default:throw new Error(En("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,r){if(ae("Query.off",0,3,arguments.length),dW("Query.off",e,!0),kt("Query.off","callback",t,!0),my("Query.off","context",r,!0),t){let i=()=>{};i.userCallback=t,i.context=r,H0(this._delegate,e,i)}else H0(this._delegate,e)}get(){return K1(this._delegate).then(e=>new zo(this.database,e))}once(e,t,r,i){ae("Query.once",1,4,arguments.length),kt("Query.once","callback",t,!0);let s=n.getCancelAndContextArgs_("Query.once",r,i),o=new Ut,a=(l,d)=>{let f=new zo(this.database,l);t&&t.call(s.context,f,d),o.resolve(f)};a.userCallback=t,a.context=s.context;let c=l=>{s.cancel&&s.cancel.call(s.context,l),o.reject(l)};switch(e){case"value":Fm(this._delegate,a,c,{onlyOnce:!0});break;case"child_added":j0(this._delegate,a,c,{onlyOnce:!0});break;case"child_removed":q0(this._delegate,a,c,{onlyOnce:!0});break;case"child_changed":B0(this._delegate,a,c,{onlyOnce:!0});break;case"child_moved":$0(this._delegate,a,c,{onlyOnce:!0});break;default:throw new Error(En("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return ae("Query.limitToFirst",1,1,arguments.length),new n(this.database,ir(this._delegate,J1(e)))}limitToLast(e){return ae("Query.limitToLast",1,1,arguments.length),new n(this.database,ir(this._delegate,eF(e)))}orderByChild(e){return ae("Query.orderByChild",1,1,arguments.length),new n(this.database,ir(this._delegate,tF(e)))}orderByKey(){return ae("Query.orderByKey",0,0,arguments.length),new n(this.database,ir(this._delegate,nF()))}orderByPriority(){return ae("Query.orderByPriority",0,0,arguments.length),new n(this.database,ir(this._delegate,rF()))}orderByValue(){return ae("Query.orderByValue",0,0,arguments.length),new n(this.database,ir(this._delegate,iF()))}startAt(e=null,t){return ae("Query.startAt",0,2,arguments.length),new n(this.database,ir(this._delegate,Z1(e,t)))}startAfter(e=null,t){return ae("Query.startAfter",0,2,arguments.length),new n(this.database,ir(this._delegate,X1(e,t)))}endAt(e=null,t){return ae("Query.endAt",0,2,arguments.length),new n(this.database,ir(this._delegate,Q1(e,t)))}endBefore(e=null,t){return ae("Query.endBefore",0,2,arguments.length),new n(this.database,ir(this._delegate,Y1(e,t)))}equalTo(e,t){return ae("Query.equalTo",1,2,arguments.length),new n(this.database,ir(this._delegate,sF(e,t)))}toString(){return ae("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return ae("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(ae("Query.isEqual",1,1,arguments.length),!(e instanceof n)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,r){let i={cancel:void 0,context:void 0};if(t&&r)i.cancel=t,kt(e,"cancel",i.cancel,!0),i.context=r,my(e,"context",i.context,!0);else if(t)if(typeof t=="object"&&t!==null)i.context=t;else if(typeof t=="function")i.cancel=t;else throw new Error(En(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return i}get ref(){return new Mi(this.database,new Bn(this._delegate._repo,this._delegate._path))}},Mi=class n extends Lm{constructor(e,t){super(e,new yn(t._repo,t._path,new xd,!1)),this.database=e,this._delegate=t}getKey(){return ae("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return ae("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new n(this.database,xs(this._delegate,e))}getParent(){ae("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new n(this.database,e):null}getRoot(){return ae("Reference.root",0,0,arguments.length),new n(this.database,this._delegate.root)}set(e,t){ae("Reference.set",1,2,arguments.length),kt("Reference.set","onComplete",t,!0);let r=Om(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}update(e,t){if(ae("Reference.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,mF("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Un("Reference.update",this._delegate._path),kt("Reference.update","onComplete",t,!0);let r=W1(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}setWithPriority(e,t,r){ae("Reference.setWithPriority",2,3,arguments.length),kt("Reference.setWithPriority","onComplete",r,!0);let i=G1(this._delegate,e,t);return r&&i.then(()=>r(null),s=>r(s)),i}remove(e){ae("Reference.remove",0,1,arguments.length),kt("Reference.remove","onComplete",e,!0);let t=H1(this._delegate);return e&&t.then(()=>e(null),r=>e(r)),t}transaction(e,t,r){ae("Reference.transaction",1,3,arguments.length),kt("Reference.transaction","transactionUpdate",e,!1),kt("Reference.transaction","onComplete",t,!0),lW("Reference.transaction","applyLocally",r,!0);let i=gF(this._delegate,e,{applyLocally:r}).then(s=>new W0(s.committed,new zo(this.database,s.snapshot)));return t&&i.then(s=>t(null,s.committed,s.snapshot),s=>t(s,!1,null)),i}setPriority(e,t){ae("Reference.setPriority",1,2,arguments.length),kt("Reference.setPriority","onComplete",t,!0);let r=z1(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}push(e,t){ae("Reference.push",0,2,arguments.length),kt("Reference.push","onComplete",t,!0);let r=q1(this._delegate,e),i=r.then(o=>new n(this.database,o));t&&i.then(()=>t(null),o=>t(o));let s=new n(this.database,r);return s.then=i.then.bind(i),s.catch=i.catch.bind(i,void 0),s}onDisconnect(){return Un("Reference.onDisconnect",this._delegate._path),new G0(new gm(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var Go=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:aF,forceLongPolling:cF}}useEmulator(e,t,r={}){uF(this._delegate,e,t,r)}ref(e){if(ae("database.ref",0,1,arguments.length),e instanceof Mi){let t=U0(this._delegate,e.toString());return new Mi(this,t)}else{let t=V0(this._delegate,e);return new Mi(this,t)}}refFromURL(e){ae("database.refFromURL",1,1,arguments.length);let r=U0(this._delegate,e);return new Mi(this,r)}goOffline(){return ae("database.goOffline",0,0,arguments.length),lF(this._delegate)}goOnline(){return ae("database.goOnline",0,0,arguments.length),dF(this._delegate)}};Go.ServerValue={TIMESTAMP:fF(),increment:n=>pF(n)};function hW({app:n,url:e,version:t,customAuthImpl:r,customAppCheckImpl:i,namespace:s,nodeAdmin:o=!1}){h0(t);let a=new yy("database-standalone"),c=new wh("auth-internal",a);c.setComponent(new Gt("auth-internal",()=>r,"PRIVATE"));let l;return i&&(l=new wh("app-check-internal",a),l.setComponent(new Gt("app-check-internal",()=>i,"PRIVATE"))),{instance:new Go(z0(n,c,l,e,o),n),namespace:s}}var fW=Object.freeze({__proto__:null,initStandalone:hW});var pW=Go.ServerValue;function gW(n){n.INTERNAL.registerComponent(new Gt("database-compat",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app-compat").getImmediate(),i=e.getProvider("database").getImmediate({identifier:t});return new Go(i,r)},"PUBLIC").setServiceProps({Reference:Mi,Query:Lm,Database:Go,DataSnapshot:zo,enableLogging:hF,INTERNAL:fW,ServerValue:pW}).setMultipleInstances(!0)),n.registerVersion(aW,cW)}gW(pt);function Gd(n,e,t="on",r=ui){return new ve(i=>{let s=null;return s=n[t](e,(o,a)=>{r.schedule(()=>{i.next({snapshot:o,prevKey:a})}),t==="once"&&r.schedule(()=>i.complete())},o=>{r.schedule(()=>i.error(o))}),t==="on"?{unsubscribe(){s!=null&&n.off(e,s)}}:{unsubscribe(){}}}).pipe(ee(i=>{let{snapshot:s,prevKey:o}=i,a=null;return s.exists()&&(a=s.key),{type:e,payload:s,prevKey:o,key:a}}),Au())}function mW(n){return typeof n=="string"}function yW(n){return typeof n.exportVal=="function"}function EF(n){return n==null}function IF(n){return typeof n.set=="function"}function yF(n,e){return IF(e)?e:n.ref(e)}function CF(n,e){if(mW(n))return e.stringCase();if(IF(n))return e.firebaseCase();if(yW(n))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof n}`)}function TF(n){return(EF(n)||n.length===0)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function DF(n,e,t){e=TF(e);let r=e.map(i=>Gd(n,i,"on",t));return ma(...r)}function _W(n,e,t){let r=DF(n,e).pipe(Dr((i,s)=>[...i,s],[]));return wW(n,r,t)}function vW(n,e){return Gd(n,"value","on",e).pipe(ee(t=>{let r;return t.payload.forEach(i=>(r=i.key,!1)),{data:t,lastKeyToLoad:r}}))}function wW(n,e,t){return vW(n,t).pipe(jy(e),ee(([i,s])=>{let o=i.lastKeyToLoad,a=s.map(c=>c.key);return{actions:s,lastKeyToLoad:o,loadedKeys:a}}),Vy(i=>i.loadedKeys.indexOf(i.lastKeyToLoad)===-1),ee(i=>i.actions))}function _F(n,e){return function(r,i){return CF(r,{stringCase:()=>n.child(r)[e](i),firebaseCase:()=>r[e](i),snapshotCase:()=>r.ref[e](i)})}}function EW(n){return function(t){return t?CF(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function IW(n,e,t){return Gd(n,"value","once",t).pipe(We(r=>{let i=[ne(r)];return e.forEach(s=>i.push(Gd(n,s,"on",t))),ma(...i).pipe(Dr(TW,[]))}),Du())}function bF(n,e){let t=n.length;for(let r=0;r<t;r++)if(n[r].payload.key===e)return r;return-1}function CW(n,e){if(EF(e))return 0;{let t=bF(n,e);return t===-1?n.length:t+1}}function TW(n,e){let{payload:t,prevKey:r,key:i}=e,s=bF(n,i),o=CW(n,r);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(c=>{let l={payload:c,type:"value",prevKey:a,key:c.key};return a=c.key,n=[...n,l],!1})}return n;case"child_added":if(s>-1)(n[s-1]?.key||null)!==r&&(n=n.filter(c=>c.payload.key!==t.key),n.splice(o,0,e));else{if(r==null)return[e,...n];n=n.slice(),n.splice(o,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===i?e:a);case"child_moved":if(s>-1){let a=n.splice(s,1)[0];return n=n.slice(),n.splice(o,0,a),n}return n;default:return n}}function vF(n,e,t){return e=TF(e),IW(n,e,t)}function DW(n,e){let t=e.schedulers.outsideAngular,r=e.schedulers.ngZone.run(()=>n.ref);return{query:n,update:_F(r,"update"),set:_F(r,"set"),push:i=>r.push(i),remove:EW(r),snapshotChanges(i){return vF(n,i,t).pipe(st)},stateChanges(i){return DF(n,i,t).pipe(st)},auditTrail(i){return _W(n,i,t).pipe(st)},valueChanges(i,s){return vF(n,i,t).pipe(ee(a=>a.map(c=>s&&s.idField?nt(Q({},c.payload.val()),{[s.idField]:c.key}):c.payload.val())),st)}}}function wF(n,e){return function(){return Gd(n,"value","on",e)}}function bW(n,e){return{query:n,snapshotChanges(){return wF(n,e.schedulers.outsideAngular)().pipe(st)},update(t){return n.ref.update(t)},set(t){return n.ref.set(t)},remove(){return n.ref.remove()},valueChanges(){return wF(n,e.schedulers.outsideAngular)().pipe(st,ee(r=>r.payload.exists()?r.payload.val():null))}}}var SW=new K("angularfire2.realtimeDatabaseURL"),AW=new K("angularfire2.database.use-emulator"),xW=(()=>{class n{schedulers;database;constructor(t,r,i,s,o,a,c,l,d,f,g,y,v,b,T){this.schedulers=a;let V=c,B=vi(t,o,r);l&&Tl(B,o,d,g,y,v,f,b),this.database=ts(`${B.name}.database.${i}`,"AngularFireDatabase",B.name,()=>{let O=o.runOutsideAngular(()=>B.database(i||void 0));return V&&O.useEmulator(...V),O},[V])}list(t,r){let i=this.schedulers.ngZone.runOutsideAngular(()=>yF(this.database,t)),s=i;return r&&(s=r(i)),DW(s,this)}object(t){let r=this.schedulers.ngZone.runOutsideAngular(()=>yF(this.database,t));return bW(r,this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(r){return new(r||n)(F(Ur),F(jr,8),F(SW,8),F(jt),F(De),F(Ji),F(AW,8),F(Ep,8),F(_l,8),F(vl,8),F(wl,8),F(El,8),F(Il,8),F(Cl,8),F(fr,8))};static \u0275prov=J({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),SF=(()=>{class n{constructor(){pt.registerVersion("angularfire",Vr.full,"rtdb-compat")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=wt({type:n});static \u0275inj=vt({providers:[xW]})}return n})();var FF="firebasestorage.googleapis.com",LF="storageBucket",RW=2*60*1e3,MW=10*60*1e3,NW=1e3;var ht=class n extends yh{constructor(e,t,r=0){super(K0(e),`Firebase Storage: ${t} (${K0(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,n.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return K0(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}},ut=function(n){return n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment",n}(ut||{});function K0(n){return"storage/"+n}function nD(){let n="An unknown error occurred, please check the error payload for server response.";return new ht(ut.UNKNOWN,n)}function PW(n){return new ht(ut.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function kW(n){return new ht(ut.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function OW(){let n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new ht(ut.UNAUTHENTICATED,n)}function FW(){return new ht(ut.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function LW(n){return new ht(ut.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function VF(){return new ht(ut.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function UF(){return new ht(ut.CANCELED,"User canceled the upload/download.")}function VW(n){return new ht(ut.INVALID_URL,"Invalid URL '"+n+"'.")}function UW(n){return new ht(ut.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function jW(){return new ht(ut.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+LF+"' property when initializing the app?")}function jF(){return new ht(ut.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function BW(){return new ht(ut.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function $W(){return new ht(ut.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function qW(n){return new ht(ut.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Wo(n){return new ht(ut.INVALID_ARGUMENT,n)}function BF(){return new ht(ut.APP_DELETED,"The Firebase app was deleted.")}function rD(n){return new ht(ut.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Kd(n,e){return new ht(ut.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function Wd(n){throw new ht(ut.INTERNAL_ERROR,"Internal error: "+n)}var _n=class n{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=n.makeFromUrl(e,t)}catch{return new n(e,"")}if(r.path==="")return r;throw UW(e)}static makeFromUrl(e,t){let r=null,i="([A-Za-z0-9.\\-_]+)";function s(z){z.path.charAt(z.path.length-1)==="/"&&(z.path_=z.path_.slice(0,-1))}let o="(/(.*))?$",a=new RegExp("^gs://"+i+o,"i"),c={bucket:1,path:3};function l(z){z.path_=decodeURIComponent(z.path)}let d="v[A-Za-z0-9_]+",f=t.replace(/[.]/g,"\\."),g="(/([^?#]*).*)?$",y=new RegExp(`^https?://${f}/${d}/b/${i}/o${g}`,"i"),v={bucket:1,path:3},b=t===FF?"(?:storage.googleapis.com|storage.cloud.google.com)":t,T="([^?#]*)",V=new RegExp(`^https?://${b}/${i}/${T}`,"i"),O=[{regex:a,indices:c,postModify:s},{regex:y,indices:v,postModify:l},{regex:V,indices:{bucket:1,path:2},postModify:l}];for(let z=0;z<O.length;z++){let re=O[z],Z=re.regex.exec(e);if(Z){let I=Z[re.indices.bucket],_=Z[re.indices.path];_||(_=""),r=new n(I,_),re.postModify(r);break}}if(r==null)throw VW(e);return r}},Y0=class{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}};function HW(n,e,t){let r=1,i=null,s=null,o=!1,a=0;function c(){return a===2}let l=!1;function d(...T){l||(l=!0,e.apply(null,T))}function f(T){i=setTimeout(()=>{i=null,n(y,c())},T)}function g(){s&&clearTimeout(s)}function y(T,...V){if(l){g();return}if(T){g(),d.call(null,T,...V);return}if(c()||o){g(),d.call(null,T,...V);return}r<64&&(r*=2);let O;a===1?(a=2,O=0):O=(r+Math.random())*1e3,f(O)}let v=!1;function b(T){v||(v=!0,g(),!l&&(i!==null?(T||(a=2),clearTimeout(i),f(0)):T||(a=1)))}return f(0),s=setTimeout(()=>{o=!0,b(!0)},t),b}function zW(n){n(!1)}function GW(n){return n!==void 0}function WW(n){return typeof n=="function"}function KW(n){return typeof n=="object"&&!Array.isArray(n)}function jm(n){return typeof n=="string"||n instanceof String}function AF(n){return iD()&&n instanceof Blob}function iD(){return typeof Blob<"u"}function Z0(n,e,t,r){if(r<e)throw Wo(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw Wo(`Invalid value for '${n}'. Expected ${t} or less.`)}function Ms(n,e,t){let r=e;return t==null&&(r=`https://${e}`),`${t}://${r}/v0${n}`}function $F(n){let e=encodeURIComponent,t="?";for(let r in n)if(n.hasOwnProperty(r)){let i=e(r)+"="+e(n[r]);t=t+i+"&"}return t=t.slice(0,-1),t}var Yc=function(n){return n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT",n}(Yc||{});function qF(n,e){let t=n>=500&&n<600,i=[408,429].indexOf(n)!==-1,s=e.indexOf(n)!==-1;return t||i||s}var X0=class{constructor(e,t,r,i,s,o,a,c,l,d,f,g=!0){this.url_=e,this.method_=t,this.headers_=r,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=c,this.timeout_=l,this.progressCallback_=d,this.connectionFactory_=f,this.retry=g,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((y,v)=>{this.resolve_=y,this.reject_=v,this.start_()})}start_(){let e=(r,i)=>{if(i){r(!1,new Qc(!1,null,!0));return}let s=this.connectionFactory_();this.pendingConnection_=s;let o=a=>{let c=a.loaded,l=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(c,l)};this.progressCallback_!==null&&s.addUploadProgressListener(o),s.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(o),this.pendingConnection_=null;let a=s.getErrorCode()===Yc.NO_ERROR,c=s.getStatus();if(!a||qF(c,this.additionalRetryCodes_)&&this.retry){let d=s.getErrorCode()===Yc.ABORT;r(!1,new Qc(!1,null,d));return}let l=this.successCodes_.indexOf(c)!==-1;r(!0,new Qc(l,s))})},t=(r,i)=>{let s=this.resolve_,o=this.reject_,a=i.connection;if(i.wasSuccessCode)try{let c=this.callback_(a,a.getResponse());GW(c)?s(c):s()}catch(c){o(c)}else if(a!==null){let c=nD();c.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,c)):o(c)}else if(i.canceled){let c=this.appDelete_?BF():UF();o(c)}else{let c=VF();o(c)}};this.canceled_?t(!1,new Qc(!1,null,!0)):this.backoffId_=HW(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&zW(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}},Qc=class{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}};function QW(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function YW(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function ZW(n,e){e&&(n["X-Firebase-GMPID"]=e)}function XW(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function JW(n,e,t,r,i,s,o=!0){let a=$F(n.urlParams),c=n.url+a,l=Object.assign({},n.headers);return ZW(l,e),QW(l,t),YW(l,s),XW(l,r),new X0(c,n.method,l,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,i,o)}function e6(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function t6(...n){let e=e6();if(e!==void 0){let t=new e;for(let r=0;r<n.length;r++)t.append(n[r]);return t.getBlob()}else{if(iD())return new Blob(n);throw new ht(ut.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function n6(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}function r6(n){if(typeof atob>"u")throw qW("base-64");return atob(n)}var qn={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"},Qd=class{constructor(e,t){this.data=e,this.contentType=t||null}};function sD(n,e){switch(n){case qn.RAW:return new Qd(HF(e));case qn.BASE64:case qn.BASE64URL:return new Qd(zF(n,e));case qn.DATA_URL:return new Qd(s6(e),o6(e))}throw nD()}function HF(n){let e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{let s=r,o=n.charCodeAt(++t);r=65536|(s&1023)<<10|o&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function i6(n){let e;try{e=decodeURIComponent(n)}catch{throw Kd(qn.DATA_URL,"Malformed data URL.")}return HF(e)}function zF(n,e){switch(n){case qn.BASE64:{let i=e.indexOf("-")!==-1,s=e.indexOf("_")!==-1;if(i||s)throw Kd(n,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case qn.BASE64URL:{let i=e.indexOf("+")!==-1,s=e.indexOf("/")!==-1;if(i||s)throw Kd(n,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=r6(e)}catch(i){throw i.message.includes("polyfill")?i:Kd(n,"Invalid character found")}let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}var Um=class{constructor(e){this.base64=!1,this.contentType=null;let t=e.match(/^data:([^,]+)?,/);if(t===null)throw Kd(qn.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");let r=t[1]||null;r!=null&&(this.base64=a6(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}};function s6(n){let e=new Um(n);return e.base64?zF(qn.BASE64,e.rest):i6(e.rest)}function o6(n){return new Um(n).contentType}function a6(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}var Zc=class n{constructor(e,t){let r=0,i="";AF(e)?(this.data_=e,r=e.size,i=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,t){if(AF(this.data_)){let r=this.data_,i=n6(r,e,t);return i===null?null:new n(i)}else{let r=new Uint8Array(this.data_.buffer,e,t-e);return new n(r,!0)}}static getBlob(...e){if(iD()){let t=e.map(r=>r instanceof n?r.data_:r);return new n(t6.apply(null,t))}else{let t=e.map(o=>jm(o)?sD(qn.RAW,o).data:o.data_),r=0;t.forEach(o=>{r+=o.byteLength});let i=new Uint8Array(r),s=0;return t.forEach(o=>{for(let a=0;a<o.length;a++)i[s++]=o[a]}),new n(i,!0)}}uploadData(){return this.data_}};function oD(n){let e;try{e=JSON.parse(n)}catch{return null}return KW(e)?e:null}function c6(n){if(n.length===0)return null;let e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function u6(n,e){let t=e.split("/").filter(r=>r.length>0).join("/");return n.length===0?t:n+"/"+t}function GF(n){let e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}function l6(n,e){return e}var Zt=class{constructor(e,t,r,i){this.server=e,this.local=t||e,this.writable=!!r,this.xform=i||l6}},Vm=null;function d6(n){return!jm(n)||n.length<2?n:GF(n)}function Bm(){if(Vm)return Vm;let n=[];n.push(new Zt("bucket")),n.push(new Zt("generation")),n.push(new Zt("metageneration")),n.push(new Zt("name","fullPath",!0));function e(s,o){return d6(o)}let t=new Zt("name");t.xform=e,n.push(t);function r(s,o){return o!==void 0?Number(o):o}let i=new Zt("size");return i.xform=r,n.push(i),n.push(new Zt("timeCreated")),n.push(new Zt("updated")),n.push(new Zt("md5Hash",null,!0)),n.push(new Zt("cacheControl",null,!0)),n.push(new Zt("contentDisposition",null,!0)),n.push(new Zt("contentEncoding",null,!0)),n.push(new Zt("contentLanguage",null,!0)),n.push(new Zt("contentType",null,!0)),n.push(new Zt("metadata","customMetadata",!0)),Vm=n,Vm}function h6(n,e){function t(){let r=n.bucket,i=n.fullPath,s=new _n(r,i);return e._makeStorageReference(s)}Object.defineProperty(n,"ref",{get:t})}function f6(n,e,t){let r={};r.type="file";let i=t.length;for(let s=0;s<i;s++){let o=t[s];r[o.local]=o.xform(r,e[o.server])}return h6(r,n),r}function WF(n,e,t){let r=oD(e);return r===null?null:f6(n,r,t)}function p6(n,e,t,r){let i=oD(e);if(i===null||!jm(i.downloadTokens))return null;let s=i.downloadTokens;if(s.length===0)return null;let o=encodeURIComponent;return s.split(",").map(l=>{let d=n.bucket,f=n.fullPath,g="/b/"+o(d)+"/o/"+o(f),y=Ms(g,t,r),v=$F({alt:"media",token:l});return y+v})[0]}function aD(n,e){let t={},r=e.length;for(let i=0;i<r;i++){let s=e[i];s.writable&&(t[s.server]=n[s.local])}return JSON.stringify(t)}var xF="prefixes",RF="items";function g6(n,e,t){let r={prefixes:[],items:[],nextPageToken:t.nextPageToken};if(t[xF])for(let i of t[xF]){let s=i.replace(/\/$/,""),o=n._makeStorageReference(new _n(e,s));r.prefixes.push(o)}if(t[RF])for(let i of t[RF]){let s=n._makeStorageReference(new _n(e,i.name));r.items.push(s)}return r}function m6(n,e,t){let r=oD(t);return r===null?null:g6(n,e,r)}var Er=class{constructor(e,t,r,i){this.url=e,this.method=t,this.handler=r,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}};function ri(n){if(!n)throw nD()}function $m(n,e){function t(r,i){let s=WF(n,i,e);return ri(s!==null),s}return t}function y6(n,e){function t(r,i){let s=m6(n,e,i);return ri(s!==null),s}return t}function _6(n,e){function t(r,i){let s=WF(n,i,e);return ri(s!==null),p6(s,i,n.host,n._protocol)}return t}function eu(n){function e(t,r){let i;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?i=FW():i=OW():t.getStatus()===402?i=kW(n.bucket):t.getStatus()===403?i=LW(n.path):i=r,i.status=t.getStatus(),i.serverResponse=r.serverResponse,i}return e}function qm(n){let e=eu(n);function t(r,i){let s=e(r,i);return r.getStatus()===404&&(s=PW(n.path)),s.serverResponse=i.serverResponse,s}return t}function KF(n,e,t){let r=e.fullServerUrl(),i=Ms(r,n.host,n._protocol),s="GET",o=n.maxOperationRetryTime,a=new Er(i,s,$m(n,t),o);return a.errorHandler=qm(e),a}function v6(n,e,t,r,i){let s={};e.isRoot?s.prefix="":s.prefix=e.path+"/",t&&t.length>0&&(s.delimiter=t),r&&(s.pageToken=r),i&&(s.maxResults=i);let o=e.bucketOnlyServerUrl(),a=Ms(o,n.host,n._protocol),c="GET",l=n.maxOperationRetryTime,d=new Er(a,c,y6(n,e.bucket),l);return d.urlParams=s,d.errorHandler=eu(e),d}function w6(n,e,t){let r=e.fullServerUrl(),i=Ms(r,n.host,n._protocol),s="GET",o=n.maxOperationRetryTime,a=new Er(i,s,_6(n,t),o);return a.errorHandler=qm(e),a}function E6(n,e,t,r){let i=e.fullServerUrl(),s=Ms(i,n.host,n._protocol),o="PATCH",a=aD(t,r),c={"Content-Type":"application/json; charset=utf-8"},l=n.maxOperationRetryTime,d=new Er(s,o,$m(n,r),l);return d.headers=c,d.body=a,d.errorHandler=qm(e),d}function I6(n,e){let t=e.fullServerUrl(),r=Ms(t,n.host,n._protocol),i="DELETE",s=n.maxOperationRetryTime;function o(c,l){}let a=new Er(r,i,o,s);return a.successCodes=[200,204],a.errorHandler=qm(e),a}function C6(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function QF(n,e,t){let r=Object.assign({},t);return r.fullPath=n.path,r.size=e.size(),r.contentType||(r.contentType=C6(null,e)),r}function T6(n,e,t,r,i){let s=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let O="";for(let z=0;z<2;z++)O=O+Math.random().toString().slice(2);return O}let c=a();o["Content-Type"]="multipart/related; boundary="+c;let l=QF(e,r,i),d=aD(l,t),f="--"+c+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+d+`\r
--`+c+`\r
Content-Type: `+l.contentType+`\r
\r
`,g=`\r
--`+c+"--",y=Zc.getBlob(f,r,g);if(y===null)throw jF();let v={name:l.fullPath},b=Ms(s,n.host,n._protocol),T="POST",V=n.maxUploadRetryTime,B=new Er(b,T,$m(n,t),V);return B.urlParams=v,B.headers=o,B.body=y.uploadData(),B.errorHandler=eu(e),B}var Xc=class{constructor(e,t,r,i){this.current=e,this.total=t,this.finalized=!!r,this.metadata=i||null}};function cD(n,e){let t=null;try{t=n.getResponseHeader("X-Goog-Upload-Status")}catch{ri(!1)}return ri(!!t&&(e||["active"]).indexOf(t)!==-1),t}function D6(n,e,t,r,i){let s=e.bucketOnlyServerUrl(),o=QF(e,r,i),a={name:o.fullPath},c=Ms(s,n.host,n._protocol),l="POST",d={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},f=aD(o,t),g=n.maxUploadRetryTime;function y(b){cD(b);let T;try{T=b.getResponseHeader("X-Goog-Upload-URL")}catch{ri(!1)}return ri(jm(T)),T}let v=new Er(c,l,y,g);return v.urlParams=a,v.headers=d,v.body=f,v.errorHandler=eu(e),v}function b6(n,e,t,r){let i={"X-Goog-Upload-Command":"query"};function s(l){let d=cD(l,["active","final"]),f=null;try{f=l.getResponseHeader("X-Goog-Upload-Size-Received")}catch{ri(!1)}f||ri(!1);let g=Number(f);return ri(!isNaN(g)),new Xc(g,r.size(),d==="final")}let o="POST",a=n.maxUploadRetryTime,c=new Er(t,o,s,a);return c.headers=i,c.errorHandler=eu(e),c}var MF=256*1024;function S6(n,e,t,r,i,s,o,a){let c=new Xc(0,0);if(o?(c.current=o.current,c.total=o.total):(c.current=0,c.total=r.size()),r.size()!==c.total)throw BW();let l=c.total-c.current,d=l;i>0&&(d=Math.min(d,i));let f=c.current,g=f+d,y="";d===0?y="finalize":l===d?y="upload, finalize":y="upload";let v={"X-Goog-Upload-Command":y,"X-Goog-Upload-Offset":`${c.current}`},b=r.slice(f,g);if(b===null)throw jF();function T(z,re){let Z=cD(z,["active","final"]),I=c.current+d,_=r.size(),w;return Z==="final"?w=$m(e,s)(z,re):w=null,new Xc(I,_,Z==="final",w)}let V="POST",B=e.maxUploadRetryTime,O=new Er(t,V,T,B);return O.headers=v,O.body=b.uploadData(),O.progressCallback=a||null,O.errorHandler=eu(n),O}var YF={STATE_CHANGED:"state_changed"},an={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Q0(n){switch(n){case"running":case"pausing":case"canceling":return an.RUNNING;case"paused":return an.PAUSED;case"success":return an.SUCCESS;case"canceled":return an.CANCELED;case"error":return an.ERROR;default:return an.ERROR}}var J0=class{constructor(e,t,r){if(WW(e)||t!=null||r!=null)this.next=e,this.error=t??void 0,this.complete=r??void 0;else{let s=e;this.next=s.next,this.error=s.error,this.complete=s.complete}}};function Kc(n){return(...e)=>{Promise.resolve().then(()=>n(...e))}}var NF=null,eD=class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Yc.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Yc.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Yc.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,i){if(this.sent_)throw Wd("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),i!==void 0)for(let s in i)i.hasOwnProperty(s)&&this.xhr_.setRequestHeader(s,i[s].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Wd("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Wd("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Wd("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Wd("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}},tD=class extends eD{initXhr(){this.xhr_.responseType="text"}};function ni(){return NF?NF():new tD}var Yd=class{constructor(e,t,r=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=r,this._mappings=Bm(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=i=>{if(this._request=void 0,this._chunkMultiplier=1,i._codeEquals(ut.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{let s=this.isExponentialBackoffExpired();if(qF(i.status,[]))if(s)i=VF();else{this.sleepTime=Math.max(this.sleepTime*2,NW),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=i,this._transition("error")}},this._metadataErrorHandler=i=>{this._request=void 0,i._codeEquals(ut.CANCELED)?this.completeTransitions_():(this._error=i,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((i,s)=>{this._resolve=i,this._reject=s,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){let e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([t,r])=>{switch(this._state){case"running":e(t,r);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,t)=>{let r=D6(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(r,ni,e,t);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._uploadUrl=s,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){let e=this._uploadUrl;this._resolveToken((t,r)=>{let i=b6(this._ref.storage,this._ref._location,e,this._blob),s=this._ref.storage._makeRequest(i,ni,t,r);this._request=s,s.getPromise().then(o=>{o=o,this._request=void 0,this._updateProgress(o.current),this._needToFetchStatus=!1,o.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){let e=MF*this._chunkMultiplier,t=new Xc(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken((i,s)=>{let o;try{o=S6(this._ref._location,this._ref.storage,r,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(c){this._error=c,this._transition("error");return}let a=this._ref.storage._makeRequest(o,ni,i,s,!1);this._request=a,a.getPromise().then(c=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(c.current),c.finalized?(this._metadata=c.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){MF*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{let r=KF(this._ref.storage,this._ref._location,this._mappings),i=this._ref.storage._makeRequest(r,ni,e,t);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{let r=T6(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(r,ni,e,t);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){let t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":let t=this._state==="paused";this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=UF(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){let e=Q0(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,r,i){let s=new J0(t||void 0,r||void 0,i||void 0);return this._addObserver(s),()=>{this._removeObserver(s)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){let t=this._observers.indexOf(e);t!==-1&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(t=>{this._notifyObserver(t)})}_finishPromise(){if(this._resolve!==void 0){let e=!0;switch(Q0(this._state)){case an.SUCCESS:Kc(this._resolve.bind(null,this.snapshot))();break;case an.CANCELED:case an.ERROR:let t=this._reject;Kc(t.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(Q0(this._state)){case an.RUNNING:case an.PAUSED:e.next&&Kc(e.next.bind(e,this.snapshot))();break;case an.SUCCESS:e.complete&&Kc(e.complete.bind(e))();break;case an.CANCELED:case an.ERROR:e.error&&Kc(e.error.bind(e,this._error))();break;default:e.error&&Kc(e.error.bind(e,this._error))()}}resume(){let e=this._state==="paused"||this._state==="pausing";return e&&this._transition("running"),e}pause(){let e=this._state==="running";return e&&this._transition("pausing"),e}cancel(){let e=this._state==="running"||this._state==="pausing";return e&&this._transition("canceling"),e}};var Jc=class n{constructor(e,t){this._service=e,t instanceof _n?this._location=t:this._location=_n.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new n(e,t)}get root(){let e=new _n(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return GF(this._location.path)}get storage(){return this._service}get parent(){let e=c6(this._location.path);if(e===null)return null;let t=new _n(this._location.bucket,e);return new n(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw rD(e)}};function A6(n,e,t){return n._throwIfRoot("uploadBytesResumable"),new Yd(n,new Zc(e),t)}function x6(n){let e={prefixes:[],items:[]};return ZF(n,e).then(()=>e)}function ZF(n,e,t){return M(this,null,function*(){let i=yield XF(n,{pageToken:t});e.prefixes.push(...i.prefixes),e.items.push(...i.items),i.nextPageToken!=null&&(yield ZF(n,e,i.nextPageToken))})}function XF(n,e){e!=null&&typeof e.maxResults=="number"&&Z0("options.maxResults",1,1e3,e.maxResults);let t=e||{},r=v6(n.storage,n._location,"/",t.pageToken,t.maxResults);return n.storage.makeRequestWithTokens(r,ni)}function R6(n){n._throwIfRoot("getMetadata");let e=KF(n.storage,n._location,Bm());return n.storage.makeRequestWithTokens(e,ni)}function M6(n,e){n._throwIfRoot("updateMetadata");let t=E6(n.storage,n._location,e,Bm());return n.storage.makeRequestWithTokens(t,ni)}function N6(n){n._throwIfRoot("getDownloadURL");let e=w6(n.storage,n._location,Bm());return n.storage.makeRequestWithTokens(e,ni).then(t=>{if(t===null)throw $W();return t})}function P6(n){n._throwIfRoot("deleteObject");let e=I6(n.storage,n._location);return n.storage.makeRequestWithTokens(e,ni)}function JF(n,e){let t=u6(n._location.path,e),r=new _n(n._location.bucket,t);return new Jc(n.storage,r)}function k6(n){return/^[A-Za-z]+:\/\//.test(n)}function O6(n,e){return new Jc(n,e)}function eL(n,e){if(n instanceof Zd){let t=n;if(t._bucket==null)throw jW();let r=new Jc(t,t._bucket);return e!=null?eL(r,e):r}else return e!==void 0?JF(n,e):n}function F6(n,e){if(e&&k6(e)){if(n instanceof Zd)return O6(n,e);throw Wo("To use ref(service, url), the first argument must be a Storage instance.")}else return eL(n,e)}function PF(n,e){let t=e?.[LF];return t==null?null:_n.makeFromBucketSpec(t,n)}function L6(n,e,t,r={}){n.host=`${e}:${t}`,n._protocol="http";let{mockUserToken:i}=r;i&&(n._overrideAuthToken=typeof i=="string"?i:ra(i,n.app.options.projectId))}var Zd=class{constructor(e,t,r,i,s){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=FF,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=RW,this._maxUploadRetryTime=MW,this._requests=new Set,i!=null?this._bucket=_n.makeFromBucketSpec(i,this._host):this._bucket=PF(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=_n.makeFromBucketSpec(this._url,e):this._bucket=PF(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Z0("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Z0("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){return M(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=yield e.getToken();if(t!==null)return t.accessToken}return null})}_getAppCheckToken(){return M(this,null,function*(){let e=this._appCheckProvider.getImmediate({optional:!0});return e?(yield e.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Jc(this,e)}_makeRequest(e,t,r,i,s=!0){if(this._deleted)return new Y0(BF());{let o=JW(e,this._appId,r,i,t,this._firebaseVersion,s);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}makeRequestWithTokens(e,t){return M(this,null,function*(){let[r,i]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,i).getPromise()})}},kF="@firebase/storage",OF="0.13.1";var V6="storage";function tL(n,e,t){return n=ce(n),A6(n,e,t)}function nL(n){return n=ce(n),R6(n)}function rL(n,e){return n=ce(n),M6(n,e)}function iL(n,e){return n=ce(n),XF(n,e)}function sL(n){return n=ce(n),x6(n)}function oL(n){return n=ce(n),N6(n)}function aL(n){return n=ce(n),P6(n)}function uD(n,e){return n=ce(n),F6(n,e)}function cL(n,e){return JF(n,e)}function uL(n,e,t,r={}){L6(n,e,t,r)}function U6(n,{instanceIdentifier:e}){let t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),i=n.getProvider("app-check-internal");return new Zd(t,r,i,e,ia)}function j6(){ai(new Gt(V6,U6,"PUBLIC").setMultipleInstances(!0)),In(kF,OF,""),In(kF,OF,"esm2017")}j6();var tu=class{constructor(e,t,r){this._delegate=e,this.task=t,this.ref=r}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}};var Hm=class{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new tu(this._delegate.snapshot,this,this._ref)}then(e,t){return this._delegate.then(r=>{if(e)return e(new tu(r,this,this._ref))},t)}on(e,t,r,i){let s;return t&&(typeof t=="function"?s=o=>t(new tu(o,this,this._ref)):s={next:t.next?o=>t.next(new tu(o,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,s,r||void 0,i||void 0)}},zm=class{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map(e=>new Ko(e,this._service))}get items(){return this._delegate.items.map(e=>new Ko(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}};var Ko=class n{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){let t=cL(this._delegate,e);return new n(t,this.storage)}get root(){return new n(this._delegate.root,this.storage)}get parent(){let e=this._delegate.parent;return e==null?null:new n(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new Hm(tL(this._delegate,e,t),this)}putString(e,t=qn.RAW,r){this._throwIfRoot("putString");let i=sD(t,e),s=Object.assign({},r);return s.contentType==null&&i.contentType!=null&&(s.contentType=i.contentType),new Hm(new Yd(this._delegate,new Zc(i.data,!0),s),this)}listAll(){return sL(this._delegate).then(e=>new zm(e,this.storage))}list(e){return iL(this._delegate,e||void 0).then(t=>new zm(t,this.storage))}getMetadata(){return nL(this._delegate)}updateMetadata(e){return rL(this._delegate,e)}getDownloadURL(){return oL(this._delegate)}delete(){return this._throwIfRoot("delete"),aL(this._delegate)}_throwIfRoot(e){if(this._delegate._location.path==="")throw rD(e)}};var Gm=class{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(lL(e))throw Wo("ref() expected a child path but got a URL, use refFromURL instead.");return new Ko(uD(this._delegate,e),this)}refFromURL(e){if(!lL(e))throw Wo("refFromURL() expected a full URL but got a child path, use ref() instead.");try{_n.makeFromUrl(e,this._delegate.host)}catch{throw Wo("refFromUrl() expected a valid full URL but got an invalid one.")}return new Ko(uD(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,r={}){uL(this._delegate,e,t,r)}};function lL(n){return/^[A-Za-z]+:\/\//.test(n)}var B6="@firebase/storage-compat",$6="0.3.11";var q6="storage-compat";function H6(n,{instanceIdentifier:e}){let t=n.getProvider("app-compat").getImmediate(),r=n.getProvider("storage").getImmediate({identifier:e});return new Gm(t,r)}function z6(n){let e={TaskState:an,TaskEvent:YF,StringFormat:qn,Storage:Gm,Reference:Ko};n.INTERNAL.registerComponent(new Gt(q6,H6,"PUBLIC").setServiceProps(e).setMultipleInstances(!0)),n.registerVersion(B6,$6)}z6(pt);function G6(n){return new ve(e=>{let t=o=>e.next(o),r=o=>e.error(o),i=()=>e.complete();t(n.snapshot);let s=n.on("state_changed",t);return n.then(o=>{t(o),i()},o=>{t(n.snapshot),r(o)}),function(){s()}}).pipe(ky(0))}function dL(n){let e=G6(n);return{task:n,then:n.then.bind(n),catch:n.catch.bind(n),pause:n.pause.bind(n),cancel:n.cancel.bind(n),resume:n.resume.bind(n),snapshotChanges:()=>e,percentageChanges:()=>e.pipe(ee(t=>t.bytesTransferred/t.totalBytes*100))}}function Wm(n){return{getDownloadURL:()=>ne(void 0).pipe(Lw,We(()=>n.getDownloadURL()),st),getMetadata:()=>ne(void 0).pipe(Lw,We(()=>n.getMetadata()),st),delete:()=>xe(n.delete()),child:e=>Wm(n.child(e)),updateMetadata:e=>xe(n.updateMetadata(e)),put:(e,t)=>{let r=n.put(e,t);return dL(r)},putString:(e,t,r)=>{let i=n.putString(e,t,r);return dL(i)},list:e=>xe(n.list(e)),listAll:()=>xe(n.listAll())}}var W6=new K("angularfire2.storageBucket"),K6=new K("angularfire2.storage.maxUploadRetryTime"),Q6=new K("angularfire2.storage.maxOperationRetryTime"),Y6=new K("angularfire2.storage.use-emulator"),Z6=(()=>{class n{storage;constructor(t,r,i,s,o,a,c,l,d,f){let g=vi(t,o,r);this.storage=ts(`${g.name}.storage.${i}`,"AngularFireStorage",g.name,()=>{let y=o.runOutsideAngular(()=>g.storage(i||void 0)),v=d;return v&&y.useEmulator(...v),c&&y.setMaxUploadRetryTime(c),l&&y.setMaxOperationRetryTime(l),y},[c,l])}ref(t){return Wm(this.storage.ref(t))}refFromURL(t){return Wm(this.storage.refFromURL(t))}upload(t,r,i){let s=this.storage.ref(t);return Wm(s).put(r,i)}static \u0275fac=function(r){return new(r||n)(F(Ur),F(jr,8),F(W6,8),F(jt),F(De),F(Ji),F(K6,8),F(Q6,8),F(Y6,8),F(fr,8))};static \u0275prov=J({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var X6=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275mod=wt({type:n});static \u0275inj=vt({})}return n})(),hL=(()=>{class n{constructor(){pt.registerVersion("angularfire",Vr.full,"gcs-compat")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=wt({type:n});static \u0275inj=vt({providers:[Z6],imports:[X6]})}return n})();var fL=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=wt({type:e,bootstrap:[rO]}),e.\u0275inj=vt({imports:[aR,XR,fM.initializeApp(iO.firebaseConfig),SF,Xk,hL]});let n=e;return n})();oR().bootstrapModule(fL).catch(n=>console.error(n));
